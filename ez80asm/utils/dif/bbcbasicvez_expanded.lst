        Output     Line 
040000             0001   ; --- Begin mos_api.inc ---
040000             0248   ; --- Begin equs.inc ---
040000             0312   ; --- Begin macros.inc ---
040000             0366   ; --- Begin agon_init.asm ---
000000 C3      0393 JP	_start				; Jump to start
000001 52   
000002 00   
000003 FF   
000004 FF   
000005 FF   
000006 FF   
000007 FF   
000008 49      0396 RST_08:			RST.LIS	08h				; API call
000009 CF   
00000A C9      0397 RET
00000B FF   
00000C FF   
00000D FF   
00000E FF   
00000F FF   
000010 49      0400 RST_10:			RST.LIS 10h				; Output
000011 D7   
000012 C9      0401 RET
000013 FF   
000014 FF   
000015 FF   
000016 FF   
000017 FF   
000018 49      0404 RST_18:			RST.LIS	18h				; Block Output
000019 DF   
00001A C9      0405 RET
00001B FF   
00001C FF   
00001D FF   
00001E FF   
00001F FF   
000020 FF   
000021 FF   
000022 FF   
000023 FF   
000024 FF   
000025 FF   
000026 FF   
000027 FF   
000028 FF   
000029 FF   
00002A FF   
00002B FF   
00002C FF   
00002D FF   
00002E FF   
00002F FF   
000030 FF   
000031 FF   
000032 FF   
000033 FF   
000034 FF   
000035 FF   
000036 FF   
000037 FF   
000038 FB      0415 RST_38:			EI
000039 ED      0416 RETI
00003A 4D   
00003B FF      0420 ALIGN	64
00003C FF   
00003D FF   
00003E FF   
00003F FF   
000040 4D      0422 DB	"MOS"				; Flag for MOS - to confirm this is a valid MOS command
000041 4F   
000042 53   
000043 00      0423 DB	00h				; MOS header version 0
000044 00      0424 DB	00h				; Flag for run mode (0: Z80, 1: ADL)
000045 42      0426 _exec_name:		DB	"BBCBASIC.BIN", 0		; The executable name, only used in argv
000046 42   
000047 43   
000048 42   
000049 41   
00004A 53   
00004B 49   
00004C 43   
00004D 2E   
00004E 42   
00004F 49   
000050 4E   
000051 00   
000052 5B      0431 _start:			PUSH.LIL	IY			; Preserve IY
000053 FD   
000054 E5   
000055 FD      0433 LD		IY, 0			; Preserve SPS
000056 21   
000057 00   
000058 00   
000059 FD      0434 ADD		IY, SP
00005A 39   
00005B 5B      0435 PUSH.LIL	IY
00005C FD   
00005D E5   
00005E E3      0437 EX		(SP), HL		; Get the SPS part of the return address
00005F 5B      0438 PUSH.LIL	HL
000060 E5   
000061 E3      0439 EX		(SP), HL		; And restore it for BASIC
000062 5B      0441 PUSH.LIL	AF			; Preserve the rest of the registers
000063 F5   
000064 5B      0442 PUSH.LIL	BC
000065 C5   
000066 5B      0443 PUSH.LIL	DE
000067 D5   
000068 5B      0444 PUSH.LIL	IX
000069 DD   
00006A E5   
00006B ED      0446 LD		A, MB			; Segment base
00006C 6E   
00006D DD      0447 LD		IX, argv_ptrs		; The argv array pointer address
00006E 21   
00006F 65   
000070 01   
000071 CD      0448 CALL		_set_aix24		; Convert to a 24-bit address
000072 51   
000073 01   
000074 5B      0449 PUSH.LIL	IX
000075 DD   
000076 E5   
000077 CD      0450 CALL		_parse_params		; Parse the parameters
000078 E1   
000079 00   
00007A 5B      0451 POP.LIL		IX			; IX: argv
00007B DD   
00007C E1   
00007D 06      0452 LD		B, 0			;  C: argc
00007E 00   
00007F CD      0453 CALL		_main			; Start user code
000080 9A   
000081 00   
000082 5B      0455 POP.LIL		IX			; Restore the registers
000083 DD   
000084 E1   
000085 5B      0456 POP.LIL		DE
000086 D1   
000087 5B      0457 POP.LIL		BC
000088 C1   
000089 5B      0458 POP.LIL		AF
00008A F1   
00008B EB      0460 EX		DE, HL 			; DE: Return code from BASIC
00008C 5B      0461 POP.LIL		HL 			; The SPS part of the return address
00008D E1   
00008E 5B      0462 POP.LIL		IY			; Get the preserved SPS
00008F FD   
000090 E1   
000091 FD      0463 LD		SP, IY			; Restore SPS
000092 F9   
000093 E3      0464 EX		(SP), HL		; Store the SPS part of the return address on the stack
000094 EB      0465 EX		DE, HL 			; HL: Return code from BASIC
000095 5B      0467 POP.LIL		IY			; Restore IY
000096 FD   
000097 E1   
000098 49      0468 RET.L					; Return to MOS
000099 C9   
00009A 21      0476 _main:			LD	HL, ACCS		; Clear the ACCS
00009B 00   
00009C 52   
00009D 36      0477 LD	(HL), 0
00009E 00   
00009F 79      0478 LD	A, C
0000A0 FE      0479 CP	2
0000A1 02   
0000A2 28      0480 JR	Z, _autoload		; 2 parameters = autoload
0000A3 24   
0000A4 38      0481 JR	C, _startbasic		; 1 parameter = normal start
0000A5 35   
0000A6 CD      0483 CALL	TELL
0000A7 DC   
0000A8 44   
0000A9 55      0484 DB	"Usage:\n\r"
0000AA 73   
0000AB 61   
0000AC 67   
0000AD 65   
0000AE 3A   
0000AF 0A   
0000B0 0D   
0000B1 52      0485 DB	"RUN . <filename>\n\r", 0
0000B2 55   
0000B3 4E   
0000B4 20   
0000B5 2E   
0000B6 20   
0000B7 3C   
0000B8 66   
0000B9 69   
0000BA 6C   
0000BB 65   
0000BC 6E   
0000BD 61   
0000BE 6D   
0000BF 65   
0000C0 3E   
0000C1 0A   
0000C2 0D   
0000C3 00   
0000C4 21      0486 LD	HL, 0			; The error code
0000C5 00   
0000C6 00   
0000C7 C9      0487 RET
0000C8 5B      0489 _autoload:		LD.LIL	HL, (IX+3)		; HLU: Address of filename
0000C9 DD   
0000CA 27   
0000CB 03   
0000CC 11      0490 LD	DE, ACCS		;  DE: Destination address
0000CD 00   
0000CE 52   
0000CF 5B      0491 @@:			LD.LIL	A, (HL)			; Fetch the filename byte
0000D0 7E   
0000D1 12      0492 LD	(DE), A			;
0000D2 5B      0493 INC.LIL	HL			; Increase the source pointer
0000D3 23   
0000D4 1C      0494 INC	E			; We only need to increase E as ACCS is on a page boundary
0000D5 20      0495 JR	NZ, @B			; Loop until we hit a 0 byte
0000D6 F8   
0000D7 1D      0496 DEC	E
0000D8 3E      0497 LD	A, CR
0000D9 0D   
0000DA 12      0498 LD	(DE), A			; Replace the 0 byte with a CR for BBC BASIC
0000DB E1      0500 _startbasic:		POP	 HL			; Pop the return address to init off SPS
0000DC 5B      0501 PUSH.LIL HL 			; Stack it on SPL (*BYE will use this as the return address)
0000DD E5   
0000DE C3      0502 JP	 START			; And start BASIC
0000DF F9   
0000E0 36   
0000E1 01      0512 _parse_params:		LD		BC, _exec_name		; Get the address of the app name in this segment
0000E2 45   
0000E3 00   
0000E4 CD      0513 CALL		_set_abc24		; Convert it to a 24-bit address based upon segment base
0000E5 3F   
0000E6 01   
0000E7 5B      0514 LD.LIL		(IX+0), BC		; ARGV[0] = the executable name
0000E8 DD   
0000E9 0F   
0000EA 00   
0000EB 5B      0515 INC.LIL		IX
0000EC DD   
0000ED 23   
0000EE 5B      0516 INC.LIL		IX
0000EF DD   
0000F0 23   
0000F1 5B      0517 INC.LIL		IX
0000F2 DD   
0000F3 23   
0000F4 CD      0518 CALL		_skip_spaces		; Skip HL past any leading spaces
0000F5 36   
0000F6 01   
0000F7 01      0520 LD		BC, 1			; C: ARGC = 1 - also clears out top 16 bits of BCU
0000F8 01   
0000F9 00   
0000FA 06      0521 LD		B, argv_ptrs_max - 1	; B: Maximum number of argv_ptrs
0000FB 0F   
0000FC C5      0523 _parse_params_1:	PUSH		BC			; Stack ARGC
0000FD 5B      0524 PUSH.LIL	HL			; Stack start address of token
0000FE E5   
0000FF CD      0525 CALL		_get_token		; Get the next token
000100 25   
000101 01   
000102 79      0526 LD		A, C			; A: Length of the token in characters
000103 5B      0527 POP.LIL		DE			; Start address of token (was in HL)
000104 D1   
000105 C1      0528 POP		BC			; ARGC
000106 B7      0529 OR		A			; Check for A=0 (no token found) OR at end of string
000107 C8      0530 RET		Z
000108 5B      0532 LD.LIL		(IX+0), DE		; Store the pointer to the token
000109 DD   
00010A 1F   
00010B 00   
00010C 5B      0533 PUSH.LIL	HL			; DE=HL
00010D E5   
00010E 5B      0534 POP.LIL		DE
00010F D1   
000110 CD      0535 CALL		_skip_spaces		; And skip HL past any spaces onto the next character
000111 36   
000112 01   
000113 AF      0536 XOR		A
000114 5B      0537 LD.LIL		(DE), A			; Zero-terminate the token
000115 12   
000116 5B      0538 INC.LIL		IX
000117 DD   
000118 23   
000119 5B      0539 INC.LIL		IX
00011A DD   
00011B 23   
00011C 5B      0540 INC.LIL		IX			; Advance to next pointer position
00011D DD   
00011E 23   
00011F 0C      0541 INC		C			; Increment ARGC
000120 79      0542 LD		A, C			; Check for C >= A
000121 B8      0543 CP		B
000122 38      0544 JR		C, _parse_params_1	; And loop
000123 D8   
000124 C9      0545 RET
000125 0E      0554 _get_token:		LD		C, 0			; Initialise length
000126 00   
000127 5B      0555 @@:			LD.LIL		A, (HL)			; Get the character from the parameter string
000128 7E   
000129 B7      0556 OR		A			; Exit if 0 (end of parameter string in MOS)
00012A C8      0557 RET 		Z
00012B FE      0558 CP		13			; Exit if CR (end of parameter string in BBC BASIC)
00012C 0D   
00012D C8      0559 RET		Z
00012E FE      0560 CP		' '			; Exit if space (end of token)
00012F 20   
000130 C8      0561 RET		Z
000131 5B      0562 INC.LIL		HL			; Advance to next character
000132 23   
000133 0C      0563 INC 		C			; Increment length
000134 18      0564 JR		@B
000135 F1   
000136 5B      0573 _skip_spaces:		LD.LIL		A, (HL)			; Get the character from the parameter string
000137 7E   
000138 FE      0574 CP		' '			; Exit if not space
000139 20   
00013A C0      0575 RET		NZ
00013B 5B      0576 INC.LIL		HL			; Advance to next character
00013C 23   
00013D 18      0577 JR		_skip_spaces		; Increment length
00013E F7   
00013F 5B      0586 _set_abc24:		PUSH.LIL	HL			; Preserve HL
000140 E5   
000141 5B      0587 PUSH.LIL	BC			; Stick BC onto SPL
000142 C5   
000143 5B      0588 LD.LIL		HL, 2			; HL: SP+2
000144 21   
000145 02   
000146 00   
000147 00   
000148 5B      0589 ADD.LIL		HL, SP
000149 39   
00014A 5B      0590 LD.LIL		(HL), A			; Store A in it
00014B 77   
00014C 5B      0591 POP.LIL		BC			; Fetch ammended BC
00014D C1   
00014E 5B      0592 POP.LIL		HL			; Restore HL
00014F E1   
000150 C9      0593 RET
000151 5B      0602 _set_aix24:		PUSH.LIL	IX			; Stick IX onto SPL
000152 DD   
000153 E5   
000154 5B      0603 LD.LIL		IX, 2			; IX: SP+2
000155 DD   
000156 21   
000157 02   
000158 00   
000159 00   
00015A 5B      0604 ADD.LIL		IX, SP
00015B DD   
00015C 39   
00015D 5B      0605 LD.LIL		(IX), A			; Store A in it
00015E DD   
00015F 77   
000160 00   
000161 5B      0606 POP.LIL		IX			; Fetch ammended IX
000162 DD   
000163 E1   
000164 C9      0607 RET
000165 00      0611 argv_ptrs:		BLKP	argv_ptrs_max, 0		; Storage for the argv array pointers
000166 00   
000167 00   
000168 00   
000169 00   
00016A 00   
00016B 00   
00016C 00   
00016D 00   
00016E 00   
00016F 00   
000170 00   
000171 00   
000172 00   
000173 00   
000174 00   
000175 00   
000176 00   
000177 00   
000178 00   
000179 00   
00017A 00   
00017B 00   
00017C 00   
00017D 00   
00017E 00   
00017F 00   
000180 00   
000181 00   
000182 00   
000183 00   
000184 00   
000185 00   
000186 00   
000187 00   
000188 00   
000189 00   
00018A 00   
00018B 00   
00018C 00   
00018D 00   
00018E 00   
00018F 00   
000190 00   
000191 00   
000192 00   
000193 00   
000194 00   
000195             0614   ; --- Begin agon_graphics.asm ---
000195 DD      0656 MODE_:			PUSH	IX			; Get the system vars in IX
000196 E5   
000197 3E    0001M1 LD	A, function
000198 08   
000199 49    0002M1 RST.LIS	08h
00019A CF   
00019B 5B      0658 RES.LIL	4, (IX+sysvar_vpd_pflags)
00019C DD   
00019D CB   
00019E 04   
00019F A6   
0001A0 CD      0659 CALL    EXPRI
0001A1 15   
0001A2 18   
0001A3 D9      0660 EXX
0001A4 3E    0001M1 LD      A, VAL
0001A5 16   
0001A6 CD    0002M1 CALL    OSWRCH
0001A7 93   
0001A8 05   
0001A9 7D    0001M1 LD      A, VAL
0001AA CD    0002M1 CALL    OSWRCH
0001AB 93   
0001AC 05   
0001AD 3E    0001M1 LD	A, function
0001AE 08   
0001AF 49    0002M1 RST.LIS	08h
0001B0 CF   
0001B1 5B      0664 @@:			BIT.LIL	4, (IX+sysvar_vpd_pflags)
0001B2 DD   
0001B3 CB   
0001B4 04   
0001B5 66   
0001B6 28      0665 JR	Z, @B			; Wait for the result
0001B7 F9   
0001B8 DD      0666 POP	IX
0001B9 E1   
0001BA C3      0667 JP	XEQ
0001BB 7B   
0001BC 24   
0001BD DD      0696 GETSCHR_1:		PUSH	IX			; Get the system vars in IX
0001BE E5   
0001BF 3E    0001M1 LD	A, function
0001C0 08   
0001C1 49    0002M1 RST.LIS	08h
0001C2 CF   
0001C3 5B      0698 RES.LIL	1, (IX+sysvar_vpd_pflags)
0001C4 DD   
0001C5 CB   
0001C6 04   
0001C7 8E   
0001C8 3E    0001M1 LD      A, VAL
0001C9 17   
0001CA CD    0002M1 CALL    OSWRCH
0001CB 93   
0001CC 05   
0001CD 3E    0001M1 LD      A, VAL
0001CE 00   
0001CF CD    0002M1 CALL    OSWRCH
0001D0 93   
0001D1 05   
0001D2 3E    0001M1 LD      A, VAL
0001D3 83   
0001D4 CD    0002M1 CALL    OSWRCH
0001D5 93   
0001D6 05   
0001D7 7B    0001M1 LD      A, VAL
0001D8 CD    0002M1 CALL    OSWRCH
0001D9 93   
0001DA 05   
0001DB 7A    0001M1 LD      A, VAL
0001DC CD    0002M1 CALL    OSWRCH
0001DD 93   
0001DE 05   
0001DF 7D    0001M1 LD      A, VAL
0001E0 CD    0002M1 CALL    OSWRCH
0001E1 93   
0001E2 05   
0001E3 7C    0001M1 LD      A, VAL
0001E4 CD    0002M1 CALL    OSWRCH
0001E5 93   
0001E6 05   
0001E7 5B      0706 @@:			BIT.LIL	1, (IX+sysvar_vpd_pflags)
0001E8 DD   
0001E9 CB   
0001EA 04   
0001EB 4E   
0001EC 28      0707 JR	Z, @B			; Wait for the result
0001ED F9   
0001EE 5B      0708 LD.LIL	A, (IX+sysvar_scrchar)	; Fetch the result in A
0001EF DD   
0001F0 7E   
0001F1 09   
0001F2 B7      0709 OR	A			; Check for 00h
0001F3 37      0710 SCF				; C = character map
0001F4 20      0711 JR	NZ, @F			; We have a character, so skip next bit
0001F5 01   
0001F6 AF      0712 XOR	A			; Clear carry
0001F7 DD      0713 @@:			POP	IX
0001F8 E1   
0001F9 C9      0714 RET
0001FA DD      0723 POINT_:			PUSH	IX			; Get the system vars in IX
0001FB E5   
0001FC 3E    0001M1 LD	A, function
0001FD 08   
0001FE 49    0002M1 RST.LIS	08h
0001FF CF   
000200 5B      0725 RES.LIL	2, (IX+sysvar_vpd_pflags)
000201 DD   
000202 CB   
000203 04   
000204 96   
000205 3E    0001M1 LD      A, VAL
000206 17   
000207 CD    0002M1 CALL    OSWRCH
000208 93   
000209 05   
00020A 3E    0001M1 LD      A, VAL
00020B 00   
00020C CD    0002M1 CALL    OSWRCH
00020D 93   
00020E 05   
00020F 3E    0001M1 LD      A, VAL
000210 84   
000211 CD    0002M1 CALL    OSWRCH
000212 93   
000213 05   
000214 7B    0001M1 LD      A, VAL
000215 CD    0002M1 CALL    OSWRCH
000216 93   
000217 05   
000218 7A    0001M1 LD      A, VAL
000219 CD    0002M1 CALL    OSWRCH
00021A 93   
00021B 05   
00021C 7D    0001M1 LD      A, VAL
00021D CD    0002M1 CALL    OSWRCH
00021E 93   
00021F 05   
000220 7C    0001M1 LD      A, VAL
000221 CD    0002M1 CALL    OSWRCH
000222 93   
000223 05   
000224 5B      0733 @@:			BIT.LIL	2, (IX+sysvar_vpd_pflags)
000225 DD   
000226 CB   
000227 04   
000228 56   
000229 28      0734 JR	Z, @B			; Wait for the result
00022A F9   
00022B 5B      0738 LD.LIL	A, (IX+sysvar_scrpixelIndex)
00022C DD   
00022D 7E   
00022E 16   
00022F DD      0739 POP	IX
000230 E1   
000231 C9      0740 RET
000232 CD      0746 COLOUR_:		CALL	EXPRI			; The colour / mode
000233 15   
000234 18   
000235 D9      0747 EXX
000236 7D      0748 LD	A, L
000237 32      0749 LD	(VDU_BUFFER+0), A	; Store first parameter
000238 00   
000239 52   
00023A CD      0750 CALL	NXT			; Are there any more parameters?
00023B ED   
00023C 44   
00023D FE      0751 CP	','
00023E 2C   
00023F 28      0752 JR	Z, COLOUR_1		; Yes, so we're doing a palette change next
000240 0E   
000241 3E    0001M1 LD      A, VAL
000242 11   
000243 CD    0002M1 CALL    OSWRCH
000244 93   
000245 05   
000246 3A    0001M1 LD      A, VAL
000247 00   
000248 52   
000249 CD    0002M1 CALL    OSWRCH
00024A 93   
00024B 05   
00024C C3      0756 JP	XEQ
00024D 7B   
00024E 24   
00024F CD      0758 COLOUR_1:		CALL	COMMA
000250 84   
000251 20   
000252 CD      0759 CALL	EXPRI			; Parse R (OR P)
000253 15   
000254 18   
000255 D9      0760 EXX
000256 7D      0761 LD	A, L
000257 32      0762 LD	(VDU_BUFFER+1), A
000258 01   
000259 52   
00025A CD      0763 CALL	NXT			; Are there any more parameters?
00025B ED   
00025C 44   
00025D FE      0764 CP	','
00025E 2C   
00025F 28      0765 JR	Z, COLOUR_2		; Yes, so we're doing COLOUR L,R,G,B
000260 23   
000261 3E    0001M1 LD      A, VAL
000262 13   
000263 CD    0002M1 CALL    OSWRCH
000264 93   
000265 05   
000266 3A    0001M1 LD      A, VAL
000267 00   
000268 52   
000269 CD    0002M1 CALL    OSWRCH
00026A 93   
00026B 05   
00026C 3A    0001M1 LD      A, VAL
00026D 01   
00026E 52   
00026F CD    0002M1 CALL    OSWRCH
000270 93   
000271 05   
000272 3E    0001M1 LD      A, VAL
000273 00   
000274 CD    0002M1 CALL    OSWRCH
000275 93   
000276 05   
000277 3E    0001M1 LD      A, VAL
000278 00   
000279 CD    0002M1 CALL    OSWRCH
00027A 93   
00027B 05   
00027C 3E    0001M1 LD      A, VAL
00027D 00   
00027E CD    0002M1 CALL    OSWRCH
00027F 93   
000280 05   
000281 C3      0773 JP	XEQ
000282 7B   
000283 24   
000284 CD      0775 COLOUR_2:		CALL	COMMA
000285 84   
000286 20   
000287 CD      0776 CALL	EXPRI			; Parse G
000288 15   
000289 18   
00028A D9      0777 EXX
00028B 7D      0778 LD	A, L
00028C 32      0779 LD	(VDU_BUFFER+2), A
00028D 02   
00028E 52   
00028F CD      0780 CALL	COMMA
000290 84   
000291 20   
000292 CD      0781 CALL	EXPRI			; Parse B
000293 15   
000294 18   
000295 D9      0782 EXX
000296 7D      0783 LD	A, L
000297 32      0784 LD	(VDU_BUFFER+3), A
000298 03   
000299 52   
00029A 3E    0001M1 LD      A, VAL
00029B 13   
00029C CD    0002M1 CALL    OSWRCH
00029D 93   
00029E 05   
00029F 3A    0001M1 LD      A, VAL
0002A0 00   
0002A1 52   
0002A2 CD    0002M1 CALL    OSWRCH
0002A3 93   
0002A4 05   
0002A5 3E    0001M1 LD      A, VAL
0002A6 FF   
0002A7 CD    0002M1 CALL    OSWRCH
0002A8 93   
0002A9 05   
0002AA 3A    0001M1 LD      A, VAL
0002AB 01   
0002AC 52   
0002AD CD    0002M1 CALL    OSWRCH
0002AE 93   
0002AF 05   
0002B0 3A    0001M1 LD      A, VAL
0002B1 02   
0002B2 52   
0002B3 CD    0002M1 CALL    OSWRCH
0002B4 93   
0002B5 05   
0002B6 3A    0001M1 LD      A, VAL
0002B7 03   
0002B8 52   
0002B9 CD    0002M1 CALL    OSWRCH
0002BA 93   
0002BB 05   
0002BC C3      0791 JP	XEQ
0002BD 7B   
0002BE 24   
0002BF             0794   ; --- Begin agon_gpio.asm ---
0002BF CD      0818 GPIOB_SETMODE:		CALL	SWITCH_A
0002C0 18   
0002C1 05   
0002C2 D6      0819 DW	GPIOB_M0	; Output
0002C3 02   
0002C4 FB      0820 DW	GPIOB_M1	; Input
0002C5 02   
0002C6 1B      0821 DW	GPIOB_M2	; Open Drain IO
0002C7 03   
0002C8 3B      0822 DW	GPIOB_M3	; Open Source IO
0002C9 03   
0002CA 56      0823 DW	GPIOB_M4	; Interrupt, Dual Edge
0002CB 03   
0002CC 82      0824 DW	GPIOB_M5	; Alt Function
0002CD 03   
0002CE 9D      0825 DW	GPIOB_M6	; Interrupt, Active Low
0002CF 03   
0002D0 C4      0826 DW	GPIOB_M7	; Interrupt, Active High
0002D1 03   
0002D2 E6      0827 DW	GPIOB_M8	; Interrupt, Falling Edge
0002D3 03   
0002D4 08      0828 DW	GPIOB_M9	; Interrupt, Rising Edge
0002D5 04   
0002D6 C5    0001M1 PUSH    BC
0002D7 78    0002M1 LD      A, VAL
0002D8 2F    0003M1 CPL
0002D9 4F    0004M1 LD      C, A
0002DA ED    0005M1 IN0     A, (REG)
0002DB 38   
0002DC 9B   
0002DD A1    0006M1 AND     C
0002DE ED    0007M1 OUT0    (REG), A
0002DF 39   
0002E0 9B   
0002E1 C1    0008M1 POP     BC
0002E2 C5    0001M1 PUSH    BC
0002E3 78    0002M1 LD      A, VAL
0002E4 2F    0003M1 CPL
0002E5 4F    0004M1 LD      C, A
0002E6 ED    0005M1 IN0     A, (REG)
0002E7 38   
0002E8 9C   
0002E9 A1    0006M1 AND     C
0002EA ED    0007M1 OUT0    (REG), A
0002EB 39   
0002EC 9C   
0002ED C1    0008M1 POP     BC
0002EE C5    0001M1 PUSH    BC
0002EF 78    0002M1 LD      A, VAL
0002F0 2F    0003M1 CPL
0002F1 4F    0004M1 LD      C, A
0002F2 ED    0005M1 IN0     A, (REG)
0002F3 38   
0002F4 9D   
0002F5 A1    0006M1 AND     C
0002F6 ED    0007M1 OUT0    (REG), A
0002F7 39   
0002F8 9D   
0002F9 C1    0008M1 POP     BC
0002FA C9      0835 RET
0002FB ED    0001M1 IN0     A, (REG)
0002FC 38   
0002FD 9B   
0002FE B0    0002M1 OR      VAL
0002FF ED    0003M1 OUT0    (REG), A
000300 39   
000301 9B   
000302 C5    0001M1 PUSH    BC
000303 78    0002M1 LD      A, VAL
000304 2F    0003M1 CPL
000305 4F    0004M1 LD      C, A
000306 ED    0005M1 IN0     A, (REG)
000307 38   
000308 9C   
000309 A1    0006M1 AND     C
00030A ED    0007M1 OUT0    (REG), A
00030B 39   
00030C 9C   
00030D C1    0008M1 POP     BC
00030E C5    0001M1 PUSH    BC
00030F 78    0002M1 LD      A, VAL
000310 2F    0003M1 CPL
000311 4F    0004M1 LD      C, A
000312 ED    0005M1 IN0     A, (REG)
000313 38   
000314 9D   
000315 A1    0006M1 AND     C
000316 ED    0007M1 OUT0    (REG), A
000317 39   
000318 9D   
000319 C1    0008M1 POP     BC
00031A C9      0842 RET
00031B C5    0001M1 PUSH    BC
00031C 78    0002M1 LD      A, VAL
00031D 2F    0003M1 CPL
00031E 4F    0004M1 LD      C, A
00031F ED    0005M1 IN0     A, (REG)
000320 38   
000321 9B   
000322 A1    0006M1 AND     C
000323 ED    0007M1 OUT0    (REG), A
000324 39   
000325 9B   
000326 C1    0008M1 POP     BC
000327 ED    0001M1 IN0     A, (REG)
000328 38   
000329 9C   
00032A B0    0002M1 OR      VAL
00032B ED    0003M1 OUT0    (REG), A
00032C 39   
00032D 9C   
00032E C5    0001M1 PUSH    BC
00032F 78    0002M1 LD      A, VAL
000330 2F    0003M1 CPL
000331 4F    0004M1 LD      C, A
000332 ED    0005M1 IN0     A, (REG)
000333 38   
000334 9D   
000335 A1    0006M1 AND     C
000336 ED    0007M1 OUT0    (REG), A
000337 39   
000338 9D   
000339 C1    0008M1 POP     BC
00033A C9      0849 RET
00033B ED    0001M1 IN0     A, (REG)
00033C 38   
00033D 9B   
00033E B0    0002M1 OR      VAL
00033F ED    0003M1 OUT0    (REG), A
000340 39   
000341 9B   
000342 ED    0001M1 IN0     A, (REG)
000343 38   
000344 9C   
000345 B0    0002M1 OR      VAL
000346 ED    0003M1 OUT0    (REG), A
000347 39   
000348 9C   
000349 C5    0001M1 PUSH    BC
00034A 78    0002M1 LD      A, VAL
00034B 2F    0003M1 CPL
00034C 4F    0004M1 LD      C, A
00034D ED    0005M1 IN0     A, (REG)
00034E 38   
00034F 9D   
000350 A1    0006M1 AND     C
000351 ED    0007M1 OUT0    (REG), A
000352 39   
000353 9D   
000354 C1    0008M1 POP     BC
000355 C9      0856 RET
000356 ED    0001M1 IN0     A, (REG)
000357 38   
000358 9A   
000359 B0    0002M1 OR      VAL
00035A ED    0003M1 OUT0    (REG), A
00035B 39   
00035C 9A   
00035D C5    0001M1 PUSH    BC
00035E 78    0002M1 LD      A, VAL
00035F 2F    0003M1 CPL
000360 4F    0004M1 LD      C, A
000361 ED    0005M1 IN0     A, (REG)
000362 38   
000363 9B   
000364 A1    0006M1 AND     C
000365 ED    0007M1 OUT0    (REG), A
000366 39   
000367 9B   
000368 C1    0008M1 POP     BC
000369 C5    0001M1 PUSH    BC
00036A 78    0002M1 LD      A, VAL
00036B 2F    0003M1 CPL
00036C 4F    0004M1 LD      C, A
00036D ED    0005M1 IN0     A, (REG)
00036E 38   
00036F 9C   
000370 A1    0006M1 AND     C
000371 ED    0007M1 OUT0    (REG), A
000372 39   
000373 9C   
000374 C1    0008M1 POP     BC
000375 C5    0001M1 PUSH    BC
000376 78    0002M1 LD      A, VAL
000377 2F    0003M1 CPL
000378 4F    0004M1 LD      C, A
000379 ED    0005M1 IN0     A, (REG)
00037A 38   
00037B 9D   
00037C A1    0006M1 AND     C
00037D ED    0007M1 OUT0    (REG), A
00037E 39   
00037F 9D   
000380 C1    0008M1 POP     BC
000381 C9      0864 RET
000382 ED    0001M1 IN0     A, (REG)
000383 38   
000384 9B   
000385 B0    0002M1 OR      VAL
000386 ED    0003M1 OUT0    (REG), A
000387 39   
000388 9B   
000389 C5    0001M1 PUSH    BC
00038A 78    0002M1 LD      A, VAL
00038B 2F    0003M1 CPL
00038C 4F    0004M1 LD      C, A
00038D ED    0005M1 IN0     A, (REG)
00038E 38   
00038F 9C   
000390 A1    0006M1 AND     C
000391 ED    0007M1 OUT0    (REG), A
000392 39   
000393 9C   
000394 C1    0008M1 POP     BC
000395 ED    0001M1 IN0     A, (REG)
000396 38   
000397 9D   
000398 B0    0002M1 OR      VAL
000399 ED    0003M1 OUT0    (REG), A
00039A 39   
00039B 9D   
00039C C9      0871 RET
00039D C5    0001M1 PUSH    BC
00039E 78    0002M1 LD      A, VAL
00039F 2F    0003M1 CPL
0003A0 4F    0004M1 LD      C, A
0003A1 ED    0005M1 IN0     A, (REG)
0003A2 38   
0003A3 9A   
0003A4 A1    0006M1 AND     C
0003A5 ED    0007M1 OUT0    (REG), A
0003A6 39   
0003A7 9A   
0003A8 C1    0008M1 POP     BC
0003A9 C5    0001M1 PUSH    BC
0003AA 78    0002M1 LD      A, VAL
0003AB 2F    0003M1 CPL
0003AC 4F    0004M1 LD      C, A
0003AD ED    0005M1 IN0     A, (REG)
0003AE 38   
0003AF 9B   
0003B0 A1    0006M1 AND     C
0003B1 ED    0007M1 OUT0    (REG), A
0003B2 39   
0003B3 9B   
0003B4 C1    0008M1 POP     BC
0003B5 ED    0001M1 IN0     A, (REG)
0003B6 38   
0003B7 9C   
0003B8 B0    0002M1 OR      VAL
0003B9 ED    0003M1 OUT0    (REG), A
0003BA 39   
0003BB 9C   
0003BC ED    0001M1 IN0     A, (REG)
0003BD 38   
0003BE 9D   
0003BF B0    0002M1 OR      VAL
0003C0 ED    0003M1 OUT0    (REG), A
0003C1 39   
0003C2 9D   
0003C3 C9      0879 RET
0003C4 ED    0001M1 IN0     A, (REG)
0003C5 38   
0003C6 9A   
0003C7 B0    0002M1 OR      VAL
0003C8 ED    0003M1 OUT0    (REG), A
0003C9 39   
0003CA 9A   
0003CB C5    0001M1 PUSH    BC
0003CC 78    0002M1 LD      A, VAL
0003CD 2F    0003M1 CPL
0003CE 4F    0004M1 LD      C, A
0003CF ED    0005M1 IN0     A, (REG)
0003D0 38   
0003D1 9B   
0003D2 A1    0006M1 AND     C
0003D3 ED    0007M1 OUT0    (REG), A
0003D4 39   
0003D5 9B   
0003D6 C1    0008M1 POP     BC
0003D7 ED    0001M1 IN0     A, (REG)
0003D8 38   
0003D9 9C   
0003DA B0    0002M1 OR      VAL
0003DB ED    0003M1 OUT0    (REG), A
0003DC 39   
0003DD 9C   
0003DE ED    0001M1 IN0     A, (REG)
0003DF 38   
0003E0 9D   
0003E1 B0    0002M1 OR      VAL
0003E2 ED    0003M1 OUT0    (REG), A
0003E3 39   
0003E4 9D   
0003E5 C9      0888 RET
0003E6 C5    0001M1 PUSH    BC
0003E7 78    0002M1 LD      A, VAL
0003E8 2F    0003M1 CPL
0003E9 4F    0004M1 LD      C, A
0003EA ED    0005M1 IN0     A, (REG)
0003EB 38   
0003EC 9A   
0003ED A1    0006M1 AND     C
0003EE ED    0007M1 OUT0    (REG), A
0003EF 39   
0003F0 9A   
0003F1 C1    0008M1 POP     BC
0003F2 ED    0001M1 IN0     A, (REG)
0003F3 38   
0003F4 9B   
0003F5 B0    0002M1 OR      VAL
0003F6 ED    0003M1 OUT0    (REG), A
0003F7 39   
0003F8 9B   
0003F9 ED    0001M1 IN0     A, (REG)
0003FA 38   
0003FB 9C   
0003FC B0    0002M1 OR      VAL
0003FD ED    0003M1 OUT0    (REG), A
0003FE 39   
0003FF 9C   
000400 ED    0001M1 IN0     A, (REG)
000401 38   
000402 9D   
000403 B0    0002M1 OR      VAL
000404 ED    0003M1 OUT0    (REG), A
000405 39   
000406 9D   
000407 C9      0897 RET
000408 ED    0001M1 IN0     A, (REG)
000409 38   
00040A 9A   
00040B B0    0002M1 OR      VAL
00040C ED    0003M1 OUT0    (REG), A
00040D 39   
00040E 9A   
00040F ED    0001M1 IN0     A, (REG)
000410 38   
000411 9B   
000412 B0    0002M1 OR      VAL
000413 ED    0003M1 OUT0    (REG), A
000414 39   
000415 9B   
000416 ED    0001M1 IN0     A, (REG)
000417 38   
000418 9C   
000419 B0    0002M1 OR      VAL
00041A ED    0003M1 OUT0    (REG), A
00041B 39   
00041C 9C   
00041D ED    0001M1 IN0     A, (REG)
00041E 38   
00041F 9D   
000420 B0    0002M1 OR      VAL
000421 ED    0003M1 OUT0    (REG), A
000422 39   
000423 9D   
000424 C9      0905 RET
000425             0908   ; --- Begin agon_interrupt.asm ---
000425 F3      0937 VBLANK_INIT:		DI
000426 ED      0939 LD		A, MB 				; Get a 24-bit pointer to
000427 6E   
000428 21      0940 LD		HL, VBLANK_HANDLER		; this interrupt handler routine who's
000429 A3   
00042A 04   
00042B CD      0941 CALL		SET_AHL16 			; address is a 16-bit pointer in BBC BASIC's segment
00042C 65   
00042D 04   
00042E 1E      0943 LD		E, 32h				; Set up the VBlank Interrupt Vector
00042F 32   
000430 3E    0001M1 LD	A, function
000431 14   
000432 49    0002M1 RST.LIS	08h
000433 CF   
000434 5B      0946 PUSH.LIL	HL				; HLU: Pointer to the MOS interrupt vector
000435 E5   
000436 5B      0947 POP.LIL		DE 				; DEU: Pointer to the MOS interrupt vector
000437 D1   
000438 21      0949 LD		HL, VBLANK_HANDLER_JP + 1	; Pointer to the JP address in this segment
000439 BB   
00043A 04   
00043B ED      0950 LD		A, MB	 			; Get the segment BBC BASIC is running in
00043C 6E   
00043D 32      0951 LD		(VBLANK_HANDLER_MB + 1), A 	; Store in the interrupt handler
00043E AC   
00043F 04   
000440 CD      0952 CALL		SET_AHL16 			; Convert pointer to an absolute 24-bit address
000441 65   
000442 04   
000443 5B      0953 LD.LIL		(HL), DE			; Self-modify the code
000444 ED   
000445 1F   
000446 FB      0954 EI
000447 C9      0955 RET
000448 F3      0959 VBLANK_STOP:		DI
000449 21      0960 LD		HL, VBLANK_HANDLER_JP + 1	; Pointer to the JP address in this segment
00044A BB   
00044B 04   
00044C 3A      0961 LD		A, (VBLANK_HANDLER_MB + 1)	; The stored MB of the segment BBC BASIC is running in
00044D AC   
00044E 04   
00044F F5      0962 PUSH		AF 				; Stack the MB for later
000450 CD      0963 CALL		SET_AHL16			; Convert pointer to an absolute 24-bit address
000451 65   
000452 04   
000453 5B      0964 LD.LIL		DE, (HL)			; DEU: Address of MOS interrupt vector
000454 ED   
000455 17   
000456 5B      0965 PUSH.LIL	DE				; Transfer to HL
000457 D5   
000458 5B      0966 POP.LIL		HL
000459 E1   
00045A 1E      0967 LD		E, 32h
00045B 32   
00045C 3E    0001M1 LD	A, function
00045D 14   
00045E 49    0002M1 RST.LIS	08h
00045F CF   
000460 F1      0969 POP		AF 				; Restore MB to this segment
000461 ED      0970 LD		MB, A
000462 6D   
000463 FB      0971 EI
000464 C9      0972 RET
000465 5B      0976 SET_AHL16:		PUSH.LIL	HL
000466 E5   
000467 5B      0977 LD.LIL		HL, 2
000468 21   
000469 02   
00046A 00   
00046B 00   
00046C 5B      0978 ADD.LIL		HL, SP
00046D 39   
00046E 5B      0979 LD.LIL		(HL), A
00046F 77   
000470 5B      0980 POP.LIL		HL
000471 E1   
000472 C9      0981 RET
000473 3E    0001M1 LD	A, function
000474 08   
000475 49    0002M1 RST.LIS	08h
000476 CF   
000477 21      0986 LD		HL, KEYCOUNT 			; Check whether the keycount has changed
000478 F8   
000479 50   
00047A 5B      0987 LD.LIL		A, (IX + sysvar_vkeycount)	; by comparing the MOS copy
00047B DD   
00047C 7E   
00047D 19   
00047E BE      0988 CP 		(HL)				; with our local copy
00047F 20      0989 JR		NZ, DO_KEYBOARD_1		; Yes it has, so jump to the next bit
000480 09   
000481 AF      0991 DO_KEYBOARD_0:		XOR		A 				; Clear the keyboard values
000482 32      0992 LD		(KEYASCII), A
000483 F7   
000484 50   
000485 32      0993 LD		(KEYDOWN), A
000486 F6   
000487 50   
000488 5B      0994 RET.LIL 					; And return
000489 C9   
00048A 77      0996 DO_KEYBOARD_1:		LD		(HL), A 			; Store the updated local copy of keycount
00048B 5B      0997 LD.LIL		A, (IX + sysvar_vkeydown)	; Fetch key down value (1 = key down, 0 = key up)
00048C DD   
00048D 7E   
00048E 18   
00048F B7      0998 OR		A
000490 28      0999 JR		Z, DO_KEYBOARD_0		; If it is key up, then clear the keyboard values
000491 EF   
000492 32      1001 LD		(KEYDOWN), A 			; Store the keydown value
000493 F6   
000494 50   
000495 5B      1002 LD.LIL		A, (IX + sysvar_keyascii)	; Fetch key ASCII value
000496 DD   
000497 7E   
000498 05   
000499 32      1003 LD		(KEYASCII), A 			; Store locally
00049A F7   
00049B 50   
00049C FE      1004 CP		1Bh				; Is it escape?
00049D 1B   
00049E CC      1005 CALL		Z, ESCSET			; Yes, so set the escape flags
00049F F8   
0004A0 05   
0004A1 49      1006 RET.LIS						; Return to the interrupt handler
0004A2 C9   
0004A3 F3      1013 VBLANK_HANDLER:		DI
0004A4 F5      1014 PUSH		AF
0004A5 E5      1015 PUSH		HL
0004A6 DD      1016 PUSH		IX
0004A7 E5   
0004A8 ED      1017 LD		A, MB
0004A9 6E   
0004AA F5      1018 PUSH		AF
0004AB 3E      1019 VBLANK_HANDLER_MB:	LD		A, 0				; This is self-modified by VBLANK_INIT
0004AC 00   
0004AD ED      1020 LD		MB, A
0004AE 6D   
0004AF 49      1021 CALL.LIS	DO_KEYBOARD
0004B0 CD   
0004B1 73   
0004B2 04   
0004B3 F1      1022 POP		AF
0004B4 ED      1023 LD		MB, A
0004B5 6D   
0004B6 DD      1024 POP		IX
0004B7 E1   
0004B8 E1      1025 POP		HL
0004B9 F1      1026 POP		AF
0004BA C3      1030 VBLANK_HANDLER_JP:	JP		0				; This is self-modified by VBLANK_INIT
0004BB 00   
0004BC 00   
0004BD 00   
0004BE             1033   ; --- Begin agon_misc.asm ---
0004BE C5      1072 ASC_TO_NUMBER:		PUSH	BC			; Preserve BC
0004BF 11      1073 LD	DE, 0			; Initialise DE
0004C0 00   
0004C1 00   
0004C2 CD      1074 CALL	SKIPSPmisc			; Skip whitespace
0004C3 02   
0004C4 05   
0004C5 7E      1075 LD	A, (HL)			; Read first character
0004C6 FE      1076 CP	'&'			; Is it prefixed with '&' (HEX number)?
0004C7 26   
0004C8 20      1077 JR	NZ, ASC_TO_NUMBER3	; Jump to decimal parser if not
0004C9 1E   
0004CA 23      1078 INC	HL			; Otherwise fall through to ASC_TO_HEX
0004CB 7E      1080 ASC_TO_NUMBER1:		LD	A, (HL)			; Fetch the character
0004CC CD      1081 CALL    UPPRCmisc			; Convert to uppercase
0004CD 10   
0004CE 05   
0004CF D6      1082 SUB	'0'			; Normalise to 0
0004D0 30   
0004D1 38      1083 JR 	C, ASC_TO_NUMBER4	; Return if < ASCII '0'
0004D2 2E   
0004D3 FE      1084 CP 	10			; Check if >= 10
0004D4 0A   
0004D5 38      1085 JR 	C,ASC_TO_NUMBER2	; No, so skip next bit
0004D6 06   
0004D7 D6      1086 SUB 	7			; Adjust ASCII A-F to nibble
0004D8 07   
0004D9 FE      1087 CP 	16			; Check for > F
0004DA 10   
0004DB 30      1088 JR 	NC, ASC_TO_NUMBER4	; Return if out of range
0004DC 24   
0004DD EB      1089 ASC_TO_NUMBER2:		EX 	DE, HL 			; Shift DE left 4 times
0004DE 29      1090 ADD	HL, HL
0004DF 29      1091 ADD	HL, HL
0004E0 29      1092 ADD	HL, HL
0004E1 29      1093 ADD	HL, HL
0004E2 EB      1094 EX	DE, HL
0004E3 B3      1095 OR      E			; OR the new digit in to the least significant nibble
0004E4 5F      1096 LD      E, A
0004E5 23      1097 INC     HL			; Onto the next character
0004E6 18      1098 JR      ASC_TO_NUMBER1		; And loop
0004E7 E3   
0004E8 7E      1100 ASC_TO_NUMBER3:		LD	A, (HL)
0004E9 D6      1101 SUB	'0'			; Normalise to 0
0004EA 30   
0004EB 38      1102 JR	C, ASC_TO_NUMBER4	; Return if < ASCII '0'
0004EC 14   
0004ED FE      1103 CP	10			; Check if >= 10
0004EE 0A   
0004EF 30      1104 JR	NC, ASC_TO_NUMBER4	; Return if >= 10
0004F0 10   
0004F1 EB      1105 EX 	DE, HL 			; Stick DE in HL
0004F2 44      1106 LD	B, H 			; And copy HL into BC
0004F3 4D      1107 LD	C, L
0004F4 29      1108 ADD	HL, HL 			; x 2
0004F5 29      1109 ADD	HL, HL 			; x 4
0004F6 09      1110 ADD	HL, BC 			; x 5
0004F7 29      1111 ADD	HL, HL 			; x 10
0004F8 EB      1112 EX	DE, HL
0004F9 83    0001M1 ADD     A, E
0004FA 5F    0002M1 LD      E, A
0004FB 8A    0003M1 ADC     A, D
0004FC 93    0004M1 SUB     E
0004FD 57    0005M1 LD      D, A
0004FE 23      1114 INC	HL
0004FF 18      1115 JR	ASC_TO_NUMBER3
000500 E7   
000501 C1      1116 ASC_TO_NUMBER4:		POP	BC 			; Fall through to SKIPSP here
000502 7E      1121 SKIPSPmisc:			LD      A, (HL)
000503 FE      1122 CP      ' '
000504 20   
000505 C0      1123 RET     NZ
000506 23      1124 INC     HL
000507 18      1125 JR      SKIPSPmisc
000508 F9   
000509 7E      1130 SKIPNOTSP:		LD	A, (HL)
00050A FE      1131 CP	' '
00050B 20   
00050C C8      1132 RET	Z
00050D 23      1133 INC	HL
00050E 18      1134 JR	SKIPNOTSP
00050F F9   
000510 E6      1139 UPPRCmisc:  		AND     7FH
000511 7F   
000512 FE      1140 CP      '`'
000513 60   
000514 D8      1141 RET     C
000515 E6      1142 AND     5FH			; Convert to upper case
000516 5F   
000517 C9      1143 RET
000518 E3      1148 SWITCH_A:		EX	(SP), HL		; Swap HL with the contents of the top of the stack
000519 87      1149 ADD	A, A			; Multiply A by two
00051A 85    0001M1 ADD     A, L
00051B 6F    0002M1 LD      L, A
00051C 8C    0003M1 ADC     A, H
00051D 95    0004M1 SUB     L
00051E 67    0005M1 LD      H, A
00051F 7E      1151 LD	A, (HL)			; follow the call. Fetch an address from the
000520 23      1152 INC	HL 			; table.
000521 66      1153 LD	H, (HL)
000522 6F      1154 LD	L, A
000523 E3      1155 EX	(SP), HL		; Swap this new address back, restores HL
000524 C9      1156 RET				; Return program control to this new address
000525 C5      1161 NULLTOCR:		PUSH 	BC
000526 06      1162 LD	B, 0
000527 00   
000528 0E      1163 LD	C, CR
000529 0D   
00052A 18      1164 JR	CRTONULL0
00052B 05   
00052C C5      1166 CRTONULL:		PUSH	BC
00052D 06      1167 LD	B, CR
00052E 0D   
00052F 0E      1168 LD	C, 0
000530 00   
000531 E5      1170 CRTONULL0:		PUSH	HL
000532 7E      1171 CRTONULL1:		LD	A, (HL)
000533 B8      1172 CP 	B
000534 28      1173 JR	Z, CRTONULL2
000535 03   
000536 23      1174 INC	HL
000537 18      1175 JR	CRTONULL1
000538 F9   
000539 71      1176 CRTONULL2:		LD	(HL), C
00053A E1      1177 POP 	HL
00053B C1      1178 POP	BC
00053C C9      1179 RET
00053D 7E      1185 CSTR_FNAME:		LD	A, (HL)			; Get source
00053E FE      1186 CP	32			; Is it space
00053F 20   
000540 28      1187 JR	Z, @F
000541 09   
000542 FE      1188 CP	CR			; Or is it CR
000543 0D   
000544 28      1189 JR	Z, @F
000545 05   
000546 12      1190 LD	(DE), A			; No, so store
000547 23      1191 INC	HL			; Increment
000548 13      1192 INC	DE
000549 18      1193 JR	CSTR_FNAME		; And loop
00054A F2   
00054B AF      1194 @@:			XOR	A			; Zero terminate the target string
00054C 12      1195 LD	(DE), A
00054D 13      1196 INC	DE			; And point to next free address
00054E C9      1197 RET
00054F 7E      1203 CSTR_LINE:		LD	A, (HL)			; Get source
000550 FE      1204 CP	CR			; Is it CR
000551 0D   
000552 28      1205 JR	Z, @F
000553 05   
000554 12      1206 LD	(DE), A			; No, so store
000555 23      1207 INC	HL			; Increment
000556 13      1208 INC	DE
000557 18      1209 JR	CSTR_LINE		; And loop
000558 F6   
000559 AF      1210 @@:			XOR	A			; Zero terminate the target string
00055A 12      1211 LD	(DE), A
00055B 13      1212 INC	DE			; And point to next free address
00055C C9      1213 RET
00055D 7E      1221 CSTR_FINDCH:		LD	A, (HL)			; Get source
00055E B9      1222 CP	C			; Is it our character?
00055F C8      1223 RET	Z			; Yes, so exit
000560 B7      1224 OR	A			; Is it the end of string?
000561 C8      1225 RET	Z			; Yes, so exit
000562 23      1226 INC	HL
000563 18      1227 JR	CSTR_FINDCH
000564 F8   
000565 7E      1235 CSTR_ENDSWITH:		LD	A, (HL)			; Get the source string byte
000566 CD      1236 CALL	UPPRCmisc			; Convert to upper case
000567 10   
000568 05   
000569 4F      1237 LD	C, A
00056A 1A      1238 LD	A, (DE)			; Get the substring byte
00056B B9      1239 CP	C
00056C C0      1240 RET	NZ			; Return NZ if at any point the strings don't match
00056D B1      1241 OR	C			; Check whether both bytes are zero
00056E C8      1242 RET	Z			; If so, return, as we have reached the end of both strings
00056F 23      1243 INC	HL
000570 13      1244 INC	DE
000571 18      1245 JR	CSTR_ENDSWITH		; And loop
000572 F2   
000573 7E      1251 CSTR_CAT:		LD	A, (HL)			; Loop until we find the end of the first string
000574 B7      1252 OR	A
000575 28      1253 JR	Z, CSTR_CAT_1
000576 03   
000577 23      1254 INC	HL
000578 18      1255 JR	CSTR_CAT
000579 F9   
00057A 1A      1257 CSTR_CAT_1:		LD	A, (DE)			; Copy the second string onto the end of the first string
00057B 77      1258 LD	(HL), A
00057C B7      1259 OR	A			; Check for end of string
00057D C8      1260 RET	Z			; And return
00057E 23      1261 INC	HL
00057F 13      1262 INC	DE
000580 18      1263 JR	CSTR_CAT_1		; Loop until finished
000581 F8   
000582             1266   ; --- Begin agon_os.asm ---
000582 CD      1364 OSINIT:			CALL	VBLANK_INIT
000583 25   
000584 04   
000585 AF      1365 XOR	A
000586 32      1366 LD	(FLAGS), A		; Clear flags and set F = Z
000587 F1   
000588 50   
000589 21      1367 LD 	HL, USER
00058A 00   
00058B 55   
00058C 11      1368 LD	DE, RAM_Top
00058D 00   
00058E FF   
00058F 5F      1369 LD	E, A			; Page boundary
000590 C9      1370 RET
000591 3E      1374 PROMPT: 		LD	A,'>'			; Falls through to OSWRCH
000592 3E   
000593 E5      1380 OSWRCH:			PUSH	HL
000594 21      1381 LD	HL, LISTON		; Fetch the LISTON variable
000595 FE   
000596 54   
000597 CB      1382 BIT	3, (HL)			; Check whether we are in *EDIT mode
000598 5E   
000599 20      1383 JR	NZ, OSWRCH_BUFFER	; Yes, so just output to buffer
00059A 0A   
00059B 2A      1385 LD	HL, (OSWRCHCH)		; L: Channel #
00059C F4   
00059D 50   
00059E 2D      1386 DEC	L			; If it is 1
00059F 28      1387 JR	Z, OSWRCH_FILE		; Then we are outputting to a file
0005A0 17   
0005A1 E1      1389 POP	HL			; Otherwise
0005A2 49      1390 RST.LIS	10h			; Output the character to MOS
0005A3 D7   
0005A4 C9      1391 RET
0005A5 2A      1393 OSWRCH_BUFFER:		LD	HL, (OSWRCHPT)		; Fetch the pointer buffer
0005A6 F2   
0005A7 50   
0005A8 FE      1394 CP	0AH			; Just ignore this
0005A9 0A   
0005AA 28      1395 JR	Z, OSWRCH_BUFFER2
0005AB 0A   
0005AC FE      1396 CP	0DH			; Is it the end of line?
0005AD 0D   
0005AE 20      1397 JR	NZ, OSWRCH_BUFFER1	; No, so carry on
0005AF 01   
0005B0 AF      1398 XOR	A			; Turn it into a NUL character
0005B1 77      1399 OSWRCH_BUFFER1:		LD	(HL), A			; Echo the character into the buffer
0005B2 23      1400 INC	HL			; Increment pointer
0005B3 22      1401 LD	(OSWRCHPT), HL		; Write pointer back
0005B4 F2   
0005B5 50   
0005B6 E1      1402 OSWRCH_BUFFER2:		POP	HL
0005B7 C9      1403 RET
0005B8 D5      1405 OSWRCH_FILE:		PUSH	DE
0005B9 5C      1406 LD	E, H			; Filehandle to E
0005BA CD      1407 CALL	OSBPUT			; Write the byte out
0005BB 45   
0005BC 06   
0005BD D1      1408 POP	DE
0005BE E1      1409 POP	HL
0005BF C9      1410 RET
0005C0 3E    0001M1 LD	A, function
0005C1 00   
0005C2 49    0002M1 RST.LIS	08h
0005C3 CF   
0005C4 FE      1415 CP	1Bh
0005C5 1B   
0005C6 28      1416 JR	Z, LTRAP1
0005C7 55   
0005C8 C9      1417 RET
0005C9 1E      1421 OSLINE:			LD 	E, 1			; Default is to clear the buffer
0005CA 01   
0005CB FD      1430 OSLINE1:		PUSH	IY
0005CC E5   
0005CD E5      1431 PUSH	HL			; Buffer address
0005CE 01      1432 LD	BC, 256			; Buffer length
0005CF 00   
0005D0 01   
0005D1 3E    0001M1 LD	A, function
0005D2 09   
0005D3 49    0002M1 RST.LIS	08h
0005D4 CF   
0005D5 E1      1434 POP	HL			; Pop the address
0005D6 FD      1435 POP	IY
0005D7 E1   
0005D8 F5      1436 PUSH	AF			; Stack the return value (key pressed)
0005D9 CD      1437 CALL	NULLTOCR		; Turn the 0 character to a CR
0005DA 25   
0005DB 05   
0005DC CD      1438 CALL	CRLF			; Display CRLF
0005DD DD   
0005DE 40   
0005DF F1      1439 POP	AF
0005E0 FE      1440 CP	1Bh 			; Check if ESC terminated the input
0005E1 1B   
0005E2 CA      1441 JP	Z, LTRAP1 		; Yes, so do the ESC thing
0005E3 1D   
0005E4 06   
0005E5 3A      1442 LD	A, (FLAGS)		; Otherwise
0005E6 F1   
0005E7 50   
0005E8 CB      1443 RES	7, A 			; Clear the escape flag
0005E9 BF   
0005EA 32      1444 LD	(FLAGS), A
0005EB F1   
0005EC 50   
0005ED CD      1445 CALL	WAIT_VBLANK 		; Wait a frame
0005EE 6D   
0005EF 0A   
0005F0 AF      1446 XOR	A			; Return A = 0
0005F1 32      1447 LD	(KEYDOWN), A
0005F2 F6   
0005F3 50   
0005F4 32      1448 LD	(KEYASCII), A
0005F5 F7   
0005F6 50   
0005F7 C9      1449 RET
0005F8 E5      1455 ESCSET: 		PUSH    HL
0005F9 21      1456 LD      HL,FLAGS		; Pointer to FLAGS
0005FA F1   
0005FB 50   
0005FC CB      1457 BIT     6,(HL)			; If bit 6 is set, then
0005FD 76   
0005FE 20      1458 JR      NZ,ESCDIS		; escape is disabled, so skip
0005FF 02   
000600 CB      1459 SET     7,(HL)			; Set bit 7, the escape flag
000601 FE   
000602 E1      1460 ESCDIS: 		POP     HL
000603 C9      1461 RET
000604 CD      1467 ESCTEST:		CALL	READKEY			; Read the keyboard
000605 0D   
000606 06   
000607 C0      1468 RET	NZ			; Skip if no key is pressed
000608 FE      1469 CP	1BH			; If ESC pressed then
000609 1B   
00060A 28      1470 JR	Z,ESCSET		; jump to the escape set routine
00060B EC   
00060C C9      1471 RET
00060D 3A      1478 READKEY:		LD	A, (KEYDOWN)		; Get key down
00060E F6   
00060F 50   
000610 3D      1479 DEC	A 			; Set Z flag if keydown is 1
000611 3A      1480 LD	A, (KEYASCII)		; Get key ASCII value
000612 F7   
000613 50   
000614 C9      1481 RET
000615 CD      1486 TRAP:			CALL	ESCTEST			; Read keyboard, test for ESC, set FLAGS
000616 04   
000617 06   
000618 3A      1488 LTRAP:			LD	A,(FLAGS)		; Get FLAGS
000619 F1   
00061A 50   
00061B B7      1489 OR	A			; This checks for bit 7; if it is not set then the result will
00061C F0      1490 RET	P			; be positive (bit 7 is the sign bit in Z80), so return
00061D 21      1491 LTRAP1:			LD	HL,FLAGS 		; Escape is pressed at this point, so
00061E F1   
00061F 50   
000620 CB      1492 RES	7,(HL)			; Clear the escape pressed flag and
000621 BE   
000622 C3      1493 JP	ESCAPE			; Jump to the ESCAPE error routine in exec.asm
000623 C5   
000624 25   
000625 C9      1497 RESET:			RET				; Yes this is fine
000626 0E      1508 OSOPEN:			LD	C, fa_read
000627 01   
000628 28      1509 JR	Z, @F
000629 06   
00062A 0E      1510 LD	C, fa_write | fa_open_append
00062B 32   
00062C 38      1511 JR	C, @F
00062D 02   
00062E 0E      1512 LD	C, fa_write | fa_create_always
00062F 0A   
000630 3E    0001M1 LD	A, function
000631 0A   
000632 49    0002M1 RST.LIS	08h
000633 CF   
000634 C9      1514 RET
000635 C5      1521 OSSHUT:			PUSH	BC
000636 4B      1522 LD	C, E
000637 3E    0001M1 LD	A, function
000638 0B   
000639 49    0002M1 RST.LIS	08h
00063A CF   
00063B C1      1524 POP	BC
00063C C9      1525 RET
00063D C5      1534 OSBGET:			PUSH	BC
00063E 4B      1535 LD	C, E
00063F 3E    0001M1 LD	A, function
000640 0C   
000641 49    0002M1 RST.LIS	08h
000642 CF   
000643 C1      1537 POP	BC
000644 C9      1538 RET
000645 C5      1545 OSBPUT:			PUSH	BC
000646 4B      1546 LD	C, E
000647 47      1547 LD	B, A
000648 3E    0001M1 LD	A, function
000649 0D   
00064A 49    0002M1 RST.LIS	08h
00064B CF   
00064C C1      1549 POP	BC
00064D C9      1550 RET
00064E C5      1559 OSSTAT:			PUSH	BC
00064F 4B      1560 LD	C, E
000650 3E    0001M1 LD	A, function
000651 0E   
000652 49    0002M1 RST.LIS	08h
000653 CF   
000654 C1      1562 POP	BC
000655 FE      1563 CP	1
000656 01   
000657 C9      1564 RET
000658 FD      1572 GETPTR:			PUSH		IY
000659 E5   
00065A 4B      1573 LD		C, E
00065B 3E    0001M1 LD	A, function
00065C 19   
00065D 49    0002M1 RST.LIS	08h
00065E CF   
00065F 5B      1575 PUSH.LIL	HL
000660 E5   
000661 5B      1576 POP.LIL		IY		; IYU: Pointer to FIL structure
000662 FD   
000663 E1   
000664 5B      1577 LD.LIL		L, (IY + FIL.fptr + 0)
000665 FD   
000666 6E   
000667 11   
000668 5B      1578 LD.LIL		H, (IY + FIL.fptr + 1)
000669 FD   
00066A 66   
00066B 12   
00066C 5B      1579 LD.LIL		E, (IY + FIL.fptr + 2)
00066D FD   
00066E 5E   
00066F 13   
000670 5B      1580 LD.LIL		D, (IY + FIL.fptr + 3)
000671 FD   
000672 56   
000673 14   
000674 FD      1581 POP		IY
000675 E1   
000676 C9      1582 RET
000677 FD      1589 PUTPTR:			PUSH		IY
000678 E5   
000679 4F      1590 LD		C, A  		; C: Filehandle
00067A 5B      1591 PUSH.LIL	HL
00067B E5   
00067C 5B      1592 LD.LIL		HL, 2
00067D 21   
00067E 02   
00067F 00   
000680 00   
000681 5B      1593 ADD.LIL		HL, SP
000682 39   
000683 5B      1594 LD.LIL		(HL), E 	; 3rd byte of DWORD set to E
000684 73   
000685 5B      1595 POP.LIL		HL
000686 E1   
000687 5A      1596 LD		E, D  		; 4th byte passed as E
000688 3E    0001M1 LD	A, function
000689 1C   
00068A 49    0002M1 RST.LIS	08h
00068B CF   
00068C FD      1598 POP		IY
00068D E1   
00068E C9      1599 RET
00068F FD      1607 GETEXT:			PUSH		IY
000690 E5   
000691 4B      1608 LD		C, E
000692 3E    0001M1 LD	A, function
000693 19   
000694 49    0002M1 RST.LIS	08h
000695 CF   
000696 5B      1610 PUSH.LIL	HL
000697 E5   
000698 5B      1611 POP.LIL		IY		; IYU: Pointer to FIL structure
000699 FD   
00069A E1   
00069B 5B      1612 LD.LIL		L, (IY + FIL.obj.objsize + 0)
00069C FD   
00069D 6E   
00069E 24   
00069F 5B      1613 LD.LIL		H, (IY + FIL.obj.objsize + 1)
0006A0 FD   
0006A1 66   
0006A2 25   
0006A3 5B      1614 LD.LIL		E, (IY + FIL.obj.objsize + 2)
0006A4 FD   
0006A5 5E   
0006A6 26   
0006A7 5B      1615 LD.LIL		D, (IY + FIL.obj.objsize + 3)
0006A8 FD   
0006A9 56   
0006AA 27   
0006AB FD      1616 POP		IY
0006AC E1   
0006AD C9      1617 RET
0006AE C5      1626 OSLOAD:			PUSH	BC			; Stack the size
0006AF D5      1627 PUSH	DE			; Stack the load address
0006B0 11      1628 LD	DE, ACCS		; Buffer address for filename
0006B1 00   
0006B2 52   
0006B3 CD      1629 CALL	CSTR_FNAME		; Fetch filename from MOS into buffer
0006B4 3D   
0006B5 05   
0006B6 21      1630 LD	HL, ACCS		; HL: Filename
0006B7 00   
0006B8 52   
0006B9 CD      1631 CALL	EXT_DEFAULT		; Tack on the extension .BBC if not specified
0006BA F7   
0006BB 07   
0006BC CD      1632 CALL	EXT_HANDLER		; Get the default handler
0006BD 08   
0006BE 08   
0006BF D1      1633 POP	DE			; Restore the load address
0006C0 C1      1634 POP	BC			; Restore the size
0006C1 B7      1635 OR	A
0006C2 CA      1636 JP 	Z, OSLOAD_BBC
0006C3 89   
0006C4 07   
0006C5 AF      1640 OSLOAD_TXT:		XOR	A			; Set file attributes to read
0006C6 CD      1641 CALL	OSOPEN			; Open the file
0006C7 26   
0006C8 06   
0006C9 5F      1642 LD 	E, A 			; The filehandle
0006CA B7      1643 OR	A
0006CB 3E      1644 LD	A, 4			; File not found error
0006CC 04   
0006CD CA      1645 JP	Z, OSERROR		; Jump to error handler
0006CE 91   
0006CF 07   
0006D0 CD      1646 CALL	NEWIT			; Call NEW to clear the program space
0006D1 20   
0006D2 40   
0006D3 21      1648 OSLOAD_TXT1:		LD	HL, ACCS 		; Where the input is going to be stored
0006D4 00   
0006D5 52   
0006D6 CD      1652 @@:			CALL	OSBGET			; Read the byte into A
0006D7 3D   
0006D8 06   
0006D9 38      1653 JR	C, OSLOAD_TXT3		; Is it EOF?
0006DA 1C   
0006DB FE      1654 CP	LF 			; Is it LF?
0006DC 0A   
0006DD 28      1655 JR	Z, OSLOAD_TXT3 		; Yes, so skip to the next line
0006DE 18   
0006DF FE      1656 CP	21h			; Is it less than or equal to ASCII space?
0006E0 21   
0006E1 38      1657 JR	C, @B 			; Yes, so keep looping
0006E2 F3   
0006E3 77      1658 LD	(HL), A 		; Store the first character
0006E4 2C      1659 INC	L
0006E5 CD      1663 OSLOAD_TXT2:		CALL	OSBGET			; Read the byte into A
0006E6 3D   
0006E7 06   
0006E8 38      1664 JR	C, OSLOAD_TXT4		; Is it EOF?
0006E9 26   
0006EA FE      1665 CP	20h			; Skip if not an ASCII character
0006EB 20   
0006EC 38      1666 JR	C, @F
0006ED 05   
0006EE 77      1667 LD	(HL), A 		; Store in the input buffer
0006EF 2C      1668 INC	L			; Increment the buffer pointer
0006F0 CA      1669 JP	Z, BAD			; If the buffer is full (wrapped to 0) then jump to Bad Program error
0006F1 D1   
0006F2 3E   
0006F3 FE      1670 @@:			CP	LF			; Check for LF
0006F4 0A   
0006F5 20      1671 JR	NZ, OSLOAD_TXT2		; If not, then loop to read the rest of the characters in
0006F6 EE   
0006F7 36      1675 OSLOAD_TXT3:		LD	(HL), CR		; Store a CR for BBC BASIC
0006F8 0D   
0006F9 7D      1676 LD	A, L			; Check for minimum line length
0006FA FE      1677 CP	2			; If it is 2 characters or less (including CR)
0006FB 02   
0006FC 38      1678 JR	C, @F			; Then don't bother entering it
0006FD 08   
0006FE D5      1679 PUSH	DE			; Preserve the filehandle
0006FF CD      1680 CALL	OSEDIT			; Enter the line in memory
000700 1B   
000701 07   
000702 DC      1681 CALL	C,CLEAN			; If a new line has been entered, then call CLEAN to set TOP and write &FFFF end of program marker
000703 FC   
000704 3F   
000705 D1      1682 POP	DE
000706 CD      1683 @@:			CALL	OSSTAT			; End of file?
000707 4E   
000708 06   
000709 20      1684 JR	NZ, OSLOAD_TXT1		; No, so loop
00070A C8   
00070B CD      1685 CALL	OSSHUT			; Close the file
00070C 35   
00070D 06   
00070E 37      1686 SCF				; Flag to BASIC that we're good
00070F C9      1687 RET
000710 FE      1691 OSLOAD_TXT4:		CP	20h			; Skip if not an ASCII character
000711 20   
000712 38      1692 JR	C, @F
000713 05   
000714 77      1693 LD	(HL), A			; Store the character
000715 2C      1694 INC	L
000716 CA      1695 JP	Z, BAD
000717 D1   
000718 3E   
000719 18      1696 @@:			JR	OSLOAD_TXT3
00071A DC   
00071B AF      1703 OSEDIT:			XOR	A			; Entry point after *EDIT
00071C 32      1704 LD      (COUNT),A
00071D FB   
00071E 54   
00071F FD      1705 LD      IY,ACCS
000720 21   
000721 00   
000722 52   
000723 CD      1706 CALL    LINNUM			; HL: The line number from the input buffer
000724 6C   
000725 43   
000726 CD      1707 CALL    NXT			; Skip spaces
000727 ED   
000728 44   
000729 7C      1708 LD      A,H			; HL: The line number will be 0 for immediate mode or when auto line numbering is used
00072A B5      1709 OR      L
00072B 28      1710 JR      Z,LNZERO        	; Skip if there is no line number in the input buffer
00072C 00   
00072D 11      1714 LNZERO:			LD	DE,BUFFER
00072E 00   
00072F 53   
000730 0E      1715 LD	C,1			; LEFT MODE
000731 01   
000732 E5      1716 PUSH	HL
000733 CD      1717 CALL	LEXAN2			; LEXICAL ANALYSIS
000734 FA   
000735 43   
000736 E1      1718 POP	HL
000737 12      1719 LD	(DE),A			; TERMINATOR
000738 AF      1720 XOR	A
000739 47      1721 LD	B,A
00073A 4B      1722 LD	C,E			; BC=LINE LENGTH
00073B 13      1723 INC	DE
00073C 12      1724 LD	(DE),A			; ZERO NEXT
00073D 7C      1725 LD	A,H
00073E B5      1726 OR	L
00073F FD      1727 LD	IY,BUFFER		; FOR XEQ
000740 21   
000741 00   
000742 53   
000743 CA      1728 JP	Z,XEQ			; DIRECT MODE
000744 7B   
000745 24   
000746 C5      1729 PUSH	BC
000747 CD      1730 CALL	FINDL
000748 25   
000749 41   
00074A CC      1731 CALL	Z,DEL
00074B CB   
00074C 3F   
00074D C1      1732 POP	BC
00074E 79      1733 LD	A,C
00074F B7      1734 OR	A
000750 C8      1735 RET	Z
000751 C6      1736 ADD	A,4
000752 04   
000753 4F      1737 LD	C,A			; LENGTH INCLUSIVE
000754 D5      1738 PUSH	DE			; LINE NUMBER
000755 C5      1739 PUSH	BC			; SAVE LINE LENGTH
000756 EB      1740 EX	DE,HL
000757 C5      1741 PUSH	BC
000758 CD      1742 CALL	GETTOP
000759 07   
00075A 40   
00075B C1      1743 POP	BC
00075C E5      1744 PUSH	HL
00075D 09      1745 ADD	HL,BC
00075E E5      1746 PUSH	HL
00075F 24      1747 INC	H
000760 AF      1748 XOR	A
000761 ED      1749 SBC	HL,SP
000762 72   
000763 E1      1750 POP	HL
000764 D2      1751 JP	NC,ERROR_		; "No room"
000765 26   
000766 3F   
000767 E3      1752 EX	(SP),HL
000768 E5      1753 PUSH	HL
000769 23      1754 INC	HL
00076A B7      1755 OR	A
00076B ED      1756 SBC	HL,DE
00076C 52   
00076D 44      1757 LD	B,H			; BC=AMOUNT TO MOVE
00076E 4D      1758 LD	C,L
00076F E1      1759 POP	HL
000770 D1      1760 POP	DE
000771 28      1761 JR	Z,ATENDos
000772 02   
000773 ED      1762 LDDR				; MAKE SPACE
000774 B8   
000775 C1      1763 ATENDos:          	POP	BC			; LINE LENGTH
000776 D1      1764 POP	DE			; LINE NUMBER
000777 23      1765 INC	HL
000778 71      1766 LD	(HL),C			; STORE LENGTH
000779 23      1767 INC	HL
00077A 73      1768 LD	(HL),E			; STORE LINE NUMBER
00077B 23      1769 INC	HL
00077C 72      1770 LD	(HL),D
00077D 23      1771 INC	HL
00077E 11      1772 LD	DE,BUFFER
00077F 00   
000780 53   
000781 EB      1773 EX	DE,HL
000782 0D      1774 DEC	C
000783 0D      1775 DEC	C
000784 0D      1776 DEC	C
000785 ED      1777 LDIR				; ADD LINE
000786 B0   
000787 37      1778 SCF
000788 C9      1779 RET
000789 3E    0001M1 LD	A, function
00078A 01   
00078B 49    0002M1 RST.LIS	08h
00078C CF   
00078D D0      1784 RET	NC			; If load returns with carry reset - NO ROOM
00078E B7      1785 OR	A			; If there is no error (A=0)
00078F 37      1786 SCF				; Need to set carry indicating there was room
000790 C8      1787 RET	Z			; Return
000791 F5      1789 OSERROR:		PUSH	AF			; Handle the MOS error
000792 21      1790 LD	HL, ACCS		; Address of the buffer
000793 00   
000794 52   
000795 01      1791 LD	BC, 256			; Length of the buffer
000796 00   
000797 01   
000798 5F      1792 LD	E, A			; The error code
000799 3E    0001M1 LD	A, function
00079A 0F   
00079B 49    0002M1 RST.LIS	08h
00079C CF   
00079D F1      1794 POP	AF
00079E E5      1795 PUSH	HL			; Stack the address of the error (now in ACCS)
00079F C6      1796 ADD	A, 127			; Add 127 to the error code (MOS errors start at 128, and are trappable)
0007A0 7F   
0007A1 C3      1797 JP	EXTERR			; Trigger an external error
0007A2 37   
0007A3 3F   
0007A4 C5      1805 OSSAVE:			PUSH	BC			; Stack the size
0007A5 D5      1806 PUSH	DE			; Stack the save address
0007A6 11      1807 LD	DE, ACCS		; Buffer address for filename
0007A7 00   
0007A8 52   
0007A9 CD      1808 CALL	CSTR_FNAME		; Fetch filename from MOS into buffer
0007AA 3D   
0007AB 05   
0007AC 21      1809 LD	HL, ACCS		; HL: Filename
0007AD 00   
0007AE 52   
0007AF CD      1810 CALL	EXT_DEFAULT		; Tack on the extension .BBC if not specified
0007B0 F7   
0007B1 07   
0007B2 CD      1811 CALL	EXT_HANDLER		; Get the default handler
0007B3 08   
0007B4 08   
0007B5 D1      1812 POP	DE			; Restore the save address
0007B6 C1      1813 POP	BC			; Restore the size
0007B7 B7      1814 OR	A			; Is the extension .BBC
0007B8 28      1815 JR	Z, OSSAVE_BBC		; Yes, so use that
0007B9 35   
0007BA 3A      1819 OSSAVE_TXT:		LD 	A, (OSWRCHCH)		; Stack the current channel
0007BB F4   
0007BC 50   
0007BD F5      1820 PUSH	AF
0007BE AF      1821 XOR	A
0007BF 3C      1822 INC	A			; Make sure C is clear, A is 1, for OPENOUT
0007C0 32      1823 LD	(OSWRCHCH), A
0007C1 F4   
0007C2 50   
0007C3 CD      1824 CALL	OSOPEN			; Open the file
0007C4 26   
0007C5 06   
0007C6 32      1825 LD	(OSWRCHFH), A		; Store the file handle for OSWRCH
0007C7 F5   
0007C8 50   
0007C9 DD      1826 LD	IX, LISTON		; Required for LISTIT
0007CA 21   
0007CB FE   
0007CC 54   
0007CD 2A      1827 LD	HL, (PAGE_)		; Get start of program area
0007CE DC   
0007CF 54   
0007D0 D9      1828 EXX
0007D1 01      1829 LD	BC, 0			; Set the initial indent counters
0007D2 00   
0007D3 00   
0007D4 D9      1830 EXX
0007D5 7E      1831 OSSAVE_TXT1:		LD	A, (HL)			; Check for end of program marker
0007D6 B7      1832 OR	A
0007D7 28      1833 JR	Z, OSSAVE_TXT2
0007D8 0A   
0007D9 23      1834 INC	HL			; Skip the length byte
0007DA 5E      1835 LD	E, (HL)			; Get the line number
0007DB 23      1836 INC	HL
0007DC 56      1837 LD	D, (HL)
0007DD 23      1838 INC	HL
0007DE CD      1839 CALL	LISTIT			; List the line
0007DF 3F   
0007E0 40   
0007E1 18      1840 JR	OSSAVE_TXT1
0007E2 F2   
0007E3 3A      1841 OSSAVE_TXT2:		LD	A, (OSWRCHFH)		; Get the file handle
0007E4 F5   
0007E5 50   
0007E6 5F      1842 LD	E, A
0007E7 CD      1843 CALL	OSSHUT			; Close it
0007E8 35   
0007E9 06   
0007EA F1      1844 POP	AF			; Restore the channel
0007EB 32      1845 LD	(OSWRCHCH), A
0007EC F4   
0007ED 50   
0007EE C9      1846 RET
0007EF 3E    0001M1 LD	A, function
0007F0 02   
0007F1 49    0002M1 RST.LIS	08h
0007F2 CF   
0007F3 B7      1851 OR	A			; If there is no error (A=0)
0007F4 C8      1852 RET	Z			; Just return
0007F5 18      1853 JR	OSERROR			; Trip an error
0007F6 9A   
0007F7 E5      1859 EXT_DEFAULT:		PUSH	HL			; Stack the filename pointer
0007F8 0E      1860 LD	C, '.'			; Search for dot (marks start of extension)
0007F9 2E   
0007FA CD      1861 CALL	CSTR_FINDCH
0007FB 5D   
0007FC 05   
0007FD B7      1862 OR	A			; Check for end of string marker
0007FE 20      1863 JR	NZ, @F			; No, so skip as we have an extension at this point
0007FF 06   
000800 11      1864 LD	DE, EXT_LOOKUP		; Get the first (default extension)
000801 34   
000802 08   
000803 CD      1865 CALL	CSTR_CAT		; Concat it to string pointed to by HL
000804 73   
000805 05   
000806 E1      1866 @@:			POP	HL			; Restore the filename pointer
000807 C9      1867 RET
000808 E5      1874 EXT_HANDLER:		PUSH	HL			; Stack the filename pointer
000809 0E      1875 LD	C, '.'			; Find the '.'
00080A 2E   
00080B CD      1876 CALL	CSTR_FINDCH
00080C 5D   
00080D 05   
00080E 11      1877 LD	DE, EXT_LOOKUP		; The lookup table
00080F 34   
000810 08   
000811 E5      1879 EXT_HANDLER_1:		PUSH	HL			; Stack the pointer to the extension
000812 CD      1880 CALL	CSTR_ENDSWITH		; Check whether the string ends with the entry in the lookup
000813 65   
000814 05   
000815 E1      1881 POP	HL			; Restore the pointer to the extension
000816 28      1882 JR	Z, EXT_HANDLER_2	; We have a match!
000817 18   
000818 1A      1884 @@:			LD	A, (DE)			; Skip to the end of the entry in the lookup
000819 13      1885 INC	DE
00081A B7      1886 OR	A
00081B 20      1887 JR	NZ, @B
00081C FB   
00081D 13      1888 INC	DE			; Skip the file extension # byte
00081E 1A      1890 LD	A, (DE)			; Are we at the end of the table?
00081F B7      1891 OR	A
000820 20      1892 JR	NZ, EXT_HANDLER_1	; No, so loop
000821 EF   
000822 3E      1894 LD      A,204			; Throw a "Bad name" error
000823 CC   
000824 CD      1895 CALL    EXTERR
000825 37   
000826 3F   
000827 42      1896 DB    	"Bad name", 0
000828 61   
000829 64   
00082A 20   
00082B 6E   
00082C 61   
00082D 6D   
00082E 65   
00082F 00   
000830 13      1898 EXT_HANDLER_2:		INC	DE			; Skip to the file extension # byte
000831 1A      1899 LD	A, (DE)
000832 E1      1900 POP	HL			; Restore the filename pointer
000833 C9      1901 RET
000834 2E      1908 EXT_LOOKUP:		DB	".BBC", 0, 0		; First entry is the default extension
000835 42   
000836 42   
000837 43   
000838 00   
000839 00   
00083A 2E      1909 DB	".TXT", 0, 1
00083B 54   
00083C 58   
00083D 54   
00083E 00   
00083F 01   
000840 2E      1910 DB	".ASC", 0, 1
000841 41   
000842 53   
000843 43   
000844 00   
000845 01   
000846 2E      1911 DB	".BAS", 0, 1
000847 42   
000848 41   
000849 53   
00084A 00   
00084B 01   
00084C 00      1912 DB	0			; End of table
00084D FE      1916 OSWORD:			CP	07H			; SOUND
00084E 07   
00084F CA      1918 JP	Z, OSWORD_07 ; JR WAS TOO LARGE
000850 80   
000851 0A   
000852 FE      1919 CP	08H			; ENVELOPE
000853 08   
000854 28      1920 JR	Z, OSWORD_08
000855 14   
000856 FE      1921 CP	09H			; POINT
000857 09   
000858 28      1922 JR	Z, OSWORD_09
000859 03   
00085A C3      1923 JP	HUH			; Anything else trips an error
00085B 8F   
00085C 08   
00085D ED      1943 OSWORD_09:		LD	DE,(SCRAP+0)
00085E 5B   
00085F F9   
000860 50   
000861 2A      1944 LD	HL,(SCRAP+2)
000862 FB   
000863 50   
000864 CD      1945 CALL	POINT_
000865 FA   
000866 01   
000867 32      1946 LD	(SCRAP+4),A
000868 FD   
000869 50   
00086A C9      1947 OSWORD_08:		RET				; Envelope not currently implemented
00086B FE      1956 OSBYTE:			CP	0BH			; Keyboard auto-repeat delay
00086C 0B   
00086D 28      1957 JR	Z, OSBYTE_0B
00086E 31   
00086F FE      1958 CP	0CH			; Keyboard auto-repeat rate
000870 0C   
000871 28      1959 JR	Z, OSBYTE_0C
000872 54   
000873 FE      1960 CP	13H			; Wait for vblank
000874 13   
000875 28      1961 JR	Z, OSBYTE_13
000876 77   
000877 FE      1962 CP	76H			; Set keyboard LED
000878 76   
000879 28      1963 JR	Z, OSBYTE_76
00087A 7B   
00087B FE      1964 CP	81H			; Read the keyboard
00087C 81   
00087D CA      1965 JP	Z, OSBYTE_81
00087E 1E   
00087F 09   
000880 FE      1966 CP	86H			; Get cursor coordinates
000881 86   
000882 CA      1967 JP	Z, OSBYTE_86
000883 38   
000884 09   
000885 FE      1968 CP	87H			; Fetch current mode and character under cursor
000886 87   
000887 CA      1969 JP	Z, OSBYTE_87
000888 67   
000889 09   
00088A FE      1970 CP	A0H			; Fetch system variable
00088B A0   
00088C CA      1971 JP	Z, OSBYTE_A0
00088D 7D   
00088E 09   
00088F 3E      1975 HUH:    		LD      A,254			; Bad command error
000890 FE   
000891 CD      1976 CALL    EXTERR
000892 37   
000893 3F   
000894 42      1977 DB    	"Bad command"
000895 61   
000896 64   
000897 20   
000898 63   
000899 6F   
00089A 6D   
00089B 6D   
00089C 61   
00089D 6E   
00089E 64   
00089F 00      1978 DEFB    0
0008A0 3E    0001M1 LD      A, VAL
0008A1 17   
0008A2 CD    0002M1 CALL    OSWRCH
0008A3 93   
0008A4 05   
0008A5 3E    0001M1 LD      A, VAL
0008A6 00   
0008A7 CD    0002M1 CALL    OSWRCH
0008A8 93   
0008A9 05   
0008AA 3E    0001M1 LD      A, VAL
0008AB 88   
0008AC CD    0002M1 CALL    OSWRCH
0008AD 93   
0008AE 05   
0008AF 7D    0001M1 LD      A, VAL
0008B0 CD    0002M1 CALL    OSWRCH
0008B1 93   
0008B2 05   
0008B3 7C    0001M1 LD      A, VAL
0008B4 CD    0002M1 CALL    OSWRCH
0008B5 93   
0008B6 05   
0008B7 3E    0001M1 LD      A, VAL
0008B8 00   
0008B9 CD    0002M1 CALL    OSWRCH
0008BA 93   
0008BB 05   
0008BC 3E    0001M1 LD      A, VAL
0008BD 00   
0008BE CD    0002M1 CALL    OSWRCH
0008BF 93   
0008C0 05   
0008C1 3E    0001M1 LD      A, VAL
0008C2 FF   
0008C3 CD    0002M1 CALL    OSWRCH
0008C4 93   
0008C5 05   
0008C6 C9      1992 RET
0008C7 3E    0001M1 LD      A, VAL
0008C8 17   
0008C9 CD    0002M1 CALL    OSWRCH
0008CA 93   
0008CB 05   
0008CC 3E    0001M1 LD      A, VAL
0008CD 00   
0008CE CD    0002M1 CALL    OSWRCH
0008CF 93   
0008D0 05   
0008D1 3E    0001M1 LD      A, VAL
0008D2 88   
0008D3 CD    0002M1 CALL    OSWRCH
0008D4 93   
0008D5 05   
0008D6 3E    0001M1 LD      A, VAL
0008D7 00   
0008D8 CD    0002M1 CALL    OSWRCH
0008D9 93   
0008DA 05   
0008DB 3E    0001M1 LD      A, VAL
0008DC 00   
0008DD CD    0002M1 CALL    OSWRCH
0008DE 93   
0008DF 05   
0008E0 7D    0001M1 LD      A, VAL
0008E1 CD    0002M1 CALL    OSWRCH
0008E2 93   
0008E3 05   
0008E4 7C    0001M1 LD      A, VAL
0008E5 CD    0002M1 CALL    OSWRCH
0008E6 93   
0008E7 05   
0008E8 3E    0001M1 LD      A, VAL
0008E9 FF   
0008EA CD    0002M1 CALL    OSWRCH
0008EB 93   
0008EC 05   
0008ED C9      2006 RET
0008EE CD      2010 OSBYTE_13:		CALL	WAIT_VBLANK
0008EF 6D   
0008F0 0A   
0008F1 2E      2011 LD	L, 0			; Returns 0
0008F2 00   
0008F3 C3      2012 JP	COUNT0
0008F4 30   
0008F5 1B   
0008F6 3E    0001M1 LD      A, VAL
0008F7 17   
0008F8 CD    0002M1 CALL    OSWRCH
0008F9 93   
0008FA 05   
0008FB 3E    0001M1 LD      A, VAL
0008FC 00   
0008FD CD    0002M1 CALL    OSWRCH
0008FE 93   
0008FF 05   
000900 3E    0001M1 LD      A, VAL
000901 88   
000902 CD    0002M1 CALL    OSWRCH
000903 93   
000904 05   
000905 3E    0001M1 LD      A, VAL
000906 00   
000907 CD    0002M1 CALL    OSWRCH
000908 93   
000909 05   
00090A 3E    0001M1 LD      A, VAL
00090B 00   
00090C CD    0002M1 CALL    OSWRCH
00090D 93   
00090E 05   
00090F 3E    0001M1 LD      A, VAL
000910 00   
000911 CD    0002M1 CALL    OSWRCH
000912 93   
000913 05   
000914 3E    0001M1 LD      A, VAL
000915 00   
000916 CD    0002M1 CALL    OSWRCH
000917 93   
000918 05   
000919 7D    0001M1 LD      A, VAL
00091A CD    0002M1 CALL    OSWRCH
00091B 93   
00091C 05   
00091D C9      2026 RET
00091E CD      2036 OSBYTE_81:		CALL	READKEY			; Read the keyboard
00091F 0D   
000920 06   
000921 28      2037 JR	Z, @F 			; Skip if we have a key
000922 09   
000923 7C      2038 LD	A, H 			; Check loop counter
000924 B5      2039 OR 	L
000925 C8      2040 RET 	Z 			; Return, we've not got a key at this point
000926 CD      2041 CALL	WAIT_VBLANK 		; Wait a frame
000927 6D   
000928 0A   
000929 2B      2042 DEC 	HL			; Decrement
00092A 18      2043 JR	OSBYTE_81		; And loop
00092B F2   
00092C 21      2045 @@:			LD	HL, KEYDOWN		; We have a key, so
00092D F6   
00092E 50   
00092F 36      2046 LD	(HL), 0			; clear the keydown flag
000930 00   
000931 FE      2047 CP	1BH			; If we are not pressing ESC,
000932 1B   
000933 37      2048 SCF 				; then flag we've got a character
000934 C0      2049 RET	NZ
000935 C3      2050 JP	ESCSET			; Handle ESC
000936 F8   
000937 05   
000938 DD      2057 OSBYTE_86:		PUSH	IX			; Get the system vars in IX
000939 E5   
00093A 3E    0001M1 LD	A, function
00093B 08   
00093C 49    0002M1 RST.LIS	08h
00093D CF   
00093E 5B      2059 RES.LIL	0, (IX+sysvar_vpd_pflags)
00093F DD   
000940 CB   
000941 04   
000942 86   
000943 3E    0001M1 LD      A, VAL
000944 17   
000945 CD    0002M1 CALL    OSWRCH
000946 93   
000947 05   
000948 3E    0001M1 LD      A, VAL
000949 00   
00094A CD    0002M1 CALL    OSWRCH
00094B 93   
00094C 05   
00094D 3E    0001M1 LD      A, VAL
00094E 82   
00094F CD    0002M1 CALL    OSWRCH
000950 93   
000951 05   
000952 5B      2063 @@:			BIT.LIL	0, (IX+sysvar_vpd_pflags)
000953 DD   
000954 CB   
000955 04   
000956 46   
000957 28      2064 JR	Z, @B			; Wait for the result
000958 F9   
000959 16      2065 LD 	D, 0
00095A 00   
00095B 62      2066 LD	H, D
00095C 5B      2067 LD.LIL	E, (IX + sysvar_cursorX)
00095D DD   
00095E 5E   
00095F 07   
000960 5B      2068 LD.LIL	L, (IX + sysvar_cursorY)
000961 DD   
000962 6E   
000963 08   
000964 DD      2069 POP	IX
000965 E1   
000966 C9      2070 RET
000967 DD      2074 OSBYTE_87:		PUSH	IX
000968 E5   
000969 CD      2075 CALL	GETCSR			; Get the current screen position
00096A 8B   
00096B 0D   
00096C CD      2076 CALL	GETSCHR_1		; Read character from screen
00096D BD   
00096E 01   
00096F 6F      2077 LD	L, A
000970 3E    0001M1 LD	A, function
000971 08   
000972 49    0002M1 RST.LIS	08h
000973 CF   
000974 5B      2079 LD.LIL	H, (IX+sysvar_scrMode)	; H: Screen mode
000975 DD   
000976 66   
000977 27   
000978 DD      2080 POP	IX
000979 E1   
00097A C3      2081 JP	COUNT1
00097B 32   
00097C 1B   
00097D DD      2087 OSBYTE_A0:		PUSH	IX
00097E E5   
00097F 3E    0001M1 LD	A, function
000980 08   
000981 49    0002M1 RST.LIS	08h
000982 CF   
000983 5B      2089 LD.LIL	BC, 0
000984 01   
000985 00   
000986 00   
000987 00   
000988 4D      2090 LD	C, L			; BCU = L
000989 5B      2091 ADD.LIL	IX, BC			; Add to IX
00098A DD   
00098B 09   
00098C 5B      2092 LD.LIL	L, (IX + 0)		; Fetch the return value
00098D DD   
00098E 6E   
00098F 00   
000990 DD      2093 POP	IX
000991 E1   
000992 C3      2094 JP 	COUNT0
000993 30   
000994 1B   
000995 CD      2101 OSCLI: 			CALL    SKIPSP
000996 EF   
000997 09   
000998 FE      2102 CP      CR
000999 0D   
00099A C8      2103 RET     Z
00099B FE      2104 CP      '|'
00099C 7C   
00099D C8      2105 RET     Z
00099E EB      2106 EX      DE,HL
00099F 21      2107 LD      HL,COMDS
0009A0 FE   
0009A1 09   
0009A2 1A      2108 OSCLI0:			LD      A,(DE)
0009A3 CD      2109 CALL    UPPRC
0009A4 F6   
0009A5 09   
0009A6 BE      2110 CP      (HL)
0009A7 28      2111 JR      Z,OSCLI2
0009A8 0B   
0009A9 38      2112 JR      C,OSCLI6
0009AA 2E   
0009AB CB      2113 OSCLI1:			BIT     7,(HL)
0009AC 7E   
0009AD 23      2114 INC     HL
0009AE 28      2115 JR      Z,OSCLI1
0009AF FB   
0009B0 23      2116 INC     HL
0009B1 23      2117 INC     HL
0009B2 18      2118 JR      OSCLI0
0009B3 EE   
0009B4 D5      2120 OSCLI2:			PUSH    DE
0009B5 13      2121 OSCLI3:			INC     DE
0009B6 23      2122 INC     HL
0009B7 1A      2123 LD      A,(DE)
0009B8 CD      2124 CALL    UPPRC
0009B9 F6   
0009BA 09   
0009BB FE      2125 CP      '.'			; ABBREVIATED?
0009BC 2E   
0009BD 28      2126 JR      Z,OSCLI4
0009BE 0A   
0009BF AE      2127 XOR     (HL)
0009C0 28      2128 JR      Z,OSCLI3
0009C1 F3   
0009C2 FE      2129 CP      80H
0009C3 80   
0009C4 28      2130 JR      Z,OSCLI4
0009C5 03   
0009C6 D1      2131 POP     DE
0009C7 18      2132 JR      OSCLI1
0009C8 E2   
0009C9 F1      2134 OSCLI4:			POP     AF
0009CA 13      2135 INC     DE
0009CB CB      2136 OSCLI5:			BIT     7,(HL)
0009CC 7E   
0009CD 23      2137 INC     HL
0009CE 28      2138 JR      Z,OSCLI5
0009CF FB   
0009D0 7E      2139 LD      A,(HL)
0009D1 23      2140 INC     HL
0009D2 66      2141 LD      H,(HL)
0009D3 6F      2142 LD      L,A
0009D4 E5      2143 PUSH    HL
0009D5 EB      2144 EX      DE,HL
0009D6 C3      2145 JP      SKIPSP
0009D7 EF   
0009D8 09   
0009D9 EB      2147 OSCLI6:			EX	DE, HL			; HL: Buffer for command
0009DA 11      2148 LD	DE, ACCS		; Buffer for command string is ACCS (the string accumulator)
0009DB 00   
0009DC 52   
0009DD D5      2149 PUSH	DE			; Store buffer address
0009DE CD      2150 CALL	CSTR_LINE		; Fetch the line
0009DF 4F   
0009E0 05   
0009E1 E1      2151 POP	HL			; HL: Pointer to command string in ACCS
0009E2 FD      2152 PUSH	IY
0009E3 E5   
0009E4 3E    0001M1 LD	A, function
0009E5 10   
0009E6 49    0002M1 RST.LIS	08h
0009E7 CF   
0009E8 FD      2154 POP	IY
0009E9 E1   
0009EA B7      2155 OR	A			; 0 means MOS returned OK
0009EB C8      2156 RET	Z			; So don't do anything
0009EC C3      2157 JP 	OSERROR			; Otherwise it's a MOS error
0009ED 91   
0009EE 07   
0009EF 7E      2159 SKIPSP:			LD      A,(HL)
0009F0 FE      2160 CP      ' '
0009F1 20   
0009F2 C0      2161 RET     NZ
0009F3 23      2162 INC     HL
0009F4 18      2163 JR      SKIPSP
0009F5 F9   
0009F6 E6      2165 UPPRC:  		AND     7FH
0009F7 7F   
0009F8 FE      2166 CP      '`'
0009F9 60   
0009FA D8      2167 RET     C
0009FB E6      2168 AND     5FH			; CONVERT TO UPPER CASE
0009FC 5F   
0009FD C9      2169 RET
0009FE 42      2174 COMDS:  		DB	"BY","E"+80h		; BYE
0009FF 59   
000A00 45   
000A01 0E      2175 DW	BYE
000A02 0A   
000A03 45      2176 DB	"EDI","T"+80h		; EDIT
000A04 44   
000A05 49   
000A06 54   
000A07 19      2177 DW	STAR_EDIT
000A08 0A   
000A09 46      2178 DB	"F","X"+80h		; FX
000A0A 58   
000A0B 55      2179 DW	STAR_FX
000A0C 0A   
000A0D FF      2182 DB	FFh
000A0E CD      2186 BYE:			CALL	VBLANK_STOP		; Restore MOS interrupts
000A0F 48   
000A10 04   
000A11 5B      2187 POP.LIL	IX 			; The return address to init
000A12 DD   
000A13 E1   
000A14 21      2188 LD	HL, 0			; The return code
000A15 00   
000A16 00   
000A17 DD      2189 JP	(IX)
000A18 E9   
000A19 CD      2193 STAR_EDIT:		CALL	ASC_TO_NUMBER		; DE: Line number to edit
000A1A BE   
000A1B 04   
000A1C EB      2194 EX	DE, HL			; HL: Line number
000A1D CD      2195 CALL	FINDL			; HL: Address in RAM of tokenised line
000A1E 25   
000A1F 41   
000A20 3E      2196 LD	A, 41			; F:NZ If the line is not found
000A21 29   
000A22 C2      2197 JP	NZ, ERROR_		; Do error 41: No such line in that case
000A23 26   
000A24 3F   
000A25 23      2201 INC	HL			; Skip the length byte
000A26 5E      2202 LD	E, (HL)			; Fetch the line number
000A27 23      2203 INC	HL
000A28 56      2204 LD	D, (HL)
000A29 23      2205 INC	HL
000A2A DD      2206 LD	IX, ACCS		; Pointer to where the copy is to be stored
000A2B 21   
000A2C 00   
000A2D 52   
000A2E DD      2207 LD	(OSWRCHPT), IX
000A2F 22   
000A30 F2   
000A31 50   
000A32 DD      2208 LD	IX, LISTON		; Pointer to LISTON variable in RAM
000A33 21   
000A34 FE   
000A35 54   
000A36 DD      2209 LD	A, (IX)			; Store that variable
000A37 7E   
000A38 00   
000A39 F5      2210 PUSH	AF
000A3A DD      2211 LD	(IX), 09h		; Set to echo to buffer
000A3B 36   
000A3C 00   
000A3D 09   
000A3E CD      2212 CALL	LISTIT
000A3F 3F   
000A40 40   
000A41 F1      2213 POP	AF
000A42 DD      2214 LD	(IX), A			; Restore the original LISTON variable
000A43 77   
000A44 00   
000A45 21      2215 LD	HL, ACCS		; HL: ACCS
000A46 00   
000A47 52   
000A48 5D      2216 LD	E, L			;  E: 0 - Don't clear the buffer; ACCS is on a page boundary so L is 0
000A49 CD      2217 CALL	OSLINE1			; Invoke the editor
000A4A CB   
000A4B 05   
000A4C CD      2218 CALL	OSEDIT
000A4D 1B   
000A4E 07   
000A4F DC      2219 CALL    C,CLEAN			; Set TOP, write out &FFFF end of program marker
000A50 FC   
000A51 3F   
000A52 C3      2220 JP      CLOOP			; Jump back to immediate mode
000A53 92   
000A54 37   
000A55 CD      2224 STAR_FX:		CALL	ASC_TO_NUMBER
000A56 BE   
000A57 04   
000A58 4B      2225 LD	C, E			; C: Save FX #
000A59 CD      2226 CALL	ASC_TO_NUMBER
000A5A BE   
000A5B 04   
000A5C 7A      2227 LD	A, D  			; Is first parameter > 255?
000A5D B7      2228 OR 	A
000A5E 28      2229 JR	Z, STAR_FX1		; Yes, so skip next bit
000A5F 03   
000A60 EB      2230 EX	DE, HL 			; Parameter is 16-bit
000A61 18      2231 JR	STAR_FX2
000A62 06   
000A63 43      2233 STAR_FX1:		LD	B, E 			; B: Save First parameter
000A64 CD      2234 CALL	ASC_TO_NUMBER		; Fetch second parameter
000A65 BE   
000A66 04   
000A67 68      2235 LD	L, B 			; L: First parameter
000A68 63      2236 LD	H, E 			; H: Second parameter
000A69 79      2238 STAR_FX2:		LD	A, C 			; A: FX #
000A6A C3      2239 JP	OSBYTE
000A6B 6B   
000A6C 08   
000A6D DD      2243 WAIT_VBLANK:		PUSH 	IX			; Wait for VBLANK interrupt
000A6E E5   
000A6F 3E    0001M1 LD	A, function
000A70 08   
000A71 49    0002M1 RST.LIS	08h
000A72 CF   
000A73 5B      2245 LD.LIL	A, (IX + sysvar_time + 0)
000A74 DD   
000A75 7E   
000A76 00   
000A77 5B      2246 @@:			CP.LIL 	A, (IX + sysvar_time + 0)
000A78 DD   
000A79 BE   
000A7A 00   
000A7B 28      2247 JR	Z, @B
000A7C FA   
000A7D DD      2248 POP	IX
000A7E E1   
000A7F C9      2249 RET
000A80             2252   ; --- Begin agon_sound.asm ---
000A80 7E      2285 SOUND_:			LD	A, (HL)			; Channel
000A81 32      2286 LD	(VDU_BUFFER+0), A
000A82 00   
000A83 52   
000A84 AF      2287 XOR	A			; Waveform
000A85 32      2288 LD	(VDU_BUFFER+1), A
000A86 01   
000A87 52   
000A88 23      2289 INC	HL
000A89 23      2290 INC	HL
000A8A 4E      2294 LD	C, (HL)			; Volume
000A8B 06      2295 LD	B, 6			; C already contains the volume
000A8C 06   
000A8D ED      2296 MLT	BC			; Multiply by 6 (0-15 scales to 0-90)
000A8E 4C   
000A8F 79      2297 LD	A, C
000A90 32      2298 LD	(VDU_BUFFER+2), A
000A91 02   
000A92 52   
000A93 23      2299 INC	HL
000A94 23      2300 INC	HL
000A95 E5      2304 PUSH	HL
000A96 6E      2305 LD	L, (HL)
000A97 26      2306 LD	H, 0
000A98 00   
000A99 11      2307 LD	DE, SOUND_FREQ_LOOKUP
000A9A 0B   
000A9B 0B   
000A9C 29      2308 ADD	HL, HL
000A9D 19      2309 ADD	HL, DE
000A9E 7E      2310 LD	A, (HL)
000A9F 32      2311 LD	(VDU_BUFFER+3), A
000AA0 03   
000AA1 52   
000AA2 23      2312 INC	HL
000AA3 7E      2313 LD	A, (HL)
000AA4 32      2314 LD	(VDU_BUFFER+4), A
000AA5 04   
000AA6 52   
000AA7 E1      2315 POP	HL
000AA8 23      2316 INC	HL
000AA9 23      2317 INC	HL
000AAA 4E      2321 LD	C, (HL)
000AAB 06      2322 LD	B, 50			; C contains the duration, so MLT by 50
000AAC 32   
000AAD ED      2323 MLT	BC
000AAE 4C   
000AAF ED      2324 LD	(VDU_BUFFER+5), BC
000AB0 43   
000AB1 05   
000AB2 52   
000AB3 DD      2326 PUSH	IX			; Get the system vars in IX
000AB4 E5   
000AB5 3E    0001M1 LD	A, function
000AB6 08   
000AB7 49    0002M1 RST.LIS	08h
000AB8 CF   
000AB9 5B      2328 SOUND0:			RES.LIL	3, (IX+sysvar_vpd_pflags)
000ABA DD   
000ABB CB   
000ABC 04   
000ABD 9E   
000ABE 3E    0001M1 LD      A, VAL
000ABF 17   
000AC0 CD    0002M1 CALL    OSWRCH
000AC1 93   
000AC2 05   
000AC3 3E    0001M1 LD      A, VAL
000AC4 00   
000AC5 CD    0002M1 CALL    OSWRCH
000AC6 93   
000AC7 05   
000AC8 3E    0001M1 LD      A, VAL
000AC9 85   
000ACA CD    0002M1 CALL    OSWRCH
000ACB 93   
000ACC 05   
000ACD 3A    0001M1 LD      A, VAL
000ACE 00   
000ACF 52   
000AD0 CD    0002M1 CALL    OSWRCH
000AD1 93   
000AD2 05   
000AD3 3A    0001M1 LD      A, VAL
000AD4 01   
000AD5 52   
000AD6 CD    0002M1 CALL    OSWRCH
000AD7 93   
000AD8 05   
000AD9 3A    0001M1 LD      A, VAL
000ADA 02   
000ADB 52   
000ADC CD    0002M1 CALL    OSWRCH
000ADD 93   
000ADE 05   
000ADF 3A    0001M1 LD      A, VAL
000AE0 03   
000AE1 52   
000AE2 CD    0002M1 CALL    OSWRCH
000AE3 93   
000AE4 05   
000AE5 3A    0001M1 LD      A, VAL
000AE6 04   
000AE7 52   
000AE8 CD    0002M1 CALL    OSWRCH
000AE9 93   
000AEA 05   
000AEB 3A    0001M1 LD      A, VAL
000AEC 05   
000AED 52   
000AEE CD    0002M1 CALL    OSWRCH
000AEF 93   
000AF0 05   
000AF1 3A    0001M1 LD      A, VAL
000AF2 06   
000AF3 52   
000AF4 CD    0002M1 CALL    OSWRCH
000AF5 93   
000AF6 05   
000AF7 5B      2343 @@:			BIT.LIL	3, (IX+sysvar_vpd_pflags)
000AF8 DD   
000AF9 CB   
000AFA 04   
000AFB 5E   
000AFC 28      2344 JR	Z, @B			; Wait for the result
000AFD F9   
000AFE CD      2345 CALL	LTRAP			; Check for ESC
000AFF 18   
000B00 06   
000B01 5B      2346 LD.LIL	A, (IX+sysvar_audioSuccess)
000B02 DD   
000B03 7E   
000B04 0E   
000B05 A7      2347 AND	A			; Check if VDP has queued the note
000B06 28      2348 JR	Z, SOUND0		; No, so loop back and send again
000B07 B1   
000B08 DD      2350 POP	IX
000B09 E1   
000B0A C9      2351 RET
000B0B 75      2387 SOUND_FREQ_LOOKUP:	DW	 117,  118,  120,  122,  123,  131,  133,  135
000B0C 00   
000B0D 76   
000B0E 00   
000B0F 78   
000B10 00   
000B11 7A   
000B12 00   
000B13 7B   
000B14 00   
000B15 83   
000B16 00   
000B17 85   
000B18 00   
000B19 87   
000B1A 00   
000B1B 89      2388 DW	 137,  139,  141,  143,  145,  147,  149,  151
000B1C 00   
000B1D 8B   
000B1E 00   
000B1F 8D   
000B20 00   
000B21 8F   
000B22 00   
000B23 91   
000B24 00   
000B25 93   
000B26 00   
000B27 95   
000B28 00   
000B29 97   
000B2A 00   
000B2B 99      2389 DW	 153,  156,  158,  160,  162,  165,  167,  170
000B2C 00   
000B2D 9C   
000B2E 00   
000B2F 9E   
000B30 00   
000B31 A0   
000B32 00   
000B33 A2   
000B34 00   
000B35 A5   
000B36 00   
000B37 A7   
000B38 00   
000B39 AA   
000B3A 00   
000B3B AC      2390 DW	 172,  175,  177,  180,  182,  185,  188,  190
000B3C 00   
000B3D AF   
000B3E 00   
000B3F B1   
000B40 00   
000B41 B4   
000B42 00   
000B43 B6   
000B44 00   
000B45 B9   
000B46 00   
000B47 BC   
000B48 00   
000B49 BE   
000B4A 00   
000B4B C1      2391 DW	 193,  196,  199,  202,  205,  208,  211,  214
000B4C 00   
000B4D C4   
000B4E 00   
000B4F C7   
000B50 00   
000B51 CA   
000B52 00   
000B53 CD   
000B54 00   
000B55 D0   
000B56 00   
000B57 D3   
000B58 00   
000B59 D6   
000B5A 00   
000B5B D9      2392 DW	 217,  220,  223,  226,  230,  233,  236,  240
000B5C 00   
000B5D DC   
000B5E 00   
000B5F DF   
000B60 00   
000B61 E2   
000B62 00   
000B63 E6   
000B64 00   
000B65 E9   
000B66 00   
000B67 EC   
000B68 00   
000B69 F0   
000B6A 00   
000B6B F3      2393 DW	 243,  247,  251,  254,  258,  262,  265,  269
000B6C 00   
000B6D F7   
000B6E 00   
000B6F FB   
000B70 00   
000B71 FE   
000B72 00   
000B73 02   
000B74 01   
000B75 06   
000B76 01   
000B77 09   
000B78 01   
000B79 0D   
000B7A 01   
000B7B 11      2394 DW	 273,  277,  281,  285,  289,  294,  298,  302
000B7C 01   
000B7D 15   
000B7E 01   
000B7F 19   
000B80 01   
000B81 1D   
000B82 01   
000B83 21   
000B84 01   
000B85 26   
000B86 01   
000B87 2A   
000B88 01   
000B89 2E   
000B8A 01   
000B8B 33      2395 DW	 307,  311,  316,  320,  325,  330,  334,  339
000B8C 01   
000B8D 37   
000B8E 01   
000B8F 3C   
000B90 01   
000B91 40   
000B92 01   
000B93 45   
000B94 01   
000B95 4A   
000B96 01   
000B97 4E   
000B98 01   
000B99 53   
000B9A 01   
000B9B 58      2396 DW	 344,  349,  354,  359,  365,  370,  375,  381
000B9C 01   
000B9D 5D   
000B9E 01   
000B9F 62   
000BA0 01   
000BA1 67   
000BA2 01   
000BA3 6D   
000BA4 01   
000BA5 72   
000BA6 01   
000BA7 77   
000BA8 01   
000BA9 7D   
000BAA 01   
000BAB 82      2397 DW	 386,  392,  398,  403,  409,  415,  421,  427
000BAC 01   
000BAD 88   
000BAE 01   
000BAF 8E   
000BB0 01   
000BB1 93   
000BB2 01   
000BB3 99   
000BB4 01   
000BB5 9F   
000BB6 01   
000BB7 A5   
000BB8 01   
000BB9 AB   
000BBA 01   
000BBB B2      2398 DW	 434,  440,  446,  453,  459,  466,  473,  480
000BBC 01   
000BBD B8   
000BBE 01   
000BBF BE   
000BC0 01   
000BC1 C5   
000BC2 01   
000BC3 CB   
000BC4 01   
000BC5 D2   
000BC6 01   
000BC7 D9   
000BC8 01   
000BC9 E0   
000BCA 01   
000BCB E7      2399 DW	 487,  494,  501,  508,  516,  523,  531,  539
000BCC 01   
000BCD EE   
000BCE 01   
000BCF F5   
000BD0 01   
000BD1 FC   
000BD2 01   
000BD3 04   
000BD4 02   
000BD5 0B   
000BD6 02   
000BD7 13   
000BD8 02   
000BD9 1B   
000BDA 02   
000BDB 22      2400 DW	 546,  554,  562,  571,  579,  587,  596,  605
000BDC 02   
000BDD 2A   
000BDE 02   
000BDF 32   
000BE0 02   
000BE1 3B   
000BE2 02   
000BE3 43   
000BE4 02   
000BE5 4B   
000BE6 02   
000BE7 54   
000BE8 02   
000BE9 5D   
000BEA 02   
000BEB 65      2401 DW	 613,  622,  631,  641,  650,  659,  669,  679
000BEC 02   
000BED 6E   
000BEE 02   
000BEF 77   
000BF0 02   
000BF1 81   
000BF2 02   
000BF3 8A   
000BF4 02   
000BF5 93   
000BF6 02   
000BF7 9D   
000BF8 02   
000BF9 A7   
000BFA 02   
000BFB B1      2402 DW	 689,  699,  709,  719,  729,  740,  751,  762
000BFC 02   
000BFD BB   
000BFE 02   
000BFF C5   
000C00 02   
000C01 CF   
000C02 02   
000C03 D9   
000C04 02   
000C05 E4   
000C06 02   
000C07 EF   
000C08 02   
000C09 FA   
000C0A 02   
000C0B 05      2403 DW	 773,  784,  795,  807,  819,  831,  843,  855
000C0C 03   
000C0D 10   
000C0E 03   
000C0F 1B   
000C10 03   
000C11 27   
000C12 03   
000C13 33   
000C14 03   
000C15 3F   
000C16 03   
000C17 4B   
000C18 03   
000C19 57   
000C1A 03   
000C1B 63      2404 DW	 867,  880,  893,  906,  919,  932,  946,  960
000C1C 03   
000C1D 70   
000C1E 03   
000C1F 7D   
000C20 03   
000C21 8A   
000C22 03   
000C23 97   
000C24 03   
000C25 A4   
000C26 03   
000C27 B2   
000C28 03   
000C29 C0   
000C2A 03   
000C2B CE      2405 DW	 974,  988, 1002, 1017, 1032, 1047, 1062, 1078
000C2C 03   
000C2D DC   
000C2E 03   
000C2F EA   
000C30 03   
000C31 F9   
000C32 03   
000C33 08   
000C34 04   
000C35 17   
000C36 04   
000C37 26   
000C38 04   
000C39 36   
000C3A 04   
000C3B 45      2406 DW	1093, 1109, 1125, 1142, 1158, 1175, 1192, 1210
000C3C 04   
000C3D 55   
000C3E 04   
000C3F 65   
000C40 04   
000C41 76   
000C42 04   
000C43 86   
000C44 04   
000C45 97   
000C46 04   
000C47 A8   
000C48 04   
000C49 BA   
000C4A 04   
000C4B CB      2407 DW	1227, 1245, 1263, 1282, 1300, 1319, 1338, 1358
000C4C 04   
000C4D DD   
000C4E 04   
000C4F EF   
000C50 04   
000C51 02   
000C52 05   
000C53 14   
000C54 05   
000C55 27   
000C56 05   
000C57 3A   
000C58 05   
000C59 4E   
000C5A 05   
000C5B 62      2408 DW	1378, 1398, 1418, 1439, 1459, 1481, 1502, 1524
000C5C 05   
000C5D 76   
000C5E 05   
000C5F 8A   
000C60 05   
000C61 9F   
000C62 05   
000C63 B3   
000C64 05   
000C65 C9   
000C66 05   
000C67 DE   
000C68 05   
000C69 F4   
000C6A 05   
000C6B 0A      2409 DW	1546, 1569, 1592, 1615, 1638, 1662, 1686, 1711
000C6C 06   
000C6D 21   
000C6E 06   
000C6F 38   
000C70 06   
000C71 4F   
000C72 06   
000C73 66   
000C74 06   
000C75 7E   
000C76 06   
000C77 96   
000C78 06   
000C79 AF   
000C7A 06   
000C7B C8      2410 DW	1736, 1761, 1786, 1812, 1839, 1866, 1893, 1920
000C7C 06   
000C7D E1   
000C7E 06   
000C7F FA   
000C80 06   
000C81 14   
000C82 07   
000C83 2F   
000C84 07   
000C85 4A   
000C86 07   
000C87 65   
000C88 07   
000C89 80   
000C8A 07   
000C8B 9C      2411 DW	1948, 1976, 2005, 2034, 2064, 2093, 2123, 2154
000C8C 07   
000C8D B8   
000C8E 07   
000C8F D5   
000C90 07   
000C91 F2   
000C92 07   
000C93 10   
000C94 08   
000C95 2D   
000C96 08   
000C97 4B   
000C98 08   
000C99 6A   
000C9A 08   
000C9B 8A      2412 DW	2186, 2217, 2250, 2282, 2316, 2349, 2383, 2418
000C9C 08   
000C9D A9   
000C9E 08   
000C9F CA   
000CA0 08   
000CA1 EA   
000CA2 08   
000CA3 0C   
000CA4 09   
000CA5 2D   
000CA6 09   
000CA7 4F   
000CA8 09   
000CA9 72   
000CAA 09   
000CAB 95      2413 DW	2453, 2489, 2525, 2562, 2599, 2637, 2675, 2714
000CAC 09   
000CAD B9   
000CAE 09   
000CAF DD   
000CB0 09   
000CB1 02   
000CB2 0A   
000CB3 27   
000CB4 0A   
000CB5 4D   
000CB6 0A   
000CB7 73   
000CB8 0A   
000CB9 9A   
000CBA 0A   
000CBB C2      2414 DW	2754, 2794, 2834, 2876, 2918, 2960, 3003, 3047
000CBC 0A   
000CBD EA   
000CBE 0A   
000CBF 12   
000CC0 0B   
000CC1 3C   
000CC2 0B   
000CC3 66   
000CC4 0B   
000CC5 90   
000CC6 0B   
000CC7 BB   
000CC8 0B   
000CC9 E7   
000CCA 0B   
000CCB 13      2415 DW	3091, 3136, 3182, 3228, 3275, 3322, 3371, 3420
000CCC 0C   
000CCD 40   
000CCE 0C   
000CCF 6E   
000CD0 0C   
000CD1 9C   
000CD2 0C   
000CD3 CB   
000CD4 0C   
000CD5 FA   
000CD6 0C   
000CD7 2B   
000CD8 0D   
000CD9 5C   
000CDA 0D   
000CDB 8E      2416 DW	3470, 3520, 3571, 3623, 3676, 3729, 3784, 3839
000CDC 0D   
000CDD C0   
000CDE 0D   
000CDF F3   
000CE0 0D   
000CE1 27   
000CE2 0E   
000CE3 5C   
000CE4 0E   
000CE5 91   
000CE6 0E   
000CE7 C8   
000CE8 0E   
000CE9 FF   
000CEA 0E   
000CEB 36      2417 DW	3894, 3951, 4009, 4067, 4126, 4186, 4247, 4309
000CEC 0F   
000CED 6F   
000CEE 0F   
000CEF A9   
000CF0 0F   
000CF1 E3   
000CF2 0F   
000CF3 1E   
000CF4 10   
000CF5 5A   
000CF6 10   
000CF7 97   
000CF8 10   
000CF9 D5   
000CFA 10   
000CFB 13      2418 DW	4371, 4435, 4499, 4565, 4631, 4699, 4767, 4836
000CFC 11   
000CFD 53   
000CFE 11   
000CFF 93   
000D00 11   
000D01 D5   
000D02 11   
000D03 17   
000D04 12   
000D05 5B   
000D06 12   
000D07 9F   
000D08 12   
000D09 E4   
000D0A 12   
000D0B             2421   ; --- Begin acorn.asm ---
000D0B 3E      2503 GETIME:         LD	A,1
000D0C 01   
000D0D 21      2504 LD	HL,SCRAP
000D0E F9   
000D0F 50   
000D10 CD      2505 CALL	OSWORD
000D11 4D   
000D12 08   
000D13 21      2506 LD	HL,SCRAP
000D14 F9   
000D15 50   
000D16 5E      2507 LD	E,(HL)
000D17 23      2508 INC	HL
000D18 56      2509 LD	D,(HL)
000D19 23      2510 INC	HL
000D1A 7E      2511 LD	A,(HL)
000D1B 23      2512 INC	HL
000D1C 66      2513 LD	H,(HL)
000D1D 6F      2514 LD	L,A
000D1E EB      2515 EX	DE,HL
000D1F C9      2516 RET
000D20 3E      2523 GETIMS:         LD	A,14
000D21 0E   
000D22 21      2524 LD	HL,SCRAP
000D23 F9   
000D24 50   
000D25 36      2525 LD	(HL),0
000D26 00   
000D27 CD      2526 CALL	OSWORD
000D28 4D   
000D29 08   
000D2A 21      2527 LD	HL,SCRAP
000D2B F9   
000D2C 50   
000D2D 11      2528 LD	DE,ACCS
000D2E 00   
000D2F 52   
000D30 7E      2529 LD	A,(HL)
000D31 BB      2530 CP	E
000D32 C8      2531 RET	Z
000D33 01      2532 LD	BC,25
000D34 19   
000D35 00   
000D36 ED      2533 LDIR
000D37 B0   
000D38 C9      2534 RET
000D39 DD      2541 PUTIME:         PUSH	IX
000D3A E5   
000D3B DD      2542 LD	IX,SCRAP
000D3C 21   
000D3D F9   
000D3E 50   
000D3F DD      2543 LD	(IX+0),L
000D40 75   
000D41 00   
000D42 DD      2544 LD	(IX+1),H
000D43 74   
000D44 01   
000D45 DD      2545 LD	(IX+2),E
000D46 73   
000D47 02   
000D48 DD      2546 LD	(IX+3),D
000D49 72   
000D4A 03   
000D4B 3E      2547 LD	A,2
000D4C 02   
000D4D 21      2548 LD	HL,SCRAP
000D4E F9   
000D4F 50   
000D50 CD      2549 CALL	OSWORD
000D51 4D   
000D52 08   
000D53 DD      2550 POP	IX
000D54 E1   
000D55 C9      2551 RET
000D56 7B      2558 PUTIMS:         LD	A,E		;Length
000D57 FE      2559 CP	26
000D58 1A   
000D59 D0      2560 RET	NC
000D5A 06      2561 LD	B,0
000D5B 00   
000D5C 4F      2562 LD	C,A
000D5D 11      2563 LD	DE,SCRAP+1
000D5E FA   
000D5F 50   
000D60 21      2564 LD	HL,ACCS
000D61 00   
000D62 52   
000D63 ED      2565 LDIR
000D64 B0   
000D65 21      2566 LD	HL,SCRAP
000D66 F9   
000D67 50   
000D68 77      2567 LD	(HL),A
000D69 3E      2568 LD	A,15
000D6A 0F   
000D6B C3      2569 JP	OSWORD
000D6C 4D   
000D6D 08   
000D6E 3E      2575 CLRSCN:         LD	A,0CH
000D6F 0C   
000D70 C3      2576 JP	OSWRCH
000D71 93   
000D72 05   
000D73 3E      2585 OSKEY:          LD	A,129
000D74 81   
000D75 CD      2586 CALL	OSBYTE
000D76 6B   
000D77 08   
000D78 7C      2587 LD	A,H
000D79 B7      2588 OR	A
000D7A C0      2589 RET	NZ		;TIME-OUT, CARRY RESET
000D7B 7D      2590 LD	A,L
000D7C 37      2591 SCF
000D7D C9      2592 RET			;NORMAL, CARRY SET
000D7E 3E      2599 PUTCSR:         LD	A,1FH
000D7F 1F   
000D80 CD      2600 CALL	OSWRCH
000D81 93   
000D82 05   
000D83 7B      2601 LD	A,E
000D84 CD      2602 CALL	OSWRCH
000D85 93   
000D86 05   
000D87 7D      2603 LD	A,L
000D88 C3      2604 JP	OSWRCH
000D89 93   
000D8A 05   
000D8B 3E      2611 GETCSR:         LD	A,134
000D8C 86   
000D8D CD      2612 CALL	OSBYTE
000D8E 6B   
000D8F 08   
000D90 5D      2613 LD	E,L
000D91 6C      2614 LD	L,H
000D92 16      2615 LD	D,0
000D93 00   
000D94 62      2616 LD	H,D
000D95 C9      2617 RET
000D96 CD      2621 POINT:          CALL	EXPRI
000D97 15   
000D98 18   
000D99 D9      2622 EXX
000D9A E5      2623 PUSH	HL
000D9B CD      2624 CALL	CEXPRI
000D9C D3   
000D9D 10   
000D9E D9      2625 EXX
000D9F D1      2626 POP	DE
000DA0 CD      2627 CALL	BRAKET
000DA1 90   
000DA2 20   
000DA3 DD      2628 LD	IX,SCRAP
000DA4 21   
000DA5 F9   
000DA6 50   
000DA7 DD      2629 LD	(IX+0),E
000DA8 73   
000DA9 00   
000DAA DD      2630 LD	(IX+1),D
000DAB 72   
000DAC 01   
000DAD DD      2631 LD	(IX+2),L
000DAE 75   
000DAF 02   
000DB0 DD      2632 LD	(IX+3),H
000DB1 74   
000DB2 03   
000DB3 21      2633 LD	HL,SCRAP
000DB4 F9   
000DB5 50   
000DB6 3E      2634 LD	A,9
000DB7 09   
000DB8 CD      2635 CALL	OSWORD
000DB9 4D   
000DBA 08   
000DBB DD      2636 LD	A,(IX+4)
000DBC 7E   
000DBD 04   
000DBE 6F      2637 LD	L,A
000DBF C6      2638 ADD	A,1
000DC0 01   
000DC1 9F      2639 SBC	A,A
000DC2 67      2640 LD	H,A
000DC3 D9      2641 RETEXX:         EXX
000DC4 67      2642 LD	H,A
000DC5 6F      2643 LD	L,A
000DC6 AF      2644 XOR	A
000DC7 4F      2645 LD	C,A
000DC8 C9      2646 RET
000DC9 CD      2650 ADVAL:          CALL	ITEMI
000DCA 42   
000DCB 18   
000DCC D9      2651 EXX
000DCD 3E      2652 LD	A,128
000DCE 80   
000DCF CD      2653 CALL	OSBYTE
000DD0 6B   
000DD1 08   
000DD2 AF      2654 XOR	A
000DD3 18      2655 JR	RETEXX
000DD4 EE   
000DD5 3E      2659 MODEFN:         LD	A,135
000DD6 87   
000DD7 CD      2660 CALL	OSBYTE
000DD8 6B   
000DD9 08   
000DDA 6C      2661 LD	L,H
000DDB AF      2662 RETU8:          XOR	A
000DDC 67      2663 LD	H,A
000DDD 18      2664 JR	RETEXX
000DDE E4   
000DDF 3A      2668 WIDFN:          LD	A,(WIDTH)
000DE0 FC   
000DE1 54   
000DE2 6F      2669 LD	L,A
000DE3 18      2670 JR	RETU8
000DE4 F6   
000DE5 06      2675 ENVEL:          LD	B,0
000DE6 00   
000DE7 DD      2676 LD	IX,SCRAP
000DE8 21   
000DE9 F9   
000DEA 50   
000DEB C5      2677 PUSH	BC
000DEC DD      2678 PUSH	IX
000DED E5   
000DEE CD      2679 ENVEL1:         CALL	EXPRI
000DEF 15   
000DF0 18   
000DF1 D9      2680 EXX
000DF2 DD      2681 POP	IX
000DF3 E1   
000DF4 C1      2682 POP	BC
000DF5 DD      2683 LD	(IX),L
000DF6 75   
000DF7 00   
000DF8 78      2684 LD	A,B
000DF9 FE      2685 CP	13
000DFA 0D   
000DFB 28      2686 JR	Z,ENVEL2
000DFC 0B   
000DFD 04      2687 INC	B
000DFE DD      2688 INC	IX
000DFF 23   
000E00 C5      2689 PUSH	BC
000E01 DD      2690 PUSH	IX
000E02 E5   
000E03 CD      2691 CALL	COMMA
000E04 84   
000E05 20   
000E06 18      2692 JR	ENVEL1
000E07 E6   
000E08 21      2693 ENVEL2:         LD	HL,SCRAP
000E09 F9   
000E0A 50   
000E0B 3E      2694 LD	A,8
000E0C 08   
000E0D CD      2695 CALL	OSWORD
000E0E 4D   
000E0F 08   
000E10 C3      2696 JP	XEQ
000E11 7B   
000E12 24   
000E13 06      2700 SOUND:          LD	B,0
000E14 00   
000E15 DD      2701 LD	IX,SCRAP
000E16 21   
000E17 F9   
000E18 50   
000E19 C5      2702 PUSH	BC
000E1A DD      2703 PUSH	IX
000E1B E5   
000E1C CD      2704 SOUND1:         CALL	EXPRI
000E1D 15   
000E1E 18   
000E1F D9      2705 EXX
000E20 DD      2706 POP	IX
000E21 E1   
000E22 C1      2707 POP	BC
000E23 DD      2708 LD	(IX+0),L
000E24 75   
000E25 00   
000E26 DD      2709 LD	(IX+1),H
000E27 74   
000E28 01   
000E29 DD      2710 INC	IX
000E2A 23   
000E2B DD      2711 INC	IX
000E2C 23   
000E2D 04      2712 INC	B
000E2E 04      2713 INC	B
000E2F 78      2714 LD	A,B
000E30 FE      2715 CP	8
000E31 08   
000E32 28      2716 JR	Z,SOUND2
000E33 08   
000E34 C5      2717 PUSH	BC
000E35 DD      2718 PUSH	IX
000E36 E5   
000E37 CD      2719 CALL	COMMA
000E38 84   
000E39 20   
000E3A 18      2720 JR	SOUND1
000E3B E0   
000E3C 21      2721 SOUND2:         LD	HL,SCRAP
000E3D F9   
000E3E 50   
000E3F 3E      2722 LD	A,7
000E40 07   
000E41 CD      2723 CALL	OSWORD
000E42 4D   
000E43 08   
000E44 C3      2724 JP	XEQ
000E45 7B   
000E46 24   
000E47 CD      2728 MODE:           CALL	EXPRI
000E48 15   
000E49 18   
000E4A AF      2729 XOR	A
000E4B 32      2730 LD	(COUNT),A
000E4C FB   
000E4D 54   
000E4E D9      2731 EXX
000E4F 65      2732 LD	H,L
000E50 2E      2733 LD	L,22
000E51 16   
000E52 CD      2734 CALL	WRCH2
000E53 BA   
000E54 10   
000E55 18      2735 JR	XEQGO1
000E56 72   
000E57 3E      2739 CLG:            LD	A,16
000E58 10   
000E59 CD      2740 CALL	OSWRCH
000E5A 93   
000E5B 05   
000E5C 18      2741 JR	XEQGO1
000E5D 6B   
000E5E CD      2745 ORIGIN:         CALL    EXPRI
000E5F 15   
000E60 18   
000E61 D9      2746 EXX
000E62 E5      2747 PUSH	HL
000E63 CD      2748 CALL    CEXPRI
000E64 D3   
000E65 10   
000E66 D9      2749 EXX
000E67 D1      2750 POP	DE
000E68 0E      2751 LD	C,29
000E69 1D   
000E6A CD      2752 CALL	WRCH5
000E6B AE   
000E6C 10   
000E6D 18      2753 JR	XEQGO1
000E6E 5A   
000E6F CD      2759 COLOUR:         CALL	EXPRI		;n
000E70 15   
000E71 18   
000E72 D9      2760 EXX
000E73 FD      2761 LD	A,(IY)
000E74 7E   
000E75 00   
000E76 FE      2762 CP	','
000E77 2C   
000E78 28      2763 JR      Z,PALCOL
000E79 08   
000E7A 65      2764 LD	H,L
000E7B 2E      2765 LD	L,17
000E7C 11   
000E7D CD      2766 CALL	WRCH2
000E7E BA   
000E7F 10   
000E80 18      2767 JR	XEQGO1
000E81 47   
000E82 E5      2769 PALCOL:         PUSH	HL
000E83 CD      2770 CALL	CEXPRI		;p or r
000E84 D3   
000E85 10   
000E86 D9      2771 EXX
000E87 EB      2772 EX	DE,HL
000E88 21      2773 LD	HL,0
000E89 00   
000E8A 00   
000E8B FD      2774 LD	A,(IY)
000E8C 7E   
000E8D 00   
000E8E FE      2775 CP	','
000E8F 2C   
000E90 20      2776 JR	NZ,PALET1
000E91 15   
000E92 D5      2777 PUSH	DE
000E93 CD      2778 CALL	CEXPRI		;g
000E94 D3   
000E95 10   
000E96 D9      2779 EXX
000E97 E5      2780 PUSH	HL
000E98 CD      2781 CALL	CEXPRI		;b
000E99 D3   
000E9A 10   
000E9B D9      2782 EXX
000E9C D1      2783 POP	DE
000E9D C1      2784 POP	BC
000E9E 7D      2785 LD	A,L
000E9F E1      2786 POP	HL
000EA0 51      2787 LD	D,C		;r
000EA1 4D      2788 LD	C,L		;n
000EA2 6B      2789 LD	L,E		;g
000EA3 67      2790 LD	H,A		;b
000EA4 1E      2791 LD	E,16
000EA5 10   
000EA6 C5      2792 PUSH	BC
000EA7 C1      2793 PALET1:         POP	BC
000EA8 06      2794 LD	B,19
000EA9 13   
000EAA CD      2795 CALL	WRCH6
000EAB AA   
000EAC 10   
000EAD 18      2796 JR	XEQGO1
000EAE 1A   
000EAF CD      2800 GCOL:           CALL	EXPRI
000EB0 15   
000EB1 18   
000EB2 D9      2801 EXX
000EB3 1E      2802 LD	E,0
000EB4 00   
000EB5 FD      2803 LD	A,(IY)
000EB6 7E   
000EB7 00   
000EB8 FE      2804 CP	','
000EB9 2C   
000EBA 20      2805 JR	NZ,GCOL0
000EBB 06   
000EBC E5      2806 PUSH	HL
000EBD CD      2807 CALL	CEXPRI
000EBE D3   
000EBF 10   
000EC0 D9      2808 EXX
000EC1 D1      2809 POP	DE
000EC2 65      2810 GCOL0:          LD	H,L
000EC3 6B      2811 LD	L,E
000EC4 16      2812 LD	D,18
000EC5 12   
000EC6 CD      2813 CALL	WRCH3		;DLH
000EC7 B6   
000EC8 10   
000EC9 C3      2814 XEQGO1:         JP	XEQ
000ECA 7B   
000ECB 24   
000ECC 0E      2819 CSRON:          LD	C,1
000ECD 01   
000ECE 18      2820 JR	CSRGO
000ECF 02   
000ED0 0E      2822 CSROFF:         LD	C,0
000ED1 00   
000ED2 3E      2823 CSRGO:          LD	A,23
000ED3 17   
000ED4 CD      2824 CALL	OSWRCH
000ED5 93   
000ED6 05   
000ED7 3E      2825 LD	A,1
000ED8 01   
000ED9 CD      2826 CALL	OSWRCH
000EDA 93   
000EDB 05   
000EDC 79      2827 LD	A,C
000EDD 06      2828 LD	B,8
000EDE 08   
000EDF CD      2829 CSRGO1:         CALL	OSWRCH
000EE0 93   
000EE1 05   
000EE2 AF      2830 XOR	A
000EE3 10      2831 DJNZ	CSRGO1
000EE4 FA   
000EE5 18      2832 JR	XEQGO1
000EE6 E2   
000EE7 CD      2836 LINE:           CALL	EXPRI
000EE8 15   
000EE9 18   
000EEA D9      2837 EXX
000EEB E5      2838 PUSH	HL
000EEC CD      2839 CALL	EXPR3
000EED C2   
000EEE 10   
000EEF E3      2840 EX	(SP),HL		;HL <- x1, (SP) <- y2
000EF0 C5      2841 PUSH	BC
000EF1 EB      2842 EX	DE,HL
000EF2 0E      2843 LD	C,4
000EF3 04   
000EF4 CD      2844 CALL	VDU25
000EF5 A8   
000EF6 10   
000EF7 D1      2845 POP	DE
000EF8 E1      2846 POP	HL
000EF9 0E      2847 LD	C,5
000EFA 05   
000EFB 18      2848 JR	PLOT4A
000EFC 2A   
000EFD FE      2852 CIRCLE:         CP	TFILL
000EFE 03   
000EFF F5      2853 PUSH	AF
000F00 20      2854 JR	NZ,CIRCL0
000F01 02   
000F02 FD      2855 INC	IY
000F03 23   
000F04 CD      2856 CIRCL0:         CALL	EXPRI
000F05 15   
000F06 18   
000F07 D9      2857 EXX
000F08 E5      2858 PUSH	HL
000F09 CD      2859 CALL	CEXPRI
000F0A D3   
000F0B 10   
000F0C D9      2860 EXX
000F0D E5      2861 PUSH	HL
000F0E CD      2862 CALL	CEXPRI
000F0F D3   
000F10 10   
000F11 D9      2863 EXX
000F12 C1      2864 POP	BC		;y
000F13 D1      2865 POP	DE		;x
000F14 E5      2866 PUSH	HL
000F15 69      2867 LD	L,C
000F16 60      2868 LD	H,B
000F17 0E      2869 LD	C,4		; PLOT 4 = MOVE
000F18 04   
000F19 CD      2870 CALL	VDU25
000F1A A8   
000F1B 10   
000F1C D1      2871 POP	DE		;r
000F1D 21      2872 LD	HL,0
000F1E 00   
000F1F 00   
000F20 F1      2873 POP	AF
000F21 0E      2874 LD	C,145		; PLOT 145 = outline circle
000F22 91   
000F23 20      2875 JR	NZ,PLOT4A
000F24 02   
000F25 0E      2876 LD	C,153		; PLOT 153 = filled circle
000F26 99   
000F27 18      2877 PLOT4A:         JR	PLOT4
000F28 6C   
000F29 FE      2881 ELLIPS:         CP	TFILL
000F2A 03   
000F2B F5      2882 PUSH	AF
000F2C 20      2883 JR	NZ,ELLIP0
000F2D 02   
000F2E FD      2884 INC	IY
000F2F 23   
000F30 CD      2885 ELLIP0:         CALL	EXPRI
000F31 15   
000F32 18   
000F33 D9      2886 EXX
000F34 E5      2887 PUSH	HL
000F35 CD      2888 CALL	EXPR3
000F36 C2   
000F37 10   
000F38 E3      2889 EX	(SP),HL		;HL <- x, (SP) <- b
000F39 C5      2890 PUSH	BC
000F3A EB      2891 EX	DE,HL
000F3B 0E      2892 LD	C,4		; PLOT 4 = Move absolute
000F3C 04   
000F3D CD      2893 CALL	VDU25
000F3E A8   
000F3F 10   
000F40 D1      2894 POP	DE		;a
000F41 D5      2895 PUSH	DE
000F42 21      2896 LD	HL,0
000F43 00   
000F44 00   
000F45 4D      2897 LD	C,L		; PLOT 0 - Move relative
000F46 CD      2898 CALL	VDU25
000F47 A8   
000F48 10   
000F49 D1      2899 POP	DE		;a
000F4A AF      2900 XOR	A
000F4B 6F      2901 LD	L,A
000F4C 67      2902 LD	H,A
000F4D ED      2903 SBC	HL,DE
000F4E 52   
000F4F EB      2904 EX	DE,HL
000F50 E1      2905 POP	HL		;b
000F51 F1      2906 POP	AF
000F52 0E      2907 LD	C,193		; PLOT 193 = outline ellipse
000F53 C1   
000F54 20      2908 JR	NZ,PLOT4
000F55 3F   
000F56 0E      2909 LD	C,201		; PLOT 201 = filled ellipse
000F57 C9   
000F58 18      2910 JR	PLOT4
000F59 3B   
000F5A 0E      2917 MOVE:           LD	C,4
000F5B 04   
000F5C 18      2918 JR	PLOT1
000F5D 23   
000F5E 0E      2920 DRAW:           LD	C,5
000F5F 05   
000F60 18      2921 JR	PLOT1
000F61 1F   
000F62 0E      2923 FILL:           LD	C,133
000F63 85   
000F64 18      2924 JR	PLOT1
000F65 1B   
000F66 0E      2926 PLOT:           LD	C,69
000F67 45   
000F68 FE      2927 CP	TBY
000F69 0F   
000F6A 28      2928 JR	Z,PLOT1
000F6B 15   
000F6C CD      2929 CALL	EXPRI
000F6D 15   
000F6E 18   
000F6F D9      2930 EXX
000F70 E5      2931 PUSH	HL
000F71 CD      2932 CALL	CEXPRI
000F72 D3   
000F73 10   
000F74 D9      2933 EXX
000F75 FD      2934 LD	A,(IY)
000F76 7E   
000F77 00   
000F78 FE      2935 CP	','
000F79 2C   
000F7A 28      2936 JR	Z,PLOT3
000F7B 12   
000F7C D1      2937 POP	DE
000F7D 0E      2938 LD	C,69
000F7E 45   
000F7F 18      2939 JR	PLOT4
000F80 14   
000F81 FE      2941 PLOT1:          CP	TBY
000F82 0F   
000F83 20      2942 JR	NZ,PLOT2
000F84 04   
000F85 FD      2943 INC	IY
000F86 23   
000F87 CB      2944 RES	2,C		;Change absolute to relative
000F88 91   
000F89 C5      2945 PLOT2:          PUSH	BC
000F8A CD      2946 CALL	EXPRI
000F8B 15   
000F8C 18   
000F8D D9      2947 EXX
000F8E E5      2948 PLOT3:          PUSH	HL
000F8F CD      2949 CALL	CEXPRI
000F90 D3   
000F91 10   
000F92 D9      2950 EXX
000F93 D1      2951 POP	DE
000F94 C1      2952 POP	BC
000F95 CD      2953 PLOT4:          CALL	VDU25
000F96 A8   
000F97 10   
000F98 C3      2954 JP	XEQ
000F99 7B   
000F9A 24   
000F9B FE      2958 RECTAN:         CP	TFILL
000F9C 03   
000F9D F5      2959 PUSH	AF
000F9E 20      2960 JR	NZ,RECT0
000F9F 02   
000FA0 FD      2961 INC	IY
000FA1 23   
000FA2 CD      2962 RECT0:          CALL	EXPRI
000FA3 15   
000FA4 18   
000FA5 D9      2963 EXX
000FA6 E5      2964 PUSH	HL
000FA7 CD      2965 CALL	CEXPRI
000FA8 D3   
000FA9 10   
000FAA D9      2966 EXX
000FAB E5      2967 PUSH	HL
000FAC CD      2968 CALL	CEXPRI
000FAD D3   
000FAE 10   
000FAF D9      2969 EXX
000FB0 E5      2970 PUSH	HL
000FB1 FD      2971 LD	A,(IY)
000FB2 7E   
000FB3 00   
000FB4 FE      2972 CP	','
000FB5 2C   
000FB6 20      2973 JR	NZ,RECT1
000FB7 04   
000FB8 CD      2974 CALL	CEXPRI
000FB9 D3   
000FBA 10   
000FBB D9      2975 EXX
000FBC C1      2976 RECT1:          POP	BC		;w
000FBD D1      2977 POP	DE		;y
000FBE E3      2978 EX	(SP),HL		;HL <- x, (SP) <- h
000FBF C5      2979 PUSH	BC
000FC0 EB      2980 EX	DE,HL
000FC1 0E      2981 LD	C,4
000FC2 04   
000FC3 CD      2982 CALL	VDU25
000FC4 A8   
000FC5 10   
000FC6 FD      2983 LD	A,(IY)
000FC7 7E   
000FC8 00   
000FC9 FE      2984 CP	TTO
000FCA B8   
000FCB 28      2985 JR	Z,RECTTO
000FCC 09   
000FCD D1      2986 POP	DE		;w
000FCE E1      2987 POP	HL		;h
000FCF F1      2988 POP	AF
000FD0 20      2989 JR	NZ,OUTLIN
000FD1 22   
000FD2 0E      2990 LD	C,97
000FD3 61   
000FD4 18      2991 JR	PLOT4
000FD5 BF   
000FD6 FD      2995 RECTTO:         INC	IY		; Bump over TO
000FD7 23   
000FD8 CD      2996 CALL	EXPRI
000FD9 15   
000FDA 18   
000FDB D9      2997 EXX
000FDC E5      2998 PUSH	HL
000FDD CD      2999 CALL	CEXPRI
000FDE D3   
000FDF 10   
000FE0 D9      3000 EXX
000FE1 C1      3001 POP	BC		;newx
000FE2 D1      3002 POP	DE		;w
000FE3 E3      3003 EX	(SP),HL		;HL <- h, (SP) <- newy
000FE4 C5      3004 PUSH	BC
000FE5 0E      3005 LD	C,0
000FE6 00   
000FE7 CD      3006 CALL	VDU25
000FE8 A8   
000FE9 10   
000FEA D1      3007 POP	DE		;newx
000FEB E1      3008 POP	HL		;newy
000FEC F1      3009 POP	AF
000FED 0E      3010 LD	C,190		; PLOT 190 - Block copy
000FEE BE   
000FEF 20      3011 JR	NZ,PLOT4B
000FF0 01   
000FF1 0D      3012 DEC	C		; PLOT 189 - Block move
000FF2 18      3013 PLOT4B:         JR	PLOT4
000FF3 A1   
000FF4 0E      3017 OUTLIN:         LD	C,9		; PLOT 9 - draw relative
000FF5 09   
000FF6 E5      3018 PUSH	HL
000FF7 21      3019 LD	HL,0
000FF8 00   
000FF9 00   
000FFA CD      3020 CALL	VDU25		; side 1
000FFB A8   
000FFC 10   
000FFD E1      3021 POP	HL
000FFE D5      3022 PUSH	DE
000FFF 11      3023 LD	DE,0
001000 00   
001001 00   
001002 CD      3024 CALL	VDU25		; side 2
001003 A8   
001004 10   
001005 D1      3025 POP	DE
001006 E5      3026 PUSH	HL
001007 AF      3027 XOR	A
001008 6F      3028 LD	L,A
001009 67      3029 LD	H,A
00100A ED      3030 SBC	HL,DE
00100B 52   
00100C EB      3031 EX	DE,HL
00100D 6F      3032 LD	L,A
00100E 67      3033 LD	H,A
00100F CD      3034 CALL 	VDU25		; side 3
001010 A8   
001011 10   
001012 D1      3035 POP	DE
001013 AF      3036 XOR	A
001014 6F      3037 LD	L,A
001015 67      3038 LD	H,A
001016 ED      3039 SBC	HL,DE
001017 52   
001018 5F      3040 LD	E,A
001019 57      3041 LD	D,A
00101A 18      3042 JR	PLOT4B
00101B D6   
00101C 3E      3046 MOUSE:          LD	A,128
00101D 80   
00101E 21      3047 LD	HL,9
00101F 09   
001020 00   
001021 CD      3048 CALL	OSBYTE
001022 6B   
001023 08   
001024 E5      3049 PUSH	HL
001025 3E      3050 LD	A,128
001026 80   
001027 21      3051 LD	HL,8
001028 08   
001029 00   
00102A CD      3052 CALL	OSBYTE
00102B 6B   
00102C 08   
00102D E5      3053 PUSH	HL
00102E 3E      3054 LD	A,128
00102F 80   
001030 21      3055 LD	HL,7
001031 07   
001032 00   
001033 CD      3056 CALL	OSBYTE
001034 6B   
001035 08   
001036 E5      3057 PUSH	HL
001037 CD      3058 CALL	VAR_
001038 B8   
001039 25   
00103A E1      3059 POP	HL
00103B CD      3060 CALL	STOREI
00103C D9   
00103D 10   
00103E CD      3061 CALL	COMMA
00103F 84   
001040 20   
001041 CD      3062 CALL	NXT
001042 ED   
001043 44   
001044 CD      3063 CALL	VAR_
001045 B8   
001046 25   
001047 E1      3064 POP	HL
001048 CD      3065 CALL	STOREI
001049 D9   
00104A 10   
00104B CD      3066 CALL	COMMA
00104C 84   
00104D 20   
00104E CD      3067 CALL	NXT
00104F ED   
001050 44   
001051 CD      3068 CALL	VAR_
001052 B8   
001053 25   
001054 E1      3069 POP	HL
001055 CD      3070 CALL	STOREI
001056 D9   
001057 10   
001058 C3      3071 XEQGO2:         JP	XEQ
001059 7B   
00105A 24   
00105B CD      3075 WAIT:           CALL	TERMQ
00105C 18   
00105D 35   
00105E 28      3076 JR	Z,XEQGO2
00105F F8   
001060 CD      3077 CALL	EXPRI
001061 15   
001062 18   
001063 D9      3078 EXX
001064 44      3079 LD	B,H
001065 4D      3080 LD	C,L
001066 CD      3081 CALL	GETIME
001067 0B   
001068 0D   
001069 09      3082 ADD	HL,BC
00106A 01      3083 LD	BC,0
00106B 00   
00106C 00   
00106D EB      3084 EX	DE,HL
00106E ED      3085 ADC	HL,BC
00106F 4A   
001070 EB      3086 EX	DE,HL
001071 CD      3087 WAIT1:          CALL	TRAP
001072 15   
001073 06   
001074 D5      3088 PUSH	DE
001075 E5      3089 PUSH	HL
001076 CD      3090 CALL	GETIME
001077 0B   
001078 0D   
001079 C1      3091 POP	BC
00107A B7      3092 OR	A
00107B ED      3093 SBC	HL,BC
00107C 42   
00107D 60      3094 LD	H,B
00107E 69      3095 LD	L,C
00107F EB      3096 EX	DE,HL
001080 C1      3097 POP	BC
001081 ED      3098 SBC	HL,BC
001082 42   
001083 30      3099 JR	NC,XEQGO2
001084 D3   
001085 EB      3100 EX	DE,HL
001086 50      3101 LD	D,B
001087 59      3102 LD	E,C
001088 18      3103 JR	WAIT1
001089 E7   
00108A E1      3107 OSCALL:         POP	HL		;DITCH RETURN ADDRESS
00108B 21      3108 LD	HL,OSRET
00108C 9D   
00108D 10   
00108E E5      3109 PUSH	HL		;NEW RETURN ADDRESS
00108F DD      3110 LD	A,(IX+4)	;A%
001090 7E   
001091 04   
001092 DD      3111 LD	E,(IX+20)	;E%
001093 5E   
001094 14   
001095 DD      3112 LD	H,(IX+100)	;Y%
001096 66   
001097 64   
001098 DD      3113 LD	L,(IX+96)	;X%
001099 6E   
00109A 60   
00109B FD      3114 JP	(IY)
00109C E9   
00109D F5      3115 OSRET:          PUSH	AF
00109E 7D      3116 LD	A,L		;F  H  L  A
00109F 6C      3117 LD	L,H		;|  |  |  |
0010A0 D9      3118 EXX			;|  |  |  |
0010A1 C1      3119 POP	BC		;|  |  |  |
0010A2 67      3120 LD	H,A		;|  |  |  |
0010A3 68      3121 LD	L,B		;H  L  H' L'
0010A4 79      3122 LD	A,C
0010A5 D9      3123 EXX
0010A6 67      3124 LD	H,A
0010A7 C9      3125 RET
0010A8 06      3127 VDU25:          LD	B,25
0010A9 19   
0010AA 78      3128 WRCH6:          LD	A,B
0010AB CD      3129 CALL	OSWRCH
0010AC 93   
0010AD 05   
0010AE 79      3130 WRCH5:          LD	A,C
0010AF CD      3131 CALL	OSWRCH
0010B0 93   
0010B1 05   
0010B2 7B      3132 WRCH4:          LD	A,E
0010B3 CD      3133 CALL	OSWRCH
0010B4 93   
0010B5 05   
0010B6 7A      3134 WRCH3:          LD	A,D
0010B7 CD      3135 CALL	OSWRCH
0010B8 93   
0010B9 05   
0010BA 7D      3136 WRCH2:          LD	A,L
0010BB CD      3137 CALL	OSWRCH
0010BC 93   
0010BD 05   
0010BE 7C      3138 LD	A,H
0010BF C3      3139 JP	OSWRCH
0010C0 93   
0010C1 05   
0010C2 CD      3141 EXPR3:          CALL	CEXPRI
0010C3 D3   
0010C4 10   
0010C5 D9      3142 EXX
0010C6 E5      3143 PUSH	HL
0010C7 CD      3144 CALL	CEXPRI
0010C8 D3   
0010C9 10   
0010CA D9      3145 EXX
0010CB E5      3146 PUSH	HL
0010CC CD      3147 CALL	CEXPRI
0010CD D3   
0010CE 10   
0010CF D9      3148 EXX
0010D0 C1      3149 POP	BC		;x2
0010D1 D1      3150 POP	DE		;y1
0010D2 C9      3151 RET
0010D3 CD      3153 CEXPRI:         CALL	COMMA
0010D4 84   
0010D5 20   
0010D6 C3      3154 JP	EXPRI
0010D7 15   
0010D8 18   
0010D9 CB      3156 STOREI:         BIT	7,A
0010DA 7F   
0010DB 20      3157 JR	NZ,EEK
0010DC 0C   
0010DD CB      3158 BIT	6,A
0010DE 77   
0010DF 20      3159 JR	NZ,EEK
0010E0 08   
0010E1 D9      3160 EXX
0010E2 21      3161 LD	HL,0
0010E3 00   
0010E4 00   
0010E5 4D      3162 LD	C,L
0010E6 C3      3163 JP	STOREN
0010E7 D2   
0010E8 31   
0010E9 3E      3165 EEK:            LD	A,50
0010EA 32   
0010EB CD      3166 CALL	EXTERR
0010EC 37   
0010ED 3F   
0010EE 13      3167 DB	13H		;'Bad '
0010EF 04      3168 DB	04H		;'MOUSE'
0010F0 20      3169 DB	20H
0010F1 15      3170 DB	15H		;'variable'
0010F2 00      3171 DB	0
0010F3 AF      3176 XOR	A
0010F4 CD      3177 CALL	EXTERR
0010F5 37   
0010F6 3F   
0010F7 53      3178 DB	"Sorry"
0010F8 6F   
0010F9 72   
0010FA 72   
0010FB 79   
0010FC 00      3179 DB	0
0010FD             3184   ; --- Begin asmb.asm ---
0010FD CD      3231 ASSEM:          CALL	SKIP
0010FE 85   
0010FF 14   
001100 FD      3232 INC	IY
001101 23   
001102 FE      3233 CP	':'
001103 3A   
001104 28      3234 JR	Z,ASSEM
001105 F7   
001106 FE      3235 CP	']'
001107 5D   
001108 C8      3236 RET	Z
001109 FE      3237 CP	CR
00110A 0D   
00110B C8      3238 RET	Z
00110C FD      3239 DEC	IY
00110D 2B   
00110E DD      3240 LD	IX,(PC)		;PROGRAM COUNTER
00110F 2A   
001110 40   
001111 54   
001112 21      3241 LD	HL,LISTON
001113 FE   
001114 54   
001115 CB      3242 BIT	6,(HL)
001116 76   
001117 28      3243 JR	Z,ASSEM0
001118 04   
001119 DD      3244 LD	IX,(OC)		;ORIGIN of CODE
00111A 2A   
00111B 3C   
00111C 54   
00111D DD      3245 ASSEM0:         PUSH	IX
00111E E5   
00111F FD      3246 PUSH	IY
001120 E5   
001121 CD      3247 CALL	ASMB
001122 B1   
001123 11   
001124 C1      3248 POP	BC
001125 D1      3249 POP	DE
001126 D8      3250 RET	C
001127 CD      3251 CALL	SKIP
001128 85   
001129 14   
00112A 37      3252 SCF
00112B C0      3253 RET	NZ
00112C FD      3254 DEC	IY
00112D 2B   
00112E FD      3255 ASSEM3:         INC	IY
00112F 23   
001130 FD      3256 LD	A,(IY)
001131 7E   
001132 00   
001133 CD      3257 CALL	TERM0
001134 A9   
001135 14   
001136 20      3258 JR	NZ,ASSEM3
001137 F6   
001138 3A      3259 LD	A,(LISTON)
001139 FE   
00113A 54   
00113B DD      3260 PUSH	IX
00113C E5   
00113D E1      3261 POP	HL
00113E B7      3262 OR	A
00113F ED      3263 SBC	HL,DE
001140 52   
001141 EB      3264 EX	DE,HL		;DE= NO. OF BYTES
001142 E5      3265 PUSH	HL
001143 2A      3266 LD	HL,(PC)
001144 40   
001145 54   
001146 E5      3267 PUSH	HL
001147 19      3268 ADD	HL,DE
001148 22      3269 LD	(PC),HL		;UPDATE PC
001149 40   
00114A 54   
00114B CB      3270 BIT	6,A
00114C 77   
00114D 28      3271 JR	Z,ASSEM5
00114E 07   
00114F 2A      3272 LD	HL,(OC)
001150 3C   
001151 54   
001152 19      3273 ADD	HL,DE
001153 22      3274 LD	(OC),HL		;UPDATE OC
001154 3C   
001155 54   
001156 E1      3275 ASSEM5:         POP	HL		;OLD PC
001157 DD      3276 POP	IX		;CODE HERE
001158 E1   
001159 CB      3277 BIT	4,A
00115A 67   
00115B 28      3278 JR	Z,ASSEM
00115C A0   
00115D 7C      3279 LD	A,H
00115E CD      3280 CALL	HEX
00115F 9D   
001160 11   
001161 7D      3281 LD	A,L
001162 CD      3282 CALL	HEXSP
001163 96   
001164 11   
001165 AF      3283 XOR	A
001166 BB      3284 CP	E
001167 28      3285 JR	Z,ASSEM2
001168 15   
001169 3A      3286 ASSEM1:         LD	A,(COUNT)
00116A FB   
00116B 54   
00116C FE      3287 CP	17
00116D 11   
00116E 3E      3288 LD	A,5
00116F 05   
001170 D4      3289 CALL	NC,TABIT	;NEXT LINE
001171 5F   
001172 35   
001173 DD      3290 LD	A,(IX)
001174 7E   
001175 00   
001176 CD      3291 CALL	HEXSP
001177 96   
001178 11   
001179 DD      3292 INC	IX
00117A 23   
00117B 1D      3293 DEC	E
00117C 20      3294 JR	NZ,ASSEM1
00117D EB   
00117E 3E      3295 ASSEM2:         LD	A,18
00117F 12   
001180 CD      3296 CALL	TABIT
001181 5F   
001182 35   
001183 FD      3297 PUSH	IY
001184 E5   
001185 E1      3298 POP	HL
001186 ED      3299 SBC	HL,BC
001187 42   
001188 0A      3300 ASSEM4:         LD	A,(BC)
001189 CD      3301 CALL	OUT
00118A FD   
00118B 40   
00118C 03      3302 INC	BC
00118D 2D      3303 DEC	L
00118E 20      3304 JR	NZ,ASSEM4
00118F F8   
001190 CD      3305 CALL	CRLF
001191 DD   
001192 40   
001193 C3      3306 JP	ASSEM
001194 FD   
001195 10   
001196 CD      3308 HEXSP:          CALL	HEX
001197 9D   
001198 11   
001199 3E      3309 LD	A,' '
00119A 20   
00119B 18      3310 JR	OUTCH1
00119C 11   
00119D F5      3311 HEX:            PUSH	AF
00119E 0F      3312 RRCA
00119F 0F      3313 RRCA
0011A0 0F      3314 RRCA
0011A1 0F      3315 RRCA
0011A2 CD      3316 CALL	HEXOUT
0011A3 A6   
0011A4 11   
0011A5 F1      3317 POP	AF
0011A6 E6      3318 HEXOUT:         AND	0FH
0011A7 0F   
0011A8 C6      3319 ADD	A,90H
0011A9 90   
0011AA 27      3320 DAA
0011AB CE      3321 ADC	A,40H
0011AC 40   
0011AD 27      3322 DAA
0011AE C3      3323 OUTCH1:         JP	OUT
0011AF FD   
0011B0 40   
0011B1 FE      3337 ASMB:           CP	'.'
0011B2 2E   
0011B3 20      3338 JR	NZ,ASMB1
0011B4 28   
0011B5 FD      3339 INC	IY
0011B6 23   
0011B7 DD      3340 PUSH	IX
0011B8 E5   
0011B9 CD      3341 CALL	VAR_
0011BA B8   
0011BB 25   
0011BC F5      3342 PUSH	AF
0011BD CD      3343 CALL	ZERO
0011BE DA   
0011BF 1F   
0011C0 D9      3344 EXX
0011C1 2A      3345 LD	HL,(PC)
0011C2 40   
0011C3 54   
0011C4 D9      3346 EXX
0011C5 3A      3347 LD	A,(LISTON)
0011C6 FE   
0011C7 54   
0011C8 E6      3348 AND	20H
0011C9 20   
0011CA 20      3349 JR	NZ,ASMB0
0011CB 0B   
0011CC DD      3350 LD	A,(IX)
0011CD 7E   
0011CE 00   
0011CF DD      3351 OR	(IX+1)
0011D0 B6   
0011D1 01   
0011D2 3E      3352 LD	A,3
0011D3 03   
0011D4 C2      3353 JP	NZ,ERROR_	;Multiple label
0011D5 26   
0011D6 3F   
0011D7 F1      3354 ASMB0:          POP	AF
0011D8 CD      3355 CALL	STOREN
0011D9 D2   
0011DA 31   
0011DB DD      3356 POP	IX
0011DC E1   
0011DD CD      3357 ASMB1:          CALL	SKIP
0011DE 85   
0011DF 14   
0011E0 C8      3358 RET	Z
0011E1 FE      3359 CP	TCALL
0011E2 D6   
0011E3 0E      3360 LD	C,0C4H
0011E4 C4   
0011E5 FD      3361 INC	IY
0011E6 23   
0011E7 CA      3362 JP	Z,GRPC
0011E8 D4   
0011E9 12   
0011EA FD      3363 DEC	IY
0011EB 2B   
0011EC 21      3364 LD	HL,OPCODS
0011ED AF   
0011EE 14   
0011EF CD      3365 CALL	FIND
0011F0 3C   
0011F1 14   
0011F2 D8      3366 RET	C
0011F3 48      3367 LD	C,B	;ROOT OPCODE
0011F4 16      3368 LD	D,0	;CLEAR IX/IY FLAG
0011F5 00   
0011F6 D6      3373 SUB	39
0011F7 27   
0011F8 30      3374 JR	NC,GROUP2
0011F9 07   
0011FA FE      3375 CP	15-39
0011FB E8   
0011FC D4      3376 CALL	NC,ED
0011FD A2   
0011FE 13   
0011FF 18      3377 JR	BYTE0
001200 68   
001201 D6      3382 GROUP2:         SUB	10
001202 0A   
001203 30      3383 JR	NC,GROUP4
001204 0F   
001205 FE      3384 CP	3-10
001206 F9   
001207 DC      3385 CALL	C,BIT
001208 2C   
001209 14   
00120A D8      3386 RET	C
00120B CD      3387 CALL	REGLO
00120C 01   
00120D 14   
00120E D8      3388 RET	C
00120F CD      3389 CALL	CB
001210 A6   
001211 13   
001212 18      3390 JR	BYTE0
001213 55   
001214 D6      3394 GROUP4:         SUB	3
001215 03   
001216 30      3395 JR	NC,GROUP5
001217 06   
001218 CD      3396 G4:             CALL	PAIRasm
001219 20   
00121A 14   
00121B D8      3397 RET	C
00121C 18      3398 JR	BYTE0
00121D 4B   
00121E D6      3403 GROUP5:         SUB	8+2
00121F 0A   
001220 30      3404 JR	NC,GROUP7
001221 32   
001222 FE      3405 CP	5-8
001223 FD   
001224 06      3406 LD	B,7
001225 07   
001226 D4      3407 CALL	NC,OPND
001227 B4   
001228 13   
001229 78      3408 LD	A,B
00122A FE      3409 CP	7
00122B 07   
00122C 20      3410 JR	NZ,G6HL
00122D 10   
00122E CD      3411 G6:             CALL	REGLO
00122F 01   
001230 14   
001231 79      3412 LD	A,C
001232 30      3413 JR	NC,BIND1
001233 28   
001234 EE      3414 XOR	46H
001235 46   
001236 CD      3415 CALL	BIND
001237 A8   
001238 13   
001239 CD      3416 DB:             CALL	NUMBER
00123A E4   
00123B 13   
00123C 18      3417 JR	VAL8
00123D 78   
00123E E6      3419 G6HL:           AND	3FH
00123F 3F   
001240 FE      3420 CP	12
001241 0C   
001242 37      3421 SCF
001243 C0      3422 RET	NZ
001244 79      3423 LD	A,C
001245 FE      3424 CP	80H
001246 80   
001247 0E      3425 LD	C,9
001248 09   
001249 28      3426 JR	Z,G4
00124A CD   
00124B EE      3427 XOR	1CH
00124C 1C   
00124D 0F      3428 RRCA
00124E 4F      3429 LD	C,A
00124F CD      3430 CALL	ED
001250 A2   
001251 13   
001252 18      3431 JR	G4
001253 C4   
001254 D6      3435 GROUP7:         SUB	2
001255 02   
001256 30      3436 JR	NC,GROUP8
001257 14   
001258 CD      3437 CALL	REGHI
001259 07   
00125A 14   
00125B 79      3438 LD	A,C
00125C D2      3439 BIND1:          JP	NC,BIND
00125D A8   
00125E 13   
00125F EE      3440 XOR	64H
001260 64   
001261 07      3441 RLCA
001262 07      3442 RLCA
001263 07      3443 RLCA
001264 4F      3444 LD	C,A
001265 CD      3445 CALL	PAIR1asm
001266 24   
001267 14   
001268 D8      3446 RET	C
001269 79      3447 BYTE0:          LD	A,C
00126A 18      3448 JR	BYTE2
00126B 7F   
00126C D6      3453 GROUP8:         SUB	2
00126D 02   
00126E 30      3454 JR	NC,GROUPA
00126F 21   
001270 FE      3455 CP	1-2
001271 FF   
001272 CC      3456 CALL	Z,CORN
001273 97   
001274 13   
001275 08      3457 EX	AF,AF'
001276 CD      3458 CALL	REGHI
001277 07   
001278 14   
001279 D8      3459 RET	C
00127A 08      3460 EX	AF,AF'
00127B DC      3461 CALL	C,CORN
00127C 97   
00127D 13   
00127E 24      3462 INC	H
00127F 28      3463 JR	Z,BYTE0
001280 E8   
001281 78      3464 LD	A,B
001282 FE      3465 CP	7
001283 07   
001284 37      3466 SCF
001285 C0      3467 RET	NZ
001286 79      3468 LD	A,C
001287 EE      3469 XOR	3
001288 03   
001289 07      3470 RLCA
00128A 07      3471 RLCA
00128B 07      3472 RLCA
00128C CD      3473 CALL	BYTE
00128D D4   
00128E 13   
00128F 18      3474 JR	VAL8
001290 25   
001291 D6      3478 GROUPA:         SUB	2
001292 02   
001293 30      3479 JR	NC,GROUPB
001294 24   
001295 FE      3480 CP	1-2
001296 FF   
001297 C4      3481 CALL	NZ,COND_
001298 0D   
001299 14   
00129A 79      3482 LD	A,C
00129B 30      3483 JR	NC,GRPA
00129C 02   
00129D 3E      3484 LD	A,18H
00129E 18   
00129F CD      3485 GRPA:           CALL	BYTE
0012A0 D4   
0012A1 13   
0012A2 CD      3486 CALL	NUMBER
0012A3 E4   
0012A4 13   
0012A5 ED      3487 LD	DE,(PC)
0012A6 5B   
0012A7 40   
0012A8 54   
0012A9 13      3488 INC	DE
0012AA 37      3489 SCF
0012AB ED      3490 SBC	HL,DE
0012AC 52   
0012AD 7D      3491 LD	A,L
0012AE 17      3492 RLA
0012AF 9F      3493 SBC	A,A
0012B0 BC      3494 CP	H
0012B1 3E      3495 TOOFAR:         LD	A,1
0012B2 01   
0012B3 C2      3496 JP	NZ,ERROR_	;"Out of range"
0012B4 26   
0012B5 3F   
0012B6 7D      3497 VAL8:           LD	A,L
0012B7 18      3498 JR	BYTE2
0012B8 32   
0012B9 47      3502 GROUPB:         LD	B,A
0012BA 20      3503 JR	NZ,GROUPC
0012BB 16   
0012BC CD      3504 CALL	COND_
0012BD 0D   
0012BE 14   
0012BF 79      3505 LD	A,C
0012C0 30      3506 JR	NC,GRPB
0012C1 0B   
0012C2 78      3507 LD	A,B
0012C3 E6      3508 AND	3FH
0012C4 3F   
0012C5 FE      3509 CP	6
0012C6 06   
0012C7 3E      3510 LD	A,0E9H
0012C8 E9   
0012C9 28      3511 JR	Z,BYTE2
0012CA 20   
0012CB 3E      3512 LD	A,0C3H
0012CC C3   
0012CD CD      3513 GRPB:           CALL	BYTE
0012CE D4   
0012CF 13   
0012D0 18      3514 JR	ADDR_
0012D1 05   
0012D2 10      3518 GROUPC:         DJNZ	GROUPD
0012D3 0C   
0012D4 CD      3519 GRPC:           CALL	GRPE
0012D5 EF   
0012D6 12   
0012D7 CD      3520 ADDR_:          CALL	NUMBER
0012D8 E4   
0012D9 13   
0012DA CD      3521 VAL16:          CALL	VAL8
0012DB B6   
0012DC 12   
0012DD 7C      3522 LD	A,H
0012DE 18      3523 JR	BYTE2
0012DF 0B   
0012E0 10      3527 GROUPD:         DJNZ	GROUPE
0012E1 0B   
0012E2 CD      3528 CALL	NUMBER
0012E3 E4   
0012E4 13   
0012E5 A1      3529 AND	C
0012E6 B4      3530 OR	H
0012E7 20      3531 JR	NZ,TOOFAR
0012E8 C8   
0012E9 7D      3532 LD	A,L
0012EA B1      3533 OR	C
0012EB 18      3534 BYTE2:          JR	BYTE1
0012EC 78   
0012ED 10      3538 GROUPE:         DJNZ	GROUPF
0012EE 0A   
0012EF CD      3539 GRPE:           CALL	COND_
0012F0 0D   
0012F1 14   
0012F2 79      3540 LD	A,C
0012F3 30      3541 JR	NC,BYTE1
0012F4 70   
0012F5 F6      3542 OR	9
0012F6 09   
0012F7 18      3543 JR	BYTE1
0012F8 6C   
0012F9 10      3547 GROUPF:         DJNZ	MISC
0012FA 6C   
0012FB CD      3548 CALL	LDOP
0012FC 39   
0012FD 14   
0012FE 30      3549 JR	NC,LDA
0012FF 5F   
001300 CD      3550 CALL	REGHI
001301 07   
001302 14   
001303 08      3551 EX	AF,AF'
001304 CD      3552 CALL	SKIP
001305 85   
001306 14   
001307 FE      3553 CP	'('
001308 28   
001309 28      3554 JR	Z,LDIN
00130A 1D   
00130B 08      3555 EX	AF,AF'
00130C D2      3556 JP	NC,G6
00130D 2E   
00130E 12   
00130F 0E      3557 LD	C,1
001310 01   
001311 CD      3558 CALL	PAIR1asm
001312 24   
001313 14   
001314 D8      3559 RET	C
001315 3E      3560 LD	A,14
001316 0E   
001317 B8      3561 CP	B
001318 47      3562 LD	B,A
001319 CC      3563 CALL	Z,PAIRasm
00131A 20   
00131B 14   
00131C 78      3564 LD	A,B
00131D E6      3565 AND	3FH
00131E 3F   
00131F FE      3566 CP	12
001320 0C   
001321 79      3567 LD	A,C
001322 20      3568 JR	NZ,GRPB
001323 A9   
001324 3E      3569 LD	A,0F9H
001325 F9   
001326 18      3570 JR	BYTE1
001327 3D   
001328 08      3572 LDIN:           EX	AF,AF'
001329 C5      3573 PUSH	BC
00132A D4      3574 CALL	NC,REGLO
00132B 01   
00132C 14   
00132D 79      3575 LD	A,C
00132E C1      3576 POP	BC
00132F 30      3577 JR	NC,BIND
001330 77   
001331 0E      3578 LD	C,0AH
001332 0A   
001333 CD      3579 CALL	PAIR1asm
001334 24   
001335 14   
001336 CD      3580 CALL	LD16
001337 7E   
001338 13   
001339 30      3581 JR	NC,GRPB
00133A 92   
00133B CD      3582 CALL	NUMBER
00133C E4   
00133D 13   
00133E 0E      3583 LD	C,2
00133F 02   
001340 CD      3584 CALL	PAIRasm
001341 20   
001342 14   
001343 CD      3585 CALL	LD16
001344 7E   
001345 13   
001346 D8      3586 RET	C
001347 CD      3587 CALL	BYTE
001348 D4   
001349 13   
00134A 18      3588 JR	VAL16
00134B 8E   
00134C 05      3592 OPT:            DEC	B
00134D CA      3593 JP	Z,DB
00134E 39   
00134F 12   
001350 10      3594 DJNZ	ADDR_
001351 85   
001352 CD      3595 CALL	NUMBER
001353 E4   
001354 13   
001355 21      3596 LD	HL,LISTON
001356 FE   
001357 54   
001358 4F      3597 LD	C,A
001359 ED      3598 RLD
00135A 6F   
00135B 79      3599 LD	A,C
00135C ED      3600 RRD
00135D 67   
00135E C9      3601 RET
00135F FE      3603 LDA:            CP	4
001360 04   
001361 DC      3604 CALL	C,ED
001362 A2   
001363 13   
001364 78      3605 LD	A,B
001365 18      3606 BYTE1:          JR	BYTE
001366 6D   
001367 10      3610 MISC:           DJNZ	OPT
001368 E3   
001369 DD      3611 PUSH	IX
00136A E5   
00136B CD      3612 CALL	EXPRS
00136C 1E   
00136D 18   
00136E DD      3613 POP	IX
00136F E1   
001370 21      3614 LD	HL,ACCS
001371 00   
001372 52   
001373 AF      3615 DEFM1:          XOR	A
001374 BB      3616 CP	E
001375 C8      3617 RET	Z
001376 7E      3618 LD	A,(HL)
001377 23      3619 INC	HL
001378 CD      3620 CALL	BYTE
001379 D4   
00137A 13   
00137B 1D      3621 DEC	E
00137C 18      3622 JR	DEFM1
00137D F5   
00137E 78      3626 LD16:           LD	A,B
00137F 38      3627 JR	C,LD8
001380 0E   
001381 78      3628 LD	A,B
001382 E6      3629 AND	3FH
001383 3F   
001384 FE      3630 CP	12
001385 0C   
001386 79      3631 LD	A,C
001387 C8      3632 RET	Z
001388 CD      3633 CALL	ED
001389 A2   
00138A 13   
00138B 79      3634 LD	A,C
00138C F6      3635 OR	43H
00138D 43   
00138E C9      3636 RET
00138F FE      3638 LD8:            CP	7
001390 07   
001391 37      3639 SCF
001392 C0      3640 RET	NZ
001393 79      3641 LD	A,C
001394 F6      3642 OR	30H
001395 30   
001396 C9      3643 RET
001397 C5      3645 CORN:           PUSH	BC
001398 CD      3646 CALL	OPND
001399 B4   
00139A 13   
00139B CB      3647 BIT	5,B
00139C 68   
00139D C1      3648 POP	BC
00139E 28      3649 JR	Z,NUMBER
00139F 44   
0013A0 26      3650 LD	H,-1
0013A1 FF   
0013A2 3E      3651 ED:             LD	A,0EDH
0013A3 ED   
0013A4 18      3652 JR	BYTE
0013A5 2E   
0013A6 3E      3654 CB:             LD	A,0CBH
0013A7 CB   
0013A8 FE      3655 BIND:           CP	76H
0013A9 76   
0013AA 37      3656 SCF
0013AB C8      3657 RET	Z		;REJECT LD (HL),(HL)
0013AC CD      3658 CALL	BYTE
0013AD D4   
0013AE 13   
0013AF 14      3659 INC	D
0013B0 F0      3660 RET	P
0013B1 7B      3661 LD	A,E
0013B2 18      3662 JR	BYTE
0013B3 20   
0013B4 E5      3664 OPND:           PUSH	HL
0013B5 21      3665 LD	HL,OPRNDS
0013B6 F6   
0013B7 15   
0013B8 CD      3666 CALL	FIND
0013B9 3C   
0013BA 14   
0013BB E1      3667 POP	HL
0013BC D8      3668 RET	C
0013BD CB      3669 BIT	7,B
0013BE 78   
0013BF C8      3670 RET	Z
0013C0 CB      3671 BIT	3,B
0013C1 58   
0013C2 E5      3672 PUSH	HL
0013C3 CC      3673 CALL	Z,OFFSETasm
0013C4 DB   
0013C5 13   
0013C6 5D      3674 LD	E,L
0013C7 E1      3675 POP	HL
0013C8 3E      3676 LD	A,0DDH
0013C9 DD   
0013CA CB      3677 BIT	6,B
0013CB 70   
0013CC 28      3678 JR	Z,OP1
0013CD 02   
0013CE 3E      3679 LD	A,0FDH
0013CF FD   
0013D0 B7      3680 OP1:            OR	A
0013D1 14      3681 INC	D
0013D2 57      3682 LD	D,A
0013D3 F8      3683 RET	M
0013D4 DD      3684 BYTE:           LD	(IX),A
0013D5 77   
0013D6 00   
0013D7 DD      3685 INC	IX
0013D8 23   
0013D9 B7      3686 OR	A
0013DA C9      3687 RET
0013DB FD      3689 OFFSETasm:         LD	A,(IY)
0013DC 7E   
0013DD 00   
0013DE FE      3690 CP	')'
0013DF 29   
0013E0 21      3691 LD	HL,0
0013E1 00   
0013E2 00   
0013E3 C8      3692 RET	Z
0013E4 CD      3693 NUMBER:         CALL	SKIP
0013E5 85   
0013E6 14   
0013E7 C5      3694 PUSH	BC
0013E8 D5      3695 PUSH	DE
0013E9 DD      3696 PUSH	IX
0013EA E5   
0013EB CD      3697 CALL	EXPRI
0013EC 15   
0013ED 18   
0013EE DD      3698 POP	IX
0013EF E1   
0013F0 D9      3699 EXX
0013F1 D1      3700 POP	DE
0013F2 C1      3701 POP	BC
0013F3 7D      3702 LD	A,L
0013F4 B7      3703 OR	A
0013F5 C9      3704 RET
0013F6 CD      3706 REG:            CALL	OPND
0013F7 B4   
0013F8 13   
0013F9 D8      3707 RET	C
0013FA 78      3708 LD	A,B
0013FB E6      3709 AND	3FH
0013FC 3F   
0013FD FE      3710 CP	8
0013FE 08   
0013FF 3F      3711 CCF
001400 C9      3712 RET
001401 CD      3714 REGLO:          CALL	REG
001402 F6   
001403 13   
001404 D8      3715 RET	C
001405 18      3716 JR	ORC
001406 2F   
001407 CD      3718 REGHI:          CALL	REG
001408 F6   
001409 13   
00140A D8      3719 RET	C
00140B 18      3720 JR	SHL3
00140C 26   
00140D CD      3722 COND_:          CALL	OPND
00140E B4   
00140F 13   
001410 D8      3723 RET	C
001411 78      3724 LD	A,B
001412 E6      3725 AND	1FH
001413 1F   
001414 D6      3726 SUB	16
001415 10   
001416 30      3727 JR	NC,SHL3
001417 1B   
001418 FE      3728 CP	-15
001419 F1   
00141A 37      3729 SCF
00141B C0      3730 RET	NZ
00141C 3E      3731 LD	A,3
00141D 03   
00141E 18      3732 JR	SHL3
00141F 13   
001420 CD      3734 PAIRasm:           CALL	OPND
001421 B4   
001422 13   
001423 D8      3735 RET	C
001424 78      3736 PAIR1asm:          LD	A,B
001425 E6      3737 AND	0FH
001426 0F   
001427 D6      3738 SUB	8
001428 08   
001429 D8      3739 RET	C
00142A 18      3740 JR	SHL3
00142B 07   
00142C CD      3742 BIT:            CALL	NUMBER
00142D E4   
00142E 13   
00142F FE      3743 CP	8
001430 08   
001431 3F      3744 CCF
001432 D8      3745 RET	C
001433 07      3746 SHL3:           RLCA
001434 07      3747 RLCA
001435 07      3748 RLCA
001436 B1      3749 ORC:            OR	C
001437 4F      3750 LD	C,A
001438 C9      3751 RET
001439 21      3753 LDOP:           LD	HL,LDOPS
00143A 3B   
00143B 16   
00143C CD      3754 FIND:           CALL	SKIP
00143D 85   
00143E 14   
00143F 06      3755 EXIT:           LD	B,0
001440 00   
001441 37      3756 SCF
001442 C8      3757 RET	Z
001443 FE      3758 CP	TDEF
001444 DD   
001445 28      3759 JR	Z,FIND0
001446 04   
001447 FE      3760 CP	TOR+1
001448 85   
001449 3F      3761 CCF
00144A D8      3762 RET	C
00144B 7E      3763 FIND0:          LD	A,(HL)
00144C B7      3764 OR	A
00144D 28      3765 JR	Z,EXIT
00144E F0   
00144F FD      3766 XOR	(IY)
001450 AE   
001451 00   
001452 E6      3767 AND	01011111B
001453 5F   
001454 28      3768 JR	Z,FIND2
001455 09   
001456 CB      3769 FIND1:          BIT	7,(HL)
001457 7E   
001458 23      3770 INC	HL
001459 28      3771 JR	Z,FIND1
00145A FB   
00145B 23      3772 INC	HL
00145C 04      3773 INC	B
00145D 18      3774 JR	FIND0
00145E EC   
00145F FD      3776 FIND2:          PUSH	IY
001460 E5   
001461 CB      3777 FIND3:          BIT	7,(HL)
001462 7E   
001463 FD      3778 INC	IY
001464 23   
001465 23      3779 INC	HL
001466 20      3780 JR	NZ,FIND5
001467 10   
001468 BE      3781 CP	(HL)
001469 CC      3782 CALL	Z,SKIP0
00146A 84   
00146B 14   
00146C 7E      3783 LD	A,(HL)
00146D FD      3784 XOR	(IY)
00146E AE   
00146F 00   
001470 E6      3785 AND	01011111B
001471 5F   
001472 28      3786 JR	Z,FIND3
001473 ED   
001474 FD      3787 FIND4:          POP	IY
001475 E1   
001476 18      3788 JR	FIND1
001477 DE   
001478 CD      3790 FIND5:          CALL	DELIM
001479 97   
00147A 14   
00147B C4      3791 CALL	NZ,SIGN
00147C 91   
00147D 14   
00147E 20      3792 JR	NZ,FIND4
00147F F4   
001480 78      3793 FIND6:          LD	A,B
001481 46      3794 LD	B,(HL)
001482 E1      3795 POP	HL
001483 C9      3796 RET
001484 23      3798 SKIP0:          INC	HL
001485 CD      3799 SKIP:           CALL	DELIM
001486 97   
001487 14   
001488 C0      3800 RET	NZ
001489 CD      3801 CALL	TERM
00148A A3   
00148B 14   
00148C C8      3802 RET	Z
00148D FD      3803 INC	IY
00148E 23   
00148F 18      3804 JR	SKIP
001490 F4   
001491 FE      3806 SIGN:           CP	'+'
001492 2B   
001493 C8      3807 RET	Z
001494 FE      3808 CP	'-'
001495 2D   
001496 C9      3809 RET
001497 FD      3811 DELIM:          LD	A,(IY)		;ASSEMBLER DELIMITER
001498 7E   
001499 00   
00149A FE      3812 CP	' '
00149B 20   
00149C C8      3813 RET	Z
00149D FE      3814 CP	','
00149E 2C   
00149F C8      3815 RET	Z
0014A0 FE      3816 CP	')'
0014A1 29   
0014A2 C8      3817 RET	Z
0014A3 FE      3818 TERM:           CP	';'		;ASSEMBLER TERMINATOR
0014A4 3B   
0014A5 C8      3819 RET	Z
0014A6 FE      3820 CP	'\'
0014A7 5C   
0014A8 C8      3821 RET	Z
0014A9 FE      3822 TERM0:          CP	':'		;ASSEMBLER SEPARATOR
0014AA 3A   
0014AB D0      3823 RET	NC
0014AC FE      3824 CP	CR
0014AD 0D   
0014AE C9      3825 RET
0014AF 4E      3827 OPCODS:         DB	"NO"
0014B0 4F   
0014B1 D0      3828 DB	'P'+80H
0014B2 00      3829 DB	0
0014B3 52      3830 DB	"RLC"
0014B4 4C   
0014B5 43   
0014B6 C1      3831 DB	'A'+80H
0014B7 07      3832 DB	7
0014B8 45      3833 DB	"EX"
0014B9 58   
0014BA 00      3834 DB	0
0014BB 41      3835 DB	"AF"
0014BC 46   
0014BD 00      3836 DB	0
0014BE 41      3837 DB	"AF"
0014BF 46   
0014C0 27      3838 DB	"'"+80H
0014C1 08      3839 DB	8
0014C2 52      3840 DB	"RRC"
0014C3 52   
0014C4 43   
0014C5 C1      3841 DB	'A'+80H
0014C6 0F      3842 DB	0FH
0014C7 52      3843 DB	"RL"
0014C8 4C   
0014C9 C1      3844 DB	'A'+80H
0014CA 17      3845 DB	17H
0014CB 52      3846 DB	"RR"
0014CC 52   
0014CD C1      3847 DB	'A'+80H
0014CE 1F      3848 DB	1FH
0014CF 44      3849 DB	"DA"
0014D0 41   
0014D1 C1      3850 DB	'A'+80H
0014D2 27      3851 DB	27H
0014D3 43      3852 DB	"CP"
0014D4 50   
0014D5 CC      3853 DB	'L'+80H
0014D6 2F      3854 DB	2FH
0014D7 53      3855 DB	"SC"
0014D8 43   
0014D9 C6      3856 DB	'F'+80H
0014DA 37      3857 DB	37H
0014DB 43      3858 DB	"CC"
0014DC 43   
0014DD C6      3859 DB	'F'+80H
0014DE 3F      3860 DB	3FH
0014DF 48      3861 DB	"HAL"
0014E0 41   
0014E1 4C   
0014E2 D4      3862 DB	'T'+80H
0014E3 76      3863 DB	76H
0014E4 45      3864 DB	"EX"
0014E5 58   
0014E6 D8      3865 DB	'X'+80H
0014E7 D9      3866 DB	0D9H
0014E8 45      3867 DB	"EX"
0014E9 58   
0014EA 00      3868 DB	0
0014EB 44      3869 DB	"DE"
0014EC 45   
0014ED 00      3870 DB	0
0014EE 48      3871 DB	'H'
0014EF CC      3872 DB	'L'+80H
0014F0 EB      3873 DB	0EBH
0014F1 44      3874 DB	'D'
0014F2 C9      3875 DB	'I'+80H
0014F3 F3      3876 DB	0F3H
0014F4 45      3877 DB	'E'
0014F5 C9      3878 DB	'I'+80H
0014F6 FB      3879 DB	0FBH
0014F7 4E      3881 DB	"NE"
0014F8 45   
0014F9 C7      3882 DB	'G'+80H
0014FA 44      3883 DB	44H
0014FB 49      3884 DB	"IM"
0014FC 4D   
0014FD 00      3885 DB	0
0014FE B0      3886 DB	'0'+80H
0014FF 46      3887 DB	46H
001500 52      3888 DB	"RET"
001501 45   
001502 54   
001503 CE      3889 DB	'N'+80H
001504 45      3890 DB	45H
001505 52      3891 DB	"RET"
001506 45   
001507 54   
001508 C9      3892 DB	'I'+80H
001509 4D      3893 DB	4DH
00150A 49      3894 DB	"IM"
00150B 4D   
00150C 00      3895 DB	0
00150D B1      3896 DB	'1'+80H
00150E 56      3897 DB	56H
00150F 49      3898 DB	"IM"
001510 4D   
001511 00      3899 DB	0
001512 B2      3900 DB	'2'+80H
001513 5E      3901 DB	5EH
001514 52      3902 DB	"RR"
001515 52   
001516 C4      3903 DB	'D'+80H
001517 67      3904 DB	67H
001518 52      3905 DB	"RL"
001519 4C   
00151A C4      3906 DB	'D'+80H
00151B 6F      3907 DB	6FH
00151C 4C      3908 DB	"LD"
00151D 44   
00151E C9      3909 DB	'I'+80H
00151F A0      3910 DB	0A0H
001520 43      3911 DB	"CP"
001521 50   
001522 C9      3912 DB	'I'+80H
001523 A1      3913 DB	0A1H
001524 49      3914 DB	"IN"
001525 4E   
001526 C9      3915 DB	'I'+80H
001527 A2      3916 DB	0A2H
001528 4F      3917 DB	"OUT"
001529 55   
00152A 54   
00152B C9      3918 DB	'I'+80H
00152C A3      3919 DB	0A3H
00152D 4C      3920 DB	"LD"
00152E 44   
00152F C4      3921 DB	'D'+80H
001530 A8      3922 DB	0A8H
001531 43      3923 DB	"CP"
001532 50   
001533 C4      3924 DB	'D'+80H
001534 A9      3925 DB	0A9H
001535 49      3926 DB	"IN"
001536 4E   
001537 C4      3927 DB	'D'+80H
001538 AA      3928 DB	0AAH
001539 4F      3929 DB	"OUT"
00153A 55   
00153B 54   
00153C C4      3930 DB	'D'+80H
00153D AB      3931 DB	0ABH
00153E 4C      3932 DB	"LDI"
00153F 44   
001540 49   
001541 D2      3933 DB	'R'+80H
001542 B0      3934 DB	0B0H
001543 43      3935 DB	"CPI"
001544 50   
001545 49   
001546 D2      3936 DB	'R'+80H
001547 B1      3937 DB	0B1H
001548 49      3938 DB	"INI"
001549 4E   
00154A 49   
00154B D2      3939 DB	'R'+80H
00154C B2      3940 DB	0B2H
00154D 4F      3941 DB	"OTI"
00154E 54   
00154F 49   
001550 D2      3942 DB	'R'+80H
001551 B3      3943 DB	0B3H
001552 4C      3944 DB	"LDD"
001553 44   
001554 44   
001555 D2      3945 DB	'R'+80H
001556 B8      3946 DB	0B8H
001557 43      3947 DB	"CPD"
001558 50   
001559 44   
00155A D2      3948 DB	'R'+80H
00155B B9      3949 DB	0B9H
00155C 49      3950 DB	"IND"
00155D 4E   
00155E 44   
00155F D2      3951 DB	'R'+80H
001560 BA      3952 DB	0BAH
001561 4F      3953 DB	"OTD"
001562 54   
001563 44   
001564 D2      3954 DB	'R'+80H
001565 BB      3955 DB	0BBH
001566 42      3957 DB	"BI"
001567 49   
001568 D4      3958 DB	'T'+80H
001569 40      3959 DB	40H
00156A 52      3960 DB	"RE"
00156B 45   
00156C D3      3961 DB	'S'+80H
00156D 80      3962 DB	80H
00156E 53      3963 DB	"SE"
00156F 45   
001570 D4      3964 DB	'T'+80H
001571 C0      3965 DB	0C0H
001572 52      3967 DB	"RL"
001573 4C   
001574 C3      3968 DB	'C'+80H
001575 00      3969 DB	0
001576 52      3970 DB	"RR"
001577 52   
001578 C3      3971 DB	'C'+80H
001579 08      3972 DB	8
00157A 52      3973 DB	'R'
00157B CC      3974 DB	'L'+80H
00157C 10      3975 DB	10H
00157D 52      3976 DB	'R'
00157E D2      3977 DB	'R'+80H
00157F 18      3978 DB	18H
001580 53      3979 DB	"SL"
001581 4C   
001582 C1      3980 DB	'A'+80H
001583 20      3981 DB	20H
001584 53      3982 DB	"SR"
001585 52   
001586 C1      3983 DB	'A'+80H
001587 28      3984 DB	28H
001588 53      3985 DB	"SR"
001589 52   
00158A CC      3986 DB	'L'+80H
00158B 38      3987 DB	38H
00158C 50      3989 DB	"PO"
00158D 4F   
00158E D0      3990 DB	'P'+80H
00158F C1      3991 DB	0C1H
001590 50      3992 DB	"PUS"
001591 55   
001592 53   
001593 C8      3993 DB	'H'+80H
001594 C5      3994 DB	0C5H
001595 45      3995 DB	"EX"
001596 58   
001597 00      3996 DB	0
001598 28      3997 DB	"(S"
001599 53   
00159A D0      3998 DB	'P'+80H
00159B E3      3999 DB	0E3H
00159C 53      4001 DB	"SU"
00159D 55   
00159E C2      4002 DB	'B'+80H
00159F 90      4003 DB	90H
0015A0 41      4004 DB	"AN"
0015A1 4E   
0015A2 C4      4005 DB	'D'+80H
0015A3 A0      4006 DB	0A0H
0015A4 58      4007 DB	"XO"
0015A5 4F   
0015A6 D2      4008 DB	'R'+80H
0015A7 A8      4009 DB	0A8H
0015A8 4F      4010 DB	'O'
0015A9 D2      4011 DB	'R'+80H
0015AA B0      4012 DB	0B0H
0015AB 43      4013 DB	'C'
0015AC D0      4014 DB	'P'+80H
0015AD B8      4015 DB	0B8H
0015AE 80      4016 DB	TAND
0015AF A0      4017 DB	0A0H
0015B0 84      4018 DB	TOR
0015B1 B0      4019 DB	0B0H
0015B2 41      4021 DB	"AD"
0015B3 44   
0015B4 C4      4022 DB	'D'+80H
0015B5 80      4023 DB	80H
0015B6 41      4024 DB	"AD"
0015B7 44   
0015B8 C3      4025 DB	'C'+80H
0015B9 88      4026 DB	88H
0015BA 53      4027 DB	"SB"
0015BB 42   
0015BC C3      4028 DB	'C'+80H
0015BD 98      4029 DB	98H
0015BE 49      4031 DB	"IN"
0015BF 4E   
0015C0 C3      4032 DB	'C'+80H
0015C1 04      4033 DB	4
0015C2 44      4034 DB	"DE"
0015C3 45   
0015C4 C3      4035 DB	'C'+80H
0015C5 05      4036 DB	5
0015C6 49      4038 DB	'I'
0015C7 CE      4039 DB	'N'+80H
0015C8 40      4040 DB	40H
0015C9 4F      4041 DB	"OU"
0015CA 55   
0015CB D4      4042 DB	'T'+80H
0015CC 41      4043 DB	41H
0015CD 4A      4045 DB	'J'
0015CE D2      4046 DB	'R'+80H
0015CF 20      4047 DB	20H
0015D0 44      4048 DB	"DJN"
0015D1 4A   
0015D2 4E   
0015D3 DA      4049 DB	'Z'+80H
0015D4 10      4050 DB	10H
0015D5 4A      4052 DB	'J'
0015D6 D0      4053 DB	'P'+80H
0015D7 C2      4054 DB	0C2H
0015D8 43      4056 DB	"CAL"
0015D9 41   
0015DA 4C   
0015DB CC      4057 DB	'L'+80H
0015DC C4      4058 DB	0C4H
0015DD 52      4060 DB	"RS"
0015DE 53   
0015DF D4      4061 DB	'T'+80H
0015E0 C7      4062 DB	0C7H
0015E1 52      4064 DB	"RE"
0015E2 45   
0015E3 D4      4065 DB	'T'+80H
0015E4 C0      4066 DB	0C0H
0015E5 4C      4068 DB	'L'
0015E6 C4      4069 DB	'D'+80H
0015E7 40      4070 DB	40H
0015E8 5D      4072 DB	TDEF & 7FH
0015E9 CD      4073 DB	'M'+80H
0015EA 00      4074 DB	0
0015EB 5D      4076 DB	TDEF & 7FH
0015EC C2      4077 DB	'B'+80H
0015ED 00      4078 DB	0
0015EE 4F      4080 DB	"OP"
0015EF 50   
0015F0 D4      4081 DB	'T'+80H
0015F1 00      4082 DB	0
0015F2 5D      4084 DB	TDEF & 7FH
0015F3 D7      4085 DB	'W'+80H
0015F4 00      4086 DB	0
0015F5 00      4088 DB	0
0015F6 C2      4090 OPRNDS:         DB	'B'+80H
0015F7 00      4091 DB	0
0015F8 C3      4092 DB	'C'+80H
0015F9 01      4093 DB	1
0015FA C4      4094 DB	'D'+80H
0015FB 02      4095 DB	2
0015FC C5      4096 DB	'E'+80H
0015FD 03      4097 DB	3
0015FE C8      4098 DB	'H'+80H
0015FF 04      4099 DB	4
001600 CC      4100 DB	'L'+80H
001601 05      4101 DB	5
001602 28      4102 DB	"(H"
001603 48   
001604 CC      4103 DB	'L'+80H
001605 06      4104 DB	6
001606 C1      4105 DB	'A'+80H
001607 07      4106 DB	7
001608 28      4107 DB	"(I"
001609 49   
00160A D8      4108 DB	'X'+80H
00160B 86      4109 DB	86H
00160C 28      4110 DB	"(I"
00160D 49   
00160E D9      4111 DB	'Y'+80H
00160F C6      4112 DB	0C6H
001610 42      4114 DB	'B'
001611 C3      4115 DB	'C'+80H
001612 08      4116 DB	8
001613 44      4117 DB	'D'
001614 C5      4118 DB	'E'+80H
001615 0A      4119 DB	10
001616 48      4120 DB	'H'
001617 CC      4121 DB	'L'+80H
001618 0C      4122 DB	12
001619 49      4123 DB	'I'
00161A D8      4124 DB	'X'+80H
00161B 8C      4125 DB	8CH
00161C 49      4126 DB	'I'
00161D D9      4127 DB	'Y'+80H
00161E CC      4128 DB	0CCH
00161F 41      4129 DB	'A'
001620 C6      4130 DB	'F'+80H
001621 0E      4131 DB	14
001622 53      4132 DB	'S'
001623 D0      4133 DB	'P'+80H
001624 0E      4134 DB	14
001625 4E      4136 DB	'N'
001626 DA      4137 DB	'Z'+80H
001627 10      4138 DB	16
001628 DA      4139 DB	'Z'+80H
001629 11      4140 DB	17
00162A 4E      4141 DB	'N'
00162B C3      4142 DB	'C'+80H
00162C 12      4143 DB	18
00162D 50      4144 DB	'P'
00162E CF      4145 DB	'O'+80H
00162F 14      4146 DB	20
001630 50      4147 DB	'P'
001631 C5      4148 DB	'E'+80H
001632 15      4149 DB	21
001633 D0      4150 DB	'P'+80H
001634 16      4151 DB	22
001635 CD      4152 DB	'M'+80H
001636 17      4153 DB	23
001637 28      4155 DB	'('
001638 C3      4156 DB	'C'+80H
001639 20      4157 DB	20H
00163A 00      4159 DB	0
00163B 49      4161 LDOPS:          DB	'I'
00163C 00      4162 DB	0
00163D C1      4163 DB	'A'+80H
00163E 47      4164 DB	47H
00163F 52      4165 DB	'R'
001640 00      4166 DB	0
001641 C1      4167 DB	'A'+80H
001642 4F      4168 DB	4FH
001643 41      4169 DB	'A'
001644 00      4170 DB	0
001645 C9      4171 DB	'I'+80H
001646 57      4172 DB	57H
001647 41      4173 DB	'A'
001648 00      4174 DB	0
001649 D2      4175 DB	'R'+80H
00164A 5F      4176 DB	5FH
00164B 28      4177 DB	"(BC"
00164C 42   
00164D 43   
00164E 00      4178 DB	0
00164F C1      4179 DB	'A'+80H
001650 02      4180 DB	2
001651 28      4181 DB	"(DE"
001652 44   
001653 45   
001654 00      4182 DB	0
001655 C1      4183 DB	'A'+80H
001656 12      4184 DB	12H
001657 41      4185 DB	'A'
001658 00      4186 DB	0
001659 28      4187 DB	"(B"
00165A 42   
00165B C3      4188 DB	'C'+80H
00165C 0A      4189 DB	0AH
00165D 41      4190 DB	'A'
00165E 00      4191 DB	0
00165F 28      4192 DB	"(D"
001660 44   
001661 C5      4193 DB	'E'+80H
001662 1A      4194 DB	1AH
001663 00      4196 DB	0
001664             4201   ; --- Begin eval.asm ---
001664 42      4337 FUNTBL:         DW	DECODE		;Line number
001665 1F   
001666 3D      4338 DW	OPENIN		;OPENIN
001667 1B   
001668 5A      4339 DW	PTRev		;PTR
001669 1B   
00166A 0F      4340 DW	PAGEVev		;PAGE
00166B 1B   
00166C 62      4341 DW	TIMEVev		;TIME
00166D 1B   
00166E 05      4342 DW	LOMEMVev		;LOMEM
00166F 1B   
001670 0A      4343 DW	HIMEMVev		;HIMEM
001671 1B   
001672 AE      4344 DW	ABSev		;ABS
001673 1B   
001674 EA      4345 DW	ACSev		;ACS
001675 1B   
001676 C9      4346 DW	ADVAL		;ADVAL
001677 0D   
001678 F2      4347 DW	ASC		;ASC
001679 1A   
00167A E2      4348 DW	ASNev		;ASN
00167B 1B   
00167C E6      4349 DW	ATNev		;ATN
00167D 1B   
00167E CE      4350 DW	BGET		;BGET
00167F 1A   
001680 CE      4351 DW	COSev		;COS
001681 1B   
001682 2D      4352 DW	COUNTV		;COUNT
001683 1B   
001684 B6      4353 DW	DEGev		;DEG
001685 1B   
001686 23      4354 DW	ERLV		;ERL
001687 1B   
001688 28      4355 DW	ERRV		;ERR
001689 1B   
00168A 0E      4356 DW	EVAL_		;EVAL_
00168B 1C   
00168C D6      4357 DW	EXPev		;EXP
00168D 1B   
00168E 52      4358 DW	EXTev		;EXT
00168F 1B   
001690 DA      4359 DW	ZERO		;FALSE
001691 1F   
001692 C5      4360 DW	FN		;FN
001693 29   
001694 DC      4361 DW	GET		;GET
001695 1A   
001696 D7      4362 DW	INKEY		;INKEY
001697 1A   
001698 87      4363 DW	INSTR		;INSTR(
001699 1D   
00169A C2      4364 DW	INT_ev		;INT_
00169B 1B   
00169C FF      4365 DW	LEN		;LEN
00169D 1A   
00169E DA      4366 DW	LNev		;LN
00169F 1B   
0016A0 DE      4367 DW	LOGev		;LOG
0016A1 1B   
0016A2 B2      4368 DW	CPL_ev		;NOT
0016A3 1B   
0016A4 3A      4369 DW	OPENUP		;OPENUP
0016A5 1B   
0016A6 38      4370 DW	OPENOT		;OPENOUT
0016A7 1B   
0016A8 AA      4371 DW	PIev		;PI
0016A9 1B   
0016AA 96      4372 DW	POINT		;POINT(
0016AB 0D   
0016AC B7      4373 DW	POS		;POS
0016AD 1A   
0016AE BA      4374 DW	RADev		;RAD
0016AF 1B   
0016B0 3B      4375 DW	RND		;RND
0016B1 1C   
0016B2 BE      4376 DW	SGNev		;SGN
0016B3 1B   
0016B4 D2      4377 DW	SINev		;SIN
0016B5 1B   
0016B6 C6      4378 DW	SQRev		;SQR
0016B7 1B   
0016B8 CA      4379 DW	TANev		;TAN
0016B9 1B   
0016BA 14      4380 DW	TOPV		;TO(P)
0016BB 1B   
0016BC 9F      4381 DW	TRUEev		;TRUE
0016BD 1B   
0016BE 21      4382 DW	USR		;USR
0016BF 30   
0016C0 01      4383 DW	VALev		;VAL
0016C1 1C   
0016C2 BD      4384 DW	VPOS		;VPOS
0016C3 1A   
0016C4 08      4385 DW	CHRS		;CHR$
0016C5 1E   
0016C6 0F      4386 DW	GETS		;GET$
0016C7 1E   
0016C8 70      4387 DW	INKEYS		;INKEY$
0016C9 1E   
0016CA B0      4388 DW	LEFTS		;LEFT$(
0016CB 1E   
0016CC 80      4389 DW	MIDS		;MID$(
0016CD 1E   
0016CE DE      4390 DW	RIGHTS		;RIGHT$(
0016CF 1E   
0016D0 9A      4391 DW	STRS		;STR$
0016D1 1F   
0016D2 08      4392 DW	STRING_		;STRING_$(
0016D3 1F   
0016D4 C2      4393 DW	EOF		;EOF
0016D5 1A   
0016D6 CB      4394 DW	SUM		;SUM
0016D7 1C   
0016D8 8D      4408 SOPTBL:         DW	SLE		;<= (STRING)
0016D9 1B   
0016DA 95      4409 DW	SNE		;<>
0016DB 1B   
0016DC 87      4410 DW	SGE		;>=
0016DD 1B   
0016DE 7A      4411 DW	SLT		;<
0016DF 1B   
0016E0 9B      4412 DW	SEQ		;=
0016E1 1B   
0016E2 80      4413 DW	SGT		;>
0016E3 1B   
0016E4 CD      4432 EXPR:           CALL	EXPR1		;GET FIRST OPERAND
0016E5 F9   
0016E6 16   
0016E7 FE      4433 EXPR0A:         CP	EOR		;CHECK OPERATOR
0016E8 82   
0016E9 28      4434 JR	Z,EXPR0B
0016EA 03   
0016EB FE      4435 CP	OR_
0016EC 84   
0016ED C0      4436 RET	NZ
0016EE CD      4437 EXPR0B:         CALL	SAVEev		;SAVE FIRST OPERAND
0016EF 55   
0016F0 20   
0016F1 CD      4438 CALL	EXPR1		;GET SECOND OPERAND
0016F2 F9   
0016F3 16   
0016F4 CD      4439 CALL	DOIT		;DO OPERATION
0016F5 65   
0016F6 20   
0016F7 18      4440 JR	EXPR0A		;CONTINUE
0016F8 EE   
0016F9 CD      4442 EXPR1:          CALL	EXPR2
0016FA 0A   
0016FB 17   
0016FC FE      4443 EXPR1A:         CP	AND_
0016FD 80   
0016FE C0      4444 RET	NZ
0016FF CD      4445 CALL	SAVEev
001700 55   
001701 20   
001702 CD      4446 CALL	EXPR2
001703 0A   
001704 17   
001705 CD      4447 CALL	DOIT
001706 65   
001707 20   
001708 18      4448 JR	EXPR1A
001709 F2   
00170A CD      4450 EXPR2:          CALL	EXPR3ev
00170B 82   
00170C 17   
00170D CD      4451 CALL	RELOPQ
00170E 4C   
00170F 20   
001710 C0      4452 RET	NZ
001711 47      4453 LD	B,A
001712 FD      4454 INC	IY		;BUMP OVER OPERATOR
001713 23   
001714 CD      4455 CALL	NXT
001715 ED   
001716 44   
001717 CD      4456 CALL	RELOPQ		;COMPOUND OPERATOR?
001718 4C   
001719 20   
00171A 20      4457 JR	NZ,EXPR2B
00171B 07   
00171C FD      4458 INC	IY
00171D 23   
00171E B8      4459 CP	B
00171F 28      4460 JR	Z,SHIFT		;SHIFT | ==
001720 1C   
001721 80      4461 ADD	A,B
001722 47      4462 LD	B,A
001723 78      4463 EXPR2B:         LD	A,B
001724 08      4464 EX	AF,AF'
001725 FA      4465 JP	M,EXPR2S
001726 55   
001727 17   
001728 08      4466 EX	AF,AF'
001729 D6      4467 SUB	4
00172A 04   
00172B FE      4468 CP	'>'-4
00172C 3A   
00172D 20      4469 JR	NZ,EXPR2C
00172E 02   
00172F C6      4470 ADD	A,2
001730 02   
001731 E6      4471 EXPR2C:         AND	0FH
001732 0F   
001733 CD      4472 EXPR2D:         CALL	SAVE1
001734 59   
001735 20   
001736 CD      4473 CALL	EXPR3ev
001737 82   
001738 17   
001739 CD      4474 CALL	DOIT		;Must NOT be "JP DOIT"
00173A 65   
00173B 20   
00173C C9      4475 RET
00173D FE      4477 SHIFT:          CP	'='
00173E 3D   
00173F 28      4478 JR	Z,EXPR2B	;==
001740 E2   
001741 CD      4479 CALL	NXT
001742 ED   
001743 44   
001744 CD      4480 CALL	RELOPQ
001745 4C   
001746 20   
001747 20      4481 JR	NZ,SHIFT1
001748 07   
001749 B8      4482 CP	B
00174A C2      4483 JP	NZ,SYNTAX
00174B C2   
00174C 25   
00174D FD      4484 INC	IY
00174E 23   
00174F 04      4485 INC	B
001750 78      4486 SHIFT1:         LD	A,B
001751 D6      4487 SUB	18
001752 12   
001753 18      4488 JR	EXPR2D
001754 DE   
001755 08      4490 EXPR2S:         EX	AF,AF'
001756 3D      4491 DEC	A
001757 E6      4492 AND	7
001758 07   
001759 CD      4493 CALL	PUSHS		;SAVE STRING ON STACK
00175A FB   
00175B 1F   
00175C F5      4494 PUSH	AF		;SAVE OPERATOR
00175D CD      4495 CALL	EXPR3ev		;SECOND STRING
00175E 82   
00175F 17   
001760 08      4496 EX	AF,AF'
001761 F2      4497 JP	P,MISMATev
001762 50   
001763 18   
001764 F1      4498 POP	AF
001765 4B      4499 LD	C,E		;LENGTH OF STRING #2
001766 D1      4500 POP	DE
001767 21      4501 LD	HL,0
001768 00   
001769 00   
00176A 39      4502 ADD	HL,SP
00176B 43      4503 LD	B,E		;LENGTH OF STRING #1
00176C D5      4504 PUSH	DE
00176D 11      4505 LD	DE,ACCS
00176E 00   
00176F 52   
001770 EB      4506 EX	DE,HL
001771 CD      4507 CALL	DISPT2
001772 9D   
001773 20   
001774 D1      4508 POP	DE
001775 EB      4509 EX	DE,HL
001776 26      4510 LD	H,0
001777 00   
001778 39      4511 ADD	HL,SP
001779 F9      4512 LD	SP,HL
00177A EB      4513 EX	DE,HL
00177B AF      4514 XOR	A		;NUMERIC MARKER
00177C 4F      4515 LD	C,A		;INTEGER MARKER
00177D 08      4516 EX	AF,AF'
00177E FD      4517 LD	A,(IY)
00177F 7E   
001780 00   
001781 C9      4518 RET
001782 CD      4520 EXPR3ev:          CALL	EXPR4
001783 D0   
001784 17   
001785 FE      4521 EXPR3A:         CP	'-'
001786 2D   
001787 28      4522 JR	Z,EXPR3B
001788 08   
001789 FE      4523 CP	'+'
00178A 2B   
00178B C0      4524 RET	NZ
00178C 08      4525 EX	AF,AF'
00178D FA      4526 JP	M,EXPR3S
00178E 9C   
00178F 17   
001790 08      4527 EX	AF,AF'
001791 CD      4528 EXPR3B:         CALL	SAVEev
001792 55   
001793 20   
001794 CD      4529 CALL	EXPR4
001795 D0   
001796 17   
001797 CD      4530 CALL	DOIT
001798 65   
001799 20   
00179A 18      4531 JR	EXPR3A
00179B E9   
00179C 08      4533 EXPR3S:         EX	AF,AF'
00179D FD      4534 INC	IY		;BUMP PAST '+'
00179E 23   
00179F CD      4535 CALL	PUSHS		;SAVE STRING ON STACK
0017A0 FB   
0017A1 1F   
0017A2 CD      4536 CALL	EXPR4		;SECOND STRING
0017A3 D0   
0017A4 17   
0017A5 08      4537 EX	AF,AF'
0017A6 F2      4538 JP	P,MISMATev
0017A7 50   
0017A8 18   
0017A9 4B      4539 LD	C,E		;C=LENGTH
0017AA D1      4540 POP	DE
0017AB D5      4541 PUSH	DE
0017AC 21      4542 LD	HL,ACCS
0017AD 00   
0017AE 52   
0017AF 54      4543 LD	D,H
0017B0 79      4544 LD	A,C
0017B1 B7      4545 OR	A
0017B2 28      4546 JR	Z,EXP3S3
0017B3 0E   
0017B4 45      4547 LD	B,L
0017B5 6F      4548 LD	L,A		;SOURCE
0017B6 83      4549 ADD	A,E
0017B7 5F      4550 LD	E,A		;DESTINATION
0017B8 3E      4551 LD	A,19
0017B9 13   
0017BA 38      4552 JR	C,ERROR2ev	;"String too long"
0017BB 6B   
0017BC D5      4553 PUSH	DE
0017BD 1D      4554 DEC	E
0017BE 2D      4555 DEC	L
0017BF ED      4556 LDDR			;COPY
0017C0 B8   
0017C1 D1      4557 POP	DE
0017C2 D9      4558 EXP3S3:         EXX
0017C3 C1      4559 POP	BC
0017C4 CD      4560 CALL	POPS		;RESTORE FROM STACK
0017C5 19   
0017C6 20   
0017C7 D9      4561 EXX
0017C8 F6      4562 OR	80H		;FLAG STRING
0017C9 80   
0017CA 08      4563 EX	AF,AF'
0017CB FD      4564 LD	A,(IY)
0017CC 7E   
0017CD 00   
0017CE 18      4565 JR	EXPR3A
0017CF B5   
0017D0 CD      4567 EXPR4:          CALL	EXPR5
0017D1 F6   
0017D2 17   
0017D3 FE      4568 EXPR4A:         CP	'*'
0017D4 2A   
0017D5 28      4569 JR	Z,EXPR4B
0017D6 0B   
0017D7 FE      4570 CP	'/'
0017D8 2F   
0017D9 28      4571 JR	Z,EXPR4B
0017DA 07   
0017DB FE      4572 CP	MOD_
0017DC 83   
0017DD 28      4573 JR	Z,EXPR4B
0017DE 03   
0017DF FE      4574 CP	DIV_
0017E0 81   
0017E1 C0      4575 RET	NZ
0017E2 CD      4576 EXPR4B:         CALL	SAVEev
0017E3 55   
0017E4 20   
0017E5 CD      4577 CALL	EXPR5
0017E6 F6   
0017E7 17   
0017E8 CD      4578 CALL	DOIT
0017E9 65   
0017EA 20   
0017EB 18      4579 JR	EXPR4A
0017EC E6   
0017ED 7B      4581 EXPR45:         LD	A,E
0017EE FE      4582 CP	'+'
0017EF 2B   
0017F0 28      4583 JR	Z,EXPR4
0017F1 DE   
0017F2 FE      4584 CP	'-'
0017F3 2D   
0017F4 28      4585 JR	Z,EXPR4
0017F5 DA   
0017F6 CD      4586 EXPR5:          CALL	ITEM
0017F7 B2   
0017F8 18   
0017F9 B7      4587 OR	A		;TEST TYPE
0017FA 08      4588 EX	AF,AF'		;SAVE TYPE
0017FB CD      4589 EXPR5A:         CALL	NXT
0017FC ED   
0017FD 44   
0017FE FE      4590 CP	'^'
0017FF 5E   
001800 C0      4591 RET	NZ
001801 CD      4592 CALL	SAVEev
001802 55   
001803 20   
001804 CD      4593 CALL	ITEM
001805 B2   
001806 18   
001807 B7      4594 OR	A
001808 08      4595 EX	AF,AF'
001809 CD      4596 CALL	DOIT
00180A 65   
00180B 20   
00180C 18      4597 JR	EXPR5A
00180D ED   
00180E CD      4599 EXPRN:          CALL	EXPR
00180F E4   
001810 16   
001811 08      4600 EX	AF,AF'
001812 F0      4601 RET	P
001813 18      4602 JR	MISMATev
001814 3B   
001815 CD      4604 EXPRI:          CALL	EXPR
001816 E4   
001817 16   
001818 08      4605 EX	AF,AF'
001819 F2      4606 JP	P,SFIX
00181A F9   
00181B 1B   
00181C 18      4607 JR	MISMATev
00181D 32   
00181E CD      4609 EXPRS:          CALL	EXPR
00181F E4   
001820 16   
001821 08      4610 EX	AF,AF'
001822 F8      4611 RET	M
001823 18      4612 JR	MISMATev
001824 2B   
001825 3E      4614 BADHEX:         LD	A,28
001826 1C   
001827 C3      4615 ERROR2ev:         JP	ERROR_		;"Bad HEX or binary"
001828 26   
001829 3F   
00182A D9      4617 NEGATEev:         EXX
00182B 7C      4618 LD	A,H
00182C 2F      4619 CPL
00182D 67      4620 LD	H,A
00182E 7D      4621 LD	A,L
00182F 2F      4622 CPL
001830 6F      4623 LD	L,A
001831 D9      4624 EXX
001832 7C      4625 LD	A,H
001833 2F      4626 CPL
001834 67      4627 LD	H,A
001835 7D      4628 LD	A,L
001836 2F      4629 CPL
001837 6F      4630 LD	L,A
001838 D9      4631 ADD1ev:           EXX
001839 23      4632 INC	HL
00183A 7C      4633 LD	A,H
00183B B5      4634 OR	L
00183C D9      4635 EXX
00183D 3E      4636 LD	A,0		;NUMERIC MARKER
00183E 00   
00183F C0      4637 RET	NZ
001840 23      4638 INC	HL
001841 C9      4639 RET
001842 CD      4641 ITEMI:          CALL	ITEM
001843 B2   
001844 18   
001845 B7      4642 OR	A
001846 F2      4643 JP	P,SFIX
001847 F9   
001848 1B   
001849 18      4644 JR	MISMATev
00184A 05   
00184B CD      4646 ITEMS:          CALL	ITEM
00184C B2   
00184D 18   
00184E B7      4647 OR	A
00184F F8      4648 RET	M
001850 3E      4649 MISMATev:         LD	A,6
001851 06   
001852 18      4650 JR	ERROR2ev		;"Type mismatch"
001853 D3   
001854 CD      4652 ITEM1:          CALL	EXPR		;BRACKETED EXPR
001855 E4   
001856 16   
001857 CD      4653 CALL	BRAKET
001858 90   
001859 20   
00185A 08      4654 EX	AF,AF'
00185B C9      4655 RET
00185C CD      4657 ITEMN:          CALL	ITEM
00185D B2   
00185E 18   
00185F B7      4658 OR	A
001860 F0      4659 RET	P
001861 18      4660 JR	MISMATev
001862 ED   
001863 CD      4667 HEXev:            CALL	ZERO
001864 DA   
001865 1F   
001866 CD      4668 CALL	HEXDIG
001867 39   
001868 20   
001869 38      4669 JR	C,BADHEX
00186A BA   
00186B FD      4670 HEX1:           INC	IY
00186C 23   
00186D E6      4671 AND	0FH
00186E 0F   
00186F 06      4672 LD	B,4
001870 04   
001871 D9      4673 HEX2:           EXX
001872 29      4674 ADD	HL,HL
001873 D9      4675 EXX
001874 ED      4676 ADC	HL,HL
001875 6A   
001876 10      4677 DJNZ	HEX2
001877 F9   
001878 D9      4678 EXX
001879 B5      4679 OR	L
00187A 6F      4680 LD	L,A
00187B D9      4681 EXX
00187C CD      4682 CALL	HEXDIG
00187D 39   
00187E 20   
00187F 30      4683 JR	NC,HEX1
001880 EA   
001881 AF      4684 XOR	A
001882 C9      4685 RET
001883 CD      4692 BIN:            CALL	ZERO
001884 DA   
001885 1F   
001886 CD      4693 CALL	BINDIG
001887 2C   
001888 20   
001889 38      4694 JR	C,BADHEX
00188A 9A   
00188B FD      4695 BIN1:           INC	IY
00188C 23   
00188D CB      4696 RR	A
00188E 1F   
00188F D9      4697 EXX
001890 ED      4698 ADC	HL,HL
001891 6A   
001892 D9      4699 EXX
001893 ED      4700 ADC	HL,HL
001894 6A   
001895 CD      4701 CALL	BINDIG
001896 2C   
001897 20   
001898 30      4702 JR	NC,BIN1
001899 F1   
00189A AF      4703 XOR	A
00189B C9      4704 RET
00189C CD      4711 MINUS:          CALL	ITEMN
00189D 5C   
00189E 18   
00189F 0D      4712 MINUS0:         DEC	C
0018A0 0C      4713 INC	C
0018A1 28      4714 JR	Z,NEGATEev	;ZERO/INTEGER
0018A2 87   
0018A3 7C      4715 LD	A,H
0018A4 EE      4716 XOR	80H		;CHANGE SIGN (FP)
0018A5 80   
0018A6 67      4717 LD	H,A
0018A7 AF      4718 XOR	A		;NUMERIC MARKER
0018A8 C9      4719 RET
0018A9 CD      4721 ADDROF:         CALL	VAR_
0018AA B8   
0018AB 25   
0018AC E5      4722 PUSH	HL
0018AD D9      4723 EXX
0018AE E1      4724 POP	HL
0018AF C3      4725 JP	COUNT1
0018B0 32   
0018B1 1B   
0018B2 CD      4734 ITEM:           CALL	CHECK
0018B3 68   
0018B4 32   
0018B5 CD      4735 CALL	NXT
0018B6 ED   
0018B7 44   
0018B8 FD      4736 INC	IY
0018B9 23   
0018BA FE      4737 CP	FUNTOK
0018BB 8D   
0018BC 38      4738 JR	C,ITEM0
0018BD 08   
0018BE FE      4739 CP	TCMD
0018BF C7   
0018C0 DA      4740 JP	C,DISPATev	;FUNCTIONS
0018C1 A3   
0018C2 20   
0018C3 C3      4741 JP	EXTRASev		;DIM, END, MODE, REPORT$, WIDTH
0018C4 12   
0018C5 1A   
0018C6 FE      4743 ITEM0:          CP	':'
0018C7 3A   
0018C8 30      4744 JR	NC,ITEM2	;VARIABLES
0018C9 25   
0018CA FE      4745 CP	'0'
0018CB 30   
0018CC 30      4746 JR	NC,CONev		;NUMERIC CONSTANT
0018CD 7B   
0018CE FE      4747 CP	'('
0018CF 28   
0018D0 28      4748 JR	Z,ITEM1		;EXPRESSION
0018D1 82   
0018D2 FE      4749 CP	'-'
0018D3 2D   
0018D4 28      4750 JR	Z,MINUS		;UNARY MINUS
0018D5 C6   
0018D6 FE      4751 CP	'+'
0018D7 2B   
0018D8 28      4752 JR	Z,ITEMN		;UNARY PLUS
0018D9 82   
0018DA FE      4753 CP	'.'
0018DB 2E   
0018DC 28      4754 JR	Z,CONev		;NUMERIC CONSTANT
0018DD 6B   
0018DE FE      4755 CP	'&'
0018DF 26   
0018E0 28      4756 JR	Z,HEXev		;HEX CONSTANT
0018E1 81   
0018E2 FE      4757 CP	'%'
0018E3 25   
0018E4 28      4758 JR	Z,BIN		;BINARY CONSTANT
0018E5 9D   
0018E6 FE      4759 CP	'"'
0018E7 22   
0018E8 28      4760 JR	Z,CONS		;STRING CONSTANT
0018E9 72   
0018EA FE      4761 CP	TTINT
0018EB 0A   
0018EC CA      4762 JP	Z,TINTev		;TINT FUNCTION
0018ED B2   
0018EE 1A   
0018EF FE      4763 ITEM2:          CP	TMOD
0018F0 83   
0018F1 CA      4764 JP	Z,MODFUN	;MOD
0018F2 2F   
0018F3 1D   
0018F4 FE      4765 CP	'^'
0018F5 5E   
0018F6 28      4766 JR	Z,ADDROF	;^ OPERATOR
0018F7 B1   
0018F8 FD      4767 DEC	IY
0018F9 2B   
0018FA CD      4768 CALL	GETVAR		;VARIABLE
0018FB C5   
0018FC 41   
0018FD 20      4769 JR	NZ,NOSUCHev
0018FE 2F   
0018FF CB      4770 BIT	6,A
001900 77   
001901 20      4771 JR	NZ,ARRAYev
001902 7E   
001903 B7      4772 OR	A
001904 FA      4773 JP	M,LOADS		;STRING VARIABLE
001905 F0   
001906 19   
001907 CB      4774 LOADN:          BIT	2,A
001908 57   
001909 0E      4775 LD	C,0
00190A 00   
00190B 28      4776 JR	Z,LOAD1		;BYTE VARIABLE
00190C 16   
00190D CB      4777 BIT	0,A
00190E 47   
00190F 28      4778 JR	Z,LOAD4		;INTEGER VARIABLE
001910 03   
001911 DD      4779 LOAD5:          LD	C,(IX+4)
001912 4E   
001913 04   
001914 D9      4780 LOAD4:          EXX
001915 DD      4781 LD	L,(IX+0)
001916 6E   
001917 00   
001918 DD      4782 LD	H,(IX+1)
001919 66   
00191A 01   
00191B D9      4783 EXX
00191C DD      4784 LD	L,(IX+2)
00191D 6E   
00191E 02   
00191F DD      4785 LD	H,(IX+3)
001920 66   
001921 03   
001922 C9      4786 RET
001923 21      4788 LOAD1:          LD	HL,0
001924 00   
001925 00   
001926 D9      4789 EXX
001927 26      4790 LD	H,0
001928 00   
001929 DD      4791 LD	L,(IX+0)
00192A 6E   
00192B 00   
00192C D9      4792 EXX
00192D C9      4793 RET
00192E DA      4795 NOSUCHev:         JP	C,SYNTAX
00192F C2   
001930 25   
001931 3A      4796 LD	A,(LISTON)
001932 FE   
001933 54   
001934 CB      4797 BIT	5,A
001935 6F   
001936 3E      4798 LD	A,26
001937 1A   
001938 20      4799 JR	NZ,ERROR0ev	;"No such variable"
001939 36   
00193A FD      4800 NOS1:           INC	IY
00193B 23   
00193C CD      4801 CALL	RANGE
00193D D1   
00193E 43   
00193F 30      4802 JR	NC,NOS1
001940 F9   
001941 DD      4803 LD	IX,PC
001942 21   
001943 40   
001944 54   
001945 AF      4804 XOR	A
001946 4F      4805 LD	C,A
001947 18      4806 JR	LOAD4
001948 CB   
001949 FD      4814 CONev:            DEC	IY
00194A 2B   
00194B FD      4815 PUSH	IY
00194C E5   
00194D DD      4816 POP	IX
00194E E1   
00194F 3E      4817 LD	A,36
001950 24   
001951 CD      4818 CALL	FPP
001952 F7   
001953 44   
001954 38      4819 JR	C,ERROR0ev
001955 1A   
001956 DD      4820 PUSH	IX
001957 E5   
001958 FD      4821 POP	IY
001959 E1   
00195A AF      4822 XOR	A
00195B C9      4823 RET
00195C 11      4832 CONS:           LD	DE,ACCS
00195D 00   
00195E 52   
00195F FD      4833 CONS3:          LD	A,(IY)
001960 7E   
001961 00   
001962 FD      4834 INC	IY
001963 23   
001964 FE      4835 CP	'"'
001965 22   
001966 28      4836 JR	Z,CONS2
001967 0B   
001968 12      4837 CONS1:          LD	(DE),A
001969 1C      4838 INC	E
00196A FE      4839 CP	CR
00196B 0D   
00196C 20      4840 JR	NZ,CONS3
00196D F1   
00196E 3E      4841 LD	A,9
00196F 09   
001970 C3      4842 ERROR0ev:         JP	ERROR_		;"Missing """
001971 26   
001972 3F   
001973 FD      4844 CONS2:          LD	A,(IY)
001974 7E   
001975 00   
001976 FE      4845 CP	'"'
001977 22   
001978 FD      4846 INC	IY
001979 23   
00197A 28      4847 JR	Z,CONS1
00197B EC   
00197C FD      4848 DEC	IY
00197D 2B   
00197E 3E      4849 LD	A,80H		;STRING MARKER
00197F 80   
001980 C9      4850 RET
001981 3E      4852 ARRAYev:          LD	A,14		;'Bad use of array'
001982 0E   
001983 C3      4853 JP	ERROR_
001984 26   
001985 3F   
001986 7E      4862 ARRLEN:         LD	A,(HL)		;Number of dimensions
001987 23      4863 INC	HL
001988 B7      4864 OR	A
001989 28      4865 JR	Z,ARRAYev
00198A F6   
00198B 11      4866 LD	DE,1
00198C 01   
00198D 00   
00198E 4E      4867 ARLOOP:         LD	C,(HL)
00198F 23      4868 INC	HL
001990 46      4869 LD	B,(HL)		;BC = size of this dimension
001991 23      4870 INC	HL
001992 EB      4871 EX	DE,HL
001993 F5      4872 PUSH	AF
001994 D5      4873 PUSH	DE
001995 CD      4874 CALL	MUL16		;HL=HL*BC
001996 9F   
001997 36   
001998 D1      4875 POP	DE
001999 F1      4876 POP	AF
00199A EB      4877 EX	DE,HL
00199B 3D      4878 DEC	A
00199C 20      4879 JR	NZ,ARLOOP
00199D F0   
00199E C9      4880 RET
00199F CD      4882 GETARR:         CALL	NXT
0019A0 ED   
0019A1 44   
0019A2 CD      4883 CALL	GETVAR
0019A3 C5   
0019A4 41   
0019A5 20      4884 JR	NZ,NOSUCHev
0019A6 87   
0019A7 CB      4885 BIT	6,A
0019A8 77   
0019A9 37      4886 SCF
0019AA 28      4887 JR	Z,NOSUCHev
0019AB 82   
0019AC E6      4888 AND	8FH
0019AD 8F   
0019AE 47      4889 LD	B,A		;Type + size
0019AF 7E      4890 GETAR1:         LD	A,(HL)
0019B0 23      4891 INC	HL
0019B1 66      4892 LD	H,(HL)
0019B2 6F      4893 LD	L,A
0019B3 E6      4894 AND	0FEH
0019B4 FE   
0019B5 B4      4895 OR	H
0019B6 28      4896 JR	Z,ARRAYev		;Bad use of array
0019B7 C9   
0019B8 C9      4897 RET
0019B9 CD      4899 GETARB:         CALL	NXT
0019BA ED   
0019BB 44   
0019BC FE      4900 CP	'('
0019BD 28   
0019BE 20      4901 JR	NZ,GETARR
0019BF DF   
0019C0 FD      4902 INC	IY
0019C1 23   
0019C2 CD      4903 CALL	GETARR
0019C3 9F   
0019C4 19   
0019C5 CD      4904 CALL	BRAKET
0019C6 90   
0019C7 20   
0019C8 C9      4905 RET
0019C9 CB      4907 DLOADN:         BIT	2,A
0019CA 57   
0019CB 06      4908 LD	B,0
0019CC 00   
0019CD 28      4909 JR	Z,DLOAD1	;BYTE VARIABLE
0019CE 16   
0019CF CB      4910 BIT	0,A
0019D0 47   
0019D1 28      4911 JR	Z,DLOAD4	;INTEGER VARIABLE
0019D2 03   
0019D3 DD      4912 DLOAD5:         LD	B,(IX+4)
0019D4 46   
0019D5 04   
0019D6 D9      4913 DLOAD4:         EXX
0019D7 DD      4914 LD	E,(IX+0)
0019D8 5E   
0019D9 00   
0019DA DD      4915 LD	D,(IX+1)
0019DB 56   
0019DC 01   
0019DD D9      4916 EXX
0019DE DD      4917 LD	E,(IX+2)
0019DF 5E   
0019E0 02   
0019E1 DD      4918 LD	D,(IX+3)
0019E2 56   
0019E3 03   
0019E4 C9      4919 RET
0019E5 11      4921 DLOAD1:         LD	DE,0
0019E6 00   
0019E7 00   
0019E8 D9      4922 EXX
0019E9 16      4923 LD	D,0
0019EA 00   
0019EB DD      4924 LD	E,(IX+0)
0019EC 5E   
0019ED 00   
0019EE D9      4925 EXX
0019EF C9      4926 RET
0019F0 11      4928 LOADS:          LD	DE,ACCS
0019F1 00   
0019F2 52   
0019F3 1F      4929 RRA
0019F4 30      4930 JR	NC,LOADS2	;FIXED STRING
0019F5 10   
0019F6 CD      4931 CALL	LOAD4
0019F7 14   
0019F8 19   
0019F9 D9      4932 EXX
0019FA 7D      4933 LD	A,L
0019FB D9      4934 EXX
0019FC B7      4935 OR	A
0019FD 4F      4936 LD	C,A
0019FE 3E      4937 LD	A,80H		;STRING MARKER
0019FF 80   
001A00 C8      4938 RET	Z
001A01 06      4939 LD	B,0
001A02 00   
001A03 ED      4940 LDIR
001A04 B0   
001A05 C9      4941 RET
001A06 7E      4943 LOADS2:         LD	A,(HL)
001A07 12      4944 LD	(DE),A
001A08 23      4945 INC	HL
001A09 FE      4946 CP	CR
001A0A 0D   
001A0B 3E      4947 REPDUN:         LD	A,80H		;STRING MARKER
001A0C 80   
001A0D C8      4948 RET	Z
001A0E 1C      4949 INC	E
001A0F 20      4950 JR	NZ,LOADS2
001A10 F5   
001A11 C9      4951 RET			;RETURN NULL STRING
001A12 FE      4955 EXTRASev:         CP	TMODE
001A13 EB   
001A14 CA      4956 JP	Z,MODEFN	;MODE
001A15 D5   
001A16 0D   
001A17 FE      4957 CP	TWIDTH
001A18 FE   
001A19 CA      4958 JP	Z,WIDFN		;WIDTH
001A1A DF   
001A1B 0D   
001A1C FE      4959 CP	TREPORT
001A1D F6   
001A1E 28      4960 JR	Z,REPORS	;REPORT$
001A1F 11   
001A20 FE      4961 CP	TEND
001A21 E0   
001A22 28      4962 JR	Z,ENDFUN	;END
001A23 07   
001A24 FE      4963 CP	TDIM
001A25 DE   
001A26 28      4964 JR	Z,DIMFUN	;DIM
001A27 44   
001A28 C3      4965 SYNERR:         JP	SYNTAX		; 'Syntax error'
001A29 C2   
001A2A 25   
001A2B 2A      4969 ENDFUN:         LD	HL,(FREE)
001A2C E0   
001A2D 54   
001A2E C3      4970 JP	COUNT1
001A2F 32   
001A30 1B   
001A31 FD      4974 REPORS:         LD	A,(IY)
001A32 7E   
001A33 00   
001A34 FE      4975 CP	'$'
001A35 24   
001A36 20      4976 JR	NZ,SYNERR
001A37 F0   
001A38 FD      4977 INC	IY
001A39 23   
001A3A 2A      4978 LD	HL,(ERRTXT)
001A3B EE   
001A3C 54   
001A3D 11      4979 LD	DE,ACCS
001A3E 00   
001A3F 52   
001A40 7E      4980 REPCPY:         LD	A,(HL)
001A41 B7      4981 OR	A
001A42 28      4982 JR	Z,REPDUN
001A43 C7   
001A44 ED      4983 LDI
001A45 A0   
001A46 FE      4984 CP	160
001A47 A0   
001A48 EA      4985 JP	PE,REPCPY
001A49 40   
001A4A 1A   
001A4B FE      4986 CP	LF
001A4C 0A   
001A4D 28      4987 JR	Z,REPCPY
001A4E F1   
001A4F 1D      4988 DEC	E
001A50 E5      4989 PUSH	HL
001A51 21      4990 LD	HL,KEYWDS
001A52 66   
001A53 38   
001A54 01      4991 LD	BC,KEYWDL
001A55 5B   
001A56 03   
001A57 ED      4992 CPIR
001A58 B1   
001A59 06      4993 LD	B,160
001A5A A0   
001A5B FE      4994 CP	145
001A5C 91   
001A5D EA      4995 JP	PE,REPTOK
001A5E 61   
001A5F 1A   
001A60 04      4996 INC	B
001A61 7E      4997 REPTOK:         LD	A,(HL)
001A62 ED      4998 LDI
001A63 A0   
001A64 B8      4999 CP	B
001A65 EA      5000 JP	PE,REPTOK
001A66 61   
001A67 1A   
001A68 E1      5001 POP	HL
001A69 1D      5002 DEC	E
001A6A 18      5003 JR	REPCPY
001A6B D4   
001A6C CD      5007 DIMFUN:         CALL	NXT
001A6D ED   
001A6E 44   
001A6F FE      5008 CP	'('
001A70 28   
001A71 20      5009 JR	NZ,DIMF0
001A72 09   
001A73 FD      5010 INC	IY
001A74 23   
001A75 CD      5011 CALL	DIMF0
001A76 7C   
001A77 1A   
001A78 CD      5012 CALL	BRAKET
001A79 90   
001A7A 20   
001A7B C9      5013 RET
001A7C CD      5015 DIMF0:          CALL	GETARR
001A7D 9F   
001A7E 19   
001A7F E5      5016 PUSH	HL
001A80 CD      5017 CALL	NXT
001A81 ED   
001A82 44   
001A83 1E      5018 LD	E,0
001A84 00   
001A85 FE      5019 CP	','
001A86 2C   
001A87 20      5020 JR	NZ,DIMF1
001A88 0B   
001A89 FD      5021 INC	IY
001A8A 23   
001A8B CD      5022 CALL	EXPRI
001A8C 15   
001A8D 18   
001A8E D9      5023 EXX
001A8F EB      5024 EX	DE,HL
001A90 1C      5025 INC	E
001A91 1D      5026 DEC	E
001A92 28      5027 JR	Z,BADSUB
001A93 19   
001A94 E1      5028 DIMF1:          POP	HL
001A95 7E      5029 LD	A,(HL)
001A96 23      5030 INC	HL
001A97 BB      5031 CP	E
001A98 38      5032 JR	C,BADSUB
001A99 13   
001A9A 1D      5033 DEC	E
001A9B FA      5034 JP	M,DIMF3
001A9C A8   
001A9D 1A   
001A9E 19      5035 ADD	HL,DE
001A9F 19      5036 ADD	HL,DE
001AA0 7E      5037 LD	A,(HL)
001AA1 23      5038 INC	HL
001AA2 66      5039 LD	H,(HL)
001AA3 6F      5040 LD	L,A
001AA4 2B      5041 DEC	HL
001AA5 C3      5042 DIMF2:          JP	COUNT1
001AA6 32   
001AA7 1B   
001AA8 6F      5043 DIMF3:          LD	L,A
001AA9 26      5044 LD	H,0
001AAA 00   
001AAB 18      5045 JR	DIMF2
001AAC F8   
001AAD 3E      5047 BADSUB:         LD	A,15
001AAE 0F   
001AAF C3      5048 JP	ERROR_			;"Bad subscript"
001AB0 26   
001AB1 3F   
001AB2 CD      5078 TINTev:           CALL	TINTFN
001AB3 F3   
001AB4 10   
001AB5 18      5079 JR	COUNT1
001AB6 7B   
001AB7 CD      5080 POS:            CALL	GETCSR
001AB8 8B   
001AB9 0D   
001ABA EB      5081 EX	DE,HL
001ABB 18      5082 JR	COUNT1
001ABC 75   
001ABD CD      5083 VPOS:           CALL	GETCSR
001ABE 8B   
001ABF 0D   
001AC0 18      5084 JR	COUNT1
001AC1 70   
001AC2 CD      5085 EOF:            CALL	CHANEL
001AC3 B3   
001AC4 36   
001AC5 CD      5086 CALL	OSSTAT
001AC6 4E   
001AC7 06   
001AC8 CA      5087 JP	Z,TRUEev
001AC9 9F   
001ACA 1B   
001ACB C3      5088 JP	ZERO
001ACC DA   
001ACD 1F   
001ACE CD      5089 BGET:           CALL	CHANEL		;CHANNEL NUMBER
001ACF B3   
001AD0 36   
001AD1 CD      5090 CALL	OSBGET
001AD2 3D   
001AD3 06   
001AD4 6F      5091 LD	L,A
001AD5 18      5092 JR	COUNT0
001AD6 59   
001AD7 CD      5093 INKEY:          CALL	INKEYS
001AD8 70   
001AD9 1E   
001ADA 18      5094 JR	ASC0
001ADB 19   
001ADC CD      5095 GET:            CALL	NXT
001ADD ED   
001ADE 44   
001ADF FE      5096 CP	'('
001AE0 28   
001AE1 20      5097 JR	NZ,GET0
001AE2 0A   
001AE3 CD      5098 CALL	ITEMI		;PORT ADDRESS
001AE4 42   
001AE5 18   
001AE6 D9      5099 EXX
001AE7 44      5100 LD	B,H
001AE8 4D      5101 LD	C,L
001AE9 ED      5102 IN	L,(C)		;INPUT FROM PORT BC
001AEA 68   
001AEB 18      5103 JR	COUNT0
001AEC 43   
001AED CD      5104 GET0:           CALL	GETS
001AEE 0F   
001AEF 1E   
001AF0 18      5105 JR	ASC1
001AF1 08   
001AF2 CD      5106 ASC:            CALL	ITEMS
001AF3 4B   
001AF4 18   
001AF5 AF      5107 ASC0:           XOR	A
001AF6 BB      5108 CP	E
001AF7 CA      5109 JP	Z,TRUEev		;NULL STRING
001AF8 9F   
001AF9 1B   
001AFA 2A      5110 ASC1:           LD	HL,(ACCS)
001AFB 00   
001AFC 52   
001AFD 18      5111 JR	COUNT0
001AFE 31   
001AFF CD      5112 LEN:            CALL	ITEMS
001B00 4B   
001B01 18   
001B02 EB      5113 EX	DE,HL
001B03 18      5114 JR	COUNT0
001B04 2B   
001B05 2A      5115 LOMEMVev:         LD	HL,(LOMEM)
001B06 DE   
001B07 54   
001B08 18      5116 JR	COUNT1
001B09 28   
001B0A 2A      5117 HIMEMVev:         LD	HL,(HIMEM)
001B0B E2   
001B0C 54   
001B0D 18      5118 JR	COUNT1
001B0E 23   
001B0F 2A      5119 PAGEVev:          LD	HL,(PAGE_)
001B10 DC   
001B11 54   
001B12 18      5120 JR	COUNT1
001B13 1E   
001B14 FD      5121 TOPV:           LD	A,(IY)
001B15 7E   
001B16 00   
001B17 FD      5122 INC	IY		;SKIP "P"
001B18 23   
001B19 FE      5123 CP	'P'
001B1A 50   
001B1B C2      5124 JP	NZ,SYNTAX	;"Syntax Error"
001B1C C2   
001B1D 25   
001B1E CD      5125 CALL	GETTOP
001B1F 07   
001B20 40   
001B21 18      5126 JR	COUNT1
001B22 0F   
001B23 2A      5127 ERLV:           LD	HL,(ERL)
001B24 F2   
001B25 54   
001B26 18      5128 JR	COUNT1
001B27 0A   
001B28 2A      5129 ERRV:           LD	HL,(ERR)
001B29 FD   
001B2A 54   
001B2B 18      5130 JR	COUNT0
001B2C 03   
001B2D 2A      5131 COUNTV:         LD	HL,(COUNT)
001B2E FB   
001B2F 54   
001B30 26      5132 COUNT0:         LD	H,0
001B31 00   
001B32 D9      5133 COUNT1:         EXX
001B33 AF      5134 XOR	A
001B34 4F      5135 LD	C,A		;INTEGER MARKER
001B35 67      5136 LD	H,A
001B36 6F      5137 LD	L,A
001B37 C9      5138 RET
001B38 AF      5145 OPENOT:         XOR	A
001B39 21      5146 DB	21H		;SKIP NEXT 2 BYTES
001B3A 3E      5147 OPENUP:         LD	A,2
001B3B 02   
001B3C 21      5148 DB	21H		;SKIP NEXT 2 BYTES
001B3D 3E      5149 OPENIN:         LD	A,1
001B3E 01   
001B3F F5      5150 PUSH	AF		;SAVE OPEN TYPE
001B40 CD      5151 CALL	ITEMS		;FILENAME
001B41 4B   
001B42 18   
001B43 3E      5152 LD	A,CR
001B44 0D   
001B45 12      5153 LD	(DE),A
001B46 F1      5154 POP	AF		;RESTORE OPEN TYPE
001B47 C6      5155 ADD	A,-1		;AFFECT FLAGS
001B48 FF   
001B49 21      5156 LD	HL,ACCS
001B4A 00   
001B4B 52   
001B4C CD      5157 CALL	OSOPEN
001B4D 26   
001B4E 06   
001B4F 6F      5158 LD	L,A
001B50 18      5159 JR	COUNT0
001B51 DE   
001B52 CD      5165 EXTev:            CALL	CHANEL
001B53 B3   
001B54 36   
001B55 CD      5166 CALL	GETEXT
001B56 8F   
001B57 06   
001B58 18      5167 JR	TIME0
001B59 12   
001B5A CD      5169 PTRev:            CALL	CHANEL
001B5B B3   
001B5C 36   
001B5D CD      5170 CALL	GETPTR
001B5E 58   
001B5F 06   
001B60 18      5171 JR	TIME0
001B61 0A   
001B62 FD      5176 TIMEVev:          LD	A,(IY)
001B63 7E   
001B64 00   
001B65 FE      5177 CP	'$'
001B66 24   
001B67 28      5178 JR	Z,TIMEVSev
001B68 09   
001B69 CD      5179 CALL	GETIME
001B6A 0B   
001B6B 0D   
001B6C D5      5180 TIME0:          PUSH	DE
001B6D D9      5181 EXX
001B6E E1      5182 POP	HL
001B6F AF      5183 XOR	A
001B70 4F      5184 LD	C,A
001B71 C9      5185 RET
001B72 FD      5190 TIMEVSev:         INC	IY		;SKIP $
001B73 23   
001B74 CD      5191 CALL	GETIMS
001B75 20   
001B76 0D   
001B77 3E      5192 LD	A,80H		;MARK STRING
001B78 80   
001B79 C9      5193 RET
001B7A CD      5197 SLT:            CALL	SCP
001B7B D7   
001B7C 1F   
001B7D D0      5198 RET	NC
001B7E 18      5199 JR	TRUEev
001B7F 1F   
001B80 CD      5201 SGT:            CALL	SCP
001B81 D7   
001B82 1F   
001B83 C8      5202 RET	Z
001B84 D8      5203 RET	C
001B85 18      5204 JR	TRUEev
001B86 18   
001B87 CD      5206 SGE:            CALL	SCP
001B88 D7   
001B89 1F   
001B8A D8      5207 RET	C
001B8B 18      5208 JR	TRUEev
001B8C 12   
001B8D CD      5210 SLE:            CALL	SCP
001B8E D7   
001B8F 1F   
001B90 28      5211 JR	Z,TRUEev
001B91 0D   
001B92 D0      5212 RET	NC
001B93 18      5213 JR	TRUEev
001B94 0A   
001B95 CD      5215 SNE:            CALL	SCP
001B96 D7   
001B97 1F   
001B98 C8      5216 RET	Z
001B99 18      5217 JR	TRUEev
001B9A 04   
001B9B CD      5219 SEQ:            CALL	SCP
001B9C D7   
001B9D 1F   
001B9E C0      5220 RET	NZ
001B9F 3E      5221 TRUEev:           LD	A,-1
001BA0 FF   
001BA1 D9      5222 EXX
001BA2 67      5223 LD	H,A
001BA3 6F      5224 LD	L,A
001BA4 D9      5225 EXX
001BA5 67      5226 LD	H,A
001BA6 6F      5227 LD	L,A
001BA7 3C      5228 INC	A
001BA8 4F      5229 LD	C,A
001BA9 C9      5230 RET
001BAA 3E      5235 PIev:             LD	A,35
001BAB 23   
001BAC 18      5236 JR	FPP1
001BAD 43   
001BAE 3E      5241 ABSev:            LD	A,16
001BAF 10   
001BB0 18      5242 JR	FPPN
001BB1 3A   
001BB2 3E      5247 CPL_ev:           LD	A,26
001BB3 1A   
001BB4 18      5248 JR	FPPN
001BB5 36   
001BB6 3E      5253 DEGev:            LD	A,21
001BB7 15   
001BB8 18      5254 JR	FPPN
001BB9 32   
001BBA 3E      5259 RADev:            LD	A,27
001BBB 1B   
001BBC 18      5260 JR	FPPN
001BBD 2E   
001BBE 3E      5265 SGNev:            LD	A,28
001BBF 1C   
001BC0 18      5266 JR	FPPN
001BC1 2A   
001BC2 3E      5271 INT_ev:           LD	A,23
001BC3 17   
001BC4 18      5272 JR	FPPN
001BC5 26   
001BC6 3E      5277 SQRev:            LD	A,30
001BC7 1E   
001BC8 18      5278 JR	FPPN
001BC9 22   
001BCA 3E      5283 TANev:            LD	A,31
001BCB 1F   
001BCC 18      5284 JR	FPPN
001BCD 1E   
001BCE 3E      5289 COSev:            LD	A,20
001BCF 14   
001BD0 18      5290 JR	FPPN
001BD1 1A   
001BD2 3E      5295 SINev:            LD	A,29
001BD3 1D   
001BD4 18      5296 JR	FPPN
001BD5 16   
001BD6 3E      5301 EXPev:            LD	A,22
001BD7 16   
001BD8 18      5302 JR	FPPN
001BD9 12   
001BDA 3E      5307 LNev:             LD	A,24
001BDB 18   
001BDC 18      5308 JR	FPPN
001BDD 0E   
001BDE 3E      5313 LOGev:            LD	A,25
001BDF 19   
001BE0 18      5314 JR	FPPN
001BE1 0A   
001BE2 3E      5319 ASNev:            LD	A,18
001BE3 12   
001BE4 18      5320 JR	FPPN
001BE5 06   
001BE6 3E      5325 ATNev:            LD	A,19
001BE7 13   
001BE8 18      5326 JR	FPPN
001BE9 02   
001BEA 3E      5331 ACSev:            LD	A,17
001BEB 11   
001BEC F5      5332 FPPN:           PUSH	AF
001BED CD      5333 CALL	ITEMN
001BEE 5C   
001BEF 18   
001BF0 F1      5334 POP	AF
001BF1 CD      5335 FPP1:           CALL	FPP
001BF2 F7   
001BF3 44   
001BF4 DA      5336 JP	C,ERROR_
001BF5 26   
001BF6 3F   
001BF7 AF      5337 XOR	A
001BF8 C9      5338 RET
001BF9 3E      5342 SFIX:           LD	A,38
001BFA 26   
001BFB 18      5343 JR	FPP1
001BFC F4   
001BFD 3E      5347 SFLOATev:         LD	A,39
001BFE 27   
001BFF 18      5348 JR	FPP1
001C00 F0   
001C01 CD      5353 VALev:            CALL	ITEMS
001C02 4B   
001C03 18   
001C04 AF      5354 VAL0:           XOR	A
001C05 12      5355 LD	(DE),A
001C06 DD      5356 LD	IX,ACCS
001C07 21   
001C08 00   
001C09 52   
001C0A 3E      5357 LD	A,36
001C0B 24   
001C0C 18      5358 JR	FPP1
001C0D E3   
001C0E CD      5363 EVAL_:          CALL	ITEMS
001C0F 4B   
001C10 18   
001C11 3E      5364 LD	A,CR
001C12 0D   
001C13 12      5365 LD	(DE),A
001C14 FD      5366 PUSH	IY
001C15 E5   
001C16 11      5367 LD	DE,ACCS
001C17 00   
001C18 52   
001C19 FD      5368 LD	IY,ACCS
001C1A 21   
001C1B 00   
001C1C 52   
001C1D 0E      5369 LD	C,0
001C1E 00   
001C1F CD      5370 CALL	LEXAN2		;TOKENISE
001C20 FA   
001C21 43   
001C22 12      5371 LD	(DE),A
001C23 13      5372 INC	DE
001C24 AF      5373 XOR	A
001C25 CD      5374 CALL	PUSHS		;PUT ON STACK
001C26 FB   
001C27 1F   
001C28 FD      5375 LD	IY,2
001C29 21   
001C2A 02   
001C2B 00   
001C2C FD      5376 ADD	IY,SP
001C2D 39   
001C2E CD      5377 CALL	EXPR
001C2F E4   
001C30 16   
001C31 FD      5378 POP	IY
001C32 E1   
001C33 FD      5379 ADD	IY,SP
001C34 39   
001C35 FD      5380 LD	SP,IY		;ADJUST STACK POINTER
001C36 F9   
001C37 FD      5381 POP	IY
001C38 E1   
001C39 08      5382 EX	AF,AF'
001C3A C9      5383 RET
001C3B DD      5392 RND:            LD	IX,RANDOM
001C3C 21   
001C3D F6   
001C3E 54   
001C3F CD      5393 CALL	NXT
001C40 ED   
001C41 44   
001C42 FE      5394 CP	'('
001C43 28   
001C44 28      5395 JR	Z,RND5		;ARGUMENT FOLLOWS
001C45 1C   
001C46 CD      5396 CALL	LOAD5
001C47 11   
001C48 19   
001C49 CB      5397 RND1:           RR	C
001C4A 19   
001C4B 06      5398 LD	B,32
001C4C 20   
001C4D D9      5399 RND2:           EXX			;CALCULATE NEXT
001C4E ED      5400 ADC	HL,HL
001C4F 6A   
001C50 D9      5401 EXX
001C51 ED      5402 ADC	HL,HL
001C52 6A   
001C53 CB      5403 BIT	3,L
001C54 5D   
001C55 28      5404 JR	Z,RND3
001C56 01   
001C57 3F      5405 CCF
001C58 10      5406 RND3:           DJNZ	RND2
001C59 F3   
001C5A CB      5407 RND4:           RL	C		;SAVE CARRY
001C5B 11   
001C5C CD      5408 CALL	STORE5		;STORE NEW NUMBER
001C5D E8   
001C5E 31   
001C5F AF      5409 XOR	A
001C60 4F      5410 LD	C,A
001C61 C9      5411 RET
001C62 CD      5412 RND5:           CALL	ITEMI
001C63 42   
001C64 18   
001C65 DD      5413 LD	IX,RANDOM
001C66 21   
001C67 F6   
001C68 54   
001C69 CB      5414 BIT	7,H		;NEGATIVE?
001C6A 7C   
001C6B 37      5415 SCF
001C6C 20      5416 JR	NZ,RND4		;SEED
001C6D EC   
001C6E CD      5417 CALL	TEST
001C6F 3B   
001C70 1F   
001C71 F5      5418 PUSH	AF
001C72 41      5419 LD	B,C
001C73 EB      5420 EX	DE,HL
001C74 D9      5421 EXX
001C75 EB      5422 EX	DE,HL
001C76 CD      5423 CALL	LOAD5
001C77 11   
001C78 19   
001C79 C4      5424 CALL	NZ,RND1		;NEXT IF NON-ZERO
001C7A 49   
001C7B 1C   
001C7C D9      5425 EXX			;SCRAMBLE (CARE!)
001C7D 0E      5426 LD	C,7FH
001C7E 7F   
001C7F CB      5427 RND6:           BIT	7,H		;FLOAT
001C80 7C   
001C81 20      5428 JR	NZ,RND7
001C82 08   
001C83 D9      5429 EXX
001C84 29      5430 ADD	HL,HL
001C85 D9      5431 EXX
001C86 ED      5432 ADC	HL,HL
001C87 6A   
001C88 0D      5433 DEC	C
001C89 20      5434 JR	NZ,RND6
001C8A F4   
001C8B CB      5435 RND7:           RES	7,H		;POSITIVE 0-0.999999
001C8C BC   
001C8D F1      5436 POP	AF
001C8E C8      5437 RET	Z		;ZERO ARGUMENT
001C8F D9      5438 EXX
001C90 7B      5439 LD	A,E
001C91 3D      5440 DEC	A
001C92 B2      5441 OR	D
001C93 D9      5442 EXX
001C94 B3      5443 OR	E
001C95 B2      5444 OR	D
001C96 C8      5445 RET	Z		;ARGUMENT=1
001C97 06      5446 LD	B,0		;INTEGER MARKER
001C98 00   
001C99 3E      5447 LD	A,10
001C9A 0A   
001C9B CD      5448 CALL	FPP		;MULTIPLY
001C9C F7   
001C9D 44   
001C9E DA      5449 JP	C,ERROR_
001C9F 26   
001CA0 3F   
001CA1 CD      5450 CALL	SFIX
001CA2 F9   
001CA3 1B   
001CA4 C3      5451 JP	ADD1ev
001CA5 38   
001CA6 18   
001CA7 FD      5455 SUMLEN:         INC	IY		;Skip LEN
001CA8 23   
001CA9 CD      5456 CALL	GETARB
001CAA B9   
001CAB 19   
001CAC CB      5457 BIT	7,B
001CAD 78   
001CAE CA      5458 JP	Z,MISMATev	;Type mismatch
001CAF 50   
001CB0 18   
001CB1 CD      5459 CALL	ARRLEN
001CB2 86   
001CB3 19   
001CB4 E5      5460 PUSH	HL
001CB5 DD      5461 POP	IX		;IX addresses array
001CB6 E1   
001CB7 AF      5462 XOR	A
001CB8 67      5463 LD	H,A
001CB9 6F      5464 LD	L,A
001CBA 47      5465 LD	B,A
001CBB DD      5466 SUMLN1:         LD	C,(IX)
001CBC 4E   
001CBD 00   
001CBE 09      5467 ADD	HL,BC
001CBF 0E      5468 LD	C,4
001CC0 04   
001CC1 DD      5469 ADD	IX,BC
001CC2 09   
001CC3 1B      5470 DEC	DE		;Count elements
001CC4 7A      5471 LD	A,D
001CC5 B3      5472 OR	E
001CC6 20      5473 JR	NZ,SUMLN1
001CC7 F3   
001CC8 C3      5474 JP	COUNT1
001CC9 32   
001CCA 1B   
001CCB CD      5478 SUM:            CALL	NXT
001CCC ED   
001CCD 44   
001CCE FE      5479 CP	TLEN
001CCF A9   
001CD0 28      5480 JR	Z,SUMLEN
001CD1 D5   
001CD2 CD      5481 CALL	GETARB
001CD3 B9   
001CD4 19   
001CD5 CB      5482 BIT	7,B
001CD6 78   
001CD7 20      5483 JR	NZ,SUMSTR
001CD8 27   
001CD9 C5      5484 PUSH	BC
001CDA CD      5485 CALL	ARRLEN
001CDB 86   
001CDC 19   
001CDD E5      5486 PUSH	HL
001CDE DD      5487 POP	IX		;IX addresses array
001CDF E1   
001CE0 CD      5488 CALL	ZERO
001CE1 DA   
001CE2 1F   
001CE3 F1      5489 POP	AF		;A = element size
001CE4 D5      5490 SUMUP:          PUSH	DE
001CE5 F5      5491 PUSH	AF
001CE6 CD      5492 CALL	DLOADN
001CE7 C9   
001CE8 19   
001CE9 3E      5493 LD	A,11
001CEA 0B   
001CEB CD      5494 CALL	FPP
001CEC F7   
001CED 44   
001CEE DA      5495 JP	C,ERROR_
001CEF 26   
001CF0 3F   
001CF1 F1      5496 POP	AF
001CF2 16      5497 LD	D,0
001CF3 00   
001CF4 5F      5498 LD	E,A
001CF5 DD      5499 ADD	IX,DE		;Bump to next element
001CF6 19   
001CF7 D1      5500 POP	DE
001CF8 1B      5501 DEC	DE		;Count elements
001CF9 47      5502 LD	B,A
001CFA 7A      5503 LD	A,D
001CFB B3      5504 OR	E
001CFC 78      5505 LD	A,B
001CFD 20      5506 JR	NZ,SUMUP
001CFE E5   
001CFF C9      5507 RET
001D00 CD      5511 SUMSTR:         CALL	ARRLEN
001D01 86   
001D02 19   
001D03 E5      5512 PUSH	HL
001D04 DD      5513 POP	IX		;IX addresses array
001D05 E1   
001D06 EB      5514 EX	DE,HL
001D07 11      5515 LD	DE,ACCS
001D08 00   
001D09 52   
001D0A 06      5516 LD	B,0
001D0B 00   
001D0C E5      5517 SUMST1:         PUSH	HL
001D0D DD      5518 LD	C,(IX)
001D0E 4E   
001D0F 00   
001D10 79      5519 LD	A,C
001D11 B7      5520 OR	A
001D12 28      5521 JR	Z,SUMST2
001D13 0E   
001D14 83      5522 ADD	A,E
001D15 3E      5523 LD	A,19
001D16 13   
001D17 DA      5524 JP	C,ERROR_		;"String too long"
001D18 26   
001D19 3F   
001D1A DD      5525 LD	L,(IX+2)
001D1B 6E   
001D1C 02   
001D1D DD      5526 LD	H,(IX+3)
001D1E 66   
001D1F 03   
001D20 ED      5527 LDIR
001D21 B0   
001D22 E1      5528 SUMST2:         POP	HL
001D23 0E      5529 LD	C,4
001D24 04   
001D25 DD      5530 ADD	IX,BC
001D26 09   
001D27 2B      5531 DEC	HL		;Count elements
001D28 7C      5532 LD	A,H
001D29 B5      5533 OR	L
001D2A 20      5534 JR	NZ,SUMST1
001D2B E0   
001D2C F6      5535 OR	80H
001D2D 80   
001D2E C9      5536 RET
001D2F CD      5540 MODFUN:         CALL	GETARB
001D30 B9   
001D31 19   
001D32 CB      5541 BIT	7,B
001D33 78   
001D34 C2      5542 JP	NZ,MISMATev
001D35 50   
001D36 18   
001D37 C5      5543 PUSH	BC
001D38 CD      5544 CALL	ARRLEN
001D39 86   
001D3A 19   
001D3B E5      5545 PUSH	HL
001D3C DD      5546 POP	IX		;IX addresses array
001D3D E1   
001D3E CD      5547 CALL	ZERO
001D3F DA   
001D40 1F   
001D41 F1      5548 POP	AF		;A = element size
001D42 D5      5549 MODUP:          PUSH	DE
001D43 F5      5550 PUSH	AF
001D44 C5      5551 PUSH	BC
001D45 E5      5552 PUSH	HL
001D46 D9      5553 EXX
001D47 E5      5554 PUSH	HL
001D48 D9      5555 EXX
001D49 CD      5556 CALL	LOADN
001D4A 07   
001D4B 19   
001D4C AF      5557 XOR	A
001D4D 47      5558 LD	B,A
001D4E 57      5559 LD	D,A
001D4F 5F      5560 LD	E,A
001D50 D9      5561 EXX
001D51 57      5562 LD	D,A
001D52 1E      5563 LD	E,2
001D53 02   
001D54 D9      5564 EXX
001D55 3E      5565 LD	A,14
001D56 0E   
001D57 DD      5566 PUSH	IX
001D58 E5   
001D59 CD      5567 CALL	FPP		;Square
001D5A F7   
001D5B 44   
001D5C DD      5568 POP	IX
001D5D E1   
001D5E DA      5569 JP	C,ERROR_
001D5F 26   
001D60 3F   
001D61 D9      5570 EXX
001D62 EB      5571 EX	DE,HL
001D63 E1      5572 POP	HL
001D64 D9      5573 EXX
001D65 EB      5574 EX	DE,HL
001D66 E1      5575 POP	HL
001D67 79      5576 LD	A,C
001D68 C1      5577 POP	BC
001D69 47      5578 LD	B,A
001D6A 3E      5579 LD	A,11
001D6B 0B   
001D6C CD      5580 CALL	FPP		;Accumulate
001D6D F7   
001D6E 44   
001D6F DA      5581 JP	C,ERROR_
001D70 26   
001D71 3F   
001D72 F1      5582 POP	AF
001D73 16      5583 LD	D,0
001D74 00   
001D75 5F      5584 LD	E,A
001D76 DD      5585 ADD	IX,DE		;Bump to next element
001D77 19   
001D78 D1      5586 POP	DE
001D79 1B      5587 DEC	DE		;Count elements
001D7A 47      5588 LD	B,A
001D7B 7A      5589 LD	A,D
001D7C B3      5590 OR	E
001D7D 78      5591 LD	A,B
001D7E 20      5592 JR	NZ,MODUP
001D7F C2   
001D80 3E      5593 LD	A,30
001D81 1E   
001D82 CD      5594 CALL	FPP		;Square root
001D83 F7   
001D84 44   
001D85 AF      5595 XOR	A
001D86 C9      5596 RET
001D87 CD      5601 INSTR:          CALL	EXPRS		;STRING TO SEARCH
001D88 1E   
001D89 18   
001D8A CD      5602 CALL	COMMA
001D8B 84   
001D8C 20   
001D8D CD      5603 CALL	PUSHS		;SAVE STRING ON STACK
001D8E FB   
001D8F 1F   
001D90 CD      5604 CALL	EXPRS		;SUB-STRING
001D91 1E   
001D92 18   
001D93 C1      5605 POP	BC
001D94 21      5606 LD	HL,0
001D95 00   
001D96 00   
001D97 39      5607 ADD	HL,SP		;HL ADDRESSES MAIN
001D98 C5      5608 PUSH	BC		;C = MAIN STRING LENGTH
001D99 43      5609 LD	B,E		;B = SUB-STRING LENGTH
001D9A CD      5610 CALL	NXT
001D9B ED   
001D9C 44   
001D9D FE      5611 CP	','
001D9E 2C   
001D9F 3E      5612 LD	A,0
001DA0 00   
001DA1 20      5613 JR	NZ,INSTR1
001DA2 17   
001DA3 FD      5614 INC	IY		;SKIP COMMA
001DA4 23   
001DA5 C5      5615 PUSH	BC		;SAVE LENGTHS
001DA6 E5      5616 PUSH	HL		;SAVE MAIN ADDRESS
001DA7 CD      5617 CALL	PUSHS
001DA8 FB   
001DA9 1F   
001DAA CD      5618 CALL	EXPRI
001DAB 15   
001DAC 18   
001DAD C1      5619 POP	BC
001DAE CD      5620 CALL	POPS
001DAF 19   
001DB0 20   
001DB1 E1      5621 POP	HL		;RESTORE MAIN ADDRESS
001DB2 C1      5622 POP	BC		;RESTORE LENGTHS
001DB3 D9      5623 EXX
001DB4 7D      5624 LD	A,L
001DB5 D9      5625 EXX
001DB6 B7      5626 OR	A
001DB7 28      5627 JR	Z,INSTR1
001DB8 01   
001DB9 3D      5628 DEC	A
001DBA 11      5629 INSTR1:         LD	DE,ACCS		;DE ADDRESSES SUB
001DBB 00   
001DBC 52   
001DBD CD      5630 CALL	SEARCH
001DBE D4   
001DBF 1D   
001DC0 D1      5631 POP	DE
001DC1 28      5632 JR	Z,INSTR2	;N.B. CARRY CLEARED
001DC2 03   
001DC3 ED      5633 SBC	HL,HL
001DC4 62   
001DC5 39      5634 ADD	HL,SP
001DC6 ED      5635 INSTR2:         SBC	HL,SP
001DC7 72   
001DC8 EB      5636 EX	DE,HL
001DC9 26      5637 LD	H,0
001DCA 00   
001DCB 39      5638 ADD	HL,SP
001DCC F9      5639 LD	SP,HL
001DCD EB      5640 EX	DE,HL
001DCE CD      5641 CALL	BRAKET
001DCF 90   
001DD0 20   
001DD1 C3      5642 JP	COUNT1
001DD2 32   
001DD3 1B   
001DD4 C5      5652 SEARCH:         PUSH	BC
001DD5 06      5653 LD	B,0
001DD6 00   
001DD7 4F      5654 LD	C,A
001DD8 09      5655 ADD	HL,BC		;NEW START ADDRESS
001DD9 C1      5656 POP	BC
001DDA 91      5657 SUB	C
001DDB 30      5658 JR	NC,SRCH4
001DDC 28   
001DDD ED      5659 NEG
001DDE 44   
001DDF 4F      5660 LD	C,A		;REMAINING LENGTH
001DE0 1A      5661 SRCH1ev:          LD	A,(DE)
001DE1 C5      5662 PUSH	BC
001DE2 06      5663 LD	B,0
001DE3 00   
001DE4 ED      5664 CPIR			;FIND FIRST CHARACTER
001DE5 B1   
001DE6 79      5665 LD	A,C
001DE7 C1      5666 POP	BC
001DE8 20      5667 JR	NZ,SRCH4
001DE9 1B   
001DEA 4F      5668 LD	C,A
001DEB 05      5669 DEC	B		;Bug fix
001DEC B8      5670 CP	B		;Bug fix
001DED 04      5671 INC	B		;Bug fix
001DEE 38      5672 JR	C,SRCH4		;Bug fix
001DEF 15   
001DF0 C5      5673 PUSH	BC
001DF1 D5      5674 PUSH	DE
001DF2 E5      5675 PUSH	HL
001DF3 05      5676 DEC	B
001DF4 28      5677 JR	Z,SRCH3		;FOUND !
001DF5 08   
001DF6 13      5678 SRCH2ev:          INC	DE
001DF7 1A      5679 LD	A,(DE)
001DF8 BE      5680 CP	(HL)
001DF9 20      5681 JR	NZ,SRCH3
001DFA 03   
001DFB 23      5682 INC	HL
001DFC 10      5683 DJNZ	SRCH2ev
001DFD F8   
001DFE E1      5684 SRCH3:          POP	HL
001DFF D1      5685 POP	DE
001E00 C1      5686 POP	BC
001E01 20      5687 JR	NZ,SRCH1ev
001E02 DD   
001E03 AF      5688 XOR	A		;Z, NC
001E04 C9      5689 RET			;FOUND
001E05 F6      5691 SRCH4:          OR	0FFH		;NZ, NC
001E06 FF   
001E07 C9      5692 RET			;NOT FOUND
001E08 CD      5697 CHRS:           CALL	ITEMI
001E09 42   
001E0A 18   
001E0B D9      5698 EXX
001E0C 7D      5699 LD	A,L
001E0D 18      5700 JR	GET1
001E0E 0A   
001E0F CD      5705 GETS:           CALL	NXT
001E10 ED   
001E11 44   
001E12 FE      5706 CP	'#'
001E13 23   
001E14 28      5707 JR	Z,GET2
001E15 06   
001E16 CD      5708 CALL	OSRDCH
001E17 C0   
001E18 05   
001E19 37      5709 GET1:           SCF
001E1A 18      5710 JR	INKEY1
001E1B 5B   
001E1C CD      5712 GET2:           CALL	CHNL		;File channel
001E1D BD   
001E1E 36   
001E1F CD      5713 CALL	NXT
001E20 ED   
001E21 44   
001E22 FE      5714 CP	TBY
001E23 0F   
001E24 28      5715 JR	Z,GET3
001E25 04   
001E26 FE      5716 CP	TTO
001E27 B8   
001E28 20      5717 JR	NZ,GET4
001E29 0C   
001E2A FD      5718 GET3:           INC	IY
001E2B 23   
001E2C F5      5719 PUSH	AF
001E2D D5      5720 PUSH	DE
001E2E CD      5721 CALL	ITEMI		;Get BY or TO qualifier
001E2F 42   
001E30 18   
001E31 D9      5722 EXX
001E32 44      5723 LD	B,H
001E33 4D      5724 LD	C,L
001E34 D1      5725 POP	DE
001E35 F1      5726 POP	AF
001E36 21      5727 GET4:           LD	HL,ACCS
001E37 00   
001E38 52   
001E39 FE      5728 CP	TTO
001E3A B8   
001E3B 28      5729 JR	Z,GET5
001E3C 08   
001E3D 51      5730 LD	D,C		;Maximum count
001E3E 01      5731 LD	BC,100H		;Default
001E3F 00   
001E40 01   
001E41 FE      5732 CP	TBY
001E42 0F   
001E43 28      5733 JR	Z,GET6
001E44 04   
001E45 16      5734 GET5:           LD	D,0
001E46 00   
001E47 CB      5735 SET	1,B		;Flag no count
001E48 C8   
001E49 C5      5736 GET6:           PUSH	BC
001E4A CD      5737 CALL	OSBGET
001E4B 3D   
001E4C 06   
001E4D C1      5738 POP	BC
001E4E 38      5739 JR	C,GET9		;EOF
001E4F 1C   
001E50 CB      5740 BIT	1,B
001E51 48   
001E52 28      5741 JR	Z,GET8
001E53 13   
001E54 B9      5742 CP	C
001E55 28      5743 JR	Z,GET9		;NUL (or supplied term)
001E56 15   
001E57 CB      5744 BIT	7,B
001E58 78   
001E59 20      5745 JR	NZ,GET7
001E5A 08   
001E5B CB      5746 BIT	0,B
001E5C 40   
001E5D 28      5747 JR	Z,GET8
001E5E 08   
001E5F FE      5748 CP	LF
001E60 0A   
001E61 28      5749 JR	Z,GET9		;LF
001E62 09   
001E63 FE      5750 GET7:           CP	CR
001E64 0D   
001E65 28      5751 JR	Z,GET9		;CR
001E66 05   
001E67 77      5752 GET8:           LD	(HL),A
001E68 2C      5753 INC	L
001E69 15      5754 DEC	D
001E6A 20      5755 JR	NZ,GET6
001E6B DD   
001E6C EB      5756 GET9:           EX	DE,HL
001E6D 3E      5757 LD	A,80H
001E6E 80   
001E6F C9      5758 RET
001E70 CD      5765 INKEYS:         CALL	ITEMI
001E71 42   
001E72 18   
001E73 D9      5766 EXX
001E74 CD      5767 CALL	OSKEY
001E75 73   
001E76 0D   
001E77 11      5768 INKEY1:         LD	DE,ACCS
001E78 00   
001E79 52   
001E7A 12      5769 LD	(DE),A
001E7B 3E      5770 LD	A,80H
001E7C 80   
001E7D D0      5771 RET	NC
001E7E 1C      5772 INC	E
001E7F C9      5773 RET
001E80 CD      5778 MIDS:           CALL	EXPRS
001E81 1E   
001E82 18   
001E83 CD      5779 CALL	COMMA
001E84 84   
001E85 20   
001E86 CD      5780 CALL	PUSHS		;SAVE STRING ON STACK
001E87 FB   
001E88 1F   
001E89 CD      5781 CALL	EXPRI
001E8A 15   
001E8B 18   
001E8C C1      5782 POP	BC
001E8D CD      5783 CALL	POPS
001E8E 19   
001E8F 20   
001E90 D9      5784 EXX
001E91 7D      5785 LD	A,L
001E92 D9      5786 EXX
001E93 B7      5787 OR	A
001E94 28      5788 JR	Z,MIDS1
001E95 0D   
001E96 3D      5789 DEC	A
001E97 6F      5790 LD	L,A
001E98 93      5791 SUB	E
001E99 1E      5792 LD	E,0
001E9A 00   
001E9B 30      5793 JR	NC,MIDS1
001E9C 06   
001E9D ED      5794 NEG
001E9E 44   
001E9F 4F      5795 LD	C,A
001EA0 CD      5796 CALL	RIGHT1
001EA1 FF   
001EA2 1E   
001EA3 CD      5797 MIDS1:          CALL	NXT
001EA4 ED   
001EA5 44   
001EA6 FE      5798 CP	','
001EA7 2C   
001EA8 28      5799 JR	Z,LEFT1
001EA9 1A   
001EAA CD      5800 CALL	BRAKET
001EAB 90   
001EAC 20   
001EAD 3E      5801 LD	A,80H
001EAE 80   
001EAF C9      5802 RET
001EB0 CD      5808 LEFTS:          CALL	EXPRS
001EB1 1E   
001EB2 18   
001EB3 CD      5809 CALL	NXT
001EB4 ED   
001EB5 44   
001EB6 FE      5810 CP	','
001EB7 2C   
001EB8 28      5811 JR	Z,LEFT1
001EB9 0A   
001EBA CD      5812 CALL	BRAKET
001EBB 90   
001EBC 20   
001EBD 7B      5813 LD	A,E
001EBE B7      5814 OR	A
001EBF 28      5815 JR	Z,LEFT3
001EC0 1A   
001EC1 1D      5816 DEC	E
001EC2 18      5817 JR	LEFT3
001EC3 17   
001EC4 FD      5819 LEFT1:          INC	IY
001EC5 23   
001EC6 CD      5820 CALL	PUSHS		;SAVE STRING ON STACK
001EC7 FB   
001EC8 1F   
001EC9 CD      5821 CALL	EXPRI
001ECA 15   
001ECB 18   
001ECC C1      5822 POP	BC
001ECD CD      5823 CALL	POPS
001ECE 19   
001ECF 20   
001ED0 CD      5824 CALL	BRAKET
001ED1 90   
001ED2 20   
001ED3 D9      5825 EXX
001ED4 7D      5826 LD	A,L
001ED5 D9      5827 EXX
001ED6 BB      5828 CP	E
001ED7 30      5829 JR	NC,LEFT3
001ED8 02   
001ED9 6B      5830 LD	L,E		;FOR RIGHT$
001EDA 5F      5831 LEFT2:          LD	E,A
001EDB 3E      5832 LEFT3:          LD	A,80H		;STRING MARKER
001EDC 80   
001EDD C9      5833 RET
001EDE CD      5838 RIGHTS:         CALL	EXPRS
001EDF 1E   
001EE0 18   
001EE1 CD      5839 CALL	NXT
001EE2 ED   
001EE3 44   
001EE4 FE      5840 CP	','
001EE5 2C   
001EE6 28      5841 JR	Z,RIGHT0
001EE7 0C   
001EE8 CD      5842 CALL	BRAKET
001EE9 90   
001EEA 20   
001EEB 7B      5843 LD	A,E
001EEC B7      5844 OR	A
001EED 28      5845 JR	Z,LEFT3
001EEE EC   
001EEF 3D      5846 DEC	A
001EF0 0E      5847 LD	C,1
001EF1 01   
001EF2 18      5848 JR	RIGHT2
001EF3 0A   
001EF4 CD      5850 RIGHT0:         CALL	LEFT1
001EF5 C4   
001EF6 1E   
001EF7 D0      5851 RET	NC
001EF8 1C      5852 INC	E
001EF9 1D      5853 DEC	E
001EFA C8      5854 RET	Z
001EFB 4B      5855 LD	C,E
001EFC 7D      5856 LD	A,L
001EFD 93      5857 SUB	E
001EFE 6F      5858 RIGHT2:         LD	L,A
001EFF 06      5859 RIGHT1:         LD	B,0
001F00 00   
001F01 62      5860 LD	H,D
001F02 58      5861 LD	E,B
001F03 ED      5862 LDIR			;MOVE
001F04 B0   
001F05 3E      5863 LD	A,80H
001F06 80   
001F07 C9      5864 RET
001F08 CD      5869 STRING_:        CALL	EXPRI
001F09 15   
001F0A 18   
001F0B CD      5870 CALL	COMMA
001F0C 84   
001F0D 20   
001F0E D9      5871 EXX
001F0F 7D      5872 LD	A,L
001F10 D9      5873 EXX
001F11 F5      5874 PUSH	AF
001F12 CD      5875 CALL	EXPRS
001F13 1E   
001F14 18   
001F15 CD      5876 CALL	BRAKET
001F16 90   
001F17 20   
001F18 F1      5877 POP	AF
001F19 B7      5878 OR	A
001F1A 28      5879 JR	Z,LEFT2		;N=0
001F1B BE   
001F1C 3D      5880 DEC	A
001F1D 4F      5881 LD	C,A
001F1E 3E      5882 LD	A,80H		;STRING MARKER
001F1F 80   
001F20 C8      5883 RET	Z
001F21 1C      5884 INC	E
001F22 1D      5885 DEC	E
001F23 C8      5886 RET	Z		;NULL STRING
001F24 43      5887 LD	B,E
001F25 62      5888 LD	H,D
001F26 2E      5889 LD	L,0
001F27 00   
001F28 C5      5890 STRIN1:         PUSH	BC
001F29 7E      5891 STRIN2:         LD	A,(HL)
001F2A 23      5892 INC	HL
001F2B 12      5893 LD	(DE),A
001F2C 1C      5894 INC	E
001F2D 3E      5895 LD	A,19
001F2E 13   
001F2F CA      5896 JP	Z,ERROR_		;"String too long"
001F30 26   
001F31 3F   
001F32 10      5897 DJNZ	STRIN2
001F33 F5   
001F34 C1      5898 POP	BC
001F35 0D      5899 DEC	C
001F36 20      5900 JR	NZ,STRIN1
001F37 F0   
001F38 3E      5901 LD	A,80H
001F39 80   
001F3A C9      5902 RET
001F3B 7C      5910 TEST:           LD	A,H
001F3C B5      5911 OR	L
001F3D D9      5912 EXX
001F3E B4      5913 OR	H
001F3F B5      5914 OR	L
001F40 D9      5915 EXX
001F41 C9      5916 RET
001F42 D9      5923 DECODE:         EXX
001F43 FD      5924 LD	A,(IY)
001F44 7E   
001F45 00   
001F46 FD      5925 INC	IY
001F47 23   
001F48 17      5926 RLA
001F49 17      5927 RLA
001F4A 67      5928 LD	H,A
001F4B E6      5929 AND	0C0H
001F4C C0   
001F4D FD      5930 XOR	(IY)
001F4E AE   
001F4F 00   
001F50 FD      5931 INC	IY
001F51 23   
001F52 6F      5932 LD	L,A
001F53 7C      5933 LD	A,H
001F54 17      5934 RLA
001F55 17      5935 RLA
001F56 E6      5936 AND	0C0H
001F57 C0   
001F58 FD      5937 XOR	(IY)
001F59 AE   
001F5A 00   
001F5B FD      5938 INC	IY
001F5C 23   
001F5D 67      5939 LD	H,A
001F5E D9      5940 EXX
001F5F AF      5941 XOR	A
001F60 4F      5942 LD	C,A
001F61 67      5943 LD	H,A
001F62 6F      5944 LD	L,A
001F63 C9      5945 RET
001F64 FD      5952 HEXSTS:         INC	IY		;SKIP TILDE
001F65 23   
001F66 CD      5953 CALL	ITEMN
001F67 5C   
001F68 18   
001F69 CD      5954 CALL	HEXSTR
001F6A 6F   
001F6B 1F   
001F6C 3E      5955 LD	A,80H
001F6D 80   
001F6E C9      5956 RET
001F6F CD      5958 HEXSTR:         CALL	SFIX
001F70 F9   
001F71 1B   
001F72 01      5959 LD	BC,8
001F73 08   
001F74 00   
001F75 11      5960 LD	DE,ACCS
001F76 00   
001F77 52   
001F78 C5      5961 HEXST1:         PUSH	BC
001F79 06      5962 LD	B,4
001F7A 04   
001F7B AF      5963 XOR	A
001F7C D9      5964 HEXST2:         EXX
001F7D 29      5965 ADD	HL,HL
001F7E D9      5966 EXX
001F7F ED      5967 ADC	HL,HL
001F80 6A   
001F81 17      5968 RLA
001F82 10      5969 DJNZ	HEXST2
001F83 F8   
001F84 C1      5970 POP	BC
001F85 0D      5971 DEC	C
001F86 F8      5972 RET	M
001F87 28      5973 JR	Z,HEXST3
001F88 06   
001F89 B7      5974 OR	A
001F8A 20      5975 JR	NZ,HEXST3
001F8B 03   
001F8C B8      5976 CP	B
001F8D 28      5977 JR	Z,HEXST1
001F8E E9   
001F8F C6      5978 HEXST3:         ADD	A,90H
001F90 90   
001F91 27      5979 DAA
001F92 CE      5980 ADC	A,40H
001F93 40   
001F94 27      5981 DAA
001F95 12      5982 LD	(DE),A
001F96 13      5983 INC	DE
001F97 47      5984 LD	B,A
001F98 18      5985 JR	HEXST1
001F99 DE   
001F9A CD      5995 STRS:           CALL	NXT
001F9B ED   
001F9C 44   
001F9D FE      5996 CP	'~'
001F9E 7E   
001F9F 28      5997 JR	Z,HEXSTS
001FA0 C3   
001FA1 CD      5998 CALL	ITEMN
001FA2 5C   
001FA3 18   
001FA4 DD      5999 LD	IX,STAVAR
001FA5 21   
001FA6 00   
001FA7 54   
001FA8 DD      6000 LD	A,(IX+3)
001FA9 7E   
001FAA 03   
001FAB B7      6001 OR	A
001FAC DD      6002 LD	IX,G9-1		;G9 FORMAT
001FAD 21   
001FAE D4   
001FAF 1F   
001FB0 28      6003 JR	Z,STR0
001FB1 04   
001FB2 DD      6004 STR:            LD	IX,STAVAR
001FB3 21   
001FB4 00   
001FB5 54   
001FB6 11      6005 STR0:           LD	DE,ACCS
001FB7 00   
001FB8 52   
001FB9 3E      6006 LD	A,37
001FBA 25   
001FBB CD      6007 CALL	FPP
001FBC F7   
001FBD 44   
001FBE DA      6008 JP	C,ERROR_
001FBF 26   
001FC0 3F   
001FC1 DD      6009 BIT	0,(IX+2)
001FC2 CB   
001FC3 02   
001FC4 46   
001FC5 3E      6010 STR1:           LD	A,80H		;STRING MARKER
001FC6 80   
001FC7 C8      6011 RET	Z
001FC8 79      6012 LD	A,C
001FC9 C6      6013 ADD	A,4
001FCA 04   
001FCB BB      6014 STR2:           CP	E
001FCC 28      6015 JR	Z,STR1
001FCD F7   
001FCE EB      6016 EX	DE,HL
001FCF 36      6017 LD	(HL),' '	;TRAILING SPACE
001FD0 20   
001FD1 23      6018 INC	HL
001FD2 EB      6019 EX	DE,HL
001FD3 18      6020 JR	STR2
001FD4 F6   
001FD5 09      6022 G9:             DW	9
001FD6 00   
001FD7 CD      6028 SCP:            CALL	SCP0
001FD8 E4   
001FD9 1F   
001FDA 3E      6029 ZERO:           LD	A,0
001FDB 00   
001FDC D9      6030 EXX
001FDD 67      6031 LD	H,A
001FDE 6F      6032 LD	L,A
001FDF D9      6033 EXX
001FE0 67      6034 LD	H,A
001FE1 6F      6035 LD	L,A
001FE2 4F      6036 LD	C,A
001FE3 C9      6037 RET
001FE4 04      6039 SCP0:           INC	B
001FE5 0C      6040 INC	C
001FE6 05      6041 SCP1:           DEC	B
001FE7 28      6042 JR	Z,SCP2
001FE8 0A   
001FE9 0D      6043 DEC	C
001FEA 28      6044 JR	Z,SCP3
001FEB 0C   
001FEC 1A      6045 LD	A,(DE)
001FED BE      6046 CP	(HL)
001FEE C0      6047 RET	NZ
001FEF 13      6048 INC	DE
001FF0 23      6049 INC	HL
001FF1 18      6050 JR	SCP1
001FF2 F3   
001FF3 B7      6051 SCP2:           OR	A
001FF4 0D      6052 DEC	C
001FF5 C8      6053 RET	Z
001FF6 37      6054 SCF
001FF7 C9      6055 RET
001FF8 B7      6056 SCP3:           OR	A
001FF9 0C      6057 INC	C
001FFA C9      6058 RET
001FFB 21      6066 PUSHS:          LD	HL,ACCS
001FFC 00   
001FFD 52   
001FFE CD      6067 CALL	CHECK
001FFF 68   
002000 32   
002001 DD      6068 POP	IX		;RETURN ADDRESS
002002 E1   
002003 B7      6069 OR	A		;CLEAR CARRY
002004 54      6070 LD	D,H
002005 4B      6071 LD	C,E
002006 ED      6072 SBC	HL,DE
002007 52   
002008 39      6073 ADD	HL,SP
002009 F9      6074 LD	SP,HL
00200A 47      6075 LD	B,A
00200B C5      6076 PUSH	BC
00200C 28      6077 JR	Z,PUSHS1	;ZERO LENGTH
00200D 09   
00200E EB      6078 EX	DE,HL
00200F 06      6079 LD	B,0
002010 00   
002011 68      6080 LD	L,B		;L=0
002012 ED      6081 LDIR			;COPY TO STACK
002013 B0   
002014 CD      6082 CALL	CHECK
002015 68   
002016 32   
002017 DD      6083 PUSHS1:         JP	(IX)		;"RETURN"
002018 E9   
002019 DD      6091 POPS:           POP	IX		;RETURN ADDRESS
00201A E1   
00201B 21      6092 LD	HL,0
00201C 00   
00201D 00   
00201E 44      6093 LD	B,H		;B=0
00201F 39      6094 ADD	HL,SP
002020 11      6095 LD	DE,ACCS
002021 00   
002022 52   
002023 0C      6096 INC	C
002024 0D      6097 DEC	C
002025 28      6098 JR	Z,POPS1		;ZERO LENGTH
002026 02   
002027 ED      6099 LDIR			;COPY FROM STACK
002028 B0   
002029 F9      6100 POPS1:          LD	SP,HL
00202A DD      6101 JP	(IX)		;"RETURN"
00202B E9   
00202C FD      6103 BINDIG:         LD	A,(IY)
00202D 7E   
00202E 00   
00202F FE      6104 CP	'0'
002030 30   
002031 D8      6105 RET	C
002032 FE      6106 CP	'1'+1
002033 32   
002034 3F      6107 CCF
002035 D8      6108 RET	C
002036 D6      6109 SUB	'0'
002037 30   
002038 C9      6110 RET
002039 FD      6112 HEXDIG:         LD	A,(IY)
00203A 7E   
00203B 00   
00203C FE      6113 CP	'0'
00203D 30   
00203E D8      6114 RET	C
00203F FE      6115 CP	'9'+1
002040 3A   
002041 3F      6116 CCF
002042 D0      6117 RET	NC
002043 FE      6118 CP	'A'
002044 41   
002045 D8      6119 RET	C
002046 D6      6120 SUB	'A'-10
002047 37   
002048 FE      6121 CP	16
002049 10   
00204A 3F      6122 CCF
00204B C9      6123 RET
00204C FE      6125 RELOPQ:         CP	'>'
00204D 3E   
00204E D0      6126 RET	NC
00204F FE      6127 CP	'='
002050 3D   
002051 D0      6128 RET	NC
002052 FE      6129 CP	'<'
002053 3C   
002054 C9      6130 RET
002055 FD      6132 SAVEev:           INC	IY
002056 23   
002057 E6      6133 AND	0FH
002058 0F   
002059 08      6134 SAVE1:          EX	AF,AF'
00205A FA      6135 JP	M,MISMATev
00205B 50   
00205C 18   
00205D 08      6136 EX	AF,AF'
00205E E3      6137 EX	(SP),HL
00205F D9      6138 EXX
002060 E5      6139 PUSH	HL
002061 D9      6140 EXX
002062 F5      6141 PUSH	AF
002063 C5      6142 PUSH	BC
002064 E9      6143 JP	(HL)
002065 08      6145 DOIT:           EX	AF,AF'
002066 FA      6146 JP	M,MISMATev
002067 50   
002068 18   
002069 D9      6147 EXX
00206A C1      6148 POP	BC		;RETURN ADDRESS
00206B D9      6149 EXX
00206C 79      6150 LD	A,C
00206D C1      6151 POP	BC
00206E 47      6152 LD	B,A
00206F F1      6153 POP	AF		;OPERATOR
002070 D9      6154 EXX
002071 EB      6155 EX	DE,HL
002072 E1      6156 POP	HL
002073 D9      6157 EXX
002074 EB      6158 EX	DE,HL
002075 E1      6159 POP	HL
002076 D9      6160 EXX
002077 C5      6161 PUSH	BC
002078 D9      6162 EXX
002079 CD      6163 CALL	FPP
00207A F7   
00207B 44   
00207C 38      6164 JR	C,ERROR1ev
00207D 1C   
00207E AF      6165 XOR	A
00207F 08      6166 EX	AF,AF'		;TYPE
002080 FD      6167 LD	A,(IY)
002081 7E   
002082 00   
002083 C9      6168 RET
002084 CD      6170 COMMA:          CALL	NXT
002085 ED   
002086 44   
002087 FD      6171 INC	IY
002088 23   
002089 FE      6172 CP	','
00208A 2C   
00208B C8      6173 RET	Z
00208C 3E      6174 LD	A,5
00208D 05   
00208E 18      6175 JR	ERROR1ev		;"Missing ,"
00208F 0A   
002090 CD      6177 BRAKET:         CALL	NXT
002091 ED   
002092 44   
002093 FD      6178 INC	IY
002094 23   
002095 FE      6179 CP	')'
002096 29   
002097 C8      6180 RET	Z
002098 3E      6181 LD	A,27
002099 1B   
00209A C3      6182 ERROR1ev:         JP	ERROR_		;"Missing )"
00209B 26   
00209C 3F   
00209D E5      6184 DISPT2:         PUSH	HL
00209E 21      6185 LD	HL,SOPTBL
00209F D8   
0020A0 16   
0020A1 18      6186 JR	DISPT0
0020A2 06   
0020A3 E5      6188 DISPATev:         PUSH	HL
0020A4 D6      6189 SUB	FUNTOK
0020A5 8D   
0020A6 21      6190 LD	HL,FUNTBL
0020A7 64   
0020A8 16   
0020A9 C5      6191 DISPT0:         PUSH	BC
0020AA 87      6192 ADD	A,A
0020AB 4F      6193 LD	C,A
0020AC 06      6194 LD	B,0
0020AD 00   
0020AE 09      6195 ADD	HL,BC
0020AF 7E      6196 LD	A,(HL)
0020B0 23      6197 INC	HL
0020B1 66      6198 LD	H,(HL)
0020B2 6F      6199 LD	L,A
0020B3 C1      6200 POP	BC
0020B4 E3      6201 EX	(SP),HL
0020B5 C9      6202 RET			;OFF TO ROUTINE
0020B6 7A      6204 STOREA:         LD	A,D
0020B7 D5      6205 PUSH	DE
0020B8 E5      6206 PUSH	HL
0020B9 DD      6207 EX	(SP),IX
0020BA E3   
0020BB B7      6208 OR	A
0020BC FA      6209 JP	M,STORA1
0020BD CD   
0020BE 20   
0020BF CD      6210 CALL	LOADN
0020C0 07   
0020C1 19   
0020C2 DD      6211 EX	(SP),IX
0020C3 E3   
0020C4 CD      6212 CALL	MODIFY
0020C5 B0   
0020C6 31   
0020C7 E1      6213 POP	HL
0020C8 D1      6214 POP	DE
0020C9 4A      6215 LD	C,D
0020CA 06      6216 LD	B,0
0020CB 00   
0020CC C9      6217 RET
0020CD D5      6219 STORA1:         PUSH	DE
0020CE CD      6220 CALL	LOADS
0020CF F0   
0020D0 19   
0020D1 E1      6221 POP	HL
0020D2 DD      6222 EX	(SP),IX
0020D3 E3   
0020D4 CD      6223 CALL	MODIFS
0020D5 FA   
0020D6 31   
0020D7 E1      6224 POP	HL
0020D8 D1      6225 POP	DE
0020D9 01      6226 LD	BC,4
0020DA 04   
0020DB 00   
0020DC C9      6227 RET
0020DD CB      6239 LETARR:         RES	6,D		;Lose array marker
0020DE B2   
0020DF D5      6240 PUSH	DE		;Save type & opcode
0020E0 CD      6241 CALL	GETAR1		;Get and check indirect link
0020E1 AF   
0020E2 19   
0020E3 CD      6242 CALL	ARRLEN		;DE = elements, HL addresses first
0020E4 86   
0020E5 19   
0020E6 C1      6243 POP	BC
0020E7 78      6244 LD	A,B		;A = type
0020E8 D5      6245 PUSH	DE
0020E9 C5      6246 PUSH	BC
0020EA E5      6247 PUSH	HL
0020EB CD      6248 CALL	X14OR5		;DE = size in bytes
0020EC 8F   
0020ED 36   
0020EE 42      6249 LD	B,D
0020EF 4B      6250 LD	C,E
0020F0 DD      6251 POP	IX
0020F1 E1   
0020F2 D1      6252 POP	DE
0020F3 AF      6261 XOR	A		;Clear carry and zero error code
0020F4 ED      6262 SBC	HL,HL
0020F5 62   
0020F6 39      6263 ADD	HL,SP		;HL = SP
0020F7 ED      6264 SBC	HL,BC
0020F8 42   
0020F9 38      6265 JR	C,ERROR1ev	;'No room'
0020FA 9F   
0020FB C5      6266 PUSH	BC
0020FC ED      6267 LD	BC,(FREE)
0020FD 4B   
0020FE E0   
0020FF 54   
002100 04      6268 INC	B		;Safety margin
002101 ED      6269 SBC	HL,BC
002102 42   
002103 09      6270 ADD	HL,BC
002104 C1      6271 POP	BC
002105 38      6272 JR	C,ERROR1ev	;'No room'
002106 93   
002107 F9      6273 LD	SP,HL
002108 36      6274 LETA0:          LD	(HL),0
002109 00   
00210A 23      6275 INC	HL
00210B 0B      6276 DEC	BC
00210C 78      6277 LD	A,B
00210D B1      6278 OR	C
00210E 20      6279 JR	NZ,LETA0	;Clear allocated stack
00210F F8   
002110 4E      6280 LD	C,(HL)
002111 23      6281 INC	HL
002112 46      6282 LD	B,(HL)
002113 67      6283 LD	H,A
002114 6F      6284 LD	L,A
002115 39      6285 ADD	HL,SP
002116 CD      6290 CALL	EXPRA
002117 1E   
002118 21   
002119 F9      6291 LD	SP,HL		;Update stack pointer
00211A C1      6292 POP	BC		;Level stack
00211B C3      6293 JP	XEQ
00211C 7B   
00211D 24   
00211E 3E      6305 EXPRA:          LD	A,'='
00211F 3D   
002120 FD      6306 DEC	IY
002121 2B   
002122 FD      6307 EXPRA1:         INC	IY
002123 23   
002124 D5      6308 PUSH	DE
002125 C5      6309 PUSH	BC
002126 E5      6310 PUSH	HL
002127 DD      6311 PUSH	IX
002128 E5   
002129 5F      6312 LD	E,A		;Operator
00212A CD      6313 CALL	ITEMA
00212B 98   
00212C 21   
00212D DD      6314 POP	IX
00212E E1   
00212F E1      6315 POP	HL
002130 C1      6316 POP	BC
002131 D1      6317 POP	DE
002132 CD      6318 CALL	NXT
002133 ED   
002134 44   
002135 FE      6319 CP	','		;List?
002136 2C   
002137 28      6320 JR	Z,EXPRA3
002138 13   
002139 CD      6321 CALL	TERMQ
00213A 18   
00213B 35   
00213C 20      6322 JR	NZ,EXPRA1
00213D E4   
00213E C5      6326 EXPRA2:         PUSH	BC
00213F CD      6327 CALL	STOREA		;(IX) <- (HL)
002140 B6   
002141 20   
002142 09      6328 ADD	HL,BC
002143 DD      6329 ADD	IX,BC
002144 09   
002145 C1      6330 POP	BC
002146 0B      6331 DEC	BC
002147 78      6332 LD	A,B
002148 B1      6333 OR	C
002149 20      6334 JR	NZ,EXPRA2
00214A F3   
00214B C9      6335 RET
00214C C5      6339 EXPRA3:         PUSH	BC
00214D CD      6340 CALL	STOREA		;(IX) <- (HL)
00214E B6   
00214F 20   
002150 FD      6341 EXPRA4:         INC	IY		;Bump past comma
002151 23   
002152 09      6342 ADD	HL,BC
002153 DD      6343 ADD	IX,BC
002154 09   
002155 C1      6344 POP	BC
002156 0B      6345 DEC	BC
002157 78      6346 LD	A,B
002158 B1      6347 OR	C
002159 C8      6348 RET	Z
00215A C5      6349 PUSH	BC
00215B D5      6350 PUSH	DE
00215C E5      6351 PUSH	HL
00215D DD      6352 PUSH	IX
00215E E5   
00215F CB      6353 BIT	7,D
002160 7A   
002161 20      6354 JR	NZ,EXPRA5
002162 0E   
002163 D5      6355 PUSH	DE
002164 CD      6356 CALL	EXPRN
002165 0E   
002166 18   
002167 D1      6357 POP	DE
002168 DD      6358 POP	IX
002169 E1   
00216A DD      6359 PUSH	IX
00216B E5   
00216C CD      6360 CALL	MODIFY
00216D B0   
00216E 31   
00216F 18      6361 JR	EXPRA6
002170 0C   
002171 D5      6363 EXPRA5:         PUSH	DE
002172 CD      6364 CALL	EXPRS
002173 1E   
002174 18   
002175 E1      6365 POP	HL
002176 DD      6366 POP	IX
002177 E1   
002178 DD      6367 PUSH	IX
002179 E5   
00217A CD      6368 CALL	MODIFS
00217B FA   
00217C 31   
00217D DD      6369 EXPRA6:         POP	IX
00217E E1   
00217F E1      6370 POP	HL
002180 D1      6371 POP	DE
002181 01      6372 LD	BC,4
002182 04   
002183 00   
002184 CB      6373 BIT	7,D
002185 7A   
002186 20      6374 JR	NZ,EXPRA7
002187 01   
002188 4A      6375 LD	C,D
002189 CD      6376 EXPRA7:         CALL	NXT
00218A ED   
00218B 44   
00218C FE      6377 CP	','
00218D 2C   
00218E 28      6378 JR	Z,EXPRA4
00218F C0   
002190 D1      6379 POP	DE
002191 09      6380 EXPRA8:         ADD	HL,BC		;Skip remaining elements
002192 1B      6381 DEC	DE
002193 7A      6382 LD	A,D
002194 B3      6383 OR	E
002195 20      6384 JR	NZ,EXPRA8
002196 FA   
002197 C9      6385 RET
002198 CD      6396 ITEMA:          CALL	NXT
002199 ED   
00219A 44   
00219B E5      6397 PUSH	HL		;Pointer to destination
00219C C5      6398 PUSH	BC		;Number of elements
00219D FD      6399 PUSH	IY		;In case normal expression
00219E E5   
00219F D5      6400 PUSH	DE		;Ditto
0021A0 FE      6401 CP	'-'
0021A1 2D   
0021A2 20      6402 JR	NZ,ITEMA1	;Not unary minus
0021A3 0C   
0021A4 7B      6403 LD	A,E
0021A5 FE      6404 CP	'='
0021A6 3D   
0021A7 20      6405 JR	NZ,ITEMA1	;Not unary minus
0021A8 07   
0021A9 FD      6406 INC	IY		;Bump past '-'
0021AA 23   
0021AB CD      6407 CALL	NXT
0021AC ED   
0021AD 44   
0021AE 1E      6408 LD	E,'-'		;Unary minus
0021AF 2D   
0021B0 D5      6409 ITEMA1:         PUSH	DE		;Type and operator
0021B1 CD      6410 CALL	GETVAR
0021B2 C5   
0021B3 41   
0021B4 D1      6411 POP	DE		;Type & operator
0021B5 20      6412 JR	NZ,ITEMA4	;Non-array expression
0021B6 56   
0021B7 CB      6413 BIT	6,A
0021B8 77   
0021B9 28      6414 JR	Z,ITEMA4	;Not a whole array
0021BA 52   
0021BB C1      6415 POP	BC		;Junk saved original op
0021BC C1      6416 POP	BC		;Junk saved text pointer
0021BD CB      6417 RES	6,A
0021BE B7   
0021BF BA      6418 CP	D
0021C0 C2      6419 JP	NZ,MISMATev	;'Type mismatch'
0021C1 50   
0021C2 18   
0021C3 D5      6420 PUSH	DE		;Save type & operator again
0021C4 CD      6421 CALL	GETAR1
0021C5 AF   
0021C6 19   
0021C7 CD      6422 CALL	ARRLEN
0021C8 86   
0021C9 19   
0021CA 42      6423 LD	B,D		;BC = number of elements
0021CB 4B      6424 LD	C,E
0021CC D1      6425 POP	DE		;Restore type & operator
0021CD E3      6426 EX	(SP),HL
0021CE CD      6427 CALL	NXT
0021CF ED   
0021D0 44   
0021D1 DD      6428 POP	IX		;Pointer to source
0021D2 E1   
0021D3 FE      6429 CP	'.'
0021D4 2E   
0021D5 CA      6430 JP	Z,ARRDOT	;Dot product
0021D6 65   
0021D7 22   
0021D8 B7      6431 OR	A
0021D9 ED      6432 SBC	HL,BC		;Same number of elements?
0021DA 42   
0021DB C2      6433 JP	NZ,MISMATev	;'Type mismatch'
0021DC 50   
0021DD 18   
0021DE E1      6434 POP	HL		;Pointer to destination
0021DF CB      6435 BIT	7,D
0021E0 7A   
0021E1 20      6436 JR	NZ,ITEMA3
0021E2 1D   
0021E3 C5      6440 ITEMA2:         PUSH	BC
0021E4 E5      6441 PUSH	HL
0021E5 7A      6442 LD	A,D
0021E6 CD      6443 CALL	LOADN
0021E7 07   
0021E8 19   
0021E9 DD      6444 EX	(SP),IX
0021EA E3   
0021EB D5      6445 PUSH	DE
0021EC CD      6446 CALL	MODIFY
0021ED B0   
0021EE 31   
0021EF D1      6447 POP	DE
0021F0 DD      6448 EX	(SP),IX
0021F1 E3   
0021F2 E1      6449 POP	HL
0021F3 4A      6450 LD	C,D
0021F4 06      6451 LD	B,0
0021F5 00   
0021F6 DD      6452 ADD	IX,BC
0021F7 09   
0021F8 09      6453 ADD	HL,BC
0021F9 C1      6454 POP	BC
0021FA 0B      6455 DEC	BC
0021FB 78      6456 LD	A,B
0021FC B1      6457 OR	C
0021FD 20      6458 JR	NZ,ITEMA2
0021FE E4   
0021FF C9      6459 RET
002200 EB      6463 ITEMA3:         EX	DE,HL		;DE = destination
002201 60      6464 LD	H,B
002202 69      6465 LD	L,C
002203 29      6466 ADD	HL,HL
002204 29      6467 ADD	HL,HL
002205 44      6468 LD	B,H
002206 4D      6469 LD	C,L
002207 DD      6470 PUSH	IX
002208 E5   
002209 E1      6471 POP	HL		;HL = source
00220A ED      6472 LDIR
00220B B0   
00220C C9      6473 RET
00220D D1      6477 ITEMA4:         POP	DE		;Restore original operator
00220E FD      6478 POP	IY		;Restore original text pointer
00220F E1   
002210 CB      6479 BIT	7,D
002211 7A   
002212 20      6480 JR	NZ,ITEMA5
002213 28   
002214 D5      6481 PUSH	DE
002215 CD      6482 CALL	EXPR45		;; should be EXP345
002216 ED   
002217 17   
002218 79      6483 LD	A,C		;Exponent
002219 D1      6484 POP	DE		;Type / operator
00221A C1      6485 POP	BC		;Count
00221B DD      6486 POP	IX
00221C E1   
00221D E5      6487 ITEMA7:         PUSH	HL
00221E C5      6488 PUSH	BC
00221F D5      6489 PUSH	DE
002220 D9      6490 EXX
002221 E5      6491 PUSH	HL
002222 D9      6492 EXX
002223 F5      6493 PUSH	AF
002224 4F      6494 LD	C,A
002225 CD      6495 CALL	MODIFY
002226 B0   
002227 31   
002228 F1      6496 POP	AF
002229 D9      6497 EXX
00222A E1      6498 POP	HL
00222B D9      6499 EXX
00222C D1      6500 POP	DE
00222D 4A      6501 LD	C,D
00222E 06      6502 LD	B,0
00222F 00   
002230 DD      6503 ADD	IX,BC
002231 09   
002232 C1      6504 POP	BC
002233 0B      6505 DEC	BC
002234 ED      6506 SBC	HL,HL
002235 62   
002236 ED      6507 SBC	HL,BC
002237 42   
002238 E1      6508 POP	HL
002239 20      6509 JR	NZ,ITEMA7	;Copy into every element!
00223A E2   
00223B C9      6510 RET
00223C CD      6514 ITEMA5:         CALL	EXPRS
00223D 1E   
00223E 18   
00223F 7B      6515 LD	A,E
002240 B7      6516 OR	A
002241 28      6517 JR	Z,ITEMA0
002242 0B   
002243 21      6518 LD	HL,ACCS
002244 00   
002245 52   
002246 11      6519 LD	DE,BUFFER
002247 00   
002248 53   
002249 4F      6520 LD	C,A
00224A 06      6521 LD	B,0
00224B 00   
00224C ED      6522 LDIR
00224D B0   
00224E C1      6523 ITEMA0:         POP	BC
00224F DD      6524 POP	IX
002250 E1   
002251 D9      6525 EXX
002252 6F      6526 LD	L,A
002253 D9      6527 EXX
002254 11      6528 LD	DE,4
002255 04   
002256 00   
002257 21      6529 LD	HL,BUFFER
002258 00   
002259 53   
00225A CD      6530 ITEMA6:         CALL	STORE4
00225B EB   
00225C 31   
00225D DD      6531 ADD	IX,DE
00225E 19   
00225F 0B      6532 DEC	BC
002260 78      6533 LD	A,B
002261 B1      6534 OR	C
002262 20      6535 JR	NZ,ITEMA6	;Copy into every element!
002263 F6   
002264 C9      6536 RET
002265 FD      6540 ARRDOT:         INC	IY		;Bump past dot
002266 23   
002267 7A      6541 LD	A,D		;Type
002268 B7      6542 OR	A
002269 FA      6543 JP	M,MISMATev	;'Type mismatch'
00226A 50   
00226B 18   
00226C EB      6544 EX	DE,HL
00226D E1      6545 POP	HL
00226E D5      6553 PUSH	DE
00226F E5      6554 PUSH	HL
002270 DD      6555 PUSH	IX
002271 E5   
002272 F5      6556 PUSH	AF
002273 CD      6557 CALL	GETARR
002274 9F   
002275 19   
002276 CD      6558 CALL	ARRLEN
002277 86   
002278 19   
002279 F1      6559 POP	AF
00227A EB      6560 EX	DE,HL
00227B DD      6561 LD	L,(IX)
00227C 6E   
00227D 00   
00227E DD      6562 LD	H,(IX+1)	;Indirect pointer
00227F 66   
002280 01   
002281 6E      6563 LD	L,(HL)		;No. of dimensions
002282 2D      6564 DEC	L
002283 EB      6565 EX	DE,HL
002284 DD      6566 POP	IX
002285 E1   
002286 C1      6567 POP	BC
002287 D1      6568 POP	DE
002288 FD      6570 PUSH	IY		;Save text pointer
002289 E5   
00228A C5      6571 PUSH	BC		;Save destination pointer
00228B E5      6572 PUSH	HL
00228C FD      6573 POP	IY
00228D E1   
00228E 21      6577 LD	HL,1
00228F 01   
002290 00   
002291 28      6578 JR	Z,ARR1D
002292 06   
002293 FD      6579 LD	H,(IY-1)
002294 66   
002295 FF   
002296 FD      6580 LD	L,(IY-2)
002297 6E   
002298 FE   
002299 D5      6581 ARR1D:          PUSH	DE
00229A EB      6582 EX	DE,HL
00229B CD      6583 CALL	X14OR5
00229C 8F   
00229D 36   
00229E EB      6584 EX	DE,HL
00229F D1      6585 POP	DE
0022A0 DD      6586 LD	B,(IX-1)
0022A1 46   
0022A2 FF   
0022A3 DD      6587 LD	C,(IX-2)
0022A4 4E   
0022A5 FE   
0022A6 C5      6599 OUTER:          PUSH	BC		;1
0022A7 D5      6600 PUSH	DE		;2
0022A8 E5      6601 PUSH	HL		;3
0022A9 DD      6602 PUSH	IX		;4
0022AA E5   
0022AB FD      6603 PUSH	IY		;5
0022AC E5   
0022AD 50      6604 LD	D,B
0022AE 59      6605 LD	E,C
0022AF F5      6606 PUSH	AF
0022B0 CD      6607 CALL	ZERO		;Zero accumulator
0022B1 DA   
0022B2 1F   
0022B3 F1      6608 POP	AF
0022B4 D5      6609 INNER:          PUSH	DE		;6
0022B5 C5      6610 PUSH	BC		;Save accumulator
0022B6 E5      6611 PUSH	HL
0022B7 D9      6612 EXX
0022B8 E5      6613 PUSH	HL
0022B9 D9      6614 EXX
0022BA CD      6616 CALL	LOADN		;Load from (IX)
0022BB 07   
0022BC 19   
0022BD DD      6617 PUSH	IX
0022BE E5   
0022BF FD      6618 EX	(SP),IY
0022C0 E3   
0022C1 DD      6619 POP	IX
0022C2 E1   
0022C3 CD      6621 CALL	DLOADN		;Load from (IY)
0022C4 C9   
0022C5 19   
0022C6 DD      6622 PUSH	IX
0022C7 E5   
0022C8 FD      6623 EX	(SP),IY
0022C9 E3   
0022CA DD      6624 POP	IX
0022CB E1   
0022CC F5      6626 PUSH	AF
0022CD 3E      6627 LD	A,10
0022CE 0A   
0022CF CD      6628 CALL	FPP		;Multiply
0022D0 F7   
0022D1 44   
0022D2 DA      6629 JP	C,ERROR_
0022D3 26   
0022D4 3F   
0022D5 F1      6630 POP	AF
0022D6 D9      6632 EXX			;Restore accumulator
0022D7 EB      6633 EX	DE,HL
0022D8 E1      6634 POP	HL
0022D9 D9      6635 EXX
0022DA EB      6636 EX	DE,HL
0022DB E1      6637 POP	HL
0022DC 08      6638 EX	AF,AF'
0022DD 79      6639 LD	A,C
0022DE C1      6640 POP	BC
0022DF 47      6641 LD	B,A
0022E0 08      6642 EX	AF,AF'
0022E1 F5      6644 PUSH	AF
0022E2 3E      6645 LD	A,11
0022E3 0B   
0022E4 CD      6646 CALL	FPP		;Accumulate
0022E5 F7   
0022E6 44   
0022E7 DA      6647 JP	C,ERROR_
0022E8 26   
0022E9 3F   
0022EA F1      6648 POP	AF
0022EB D1      6652 POP	DE		;5
0022EC D9      6654 EXX
0022ED 4F      6655 LD	C,A
0022EE 06      6656 LD	B,0
0022EF 00   
0022F0 DD      6657 ADD	IX,BC
0022F1 09   
0022F2 D1      6658 POP	DE
0022F3 C1      6659 POP	BC
0022F4 E3      6660 EX	(SP),HL
0022F5 EB      6661 EX	DE,HL
0022F6 FD      6662 ADD	IY,DE
0022F7 19   
0022F8 EB      6663 EX	DE,HL
0022F9 E3      6664 EX	(SP),HL
0022FA C5      6665 PUSH	BC
0022FB D5      6666 PUSH	DE
0022FC D9      6667 EXX
0022FD 1B      6671 DEC	DE		;Inner loop counter
0022FE 1C      6672 INC	E
0022FF 1D      6673 DEC	E
002300 20      6674 JR	NZ,INNER
002301 B2   
002302 14      6675 INC	D
002303 15      6676 DEC	D
002304 20      6677 JR	NZ,INNER
002305 AE   
002306 FD      6679 POP	IY		;4
002307 E1   
002308 DD      6680 POP	IX		;3
002309 E1   
00230A D9      6684 EXX
00230B 08      6685 EX	AF,AF'
00230C F1      6686 POP	AF
00230D C1      6687 POP	BC
00230E D1      6688 POP	DE
00230F DD      6689 EX	(SP),IX
002310 E3   
002311 D5      6690 PUSH	DE
002312 C5      6691 PUSH	BC
002313 F5      6692 PUSH	AF
002314 08      6693 EX	AF,AF'
002315 D9      6694 EXX
002316 F5      6698 PUSH	AF
002317 D5      6699 PUSH	DE
002318 CD      6700 CALL	STOREN
002319 D2   
00231A 31   
00231B D1      6701 POP	DE
00231C F1      6702 POP	AF
00231D 4F      6703 LD	C,A
00231E 06      6704 LD	B,0
00231F 00   
002320 DD      6705 ADD	IX,BC
002321 09   
002322 D9      6709 EXX
002323 08      6710 EX	AF,AF'
002324 F1      6711 POP	AF
002325 C1      6712 POP	BC
002326 D1      6713 POP	DE
002327 DD      6714 EX	(SP),IX
002328 E3   
002329 D5      6715 PUSH	DE
00232A C5      6716 PUSH	BC
00232B F5      6717 PUSH	AF
00232C 08      6718 EX	AF,AF'
00232D D9      6719 EXX
00232E E1      6721 POP	HL		;2
00232F D1      6722 POP	DE		;1 Outer loop counter
002330 C1      6723 POP	BC		;0
002331 1B      6724 DEC	DE		;Count outer loops
002332 C5      6728 PUSH	BC
002333 D5      6729 PUSH	DE
002334 E5      6730 PUSH	HL
002335 4F      6731 LD	C,A
002336 06      6732 LD	B,0
002337 00   
002338 FD      6733 ADD	IY,BC
002339 09   
00233A F5      6734 PUSH	AF
00233B E5      6735 PUSH	HL
00233C CD      6736 CALL	X14OR5
00233D 8F   
00233E 36   
00233F C1      6737 POP	BC
002340 CD      6738 CALL	MOD16
002341 72   
002342 23   
002343 F1      6739 POP	AF
002344 B7      6740 OR	A
002345 01      6741 LD	BC,0
002346 00   
002347 00   
002348 ED      6742 SBC	HL,BC
002349 42   
00234A E1      6743 POP	HL
00234B D1      6744 POP	DE
00234C C1      6745 POP	BC
00234D 20      6746 JR	NZ,MODNZ
00234E 15   
00234F D5      6747 PUSH	DE
002350 E5      6748 PUSH	HL
002351 EB      6749 EX	DE,HL
002352 FD      6750 PUSH	IY
002353 E5   
002354 E1      6751 POP	HL
002355 B7      6752 OR	A
002356 ED      6753 SBC	HL,DE
002357 52   
002358 E5      6754 PUSH	HL
002359 FD      6755 POP	IY
00235A E1   
00235B 50      6756 LD	D,B
00235C 59      6757 LD	E,C
00235D CD      6758 CALL	X14OR5
00235E 8F   
00235F 36   
002360 DD      6759 ADD	IX,DE
002361 19   
002362 E1      6760 POP	HL
002363 D1      6761 POP	DE
002364 1C      6766 INC	E
002365 1D      6767 DEC	E
002366 C2      6768 JP	NZ,OUTER
002367 A6   
002368 22   
002369 14      6769 INC	D
00236A 15      6770 DEC	D
00236B C2      6771 JP	NZ,OUTER
00236C A6   
00236D 22   
00236E E1      6775 POP	HL
00236F FD      6776 POP	IY
002370 E1   
002371 C9      6777 RET
002372 AF      6781 MOD16:          XOR	A
002373 67      6782 LD	H,A
002374 6F      6783 LD	L,A
002375 3E      6784 LD	A,17
002376 11   
002377 ED      6785 MOD160:         SBC	HL,BC
002378 42   
002379 30      6786 JR	NC,MOD161
00237A 01   
00237B 09      6787 ADD	HL,BC
00237C 3F      6788 MOD161:         CCF
00237D CB      6789 RL	E
00237E 13   
00237F CB      6790 RL	D
002380 12   
002381 3D      6791 DEC	A
002382 C8      6792 RET	Z
002383 ED      6793 ADC	HL,HL
002384 6A   
002385 18      6794 JR	MOD160
002386 F0   
002387             6799   ; --- Begin exec.asm ---
002387 59      6986 CMDTAB:         DW	LEFTSL
002388 30   
002389 6D      6987 DW	MIDSL
00238A 30   
00238B 63      6988 DW	RITESL
00238C 30   
00238D C2      6989 DW	SYNTAX	;STR$
00238E 25   
00238F C2      6990 DW	SYNTAX	;STRING$
002390 25   
002391 C2      6991 DW	SYNTAX	;EOF
002392 25   
002393 C2      6992 DW	SYNTAX	;SUM
002394 25   
002395 08      6993 DW	WHILE
002396 2E   
002397 39      6994 DW	CASE
002398 2D   
002399 C2      6995 DW	SYNTAX	;WHEN
00239A 25   
00239B C2      6996 DW	SYNTAX	;OF
00239C 25   
00239D 7B      6997 DW	XEQ	;ENDCASE
00239E 24   
00239F C2      6998 DW	SYNTAX	;OTHERWISE
0023A0 25   
0023A1 7B      6999 DW	XEQ	;ENDIF
0023A2 24   
0023A3 25      7000 DW	ENDWHI	;ENDWHILE
0023A4 2E   
0023A5 E3      7001 DW	PTR
0023A6 2E   
0023A7 F7      7002 DW	PAGEV
0023A8 2E   
0023A9 05      7003 DW	TIMEV
0023AA 2F   
0023AB 24      7004 DW	LOMEMV
0023AC 2F   
0023AD 36      7005 DW	HIMEMV
0023AE 2F   
0023AF 13      7006 DW	SOUND
0023B0 0E   
0023B1 B5      7007 DW	BPUT
0023B2 2F   
0023B3 EE      7008 DW	CALL
0023B4 2F   
0023B5 2E      7009 DW	CHAIN
0023B6 24   
0023B7 78      7010 DW	CLR
0023B8 2E   
0023B9 AD      7011 DW	CLOSE
0023BA 2F   
0023BB 57      7012 DW	CLG
0023BC 0E   
0023BD 57      7013 DW	CLS
0023BE 2E   
0023BF 13      7014 DW	REM		;DATA
0023C0 25   
0023C1 13      7015 DW	REM		;DEF
0023C2 25   
0023C3 20      7016 DW	DIM
0023C4 26   
0023C5 5E      7017 DW	DRAW
0023C6 0F   
0023C7 B5      7018 DW	END
0023C8 24   
0023C9 5F      7019 DW	ENDPRO
0023CA 2B   
0023CB E5      7020 DW	ENVEL
0023CC 0D   
0023CD F6      7021 DW	FORex
0023CE 28   
0023CF AD      7022 DW	GOSUB
0023D0 28   
0023D1 96      7023 DW	GOTO
0023D2 28   
0023D3 AF      7024 DW	GCOL
0023D4 0E   
0023D5 AB      7025 DW	IF_
0023D6 2C   
0023D7 C4      7026 DW	INPUT
0023D8 2B   
0023D9 83      7027 DW	LET
0023DA 25   
0023DB F5      7028 DW	LOCAL
0023DC 2A   
0023DD 47      7029 DW	MODE
0023DE 0E   
0023DF 5A      7030 DW	MOVE
0023E0 0F   
0023E1 43      7031 DW	NEXT
0023E2 29   
0023E3 1C      7032 DW	ON
0023E4 28   
0023E5 7E      7033 DW	VDU
0023E6 2F   
0023E7 66      7034 DW	PLOT
0023E8 0F   
0023E9 28      7035 DW	PRINT
0023EA 27   
0023EB C9      7036 DW	PROC
0023EC 29   
0023ED 62      7037 DW	READ
0023EE 2C   
0023EF 13      7038 DW	REM
0023F0 25   
0023F1 C7      7039 DW	REPEAT
0023F2 28   
0023F3 73      7040 DW	REPOR
0023F4 2E   
0023F5 9E      7041 DW	RESTOR
0023F6 2E   
0023F7 B8      7042 DW	RETURN
0023F8 28   
0023F9 29      7043 DW	RUN
0023FA 24   
0023FB 60      7044 DW	STOP
0023FC 2E   
0023FD 6F      7045 DW	COLOUR
0023FE 0E   
0023FF 65      7046 DW	TRACE
002400 2F   
002401 CF      7047 DW	UNTIL
002402 28   
002403 5B      7048 DW	WIDTHV
002404 2F   
002405 EA      7049 DW	CLI		;OSCLI
002406 24   
002407 13      7050 DW	REM		;NUL
002408 25   
002409 FD      7051 DW	CIRCLE
00240A 0E   
00240B 29      7052 DW	ELLIPS
00240C 0F   
00240D 62      7053 DW	FILL
00240E 0F   
00240F 1C      7054 DW	MOUSE
002410 10   
002411 5E      7055 DW	ORIGIN
002412 0E   
002413 0E      7056 DW	BYE		;QUIT
002414 0A   
002415 9B      7057 DW	RECTAN
002416 0F   
002417 40      7058 DW	SWAPex
002418 25   
002419 F3      7059 DW	SYS
00241A 10   
00241B F3      7060 DW	TINT
00241C 10   
00241D 5B      7061 DW	WAIT
00241E 10   
00241F C2      7062 DW	SYNTAX		;INSTALL
002420 25   
002421 13      7063 DW	REM		;CR
002422 25   
002423 7F      7064 DW	PUT		;Token changed
002424 31   
002425 C2      7065 DW	SYNTAX		;BY
002426 25   
002427 05      7066 DW	EXITex
002428 31   
002429 CD      7072 RUN:            CALL	TERMQ
00242A 18   
00242B 35   
00242C 28      7073 JR	Z,RUN0
00242D 0D   
00242E CD      7074 CHAIN:          CALL	EXPRS
00242F 1E   
002430 18   
002431 3E      7075 LD	A,CR
002432 0D   
002433 12      7076 LD	(DE),A
002434 ED      7077 CHAIN0:         LD	SP,(HIMEM)
002435 7B   
002436 E2   
002437 54   
002438 CD      7078 CALL	LOAD0
002439 E2   
00243A 3F   
00243B ED      7079 RUN0:           LD	SP,(HIMEM)	;PREPARE FOR RUN
00243C 7B   
00243D E2   
00243E 54   
00243F DD      7080 LD	IX,RANDOM
002440 21   
002441 F6   
002442 54   
002443 ED      7081 RAND:           LD	A,R		;RANDOMISE (CARE!)
002444 5F   
002445 28      7082 JR	Z,RAND
002446 FC   
002447 07      7083 RLCA
002448 07      7084 RLCA
002449 DD      7085 LD	(IX+3),A
00244A 77   
00244B 03   
00244C 9F      7086 SBC	A,A
00244D DD      7087 LD	(IX+4),A
00244E 77   
00244F 04   
002450 CD      7088 CALL	CLEAR
002451 25   
002452 40   
002453 21      7089 LD	HL,0
002454 00   
002455 00   
002456 22      7090 LD	(ERRTRP),HL
002457 EA   
002458 54   
002459 2A      7091 LD	HL,(PAGE_)
00245A DC   
00245B 54   
00245C CD      7092 CALL	DSRCH		;LOOK FOR "DATA"
00245D DB   
00245E 35   
00245F 22      7093 LD	(DATPTR),HL	;SET DATA POINTER
002460 F0   
002461 54   
002462 FD      7094 LD	IY,(PAGE_)
002463 2A   
002464 DC   
002465 54   
002466 CD      7095 XEQ0:           CALL	NEWLIN
002467 BD   
002468 24   
002469 FD      7096 LD	A,(IY)
00246A 7E   
00246B 00   
00246C FE      7097 CP	TELSE
00246D 8B   
00246E CA      7098 JP	Z,MELSE		;ELSE
00246F 12   
002470 2D   
002471 FE      7099 CP	TWHEN
002472 C9   
002473 CA      7100 JP	Z,WHEN		;WHEN
002474 25   
002475 2D   
002476 FE      7101 CP	TOTHERWISE
002477 CC   
002478 CA      7102 JP	Z,WHEN
002479 25   
00247A 2D   
00247B FD      7103 XEQ:            LD	(CURLIN),IY	;ERROR POINTER
00247C 22   
00247D F4   
00247E 54   
00247F CD      7104 CALL	TRAP		;CHECK KEYBOARD
002480 15   
002481 06   
002482 CD      7105 XEQ1:           CALL	NXT
002483 ED   
002484 44   
002485 FD      7106 INC	IY
002486 23   
002487 FE      7107 CP	':'		;SEPARATOR
002488 3A   
002489 28      7108 JR	Z,XEQ1
00248A F7   
00248B FE      7109 CP	CR
00248C 0D   
00248D 28      7110 JR	Z,XEQ0		;NEW PROGRAM LINE
00248E D7   
00248F FE      7111 CP	TLAST
002490 98   
002491 EA      7112 JP	PE,LET0		;IMPLIED LET
002492 75   
002493 25   
002494 D6      7113 SUB	TCMD
002495 C7   
002496 FA      7114 JP	M,EXTRAS
002497 F8   
002498 24   
002499 87      7115 ADD	A,A
00249A 4F      7116 LD	C,A
00249B 06      7117 LD	B,0
00249C 00   
00249D 21      7118 LD	HL,CMDTAB
00249E 87   
00249F 23   
0024A0 09      7119 ADD	HL,BC
0024A1 7E      7120 LD	A,(HL)		;TABLE ENTRY
0024A2 23      7121 INC	HL
0024A3 66      7122 LD	H,(HL)
0024A4 6F      7123 LD	L,A
0024A5 CD      7124 CALL	NXT
0024A6 ED   
0024A7 44   
0024A8 E9      7125 JP	(HL)		;EXECUTE STATEMENT
0024A9 FD      7129 ENDIM:          PUSH	IY
0024AA E5   
0024AB E1      7130 POP	HL
0024AC ED      7131 LD	BC,(PAGE_)
0024AD 4B   
0024AE DC   
0024AF 54   
0024B0 ED      7132 SBC	HL,BC		;IMMEDIATE MODE ?
0024B1 42   
0024B2 DA      7133 JP	C,CLOOP
0024B3 92   
0024B4 37   
0024B5 1E      7134 END:            LD	E,0
0024B6 00   
0024B7 CD      7135 CALL	OSSHUT		;CLOSE ALL FILES
0024B8 35   
0024B9 06   
0024BA C3      7136 JP	WARM		;"Ready"
0024BB 91   
0024BC 37   
0024BD FD      7138 NEWLIN:         LD	A,(IY+0)	;A=LINE LENGTH
0024BE 7E   
0024BF 00   
0024C0 01      7139 LD	BC,3
0024C1 03   
0024C2 00   
0024C3 FD      7140 ADD	IY,BC
0024C4 09   
0024C5 B7      7141 OR	A
0024C6 28      7142 JR	Z,ENDIM		;LENGTH=0, EXITex
0024C7 E1   
0024C8 2A      7143 LD	HL,(TRACEN)
0024C9 E6   
0024CA 54   
0024CB 7C      7144 LD	A,H
0024CC B5      7145 OR	L
0024CD C8      7146 RET	Z
0024CE FD      7147 LD	D,(IY-1)	;DE = LINE NUMBER
0024CF 56   
0024D0 FF   
0024D1 FD      7148 LD	E,(IY-2)
0024D2 5E   
0024D3 FE   
0024D4 ED      7149 SBC	HL,DE
0024D5 52   
0024D6 D8      7150 RET	C
0024D7 EB      7151 EX	DE,HL
0024D8 3E      7152 LD	A,'['		;TRACE
0024D9 5B   
0024DA CD      7153 CALL	OUTCHR
0024DB E4   
0024DC 40   
0024DD CD      7154 CALL	PBCDL
0024DE 74   
0024DF 41   
0024E0 3E      7155 LD	A,']'
0024E1 5D   
0024E2 CD      7156 CALL	OUTCHR
0024E3 E4   
0024E4 40   
0024E5 3E      7157 LD	A,' '
0024E6 20   
0024E7 C3      7158 JP	OUTCHR
0024E8 E4   
0024E9 40   
0024EA CD      7164 CLI:            CALL	EXPRS
0024EB 1E   
0024EC 18   
0024ED 3E      7165 LD	A,CR
0024EE 0D   
0024EF 12      7166 LD	(DE),A
0024F0 21      7167 LD	HL,ACCS
0024F1 00   
0024F2 52   
0024F3 CD      7168 CALL	OSCLI
0024F4 95   
0024F5 09   
0024F6 18      7169 JR	XEQ
0024F7 83   
0024F8 FE      7171 EXTRAS:         CP	TELSE-TCMD
0024F9 C4   
0024FA 28      7172 JR	Z,REM		;ELSE
0024FB 17   
0024FC FE      7173 CP	TERROR-TCMD
0024FD BE   
0024FE 28      7174 JR	Z,THROW		;ERROR
0024FF 21   
002500 FE      7175 CP	TLINE-TCMD
002501 BF   
002502 CA      7176 JP	Z,LINE		;LINE
002503 E7   
002504 0E   
002505 FE      7177 CP	TOFF-TCMD
002506 C0   
002507 CA      7178 JP	Z,CSROFF	;OFF
002508 D0   
002509 0E   
00250A C3      7179 JP	SYNTAX
00250B C2   
00250C 25   
00250D FD      7183 EXT:            PUSH	IY
00250E E5   
00250F E1      7184 POP	HL
002510 CD      7185 CALL	OSCLI
002511 95   
002512 09   
002513 FD      7186 REM:            PUSH	IY
002514 E5   
002515 E1      7187 POP	HL
002516 3E      7188 LD	A,CR
002517 0D   
002518 47      7189 LD	B,A
002519 ED      7190 CPIR			;FIND LINE END
00251A B1   
00251B E5      7191 PUSH	HL
00251C FD      7192 POP	IY
00251D E1   
00251E C3      7193 JP	XEQ0
00251F 66   
002520 24   
002521 CD      7197 THROW:          CALL	EXPRI
002522 15   
002523 18   
002524 D9      7198 EXX
002525 E5      7199 PUSH	HL
002526 D9      7200 EXX
002527 CD      7201 CALL	COMMA
002528 84   
002529 20   
00252A CD      7202 CALL	EXPRS
00252B 1E   
00252C 18   
00252D E1      7203 POP	HL
00252E AF      7204 XOR	A
00252F 12      7205 LD	(DE),A
002530 7D      7206 LD	A,L
002531 21      7207 LD	HL,ACCS
002532 00   
002533 52   
002534 11      7208 LD	DE,BUFFER
002535 00   
002536 53   
002537 D5      7209 PUSH	DE
002538 01      7210 LD	BC,256
002539 00   
00253A 01   
00253B ED      7211 LDIR
00253C B0   
00253D C3      7212 JP	EXTERR
00253E 37   
00253F 3F   
002540 CD      7216 SWAPex:           CALL	GETVAR
002541 C5   
002542 41   
002543 20      7217 JR	NZ,SWAPNZ
002544 0B   
002545 F5      7218 PUSH	AF
002546 E5      7219 PUSH	HL
002547 CD      7220 CALL	COMMA
002548 84   
002549 20   
00254A CD      7221 CALL	NXT
00254B ED   
00254C 44   
00254D CD      7222 CALL	GETVAR
00254E C5   
00254F 41   
002550 20      7223 SWAPNZ:         JR	NZ,NOSUCH
002551 6D   
002552 D1      7224 POP	DE
002553 C1      7225 POP	BC
002554 B8      7226 CP	B
002555 20      7227 JR	NZ,MISMAT
002556 74   
002557 E6      7228 AND	00001111B
002558 0F   
002559 28      7229 JR	Z,MISMAT
00255A 70   
00255B 78      7230 LD	A,B
00255C E6      7231 AND	11000000B
00255D C0   
00255E 28      7232 JR	Z,SWAP1ex
00255F 0A   
002560 06      7233 LD	B,2
002561 02   
002562 F2      7234 JP	P,SWAP1ex
002563 6A   
002564 25   
002565 EA      7235 JP	PE,SWAP1ex
002566 6A   
002567 25   
002568 06      7236 LD	B,4
002569 04   
00256A 4E      7237 SWAP1ex:          LD	C,(HL)
00256B 1A      7238 LD	A,(DE)
00256C 77      7239 LD	(HL),A
00256D 79      7240 LD	A,C
00256E 12      7241 LD	(DE),A
00256F 13      7242 INC	DE
002570 23      7243 INC	HL
002571 10      7244 DJNZ	SWAP1ex
002572 F7   
002573 18      7245 JR	XEQGO4
002574 28   
002575 FE      7249 LET0:           CP	'*'
002576 2A   
002577 28      7250 JR	Z,EXT
002578 94   
002579 FE      7251 CP	'='
00257A 3D   
00257B 28      7252 JR	Z,FNEND
00257C 71   
00257D FE      7253 CP	'['
00257E 5B   
00257F 28      7254 JR	Z,ASM
002580 52   
002581 FD      7255 DEC	IY
002582 2B   
002583 CD      7256 LET:            CALL	ASSIGN
002584 91   
002585 31   
002586 CA      7257 JP	Z,XEQ
002587 7B   
002588 24   
002589 38      7258 JR	C,SYNTAX	;"Syntax error"
00258A 37   
00258B F2      7259 JP	P,LETARR	;Numeric array
00258C DD   
00258D 20   
00258E EA      7260 JP	PE,LETARR	;String array
00258F DD   
002590 20   
002591 7A      7261 LD	A,D		;Type
002592 D5      7262 PUSH	DE
002593 E5      7263 PUSH	HL
002594 CD      7264 CALL	EXPRS
002595 1E   
002596 18   
002597 DD      7265 POP	IX
002598 E1   
002599 E1      7266 POP	HL
00259A CD      7267 CALL	MODIFS
00259B FA   
00259C 31   
00259D C3      7268 XEQGO4:         JP	XEQ
00259E 7B   
00259F 24   
0025A0 CD      7275 GETSTR:         CALL	GETVAR
0025A1 C5   
0025A2 41   
0025A3 20      7276 JR	NZ,NOSUCH
0025A4 1A   
0025A5 47      7277 LD	B,A
0025A6 E6      7278 AND	11000000B
0025A7 C0   
0025A8 F2      7279 JP	P,MISMAT
0025A9 CB   
0025AA 25   
0025AB EA      7280 JP	PE,BADUSE
0025AC C8   
0025AD 25   
0025AE CB      7281 BIT	0,B
0025AF 40   
0025B0 28      7282 JR	Z,MISMAT
0025B1 19   
0025B2 CD      7283 CALL	NXT
0025B3 ED   
0025B4 44   
0025B5 FE      7284 CP	','
0025B6 2C   
0025B7 C9      7285 RET
0025B8 CD      7287 VAR_:           CALL	GETVAR
0025B9 C5   
0025BA 41   
0025BB C8      7288 RET	Z
0025BC D2      7289 JP	NC,PUTVAR
0025BD AF   
0025BE 41   
0025BF 3E      7290 NOSUCH:         LD	A,26		;'No such variable'
0025C0 1A   
0025C1 21      7291 DB	21H
0025C2 3E      7292 SYNTAX:         LD	A,16		;"Syntax error"
0025C3 10   
0025C4 21      7293 DB	21H
0025C5 3E      7294 ESCAPE:         LD	A,17		;"Escape"
0025C6 11   
0025C7 21      7295 DB	21H
0025C8 3E      7296 BADUSE:         LD	A,14		;'Bad use of array'
0025C9 0E   
0025CA 21      7297 DB	21H
0025CB 3E      7298 MISMAT:         LD	A,6		;'Type mismatch'
0025CC 06   
0025CD C3      7299 ERROR0ex:         JP	ERROR_
0025CE 26   
0025CF 3F   
0025D0 CD      7301 ASM0:           CALL	NEWLIN
0025D1 BD   
0025D2 24   
0025D3 FD      7302 ASM:            LD	(CURLIN),IY
0025D4 22   
0025D5 F4   
0025D6 54   
0025D7 CD      7303 CALL	TRAP
0025D8 15   
0025D9 06   
0025DA CD      7304 CALL	ASSEM
0025DB FD   
0025DC 10   
0025DD 38      7305 JR	C,SYNTAX
0025DE E3   
0025DF FE      7306 CP	CR
0025E0 0D   
0025E1 28      7307 JR	Z,ASM0
0025E2 ED   
0025E3 21      7308 LD	HL,LISTON
0025E4 FE   
0025E5 54   
0025E6 7E      7309 LD	A,(HL)
0025E7 E6      7310 AND	0FH
0025E8 0F   
0025E9 F6      7311 OR	30H
0025EA 30   
0025EB 77      7312 LD	(HL),A
0025EC 18      7313 JR	XEQGO4
0025ED AF   
0025EE CD      7317 FNEND:          CALL	EXPR		;FUNCTION RESULT
0025EF E4   
0025F0 16   
0025F1 08      7318 EX	AF,AF'
0025F2 87      7319 ADD	A,A
0025F3 7B      7320 LD	A,E
0025F4 38      7321 JR	C,FNEND1
0025F5 01   
0025F6 79      7322 LD	A,C
0025F7 08      7323 FNEND1:         EX	AF,AF'
0025F8 E5      7324 PUSH	HL
0025F9 D9      7325 EXX
0025FA C1      7326 POP	BC
0025FB EB      7327 EX	DE,HL		;SAVE RESULT IN A'B'C'D'E'
0025FC D9      7328 EXX
0025FD C1      7329 FNEND2:         POP	BC
0025FE 21      7330 LD	HL,FNCHK
0025FF C9   
002600 29   
002601 AF      7331 XOR	A
002602 ED      7332 SBC	HL,BC
002603 42   
002604 28      7333 JR	Z,FNEND3
002605 0A   
002606 C5      7334 PUSH	BC
002607 CD      7335 CALL	RESLOC
002608 13   
002609 34   
00260A 20      7336 JR	NZ,FNEND2
00260B F1   
00260C 3E      7337 LD	A,7
00260D 07   
00260E 18      7338 JR	ERROR0ex		;"No FN"
00260F BD   
002610 FD      7340 FNEND3:         POP	IY
002611 E1   
002612 FD      7341 LD	(CURLIN),IY	;IN CASE OF ERROR
002613 22   
002614 F4   
002615 54   
002616 D9      7342 EXX
002617 EB      7343 EX	DE,HL
002618 C5      7344 PUSH	BC
002619 D9      7345 EXX
00261A E1      7346 POP	HL
00261B 08      7347 EX	AF,AF'
00261C 5F      7348 LD	E,A
00261D 4F      7349 LD	C,A
00261E 1F      7350 RRA
00261F C9      7351 RET
002620 FD      7356 DIM:            PUSH	IY
002621 E5   
002622 FE      7357 CP	'!'
002623 21   
002624 CA      7358 JP	Z,DIM4
002625 F1   
002626 26   
002627 CD      7359 CALL	LOCATE		;VARIABLE
002628 92   
002629 42   
00262A DA      7360 JP	C,BADDIM
00262B DB   
00262C 26   
00262D C4      7361 CALL	NZ,CREATE
00262E 1E   
00262F 43   
002630 FD      7362 LD	A,(IY)
002631 7E   
002632 00   
002633 FE      7363 CP	'('
002634 28   
002635 C2      7364 JP	NZ,DIM4
002636 F1   
002637 26   
002638 E5      7365 PUSH	HL
002639 DD      7366 POP	IX
00263A E1   
00263B 7E      7367 LD	A,(HL)
00263C E6      7368 AND	0FEH
00263D FE   
00263E 23      7369 INC	HL
00263F B6      7370 OR	(HL)
002640 C2      7371 JP	NZ,DIM4
002641 F1   
002642 26   
002643 C1      7372 POP	BC		;LEVEL STACK
002644 7A      7373 LD	A,D
002645 2A      7374 LD	HL,(FREE)
002646 E0   
002647 54   
002648 E5      7375 PUSH	HL
002649 DD      7376 EX	(SP),IX
00264A E3   
00264B E5      7377 PUSH	HL
00264C F5      7378 PUSH	AF		;SAVE TYPE
00264D 11      7379 LD	DE,1
00264E 01   
00264F 00   
002650 42      7380 LD	B,D		;DIMENSION COUNTER
002651 FD      7381 DIM1:           INC	IY
002652 23   
002653 C5      7382 PUSH	BC
002654 D5      7383 PUSH	DE
002655 DD      7384 PUSH	IX
002656 E5   
002657 CD      7385 CALL	EXPRI		;DIMENSION SIZE
002658 15   
002659 18   
00265A CB      7386 BIT	7,H
00265B 7C   
00265C 20      7387 JR	NZ,BADDIM
00265D 7D   
00265E D9      7388 EXX
00265F 23      7389 INC	HL
002660 DD      7390 POP	IX
002661 E1   
002662 DD      7391 INC	IX
002663 23   
002664 DD      7392 LD	(IX),L		;SAVE SIZE
002665 75   
002666 00   
002667 DD      7393 INC	IX
002668 23   
002669 DD      7394 LD	(IX),H
00266A 74   
00266B 00   
00266C C1      7395 POP	BC
00266D CD      7396 CALL	MUL16		;HL=HL*BC
00266E 9F   
00266F 36   
002670 38      7397 JR	C,NOROOM	;TOO LARGE
002671 6C   
002672 EB      7398 EX	DE,HL		;DE=PRODUCT
002673 C1      7399 POP	BC
002674 04      7400 INC	B		;DIMENSION COUNTER
002675 FD      7401 LD	A,(IY)
002676 7E   
002677 00   
002678 FE      7402 CP	','		;ANOTHER
002679 2C   
00267A 28      7403 JR	Z,DIM1
00267B D5   
00267C DD      7404 INC	IX
00267D 23   
00267E CD      7405 CALL	BRAKET		;CLOSING BRACKET
00267F 90   
002680 20   
002681 F1      7406 POP	AF		;RESTORE TYPE
002682 CD      7407 CALL	X14OR5		;DE=DE*n
002683 8F   
002684 36   
002685 38      7408 JR	C,NOROOM
002686 57   
002687 E1      7409 POP	HL
002688 70      7410 LD	(HL),B		;NO. OF DIMENSIONS
002689 DD      7411 EX	(SP),IX
00268A E3   
00268B E1      7412 POP	HL
00268C E6      7413 AND	80H
00268D 80   
00268E DD      7414 OR	(IX)		;FLAGS
00268F B6   
002690 00   
002691 E5      7422 DIM3:           PUSH	HL
002692 24      7423 INC	H		;Safety margin
002693 19      7424 ADD	HL,DE
002694 38      7425 JR	C,NOROOM
002695 48   
002696 ED      7426 SBC	HL,SP
002697 72   
002698 30      7427 JR	NC,NOROOM
002699 44   
00269A E1      7428 POP	HL
00269B E5      7429 PUSH	HL
00269C ED      7430 LD	BC,(FREE)
00269D 4B   
00269E E0   
00269F 54   
0026A0 B7      7431 OR	A
0026A1 ED      7432 SBC	HL,BC
0026A2 42   
0026A3 44      7433 LD	B,H
0026A4 4D      7434 LD	C,L
0026A5 E1      7435 POP	HL
0026A6 ED      7436 SBC	HL,BC
0026A7 42   
0026A8 CB      7437 BIT	0,A
0026A9 47   
0026AA 28      7438 JR	Z,ARRCHK	;NOT LOCAL
0026AB 12   
0026AC 21      7439 LD	HL,0
0026AD 00   
0026AE 00   
0026AF ED      7440 SBC	HL,DE
0026B0 52   
0026B1 B7      7441 OR	A
0026B2 ED      7442 SBC	HL,BC
0026B3 42   
0026B4 39      7443 ADD	HL,SP
0026B5 28      7444 JR	Z,ARRCHK	;RESERVE NOTHING
0026B6 07   
0026B7 F9      7445 LD	SP,HL
0026B8 D5      7446 PUSH	DE
0026B9 C5      7447 PUSH	BC
0026BA F5      7448 PUSH	AF
0026BB CD      7449 CALL	ARRCHK
0026BC BE   
0026BD 26   
0026BE DD      7450 ARRCHK:         LD	(IX+0),L	;SAVE POINTER
0026BF 75   
0026C0 00   
0026C1 DD      7451 LD	(IX+1),H
0026C2 74   
0026C3 01   
0026C4 78      7452 LD	A,B
0026C5 B1      7453 OR	C
0026C6 28      7454 JR	Z,DIM2
0026C7 09   
0026C8 D5      7455 PUSH	DE
0026C9 EB      7456 EX	DE,HL
0026CA 2A      7457 LD	HL,(FREE)
0026CB E0   
0026CC 54   
0026CD ED      7458 LDIR			;COPY DESCRIPTOR
0026CE B0   
0026CF EB      7459 EX	DE,HL
0026D0 D1      7460 POP	DE
0026D1 7A      7461 DIM2:           LD	A,D
0026D2 B3      7462 OR	E
0026D3 28      7463 JR	Z,DIM5
0026D4 0E   
0026D5 36      7464 LD	(HL),0		;INITIALISE ARRAY
0026D6 00   
0026D7 23      7465 INC	HL
0026D8 1B      7466 DEC	DE
0026D9 18      7467 JR	DIM2
0026DA F6   
0026DB 3E      7469 BADDIM:         LD	A,10		;"Bad DIM"
0026DC 0A   
0026DD 21      7470 DB	21H
0026DE 3E      7471 NOROOM:         LD	A,11		;"DIM space"
0026DF 0B   
0026E0 C3      7472 ERROR1ex:         JP	ERROR_
0026E1 26   
0026E2 3F   
0026E3 ED      7474 DIM5:           SBC	HL,SP
0026E4 72   
0026E5 30      7475 JR	NC,DIM7		;LOCAL
0026E6 04   
0026E7 39      7476 ADD	HL,SP
0026E8 22      7477 LD	(FREE),HL
0026E9 E0   
0026EA 54   
0026EB CD      7478 DIM7:           CALL	NLIST		;ANOTHER VARIABLE?
0026EC E2   
0026ED 44   
0026EE C3      7479 JP	DIM
0026EF 20   
0026F0 26   
0026F1 FD      7481 DIM4:           POP	IY
0026F2 E1   
0026F3 CD      7482 CALL	VAR_
0026F4 B8   
0026F5 25   
0026F6 B7      7483 OR	A
0026F7 28      7484 JR	Z,BADDIM
0026F8 E2   
0026F9 FA      7485 JP	M,BADDIM
0026FA DB   
0026FB 26   
0026FC CB      7486 BIT	6,A
0026FD 77   
0026FE 20      7487 JR	NZ,BADDIM
0026FF DB   
002700 47      7488 LD	B,A		;TYPE
002701 CD      7489 CALL	NXT
002702 ED   
002703 44   
002704 FE      7490 CP	TLOCAL
002705 EA   
002706 3E      7491 LD	A,0		;PRESET TO NOT LOCAL
002707 00   
002708 20      7492 JR	NZ,DIM8
002709 03   
00270A FD      7493 INC	IY
00270B 23   
00270C 3C      7494 INC	A		;FLAG LOCAL
00270D F5      7495 DIM8:           PUSH	AF
00270E 78      7496 LD	A,B		;TYPE
00270F D9      7497 EXX
002710 21      7498 LD	HL,0
002711 00   
002712 00   
002713 4C      7499 LD	C,H
002714 CD      7500 CALL	STOREN		;RESERVED AREA
002715 D2   
002716 31   
002717 DD      7501 PUSH	IX
002718 E5   
002719 CD      7502 CALL	EXPRI
00271A 15   
00271B 18   
00271C DD      7503 POP	IX
00271D E1   
00271E D9      7504 EXX
00271F 23      7505 INC	HL
002720 EB      7506 EX	DE,HL
002721 2A      7507 LD	HL,(FREE)
002722 E0   
002723 54   
002724 F1      7508 POP	AF		;LOCAL FLAG
002725 C3      7509 JP	DIM3
002726 91   
002727 26   
002728 FE      7514 PRINT:          CP	'#'
002729 23   
00272A 20      7515 JR	NZ,PRINT0
00272B 64   
00272C CD      7516 CALL	CHNL		;CHANNEL NO. = E
00272D BD   
00272E 36   
00272F CD      7517 PRNTN1:         CALL	NLIST
002730 E2   
002731 44   
002732 D5      7518 PUSH	DE
002733 CD      7519 CALL	EXPR		;ITEM TO PRINT
002734 E4   
002735 16   
002736 08      7520 EX	AF,AF'
002737 FA      7521 JP	M,PRNTN2	;STRING
002738 57   
002739 27   
00273A D1      7522 POP	DE
00273B C5      7523 PUSH	BC
00273C D9      7524 EXX
00273D 7D      7525 LD	A,L
00273E D9      7526 EXX
00273F CD      7527 CALL	OSBPUT
002740 45   
002741 06   
002742 D9      7528 EXX
002743 7C      7529 LD	A,H
002744 D9      7530 EXX
002745 CD      7531 CALL	OSBPUT
002746 45   
002747 06   
002748 7D      7532 LD	A,L
002749 CD      7533 CALL	OSBPUT
00274A 45   
00274B 06   
00274C 7C      7534 LD	A,H
00274D CD      7535 CALL	OSBPUT
00274E 45   
00274F 06   
002750 C1      7536 POP	BC
002751 79      7537 LD	A,C
002752 CD      7538 CALL	OSBPUT
002753 45   
002754 06   
002755 18      7539 JR	PRNTN1
002756 D8   
002757 4B      7540 PRNTN2:         LD	C,E
002758 D1      7541 POP	DE
002759 21      7542 LD	HL,ACCS
00275A 00   
00275B 52   
00275C 0C      7543 INC	C
00275D 0D      7544 PRNTN3:         DEC	C
00275E 28      7545 JR	Z,PRNTN4
00275F 09   
002760 7E      7546 LD	A,(HL)
002761 23      7547 INC	HL
002762 C5      7548 PUSH	BC
002763 CD      7549 CALL	OSBPUT
002764 45   
002765 06   
002766 C1      7550 POP	BC
002767 18      7551 JR	PRNTN3
002768 F4   
002769 3E      7552 PRNTN4:         LD	A,CR
00276A 0D   
00276B CD      7553 CALL	OSBPUT
00276C 45   
00276D 06   
00276E 18      7554 JR	PRNTN1
00276F BF   
002770 06      7556 PRINT6:         LD	B,2
002771 02   
002772 18      7557 JR	PRINTC
002773 22   
002774 01      7558 PRINT8:         LD	BC,100H
002775 00   
002776 01   
002777 18      7559 JR	PRINTC
002778 1D   
002779 21      7560 PRINT9:         LD	HL,STAVAR
00277A 00   
00277B 54   
00277C AF      7561 XOR	A
00277D BE      7562 CP	(HL)
00277E 28      7563 JR	Z,PRINT0
00277F 10   
002780 3A      7564 LD	A,(COUNT)
002781 FB   
002782 54   
002783 B7      7565 OR	A
002784 28      7566 JR	Z,PRINT0
002785 0A   
002786 96      7567 PRINTA:         SUB	(HL)
002787 28      7568 JR	Z,PRINT0
002788 07   
002789 30      7569 JR	NC,PRINTA
00278A FB   
00278B ED      7570 NEG
00278C 44   
00278D CD      7571 CALL	SPACES
00278E 85   
00278F 35   
002790 3A      7572 PRINT0:         LD	A,(STAVAR)
002791 00   
002792 54   
002793 4F      7573 LD	C,A		;PRINTS
002794 06      7574 LD	B,0		;PRINTF
002795 00   
002796 CD      7575 PRINTC:         CALL	TERMQ
002797 18   
002798 35   
002799 28      7576 JR	Z,PRINT4
00279A 38   
00279B CB      7577 RES	0,B
00279C 80   
00279D FD      7578 INC	IY
00279E 23   
00279F FE      7579 CP	'~'
0027A0 7E   
0027A1 28      7580 JR	Z,PRINT6
0027A2 CD   
0027A3 FE      7581 CP	';'
0027A4 3B   
0027A5 28      7582 JR	Z,PRINT8
0027A6 CD   
0027A7 FE      7583 CP	','
0027A8 2C   
0027A9 28      7584 JR	Z,PRINT9
0027AA CE   
0027AB CD      7585 CALL	FORMAT		;SPC, TAB, '
0027AC 3E   
0027AD 35   
0027AE 28      7586 JR	Z,PRINTC
0027AF E6   
0027B0 FD      7587 DEC	IY
0027B1 2B   
0027B2 C5      7588 PUSH	BC
0027B3 CD      7589 CALL	EXPR		;VARIABLE TYPE
0027B4 E4   
0027B5 16   
0027B6 08      7590 EX	AF,AF'
0027B7 FA      7591 JP	M,PRINT3	;STRING
0027B8 CD   
0027B9 27   
0027BA D1      7592 POP	DE
0027BB D5      7593 PUSH	DE
0027BC CB      7594 BIT	1,D
0027BD 4A   
0027BE F5      7595 PUSH	AF
0027BF CC      7596 CALL	Z,STR		;DECIMAL
0027C0 B2   
0027C1 1F   
0027C2 F1      7597 POP	AF
0027C3 C4      7598 CALL	NZ,HEXSTR	;HEX
0027C4 6F   
0027C5 1F   
0027C6 C1      7599 POP	BC
0027C7 C5      7600 PUSH	BC
0027C8 79      7601 LD	A,C
0027C9 93      7602 SUB	E
0027CA D4      7603 CALL	NC,SPACES		;RIGHT JUSTIFY
0027CB 85   
0027CC 35   
0027CD C1      7604 PRINT3:         POP	BC
0027CE CD      7605 CALL	PTEXT		;PRINT
0027CF 93   
0027D0 35   
0027D1 18      7606 JR	PRINTC
0027D2 C3   
0027D3 CB      7607 PRINT4:         BIT	0,B
0027D4 40   
0027D5 CC      7608 CALL	Z,CRLF
0027D6 DD   
0027D7 40   
0027D8 18      7609 JR	XEQGO3
0027D9 3F   
0027DA FD      7611 ONERR:          INC	IY		;SKIP "ERROR"
0027DB 23   
0027DC CD      7612 CALL	NXT
0027DD ED   
0027DE 44   
0027DF 21      7613 LD	HL,0		;FLAG NOT LOCAL
0027E0 00   
0027E1 00   
0027E2 FE      7614 CP	TLOCAL
0027E3 EA   
0027E4 20      7615 JR	NZ,ONERR1
0027E5 1D   
0027E6 FD      7616 INC	IY		;SKIP "LOCAL"
0027E7 23   
0027E8 2A      7617 LD	HL,(ERRTRP)
0027E9 EA   
0027EA 54   
0027EB E5      7618 PUSH	HL
0027EC 2A      7619 LD	HL,(ONERSP)
0027ED EC   
0027EE 54   
0027EF E5      7620 PUSH	HL
0027F0 21      7621 LD	HL,400H		;TYPE = 4, 'EXPONENT' = 0
0027F1 00   
0027F2 04   
0027F3 E5      7622 PUSH	HL
0027F4 21      7623 LD	HL,ERRTRP
0027F5 EA   
0027F6 54   
0027F7 E5      7624 PUSH	HL
0027F8 21      7625 LD	HL,LOCCHK
0027F9 0C   
0027FA 35   
0027FB E5      7626 PUSH	HL
0027FC 21      7627 LD	HL,0
0027FD 00   
0027FE 00   
0027FF 39      7628 ADD	HL,SP
002800 CD      7629 CALL	NXT
002801 ED   
002802 44   
002803 22      7630 ONERR1:         LD	(ONERSP),HL
002804 EC   
002805 54   
002806 FD      7631 LD	(ERRTRP),IY
002807 22   
002808 EA   
002809 54   
00280A FE      7632 CP	TOFF
00280B 87   
00280C C2      7633 JP	NZ,REM
00280D 13   
00280E 25   
00280F FD      7634 INC	IY		;SKIP "OFF"
002810 23   
002811 ED      7635 SBC	HL,HL
002812 62   
002813 22      7636 LD	(ONERSP),HL
002814 EC   
002815 54   
002816 22      7637 LD	(ERRTRP),HL
002817 EA   
002818 54   
002819 C3      7638 XEQGO3:         JP	XEQ
00281A 7B   
00281B 24   
00281C CD      7648 ON:             CALL	TERMQ
00281D 18   
00281E 35   
00281F CA      7649 JP	Z,CSRON
002820 CC   
002821 0E   
002822 FE      7650 CP	TERROR
002823 85   
002824 28      7651 JR	Z,ONERR		;"ON ERROR"
002825 B4   
002826 CD      7652 CALL	EXPRI
002827 15   
002828 18   
002829 FD      7653 LD	A,(IY)
00282A 7E   
00282B 00   
00282C FD      7654 INC	IY
00282D 23   
00282E 1E      7655 LD	E,','		;SEPARATOR
00282F 2C   
002830 FE      7656 CP	TGOTO
002831 E5   
002832 28      7657 JR	Z,ON1
002833 0B   
002834 FE      7658 CP	TGOSUB
002835 E4   
002836 28      7659 JR	Z,ON1
002837 07   
002838 1E      7660 LD	E,TPROC
002839 F2   
00283A BB      7661 CP	E
00283B 3E      7662 LD	A,39
00283C 27   
00283D 20      7663 JR	NZ,ERROR2ex	;"ON syntax"
00283E 4F   
00283F 57      7664 ON1:            LD	D,A
002840 D9      7665 EXX
002841 E5      7666 PUSH	HL
002842 D9      7667 EXX
002843 C1      7668 POP	BC		;ON INDEX
002844 78      7669 LD	A,B
002845 B4      7670 OR	H
002846 B5      7671 OR	L
002847 20      7672 JR	NZ,ON4		;OUT OF RANGE
002848 32   
002849 B1      7673 OR	C
00284A 28      7674 JR	Z,ON4
00284B 2F   
00284C 0D      7675 DEC	C
00284D 28      7676 JR	Z,ON3		;INDEX=1
00284E 11   
00284F CD      7677 ON2:            CALL	TERMQ
002850 18   
002851 35   
002852 28      7678 JR	Z,ON4		;OUT OF RANGE
002853 27   
002854 FD      7679 INC	IY		;SKIP DELIMITER
002855 23   
002856 FE      7680 CP	'"'
002857 22   
002858 28      7681 JR	Z,ON5
002859 1A   
00285A BB      7682 CP	E
00285B 20      7683 JR	NZ,ON2
00285C F2   
00285D 0D      7684 DEC	C
00285E 20      7685 JR	NZ,ON2
00285F EF   
002860 7B      7686 ON3:            LD	A,E
002861 FE      7687 CP	TPROC
002862 F2   
002863 28      7688 JR	Z,ONPROC
002864 2C   
002865 D5      7689 PUSH	DE
002866 CD      7690 CALL	ITEMI		;LINE NUMBER
002867 42   
002868 18   
002869 D1      7691 POP	DE
00286A 7A      7692 LD	A,D
00286B FE      7693 CP	TGOTO
00286C E5   
00286D 28      7694 JR	Z,GOTO2
00286E 30   
00286F CD      7695 CALL	SPAN		;SKIP REST OF LIST
002870 24   
002871 35   
002872 18      7696 JR	GOSUB1
002873 3C   
002874 CD      7698 ON5:            CALL	QUOTE
002875 7B   
002876 36   
002877 FD      7699 INC	IY
002878 23   
002879 18      7700 JR	ON2
00287A D4   
00287B FD      7702 ON4:            LD	A,(IY)
00287C 7E   
00287D 00   
00287E FD      7703 INC	IY
00287F 23   
002880 FE      7704 CP	TELSE
002881 8B   
002882 CA      7705 JP	Z,IF1		;ELSE CLAUSE
002883 C4   
002884 2C   
002885 FE      7706 CP	CR
002886 0D   
002887 20      7707 JR	NZ,ON4
002888 F2   
002889 3E      7708 LD	A,40		;'ON range'
00288A 28   
00288B 21      7709 DB	21H
00288C 3E      7710 FORVAR:         LD	A,34		;'FOR variable'
00288D 22   
00288E C3      7711 ERROR2ex:         JP	ERROR_
00288F 26   
002890 3F   
002891 3E      7713 ONPROC:         LD	A,TON
002892 EE   
002893 C3      7714 JP	PROC
002894 C9   
002895 29   
002896 CD      7718 GOTO:           CALL	ITEMI		;LINE NUMBER
002897 42   
002898 18   
002899 CD      7719 GOTO1:          CALL	TERMQ
00289A 18   
00289B 35   
00289C C2      7720 JP	NZ,SYNTAX
00289D C2   
00289E 25   
00289F D9      7721 GOTO2:          EXX
0028A0 CD      7722 CALL	FINDL
0028A1 25   
0028A2 41   
0028A3 E5      7723 PUSH	HL
0028A4 FD      7724 POP	IY
0028A5 E1   
0028A6 CA      7725 JP	Z,XEQ0
0028A7 66   
0028A8 24   
0028A9 3E      7726 LD	A,41
0028AA 29   
0028AB 18      7727 JR	ERROR2ex		;"No such line"
0028AC E1   
0028AD CD      7731 GOSUB:          CALL	ITEMI		;LINE NUMBER
0028AE 42   
0028AF 18   
0028B0 FD      7732 GOSUB1:         PUSH	IY		;TEXT POINTER
0028B1 E5   
0028B2 CD      7733 CALL	CHECK		;CHECK ROOM
0028B3 68   
0028B4 32   
0028B5 CD      7734 CALL	GOTO1		;SAVE MARKER
0028B6 99   
0028B7 28   
0028B8 D1      7739 RETURN:         POP	DE		;MARKER
0028B9 21      7740 LD	HL,GOSCHK
0028BA B8   
0028BB 28   
0028BC B7      7741 OR	A
0028BD ED      7742 SBC	HL,DE
0028BE 52   
0028BF FD      7743 POP	IY
0028C0 E1   
0028C1 28      7744 JR	Z,XEQGO2ex
0028C2 30   
0028C3 3E      7745 LD	A,38
0028C4 26   
0028C5 18      7746 JR	ERROR2ex		;"No GOSUB"
0028C6 C7   
0028C7 FD      7750 REPEAT:         PUSH	IY
0028C8 E5   
0028C9 CD      7751 CALL	CHECK
0028CA 68   
0028CB 32   
0028CC CD      7752 CALL	XEQ
0028CD 7B   
0028CE 24   
0028CF C1      7757 UNTIL:          POP	BC
0028D0 C5      7758 PUSH	BC
0028D1 21      7759 LD	HL,REPCHK
0028D2 CF   
0028D3 28   
0028D4 B7      7760 OR	A
0028D5 ED      7761 SBC	HL,BC
0028D6 42   
0028D7 28      7762 JR	Z,UNTIL1
0028D8 0B   
0028D9 3E      7763 LD	A,3
0028DA 03   
0028DB CD      7764 CALL	RESLOC
0028DC 13   
0028DD 34   
0028DE 20      7765 JR	NZ,UNTIL
0028DF EF   
0028E0 3E      7766 LD	A,43
0028E1 2B   
0028E2 18      7767 JR	ERROR2ex		;"Not in a REPEAT loop"
0028E3 AA   
0028E4 CD      7769 UNTIL1:         CALL	EXPRI
0028E5 15   
0028E6 18   
0028E7 CD      7770 CALL	TEST
0028E8 3B   
0028E9 1F   
0028EA C1      7771 POP	BC
0028EB D1      7772 POP	DE
0028EC 20      7773 JR	NZ,XEQGO2ex		;TRUE
0028ED 05   
0028EE D5      7774 PUSH	DE
0028EF C5      7775 PUSH	BC
0028F0 D5      7776 PUSH	DE
0028F1 FD      7777 POP	IY
0028F2 E1   
0028F3 C3      7778 XEQGO2ex:         JP	XEQ
0028F4 7B   
0028F5 24   
0028F6 CD      7782 FORex:            CALL	ASSIGN
0028F7 91   
0028F8 31   
0028F9 20      7783 JR	NZ,FORVAR	;"FOR variable"
0028FA 91   
0028FB F5      7784 PUSH	AF		;SAVE TYPE
0028FC FD      7785 LD	A,(IY)
0028FD 7E   
0028FE 00   
0028FF FE      7786 CP	TTO
002900 B8   
002901 3E      7787 LD	A,36
002902 24   
002903 20      7788 JR	NZ,ERROR2ex	;"No TO"
002904 89   
002905 FD      7789 INC	IY
002906 23   
002907 DD      7790 PUSH	IX
002908 E5   
002909 CD      7791 CALL	EXPRN		;LIMIT
00290A 0E   
00290B 18   
00290C DD      7792 POP	IX
00290D E1   
00290E F1      7793 POP	AF
00290F 47      7794 LD	B,A		;TYPE
002910 C5      7795 PUSH	BC		;SAVE ON STACK
002911 E5      7796 PUSH	HL
002912 21      7797 LD	HL,0
002913 00   
002914 00   
002915 4C      7798 LD	C,H
002916 D9      7799 EXX
002917 E5      7800 PUSH	HL
002918 21      7801 LD	HL,1		;PRESET STEP
002919 01   
00291A 00   
00291B D9      7802 EXX
00291C FD      7803 LD	A,(IY)
00291D 7E   
00291E 00   
00291F FE      7804 CP	TSTEP
002920 88   
002921 20      7805 JR	NZ,FOR1
002922 09   
002923 FD      7806 INC	IY
002924 23   
002925 DD      7807 PUSH	IX
002926 E5   
002927 CD      7808 CALL	EXPRN		;STEP
002928 0E   
002929 18   
00292A DD      7809 POP	IX
00292B E1   
00292C 06      7810 FOR1:           LD	B,8		;FPP '>'
00292D 08   
00292E CB      7811 BIT	7,H
00292F 7C   
002930 20      7812 JR	NZ,FOR2		;STEP SIGN
002931 02   
002932 06      7813 LD	B,12		;FPP '<'
002933 0C   
002934 C5      7814 FOR2:           PUSH	BC
002935 E5      7815 PUSH	HL
002936 D9      7816 EXX
002937 E5      7817 PUSH	HL
002938 D9      7818 EXX
002939 FD      7819 PUSH	IY		;SAVE TEXT POINTER
00293A E5   
00293B DD      7820 PUSH	IX		;LOOP VARIABLE
00293C E5   
00293D CD      7821 CALL	CHECK
00293E 68   
00293F 32   
002940 CD      7822 CALL	XEQ
002941 7B   
002942 24   
002943 C1      7827 NEXT:           POP	BC		;MARKER
002944 21      7828 LD	HL,FORCHK
002945 43   
002946 29   
002947 B7      7829 OR	A
002948 ED      7830 SBC	HL,BC
002949 42   
00294A 28      7831 JR	Z,NEXT2
00294B 0C   
00294C C5      7832 PUSH	BC
00294D 3E      7833 LD	A,3
00294E 03   
00294F CD      7834 CALL	RESLOC
002950 13   
002951 34   
002952 20      7835 JR	NZ,NEXT
002953 EF   
002954 3E      7836 LD	A,32
002955 20   
002956 18      7837 JR	ERROR3ex		;"Not in a FOR loop"
002957 6A   
002958 CD      7839 NEXT2:          CALL	TERMQ
002959 18   
00295A 35   
00295B E1      7840 POP	HL
00295C E5      7841 PUSH	HL
00295D C5      7842 PUSH	BC
00295E E5      7843 PUSH	HL
00295F C4      7844 CALL	NZ,GETVAR	;VARIABLE
002960 C5   
002961 41   
002962 D1      7845 POP	DE
002963 EB      7846 EX	DE,HL
002964 B7      7847 OR	A
002965 ED      7848 NEXT0:          SBC	HL,DE
002966 52   
002967 20      7849 JR	NZ,NEXT1
002968 47   
002969 D5      7850 PUSH	DE
00296A DD      7851 LD	IX,6+2
00296B 21   
00296C 08   
00296D 00   
00296E DD      7852 ADD	IX,SP
00296F 39   
002970 CD      7853 CALL	DLOAD5		;STEP
002971 D3   
002972 19   
002973 DD      7854 LD	A,(IX+11)	;TYPE
002974 7E   
002975 0B   
002976 DD      7855 POP	IX
002977 E1   
002978 CD      7856 CALL	LOADN		;LOOP VARIABLE
002979 07   
00297A 19   
00297B F5      7857 PUSH	AF
00297C 3E      7858 LD	A,'+' & 0FH
00297D 0B   
00297E CD      7859 CALL	FPP		;ADD STEP
00297F F7   
002980 44   
002981 38      7860 JR	C,ERROR3ex
002982 3F   
002983 F1      7861 POP	AF		;RESTORE TYPE
002984 CD      7862 CALL	STOREN		;UPDATE VARIABLE
002985 D2   
002986 31   
002987 DD      7863 LD	IX,12
002988 21   
002989 0C   
00298A 00   
00298B DD      7864 ADD	IX,SP
00298C 39   
00298D CD      7865 CALL	DLOAD5		;LIMIT
00298E D3   
00298F 19   
002990 DD      7866 LD	A,(IX-1)
002991 7E   
002992 FF   
002993 CD      7867 CALL	FPP		;TEST AGAINST LIMIT
002994 F7   
002995 44   
002996 38      7868 JR	C,ERROR3ex
002997 2A   
002998 24      7869 INC	H
002999 20      7870 JR	NZ,LOOP		;KEEP LOOPING
00299A 0A   
00299B 21      7871 LD	HL,18
00299C 12   
00299D 00   
00299E 39      7872 ADD	HL,SP
00299F F9      7873 LD	SP,HL
0029A0 CD      7874 CALL	NLIST
0029A1 E2   
0029A2 44   
0029A3 18      7875 JR	NEXT
0029A4 9E   
0029A5 C1      7877 LOOP:           POP	BC
0029A6 D1      7878 POP	DE
0029A7 FD      7879 POP	IY
0029A8 E1   
0029A9 FD      7880 PUSH	IY
0029AA E5   
0029AB D5      7881 PUSH	DE
0029AC C5      7882 PUSH	BC
0029AD C3      7883 JP	XEQ
0029AE 7B   
0029AF 24   
0029B0 21      7885 NEXT1:          LD	HL,18
0029B1 12   
0029B2 00   
0029B3 39      7886 ADD	HL,SP
0029B4 F9      7887 LD	SP,HL		;"POP" THE STACK
0029B5 C1      7888 POP	BC
0029B6 21      7889 LD	HL,FORCHK
0029B7 43   
0029B8 29   
0029B9 ED      7890 SBC	HL,BC
0029BA 42   
0029BB E1      7891 POP	HL		;VARIABLE POINTER
0029BC E5      7892 PUSH	HL
0029BD C5      7893 PUSH	BC
0029BE 28      7894 JR	Z,NEXT0
0029BF A5   
0029C0 3E      7895 LD	A,33
0029C1 21   
0029C2 C3      7896 ERROR3ex:         JP	ERROR_		;"Can't match FOR"
0029C3 26   
0029C4 3F   
0029C5 F5      7901 FN:             PUSH	AF		;MAKE SPACE ON STACK
0029C6 CD      7902 CALL	PROC1
0029C7 CD   
0029C8 29   
0029C9 F5      7908 PROC:           PUSH	AF		;MAKE SPACE ON STACK
0029CA CD      7909 CALL	PROC1
0029CB CD   
0029CC 29   
0029CD CD      7911 PROC1:          CALL	CHECK
0029CE 68   
0029CF 32   
0029D0 FD      7912 DEC	IY
0029D1 2B   
0029D2 FD      7913 PUSH	IY
0029D3 E5   
0029D4 CD      7914 CALL	GETDEF
0029D5 78   
0029D6 42   
0029D7 C1      7915 POP	BC
0029D8 28      7916 JR	Z,PROC4
0029D9 39   
0029DA 3E      7917 LD	A,30
0029DB 1E   
0029DC 38      7918 JR	C,ERROR3ex	;"Bad call"
0029DD E4   
0029DE C5      7919 PUSH	BC
0029DF 2A      7920 LD	HL,(PAGE_)
0029E0 DC   
0029E1 54   
0029E2 3E      7921 PROC2:          LD	A,TDEF
0029E3 DD   
0029E4 CD      7922 CALL	SEARCHex		;LOOK FOR "DEF"
0029E5 DD   
0029E6 35   
0029E7 38      7923 JR	C,PROC3
0029E8 21   
0029E9 E5      7924 PUSH	HL
0029EA FD      7925 POP	IY
0029EB E1   
0029EC FD      7926 INC	IY		;SKIP DEF
0029ED 23   
0029EE CD      7927 CALL	NXT
0029EF ED   
0029F0 44   
0029F1 CD      7928 CALL	GETDEF
0029F2 78   
0029F3 42   
0029F4 FD      7929 PUSH	IY
0029F5 E5   
0029F6 D1      7930 POP	DE
0029F7 38      7931 JR	C,PROC6
0029F8 09   
0029F9 C4      7932 CALL	NZ,CREATE
0029FA 1E   
0029FB 43   
0029FC FD      7933 PUSH	IY
0029FD E5   
0029FE D1      7934 POP	DE
0029FF 73      7935 LD	(HL),E
002A00 23      7936 INC	HL
002A01 72      7937 LD	(HL),D		;SAVE ADDRESS
002A02 EB      7938 PROC6:          EX	DE,HL
002A03 3E      7939 LD	A,CR
002A04 0D   
002A05 47      7940 LD	B,A
002A06 ED      7941 CPIR			;SKIP TO END OF LINE
002A07 B1   
002A08 18      7942 JR	PROC2
002A09 D8   
002A0A FD      7943 PROC3:          POP	IY		;RESTORE TEXT POINTER
002A0B E1   
002A0C CD      7944 CALL	GETDEF
002A0D 78   
002A0E 42   
002A0F 3E      7945 LD	A,29
002A10 1D   
002A11 20      7946 JR	NZ,ERROR3ex	;"No such FN/PROC"
002A12 AF   
002A13 5E      7947 PROC4:          LD	E,(HL)
002A14 23      7948 INC	HL
002A15 56      7949 LD	D,(HL)		;GET ADDRESS
002A16 21      7950 LD	HL,2
002A17 02   
002A18 00   
002A19 39      7951 ADD	HL,SP
002A1A CD      7952 CALL	NXT		;ALLOW SPACE BEFORE (
002A1B ED   
002A1C 44   
002A1D D5      7953 PUSH	DE		;EXCHANGE DE,IY
002A1E FD      7954 EX	(SP),IY
002A1F E3   
002A20 D1      7955 POP	DE
002A21 FE      7956 CP	'('		;ARGUMENTS?
002A22 28   
002A23 C2      7957 JP	NZ,PROC5
002A24 C7   
002A25 2A   
002A26 CD      7958 CALL	NXT		;ALLOW SPACE BEFORE (
002A27 ED   
002A28 44   
002A29 FE      7959 CP	'('
002A2A 28   
002A2B C2      7960 JP	NZ,SYNTAX	;"Syntax error"
002A2C C2   
002A2D 25   
002A2E FD      7961 PUSH	IY
002A2F E5   
002A30 C1      7962 POP	BC		;SAVE IY IN BC
002A31 D9      7963 EXX
002A32 08      7964 EX	AF,AF'
002A33 AF      7965 XOR	A		;INITIALISE RETURN COUNT
002A34 08      7966 EX	AF,AF'
002A35 CD      7967 CALL	SAVLOC		;SAVE DUMMY VARIABLES
002A36 A0   
002A37 34   
002A38 08      7968 EX	AF,AF'
002A39 B7      7969 OR	A
002A3A 28      7970 JR	Z,RETCHK	;NO RETURNS
002A3B 16   
002A3C E5      7971 PUSH	HL
002A3D ED      7972 NEG
002A3E 44   
002A3F 6F      7973 LD	L,A
002A40 ED      7974 NEG
002A41 44   
002A42 26      7975 LD	H,-1		;HL = -RETURNS
002A43 FF   
002A44 29      7976 ADD	HL,HL
002A45 29      7977 ADD	HL,HL
002A46 29      7978 ADD	HL,HL		;-RETURNS * 8
002A47 E3      7979 EX	(SP),HL
002A48 DD      7980 POP	IX
002A49 E1   
002A4A DD      7981 ADD	IX,SP
002A4B 39   
002A4C DD      7982 LD	SP,IX
002A4D F9   
002A4E F5      7983 PUSH	AF		;PUSH RETURN COUNT
002A4F CD      7984 CALL	RETCHK		;PUSH MARKER
002A50 52   
002A51 2A   
002A52 08      7985 RETCHK:         EX	AF,AF'
002A53 CD      7986 CALL	BRAKET		;CLOSING BRACKET
002A54 90   
002A55 20   
002A56 D9      7987 EXX
002A57 C5      7988 PUSH	BC
002A58 FD      7989 POP	IY		;RESTORE IY
002A59 E1   
002A5A E5      7990 PUSH	HL
002A5B CD      7991 CALL	ARGUE		;TRANSFER ARGUMENTS
002A5C AF   
002A5D 32   
002A5E E1      7992 POP	HL
002A5F E3      8000 EX	(SP),HL
002A60 B7      8001 OR	A
002A61 01      8002 LD	BC,RETCHK
002A62 52   
002A63 2A   
002A64 ED      8003 SBC	HL,BC
002A65 42   
002A66 09      8004 ADD	HL,BC
002A67 E3      8005 EX	(SP),HL
002A68 20      8006 JR	NZ,PROC5	;No RETURNs
002A69 5D   
002A6A D5      8008 PUSH	DE
002A6B E5      8009 PUSH	HL
002A6C 21      8010 LD	HL,7		;Skip two PUSHes and RETCHK
002A6D 07   
002A6E 00   
002A6F 39      8011 ADD	HL,SP
002A70 7E      8012 LD	A,(HL)		;RETURN count
002A71 23      8013 INC	HL
002A72 E5      8014 PUSH	HL
002A73 DD      8015 POP	IX		;Address RETURNs table
002A74 E1   
002A75 5F      8016 PROC0:          LD	E,A
002A76 16      8017 LD	D,0
002A77 00   
002A78 EB      8018 EX	DE,HL
002A79 29      8019 ADD	HL,HL
002A7A 29      8020 ADD	HL,HL
002A7B 29      8021 ADD	HL,HL
002A7C 19      8022 ADD	HL,DE		;HL addresses SAVLOC stack
002A7D 23      8023 INC	HL
002A7E 23      8024 INC	HL		;Bump past LOCCHK
002A7F 5E      8025 PROC7:          LD	E,(HL)
002A80 23      8026 INC	HL
002A81 56      8027 LD	D,(HL)		;DE = SAVLOC VARPTR
002A82 23      8028 INC	HL
002A83 4E      8029 LD	C,(HL)		;Length (if string)
002A84 23      8030 INC	HL
002A85 46      8031 LD	B,(HL)		;Variable type
002A86 C5      8035 PUSH	BC		;Save type
002A87 E5      8036 PUSH	HL
002A88 DD      8037 PUSH	IX
002A89 E5   
002A8A 47      8038 LD	B,A		;B = RETURN count
002A8B DD      8039 PROC8:          LD	L,(IX+4)
002A8C 6E   
002A8D 04   
002A8E DD      8040 LD	H,(IX+5)	;HL = RETURNed VARPTR
002A8F 66   
002A90 05   
002A91 B7      8041 OR	A
002A92 ED      8042 SBC	HL,DE
002A93 52   
002A94 28      8043 JR	Z,PROC9
002A95 09   
002A96 EB      8044 EX	DE,HL
002A97 11      8045 LD	DE,8
002A98 08   
002A99 00   
002A9A DD      8046 ADD	IX,DE
002A9B 19   
002A9C EB      8047 EX	DE,HL
002A9D 10      8048 DJNZ	PROC8
002A9E EC   
002A9F DD      8049 PROC9:          POP	IX
002AA0 E1   
002AA1 E1      8050 POP	HL
002AA2 C1      8051 POP	BC		;Restore type
002AA3 20      8055 JR	NZ,PROCA
002AA4 02   
002AA5 CB      8056 SET	4,(HL)		;Flag don't restore
002AA6 E6   
002AA7 11      8060 PROCA:          LD	DE,3
002AA8 03   
002AA9 00   
002AAA CB      8061 BIT	6,B
002AAB 70   
002AAC 20      8062 JR	NZ,PROCB	;Whole array
002AAD 08   
002AAE 1E      8063 LD	E,5
002AAF 05   
002AB0 CB      8064 BIT	7,B
002AB1 78   
002AB2 28      8065 JR	Z,PROCB		;Numeric
002AB3 02   
002AB4 59      8066 LD	E,C
002AB5 13      8067 INC	DE
002AB6 19      8068 PROCB:          ADD	HL,DE
002AB7 4E      8069 LD	C,(HL)
002AB8 23      8070 INC	HL
002AB9 46      8071 LD	B,(HL)
002ABA 23      8072 INC	HL		; BC = marker ?
002ABB EB      8073 EX	DE,HL
002ABC 21      8074 LD	HL,LOCCHK
002ABD 0C   
002ABE 35   
002ABF B7      8075 OR	A
002AC0 ED      8076 SBC	HL,BC
002AC1 42   
002AC2 EB      8077 EX	DE,HL
002AC3 28      8078 JR	Z,PROC7		;Another
002AC4 BA   
002AC5 E1      8079 POP	HL
002AC6 D1      8080 POP	DE
002AC7 73      8082 PROC5:          LD	(HL),E		;SAVE "RETURN ADDRESS"
002AC8 23      8083 INC	HL
002AC9 7E      8084 LD	A,(HL)
002ACA 72      8085 LD	(HL),D
002ACB FE      8086 CP	TON		;WAS IT "ON PROC" ?
002ACC EE   
002ACD 20      8087 JR	NZ,XEQGO
002ACE 0C   
002ACF D5      8088 PUSH	DE
002AD0 FD      8089 EX	(SP),IY
002AD1 E3   
002AD2 CD      8090 CALL	SPAN		;SKIP REST OF ON LIST
002AD3 24   
002AD4 35   
002AD5 FD      8091 EX	(SP),IY
002AD6 E3   
002AD7 D1      8092 POP	DE
002AD8 72      8093 LD	(HL),D
002AD9 2B      8094 DEC	HL
002ADA 73      8095 LD	(HL),E
002ADB C3      8096 XEQGO:          JP	XEQ
002ADC 7B   
002ADD 24   
002ADE FD      8098 LOCERR:         INC	IY
002ADF 23   
002AE0 18      8099 JR	XEQGO
002AE1 F9   
002AE2 FD      8103 LOCDAT:         INC	IY
002AE3 23   
002AE4 2A      8104 LD	HL,(DATPTR)
002AE5 F0   
002AE6 54   
002AE7 E5      8105 PUSH	HL
002AE8 3E      8106 LD	A,40H
002AE9 40   
002AEA F5      8107 PUSH	AF
002AEB 21      8108 LD	HL,DATPTR
002AEC F0   
002AED 54   
002AEE E5      8109 PUSH	HL
002AEF 21      8110 LD	HL,LOCCHK
002AF0 0C   
002AF1 35   
002AF2 E5      8111 PUSH	HL
002AF3 18      8112 JR	XEQGO
002AF4 E6   
002AF5 FE      8116 LOCAL:          CP	TERROR
002AF6 85   
002AF7 28      8117 JR	Z,LOCERR
002AF8 E5   
002AF9 FE      8118 CP	TDATA
002AFA DC   
002AFB 28      8119 JR	Z,LOCDAT
002AFC E5   
002AFD C1      8120 POP	BC
002AFE C5      8121 PUSH	BC
002AFF 21      8122 LD	HL,FNCHK
002B00 C9   
002B01 29   
002B02 B7      8123 OR	A
002B03 ED      8124 SBC	HL,BC
002B04 42   
002B05 28      8125 JR	Z,LOCAL1
002B06 23   
002B07 21      8126 LD	HL,PROCHK
002B08 CD   
002B09 29   
002B0A B7      8127 OR	A
002B0B ED      8128 SBC	HL,BC
002B0C 42   
002B0D 28      8129 JR	Z,LOCAL1
002B0E 1B   
002B0F 21      8130 LD	HL,LOCCHK
002B10 0C   
002B11 35   
002B12 B7      8131 OR	A
002B13 ED      8132 SBC	HL,BC
002B14 42   
002B15 28      8133 JR	Z,LOCAL1
002B16 13   
002B17 21      8134 LD	HL,ARRCHK
002B18 BE   
002B19 26   
002B1A B7      8135 OR	A
002B1B ED      8136 SBC	HL,BC
002B1C 42   
002B1D 28      8137 JR	Z,LOCAL1
002B1E 0B   
002B1F 21      8138 LD	HL,RETCHK
002B20 52   
002B21 2A   
002B22 B7      8139 OR	A
002B23 ED      8140 SBC	HL,BC
002B24 42   
002B25 3E      8141 LD	A,12
002B26 0C   
002B27 C2      8142 JP	NZ,ERROR_	;"Not LOCAL"
002B28 26   
002B29 3F   
002B2A FD      8143 LOCAL1:         PUSH	IY
002B2B E5   
002B2C C1      8144 POP	BC
002B2D D9      8145 EXX
002B2E FD      8146 DEC	IY
002B2F 2B   
002B30 CD      8147 CALL	SAVLOC
002B31 A0   
002B32 34   
002B33 D9      8148 EXX
002B34 C5      8149 PUSH	BC
002B35 FD      8150 POP	IY
002B36 E1   
002B37 CD      8151 LOCAL2:         CALL	GETVAR
002B38 C5   
002B39 41   
002B3A C2      8152 JP	NZ,SYNTAX
002B3B C2   
002B3C 25   
002B3D CB      8153 BIT	6,A		;ARRAY?
002B3E 77   
002B3F 20      8154 JR	NZ,LOCAL4
002B40 14   
002B41 B7      8155 OR	A		;TYPE
002B42 08      8156 EX	AF,AF'
002B43 CD      8157 CALL	ZERO
002B44 DA   
002B45 1F   
002B46 08      8158 EX	AF,AF'
002B47 F5      8159 PUSH	AF
002B48 F4      8160 CALL	P,STOREN	;ZERO
002B49 D2   
002B4A 31   
002B4B F1      8161 POP	AF
002B4C 59      8162 LD	E,C
002B4D FC      8163 CALL	M,STORES
002B4E 23   
002B4F 32   
002B50 CD      8164 LOCAL3:         CALL	NLIST
002B51 E2   
002B52 44   
002B53 18      8165 JR	LOCAL2
002B54 E2   
002B55 DD      8167 LOCAL4:         LD	(IX+0),1	;FLAG LOCAL ARRAY
002B56 36   
002B57 00   
002B58 01   
002B59 DD      8168 LD	(IX+1),0
002B5A 36   
002B5B 01   
002B5C 00   
002B5D 18      8169 JR	LOCAL3
002B5E F1   
002B5F C1      8173 ENDPRO:         POP	BC
002B60 21      8174 LD	HL,PROCHK	;PROC MARKER
002B61 CD   
002B62 29   
002B63 AF      8175 XOR	A
002B64 ED      8176 SBC	HL,BC
002B65 42   
002B66 28      8177 JR	Z,ENDPR1
002B67 0B   
002B68 C5      8178 PUSH	BC		;PUT BACK
002B69 CD      8179 CALL	RESLOC
002B6A 13   
002B6B 34   
002B6C 20      8180 JR	NZ,ENDPRO
002B6D F1   
002B6E 3E      8181 LD	A,13
002B6F 0D   
002B70 C3      8182 JP	ERROR_		;"No PROC"
002B71 26   
002B72 3F   
002B73 FD      8184 ENDPR1:         POP	IY
002B74 E1   
002B75 C3      8185 XEQGO6:         JP	XEQ
002B76 7B   
002B77 24   
002B78 CD      8189 INPUTN:         CALL	CHNL		;E = CHANNEL NUMBER
002B79 BD   
002B7A 36   
002B7B CD      8190 INPN1:          CALL	NLIST
002B7C E2   
002B7D 44   
002B7E D5      8191 PUSH	DE
002B7F CD      8192 CALL	VAR_
002B80 B8   
002B81 25   
002B82 D1      8193 POP	DE
002B83 F5      8194 PUSH	AF		;SAVE TYPE
002B84 E5      8195 PUSH	HL		;VARPTR
002B85 B7      8196 OR	A
002B86 FA      8197 JP	M,INPN2		;STRING
002B87 AB   
002B88 2B   
002B89 CD      8198 CALL	OSBGET
002B8A 3D   
002B8B 06   
002B8C D9      8199 EXX
002B8D 6F      8200 LD	L,A
002B8E D9      8201 EXX
002B8F CD      8202 CALL	OSBGET
002B90 3D   
002B91 06   
002B92 D9      8203 EXX
002B93 67      8204 LD	H,A
002B94 D9      8205 EXX
002B95 CD      8206 CALL	OSBGET
002B96 3D   
002B97 06   
002B98 6F      8207 LD	L,A
002B99 CD      8208 CALL	OSBGET
002B9A 3D   
002B9B 06   
002B9C 67      8209 LD	H,A
002B9D CD      8210 CALL	OSBGET
002B9E 3D   
002B9F 06   
002BA0 4F      8211 LD	C,A
002BA1 DD      8212 POP	IX
002BA2 E1   
002BA3 F1      8213 POP	AF		;RESTORE TYPE
002BA4 D5      8214 PUSH	DE		;SAVE CHANNEL
002BA5 CD      8215 CALL	STOREN
002BA6 D2   
002BA7 31   
002BA8 D1      8216 POP	DE
002BA9 18      8217 JR	INPN1
002BAA D0   
002BAB 21      8218 INPN2:          LD	HL,ACCS
002BAC 00   
002BAD 52   
002BAE CD      8219 INPN3:          CALL	OSBGET
002BAF 3D   
002BB0 06   
002BB1 FE      8220 CP	CR
002BB2 0D   
002BB3 28      8221 JR	Z,INPN4
002BB4 04   
002BB5 77      8222 LD	(HL),A
002BB6 2C      8223 INC	L
002BB7 20      8224 JR	NZ,INPN3
002BB8 F5   
002BB9 DD      8225 INPN4:          POP	IX
002BBA E1   
002BBB F1      8226 POP	AF
002BBC D5      8227 PUSH	DE
002BBD EB      8228 EX	DE,HL
002BBE CD      8229 CALL	STACCS
002BBF 20   
002BC0 32   
002BC1 D1      8230 POP	DE
002BC2 18      8231 JR	INPN1
002BC3 B7   
002BC4 FE      8236 INPUT:          CP	'#'
002BC5 23   
002BC6 28      8237 JR	Z,INPUTN
002BC7 B0   
002BC8 0E      8238 LD	C,0		;FLAG PROMPT
002BC9 00   
002BCA FE      8239 CP	TLINE
002BCB 86   
002BCC 20      8240 JR	NZ,INPUT0
002BCD 04   
002BCE FD      8241 INC	IY		;SKIP "LINE"
002BCF 23   
002BD0 0E      8242 LD	C,80H
002BD1 80   
002BD2 21      8243 INPUT0:         LD	HL,BUFFER
002BD3 00   
002BD4 53   
002BD5 36      8244 LD	(HL),CR		;INITIALISE EMPTY
002BD6 0D   
002BD7 CD      8245 INPUT1:         CALL	TERMQ
002BD8 18   
002BD9 35   
002BDA 28      8246 JR	Z,XEQGO6	;DONE
002BDB 99   
002BDC FD      8247 INC	IY
002BDD 23   
002BDE FE      8248 CP	','
002BDF 2C   
002BE0 28      8249 JR	Z,INPUT3	;SKIP COMMA
002BE1 51   
002BE2 FE      8250 CP	';'
002BE3 3B   
002BE4 28      8251 JR	Z,INPUT3
002BE5 4D   
002BE6 E5      8252 PUSH	HL		;SAVE BUFFER POINTER
002BE7 FE      8253 CP	'"'
002BE8 22   
002BE9 20      8254 JR	NZ,INPUT6
002BEA 0A   
002BEB C5      8255 PUSH	BC
002BEC CD      8256 CALL	CONS
002BED 5C   
002BEE 19   
002BEF C1      8257 POP	BC
002BF0 CD      8258 CALL	PTEXT		;PRINT PROMPT
002BF1 93   
002BF2 35   
002BF3 18      8259 JR	INPUT9
002BF4 05   
002BF5 CD      8260 INPUT6:         CALL	FORMAT		;SPC, TAB, '
002BF6 3E   
002BF7 35   
002BF8 20      8261 JR	NZ,INPUT2
002BF9 05   
002BFA E1      8262 INPUT9:         POP	HL
002BFB CB      8263 SET	0,C		;FLAG NO PROMPT
002BFC C1   
002BFD 18      8264 JR	INPUT0
002BFE D3   
002BFF FD      8265 INPUT2:         DEC	IY
002C00 2B   
002C01 C5      8266 PUSH	BC
002C02 CD      8267 CALL	VAR_
002C03 B8   
002C04 25   
002C05 C1      8268 POP	BC
002C06 E1      8269 POP	HL
002C07 F5      8270 PUSH	AF		;SAVE TYPE
002C08 7E      8271 LD	A,(HL)
002C09 23      8272 INC	HL
002C0A FE      8273 CP	CR		;BUFFER EMPTY?
002C0B 0D   
002C0C CC      8274 CALL	Z,REFILL
002C0D 37   
002C0E 2C   
002C0F CB      8275 BIT	7,C
002C10 79   
002C11 F5      8276 PUSH	AF
002C12 C4      8277 CALL	NZ,LINES
002C13 B1   
002C14 35   
002C15 F1      8278 POP	AF
002C16 CC      8279 CALL	Z,FETCHS
002C17 A0   
002C18 35   
002C19 F1      8280 POP	AF		;RESTORE TYPE
002C1A C5      8281 PUSH	BC
002C1B E5      8282 PUSH	HL
002C1C B7      8283 OR	A
002C1D FA      8284 JP	M,INPUT4	;STRING
002C1E 2E   
002C1F 2C   
002C20 F5      8285 PUSH	AF
002C21 DD      8286 PUSH	IX
002C22 E5   
002C23 CD      8287 CALL	VAL0
002C24 04   
002C25 1C   
002C26 DD      8288 POP	IX
002C27 E1   
002C28 F1      8289 POP	AF
002C29 CD      8290 CALL	STOREN
002C2A D2   
002C2B 31   
002C2C 18      8291 JR	INPUT5
002C2D 03   
002C2E CD      8292 INPUT4:         CALL	STACCS
002C2F 20   
002C30 32   
002C31 E1      8293 INPUT5:         POP	HL
002C32 C1      8294 POP	BC
002C33 CB      8295 INPUT3:         RES	0,C
002C34 81   
002C35 18      8296 JR	INPUT1
002C36 A0   
002C37 CB      8298 REFILL:         BIT	0,C
002C38 41   
002C39 20      8299 JR	NZ,REFIL0	;NO PROMPT
002C3A 0A   
002C3B 3E      8300 LD	A,'?'
002C3C 3F   
002C3D CD      8301 CALL	OUTCHR		;PROMPT
002C3E E4   
002C3F 40   
002C40 3E      8302 LD	A,' '
002C41 20   
002C42 CD      8303 CALL	OUTCHR
002C43 E4   
002C44 40   
002C45 21      8304 REFIL0:         LD	HL,BUFFER
002C46 00   
002C47 53   
002C48 C5      8305 PUSH	BC
002C49 E5      8306 PUSH	HL
002C4A DD      8307 PUSH	IX
002C4B E5   
002C4C CD      8308 CALL	OSLINE
002C4D C9   
002C4E 05   
002C4F DD      8309 POP	IX
002C50 E1   
002C51 E1      8310 POP	HL
002C52 C1      8311 POP	BC
002C53 47      8312 LD	B,A		;POS AT ENTRY
002C54 AF      8313 XOR	A
002C55 32      8314 LD	(COUNT),A
002C56 FB   
002C57 54   
002C58 B8      8315 CP	B
002C59 C8      8316 RET	Z
002C5A 7E      8317 REFIL1:         LD	A,(HL)
002C5B FE      8318 CP	CR
002C5C 0D   
002C5D C8      8319 RET	Z
002C5E 23      8320 INC	HL
002C5F 10      8321 DJNZ	REFIL1
002C60 F9   
002C61 C9      8322 RET
002C62 FE      8326 READ:           CP	'#'
002C63 23   
002C64 CA      8327 JP	Z,INPUTN
002C65 78   
002C66 2B   
002C67 2A      8328 LD	HL,(DATPTR)
002C68 F0   
002C69 54   
002C6A 7E      8329 READ0:          LD	A,(HL)
002C6B FE      8330 CP	':'
002C6C 3A   
002C6D CC      8331 CALL	Z,REFIL1
002C6E 5A   
002C6F 2C   
002C70 23      8332 INC	HL		;SKIP COMMA | "DATA"
002C71 FE      8333 CP	CR		;END OF DATA STMT?
002C72 0D   
002C73 CC      8334 CALL	Z,GETDAT
002C74 A2   
002C75 2C   
002C76 E5      8335 PUSH	HL
002C77 CD      8336 CALL	VAR_
002C78 B8   
002C79 25   
002C7A E1      8337 POP	HL
002C7B B7      8338 OR	A
002C7C FA      8339 JP	M,READ1		;STRING
002C7D 92   
002C7E 2C   
002C7F E5      8340 PUSH	HL
002C80 FD      8341 EX	(SP),IY
002C81 E3   
002C82 F5      8342 PUSH	AF		;SAVE TYPE
002C83 DD      8343 PUSH	IX
002C84 E5   
002C85 CD      8344 CALL	EXPRN
002C86 0E   
002C87 18   
002C88 DD      8345 POP	IX
002C89 E1   
002C8A F1      8346 POP	AF
002C8B CD      8347 CALL	STOREN
002C8C D2   
002C8D 31   
002C8E FD      8348 EX	(SP),IY
002C8F E3   
002C90 18      8349 JR	READ2
002C91 07   
002C92 CD      8350 READ1:          CALL	FETCHS
002C93 A0   
002C94 35   
002C95 E5      8351 PUSH	HL
002C96 CD      8352 CALL	STACCS
002C97 20   
002C98 32   
002C99 E1      8353 READ2:          POP	HL
002C9A 22      8354 LD	(DATPTR),HL
002C9B F0   
002C9C 54   
002C9D CD      8355 CALL	NLIST
002C9E E2   
002C9F 44   
002CA0 18      8356 JR	READ0
002CA1 C8   
002CA2 CD      8358 GETDAT:         CALL	DSRCH
002CA3 DB   
002CA4 35   
002CA5 23      8359 INC	HL
002CA6 D0      8360 RET	NC
002CA7 3E      8361 LD	A,42
002CA8 2A   
002CA9 18      8362 JR	ERROR4ex		;"Out of DATA"
002CAA 64   
002CAB CD      8369 IF_:            CALL	EXPRI
002CAC 15   
002CAD 18   
002CAE CD      8370 CALL	TEST
002CAF 3B   
002CB0 1F   
002CB1 28      8371 JR	Z,IFNOT		;FALSE
002CB2 2A   
002CB3 FD      8372 LD	A,(IY)
002CB4 7E   
002CB5 00   
002CB6 FE      8373 CP	TTHEN
002CB7 8C   
002CB8 C2      8374 JP	NZ,XEQ
002CB9 7B   
002CBA 24   
002CBB FD      8375 IF0:            INC	IY		;SKIP "THEN"
002CBC 23   
002CBD FD      8376 LD	A,(IY)
002CBE 7E   
002CBF 00   
002CC0 FE      8377 CP	';'
002CC1 3B   
002CC2 28      8378 JR	Z,IF0
002CC3 F7   
002CC4 CD      8379 IF1:            CALL	NXT
002CC5 ED   
002CC6 44   
002CC7 FE      8380 CP	TLINO
002CC8 8D   
002CC9 C2      8381 JP	NZ,XEQ		;STATEMENT FOLLOWS
002CCA 7B   
002CCB 24   
002CCC C3      8382 JP	GOTO		;LINE NO. FOLLOWS
002CCD 96   
002CCE 28   
002CCF FD      8384 IFELSE:         LD	A,(IY)
002CD0 7E   
002CD1 00   
002CD2 FD      8385 INC	IY
002CD3 23   
002CD4 FE      8386 CP	';'
002CD5 3B   
002CD6 20      8387 JR	NZ,IFNEXT
002CD7 0A   
002CD8 18      8388 JR	IFTHEN
002CD9 1E   
002CDA CD      8390 IF2:            CALL	QUOTE		;SKIP STRING
002CDB 7B   
002CDC 36   
002CDD FD      8391 IFNOT:          LD	A,(IY)
002CDE 7E   
002CDF 00   
002CE0 FD      8392 INC	IY
002CE1 23   
002CE2 FE      8393 IFNEXT:         CP	'"'
002CE3 22   
002CE4 28      8394 JR	Z,IF2		;QUOTED STRING
002CE5 F4   
002CE6 FE      8395 CP	TREM
002CE7 F4   
002CE8 CA      8396 JP	Z,REM		;REM
002CE9 13   
002CEA 25   
002CEB FE      8397 CP	CR
002CEC 0D   
002CED CA      8398 JP	Z,XEQ0		;END OF LINE
002CEE 66   
002CEF 24   
002CF0 FE      8399 CP	TELSE
002CF1 8B   
002CF2 28      8400 JR	Z,IF1		;ELSE CLAUSE
002CF3 D0   
002CF4 FE      8401 CP	TTHEN
002CF5 8C   
002CF6 20      8402 JR	NZ,IFNOT	;TRY FOR END AGAIN
002CF7 E5   
002CF8 FD      8403 IFTHEN:         LD	A,(IY)
002CF9 7E   
002CFA 00   
002CFB FE      8404 CP	CR
002CFC 0D   
002CFD 20      8405 JR	NZ,IFELSE
002CFE D0   
002CFF 01      8406 LD	BC,TELSE
002D00 8B   
002D01 00   
002D02 11      8407 LD	DE,TENDIF*256+TTHEN
002D03 8C   
002D04 CD   
002D05 FD      8408 INC	IY
002D06 23   
002D07 CD      8409 CALL	NSCAN
002D08 F3   
002D09 35   
002D0A CA      8410 JP	Z,XEQ1
002D0B 82   
002D0C 24   
002D0D 3E      8411 NENDIF:         LD	A,49
002D0E 31   
002D0F C3      8412 ERROR4ex:         JP	ERROR_		;"Missing ENDIF"
002D10 26   
002D11 3F   
002D12 01      8416 MELSE:          LD	BC,-3
002D13 FD   
002D14 FF   
002D15 FD      8417 ADD	IY,BC
002D16 09   
002D17 01      8418 LD	BC,TENDIF
002D18 CD   
002D19 00   
002D1A 11      8419 LD	DE,TENDIF*256+TTHEN
002D1B 8C   
002D1C CD   
002D1D CD      8420 CALL	NSCAN
002D1E F3   
002D1F 35   
002D20 20      8421 JR	NZ,NENDIF
002D21 EB   
002D22 C3      8422 XEQGO7:         JP	XEQ
002D23 7B   
002D24 24   
002D25 01      8426 WHEN:           LD	BC,-3
002D26 FD   
002D27 FF   
002D28 FD      8427 ADD	IY,BC
002D29 09   
002D2A 01      8428 LD	BC,TENDCASE
002D2B CB   
002D2C 00   
002D2D 11      8429 LD	DE,TENDCASE*256+TOF
002D2E CA   
002D2F CB   
002D30 CD      8430 CALL	NSCAN
002D31 F3   
002D32 35   
002D33 28      8431 JR	Z,XEQGO7
002D34 ED   
002D35 3E      8432 LD	A,47
002D36 2F   
002D37 18      8433 JR	ERROR4ex		;"Missing ENDCASE"
002D38 D6   
002D39 CD      8437 CASE:           CALL	EXPR		;String or numeric
002D3A E4   
002D3B 16   
002D3C 08      8438 EX	AF,AF'
002D3D 06      8439 LD	B,0		;Flag numeric
002D3E 00   
002D3F F2      8440 JP	P,CASE6		;numeric
002D40 48   
002D41 2D   
002D42 CD      8441 CALL	PUSHS		;put string on stack
002D43 FB   
002D44 1F   
002D45 C1      8442 POP	BC		;C = length
002D46 06      8443 LD	B,1		;Flag string
002D47 01   
002D48 FD      8444 CASE6:          LD	A,(IY)
002D49 7E   
002D4A 00   
002D4B FD      8445 INC	IY
002D4C 23   
002D4D FE      8446 CP	TOF
002D4E CA   
002D4F 3E      8447 LD	A,37
002D50 25   
002D51 20      8448 JR	NZ,ERROR4ex	;"Missing OF"
002D52 BC   
002D53 FD      8449 LD	A,(IY)
002D54 7E   
002D55 00   
002D56 FD      8450 INC	IY		;Address line-length byte
002D57 23   
002D58 FE      8451 CP	CR
002D59 0D   
002D5A 3E      8452 LD	A,48
002D5B 30   
002D5C 20      8453 JR	NZ,ERROR4ex	;"OF not last"
002D5D B1   
002D5E AF      8454 CASE1:          XOR	A		;Level
002D5F D9      8455 CASE0:          EXX
002D60 E5      8456 PUSH	HL		;Push to stack
002D61 D9      8457 EXX
002D62 E5      8458 PUSH	HL
002D63 C5      8459 PUSH	BC
002D64 6F      8460 LD	L,A		;Level
002D65 01      8461 LD	BC,TOTHERWISE*256+TWHEN
002D66 C9   
002D67 CC   
002D68 11      8462 LD	DE,TENDCASE*256+TOF
002D69 CA   
002D6A CB   
002D6B CD      8463 CALL	NSCAN1
002D6C F5   
002D6D 35   
002D6E C1      8464 POP	BC		;Restore from stack
002D6F E1      8465 POP	HL
002D70 D9      8466 EXX
002D71 E1      8467 POP	HL
002D72 D9      8468 EXX
002D73 3E      8469 LD	A,47
002D74 2F   
002D75 C2      8470 JP	NZ,ERROR_	;Missing ENDCASE
002D76 26   
002D77 3F   
002D78 FD      8471 LD	A,(IY-1)
002D79 7E   
002D7A FF   
002D7B FE      8472 CP	TENDCASE
002D7C CB   
002D7D 28      8473 JR	Z,CASE9
002D7E 56   
002D7F FE      8474 CP	TOTHERWISE
002D80 CC   
002D81 28      8475 JR	Z,CASE9
002D82 52   
002D83 CB      8476 CASE4:          BIT	0,B		;Numeric or string?
002D84 40   
002D85 20      8477 JR	NZ,CASE3
002D86 69   
002D87 C5      8478 PUSH	BC		;Type/exponent/length
002D88 E5      8479 PUSH	HL		;MS 32 bits
002D89 D9      8480 EXX
002D8A E5      8481 PUSH	HL		;LS 32 bits
002D8B D9      8482 EXX
002D8C CD      8483 CALL	EXPRN
002D8D 0E   
002D8E 18   
002D8F DD      8484 LD	IX,0
002D90 21   
002D91 00   
002D92 00   
002D93 DD      8485 ADD	IX,SP		;Address stack
002D94 39   
002D95 D9      8486 EXX
002D96 DD      8487 LD	E,(IX+0)	;Get LS 32-bits
002D97 5E   
002D98 00   
002D99 DD      8488 LD	D,(IX+1)
002D9A 56   
002D9B 01   
002D9C D9      8489 EXX
002D9D DD      8490 LD	E,(IX+2)
002D9E 5E   
002D9F 02   
002DA0 DD      8491 LD	D,(IX+3)	;Get MS 32-bits
002DA1 56   
002DA2 03   
002DA3 DD      8492 LD	B,(IX+4)	;Get exponent
002DA4 46   
002DA5 04   
002DA6 3E      8493 LD	A,9
002DA7 09   
002DA8 CD      8494 CALL	FPP		;In case integer vs float
002DA9 F7   
002DAA 44   
002DAB 7D      8495 LD	A,L
002DAC B7      8496 OR	A		;NZ if equal
002DAD D9      8497 EXX
002DAE E1      8498 POP	HL
002DAF D9      8499 EXX
002DB0 E1      8500 POP	HL
002DB1 C1      8501 POP	BC
002DB2 20      8502 JR	NZ,CASE5	;Match found
002DB3 2C   
002DB4 FD      8503 CASE2:          LD	A,(IY)
002DB5 7E   
002DB6 00   
002DB7 FD      8504 INC	IY
002DB8 23   
002DB9 FE      8505 CP	','
002DBA 2C   
002DBB 28      8506 JR	Z,CASE4		;Not found, try another
002DBC C6   
002DBD D9      8507 EXX
002DBE FD      8508 PUSH	IY
002DBF E5   
002DC0 E3      8509 EX	(SP),HL
002DC1 3E      8510 LD	A,CR
002DC2 0D   
002DC3 47      8511 LD	B,A
002DC4 ED      8512 CPIR			;Find CR
002DC5 B1   
002DC6 E3      8513 EX	(SP),HL
002DC7 FD      8514 POP	IY
002DC8 E1   
002DC9 D9      8515 EXX
002DCA FD      8516 LD	A,(IY-2)	;Last token in previous line
002DCB 7E   
002DCC FE   
002DCD FE      8517 CP	TOF		;CASE statement in WHEN line
002DCE CA   
002DCF 20      8518 JR	NZ,CASE1
002DD0 8D   
002DD1 3E      8519 LD	A,1
002DD2 01   
002DD3 18      8520 JR	CASE0
002DD4 8A   
002DD5 CB      8524 CASE9:          BIT	0,B
002DD6 40   
002DD7 28      8525 JR	Z,XEQGO5
002DD8 49   
002DD9 26      8526 LD	H,0
002DDA 00   
002DDB 69      8527 LD	L,C
002DDC 39      8528 ADD	HL,SP
002DDD F9      8529 LD	SP,HL
002DDE 18      8530 JR	XEQGO5
002DDF 42   
002DE0 CD      8534 CASE5:          CALL	NXT
002DE1 ED   
002DE2 44   
002DE3 FE      8535 CP	','
002DE4 2C   
002DE5 20      8536 JR	NZ,CASE9	;End of list
002DE6 EE   
002DE7 FD      8537 INC	IY
002DE8 23   
002DE9 C5      8538 PUSH	BC		;Save type and string length
002DEA CD      8539 CALL	EXPR		;Evaluate but discard
002DEB E4   
002DEC 16   
002DED C1      8540 POP	BC
002DEE 18      8541 JR	CASE5
002DEF F0   
002DF0 C5      8545 CASE3:          PUSH	BC
002DF1 CD      8546 CALL	EXPRS
002DF2 1E   
002DF3 18   
002DF4 C1      8547 POP	BC
002DF5 21      8548 LD	HL,0
002DF6 00   
002DF7 00   
002DF8 39      8549 ADD	HL,SP
002DF9 43      8550 LD	B,E
002DFA 11      8551 LD	DE,ACCS
002DFB 00   
002DFC 52   
002DFD C5      8552 PUSH	BC
002DFE CD      8553 CALL	SCP		;String compare
002DFF D7   
002E00 1F   
002E01 C1      8554 POP	BC
002E02 06      8555 LD	B,1
002E03 01   
002E04 20      8556 JR	NZ,CASE2
002E05 AE   
002E06 18      8557 JR	CASE5
002E07 D8   
002E08 FD      8561 WHILE:          PUSH	IY		;Save current position
002E09 E5   
002E0A CD      8562 CALL	CHECK
002E0B 68   
002E0C 32   
002E0D CD      8563 CALL	WHICHK		;Push marker
002E0E 10   
002E0F 2E   
002E10 CD      8564 WHICHK:         CALL	EXPRI
002E11 15   
002E12 18   
002E13 CD      8565 CALL	TEST
002E14 3B   
002E15 1F   
002E16 20      8566 JR	NZ,XEQGO5
002E17 0A   
002E18 C1      8567 POP	BC		;Pop marker
002E19 C1      8568 POP	BC		;Level stack
002E1A 01      8569 LD	BC,TWHILE+TENDWHILE*256
002E1B 00   
002E1C 95   
002E1D 16      8570 LD	D,1
002E1E 01   
002E1F CD      8571 CALL	WSRCH
002E20 32   
002E21 36   
002E22 C3      8572 XEQGO5:         JP	XEQ
002E23 7B   
002E24 24   
002E25 C1      8576 ENDWHI:         POP	BC		;Marker
002E26 D1      8577 POP	DE		;Saved text pointer
002E27 D5      8578 PUSH	DE
002E28 C5      8579 PUSH	BC
002E29 B7      8580 OR	A
002E2A 21      8581 LD	HL,WHICHK
002E2B 10   
002E2C 2E   
002E2D ED      8582 SBC	HL,BC
002E2E 42   
002E2F 28      8583 JR	Z,ENDWH1
002E30 0B   
002E31 3E      8584 LD	A,3
002E32 03   
002E33 CD      8585 CALL	RESLOC
002E34 13   
002E35 34   
002E36 20      8586 JR	NZ,ENDWHI
002E37 ED   
002E38 3E      8587 LD	A,46
002E39 2E   
002E3A 18      8588 JR	ERROR5		;"Not in a WHILE loop"
002E3B 4F   
002E3C FD      8590 ENDWH1:         PUSH	IY
002E3D E5   
002E3E FD      8591 LD	IY,0
002E3F 21   
002E40 00   
002E41 00   
002E42 FD      8592 ADD	IY,DE
002E43 19   
002E44 CD      8593 CALL	EXPRI
002E45 15   
002E46 18   
002E47 CD      8594 CALL	TEST
002E48 3B   
002E49 1F   
002E4A D1      8595 POP	DE		;Text pointer
002E4B 20      8596 JR	NZ,XEQGO5
002E4C D5   
002E4D C1      8597 POP	BC		;Junk marker
002E4E C1      8598 POP	BC		;Junk pointer
002E4F FD      8599 LD	IY,0
002E50 21   
002E51 00   
002E52 00   
002E53 FD      8600 ADD	IY,DE
002E54 19   
002E55 18      8601 JR	XEQGO5
002E56 CB   
002E57 CD      8605 CLS:            CALL	CLRSCN
002E58 6E   
002E59 0D   
002E5A AF      8606 XOR	A
002E5B 32      8607 LD	(COUNT),A
002E5C FB   
002E5D 54   
002E5E 18      8608 JR	XEQGO5
002E5F C2   
002E60 CD      8612 STOP:           CALL	TELL
002E61 DC   
002E62 44   
002E63 0D      8613 DB	CR
002E64 0A      8614 DB	LF
002E65 FA      8615 DB	TSTOP
002E66 00      8616 DB	0
002E67 CD      8617 CALL	SETLIN		;FIND CURRENT LINE
002E68 3D   
002E69 41   
002E6A CD      8618 CALL	SAYLN
002E6B 64   
002E6C 41   
002E6D CD      8619 CALL	CRLF
002E6E DD   
002E6F 40   
002E70 C3      8620 JP	CLOOP
002E71 92   
002E72 37   
002E73 CD      8624 REPOR:          CALL	REPORT
002E74 C7   
002E75 44   
002E76 18      8625 JR	XEQGO5
002E77 AA   
002E78 CD      8629 CLR:            CALL	CLEAR
002E79 25   
002E7A 40   
002E7B 2A      8630 LD	HL,(PAGE_)
002E7C DC   
002E7D 54   
002E7E 18      8631 JR	RESTR1
002E7F 3B   
002E80 FD      8635 RESERR:         INC	IY
002E81 23   
002E82 3E      8636 LD	A,2
002E83 02   
002E84 CD      8637 CALL	RESLOC
002E85 13   
002E86 34   
002E87 20      8638 JR	NZ,XEQGO5
002E88 99   
002E89 3E      8639 LD	A,53		;ON ERROR not LOCAL
002E8A 35   
002E8B C3      8640 ERROR5:         JP	ERROR_
002E8C 26   
002E8D 3F   
002E8E FD      8644 RESDAT:         INC	IY
002E8F 23   
002E90 3E      8645 LD	A,1
002E91 01   
002E92 CD      8646 CALL	RESLOC
002E93 13   
002E94 34   
002E95 20      8647 JR	NZ,XEQGO5
002E96 8B   
002E97 3E      8648 LD	A,54		;'DATA not LOCAL'
002E98 36   
002E99 21      8649 DB	21H
002E9A 3E      8650 NOLINE:         LD	A,41		;'No such line'
002E9B 29   
002E9C 18      8651 JR	ERROR5
002E9D ED   
002E9E FE      8655 RESTOR:         CP	TERROR
002E9F 85   
002EA0 28      8656 JR	Z,RESERR
002EA1 DE   
002EA2 FE      8657 CP	TDATA
002EA3 DC   
002EA4 28      8658 JR	Z,RESDAT
002EA5 E8   
002EA6 FE      8659 CP	'+'
002EA7 2B   
002EA8 28      8660 JR	Z,RESREL
002EA9 1A   
002EAA 2A      8661 LD	HL,(PAGE_)
002EAB DC   
002EAC 54   
002EAD CD      8662 CALL	TERMQ
002EAE 18   
002EAF 35   
002EB0 28      8663 JR	Z,RESTR1
002EB1 09   
002EB2 CD      8664 CALL	ITEMI
002EB3 42   
002EB4 18   
002EB5 D9      8665 EXX
002EB6 CD      8666 CALL	FINDL		;SEARCH FOR LINE
002EB7 25   
002EB8 41   
002EB9 20      8667 JR	NZ,NOLINE
002EBA DF   
002EBB CD      8668 RESTR1:         CALL	DSRCH
002EBC DB   
002EBD 35   
002EBE 22      8669 LD	(DATPTR),HL
002EBF F0   
002EC0 54   
002EC1 C3      8670 JP	XEQ
002EC2 7B   
002EC3 24   
002EC4 CD      8672 RESREL:         CALL	EXPRI
002EC5 15   
002EC6 18   
002EC7 D9      8673 EXX
002EC8 EB      8674 EX	DE,HL
002EC9 FD      8675 PUSH	IY
002ECA E5   
002ECB E1      8676 POP	HL
002ECC 3E      8677 LD	A,CR
002ECD 0D   
002ECE 47      8678 LD	B,A
002ECF ED      8679 CPIR			;FIND LINE END
002ED0 B1   
002ED1 1D      8680 DEC	E
002ED2 28      8681 JR	Z,RESTR1
002ED3 E7   
002ED4 FA      8682 JP	M,RESTR1
002ED5 BB   
002ED6 2E   
002ED7 AF      8683 XOR	A
002ED8 47      8684 LD	B,A
002ED9 4E      8685 RESTR2:         LD	C,(HL)
002EDA B9      8686 CP	C
002EDB 28      8687 JR	Z,NOLINE
002EDC BD   
002EDD 09      8688 ADD	HL,BC
002EDE 1D      8689 DEC	E
002EDF 20      8690 JR	NZ,RESTR2
002EE0 F8   
002EE1 18      8691 JR	RESTR1
002EE2 D8   
002EE3 CD      8699 PTR:            CALL	CHANEL
002EE4 B3   
002EE5 36   
002EE6 CD      8700 CALL	EQUALS
002EE7 31   
002EE8 35   
002EE9 7B      8701 LD	A,E
002EEA F5      8702 PUSH	AF
002EEB CD      8703 CALL	EXPRI
002EEC 15   
002EED 18   
002EEE E5      8704 PUSH	HL
002EEF D9      8705 EXX
002EF0 D1      8706 POP	DE
002EF1 F1      8707 POP	AF
002EF2 CD      8708 CALL	PUTPTR
002EF3 77   
002EF4 06   
002EF5 18      8709 JR	XEQGO1ex
002EF6 61   
002EF7 CD      8711 PAGEV:          CALL	EQUALS
002EF8 31   
002EF9 35   
002EFA CD      8712 CALL	EXPRI
002EFB 15   
002EFC 18   
002EFD D9      8713 EXX
002EFE 2E      8714 LD	L,0
002EFF 00   
002F00 22      8715 LD	(PAGE_),HL
002F01 DC   
002F02 54   
002F03 18      8716 JR	XEQGO1ex
002F04 53   
002F05 FE      8718 TIMEV:          CP	'$'
002F06 24   
002F07 28      8719 JR	Z,TIMEVS
002F08 0E   
002F09 CD      8720 CALL	EQUALS
002F0A 31   
002F0B 35   
002F0C CD      8721 CALL	EXPRI
002F0D 15   
002F0E 18   
002F0F E5      8722 PUSH	HL
002F10 D9      8723 EXX
002F11 D1      8724 POP	DE
002F12 CD      8725 CALL	PUTIME
002F13 39   
002F14 0D   
002F15 18      8726 JR	XEQGO1ex
002F16 41   
002F17 FD      8728 TIMEVS:         INC	IY		;SKIP '$'
002F18 23   
002F19 CD      8729 CALL	EQUALS
002F1A 31   
002F1B 35   
002F1C CD      8730 CALL	EXPRS
002F1D 1E   
002F1E 18   
002F1F CD      8731 CALL	PUTIMS
002F20 56   
002F21 0D   
002F22 18      8732 JR	XEQGO1ex
002F23 34   
002F24 CD      8734 LOMEMV:         CALL	EQUALS
002F25 31   
002F26 35   
002F27 CD      8735 CALL	EXPRI
002F28 15   
002F29 18   
002F2A CD      8736 CALL	CLEAR
002F2B 25   
002F2C 40   
002F2D D9      8737 EXX
002F2E 22      8738 LD	(LOMEM),HL
002F2F DE   
002F30 54   
002F31 22      8739 LD	(FREE),HL
002F32 E0   
002F33 54   
002F34 18      8740 JR	XEQGO1ex
002F35 22   
002F36 CD      8742 HIMEMV:         CALL	EQUALS
002F37 31   
002F38 35   
002F39 CD      8743 CALL	EXPRI
002F3A 15   
002F3B 18   
002F3C D9      8744 EXX
002F3D ED      8745 LD	DE,(FREE)
002F3E 5B   
002F3F E0   
002F40 54   
002F41 14      8746 INC	D
002F42 AF      8747 XOR	A
002F43 ED      8748 SBC	HL,DE
002F44 52   
002F45 19      8749 ADD	HL,DE
002F46 DA      8750 JP	C,ERROR_		;"No room"
002F47 26   
002F48 3F   
002F49 ED      8751 LD	DE,(HIMEM)
002F4A 5B   
002F4B E2   
002F4C 54   
002F4D 22      8752 LD	(HIMEM),HL
002F4E E2   
002F4F 54   
002F50 EB      8753 EX	DE,HL
002F51 ED      8754 SBC	HL,SP
002F52 72   
002F53 C2      8755 JP	NZ,XEQ
002F54 7B   
002F55 24   
002F56 EB      8756 EX	DE,HL
002F57 F9      8757 LD	SP,HL		;LOAD STACK POINTER
002F58 C3      8758 XEQGO1ex:         JP	XEQ
002F59 7B   
002F5A 24   
002F5B CD      8762 WIDTHV:         CALL	EXPRI
002F5C 15   
002F5D 18   
002F5E D9      8763 EXX
002F5F 7D      8764 LD	A,L
002F60 32      8765 LD	(WIDTH),A
002F61 FC   
002F62 54   
002F63 18      8766 JR	XEQGO1ex
002F64 F3   
002F65 FD      8772 TRACE:          INC	IY
002F66 23   
002F67 21      8773 LD	HL,0
002F68 00   
002F69 00   
002F6A FE      8774 CP	TON
002F6B EE   
002F6C 28      8775 JR	Z,TRACE0
002F6D 0A   
002F6E FE      8776 CP	TOFF
002F6F 87   
002F70 28      8777 JR	Z,TRACE1
002F71 07   
002F72 FD      8778 DEC	IY
002F73 2B   
002F74 CD      8779 CALL	EXPRI
002F75 15   
002F76 18   
002F77 D9      8780 EXX
002F78 2B      8781 TRACE0:         DEC	HL
002F79 22      8782 TRACE1:         LD	(TRACEN),HL
002F7A E6   
002F7B 54   
002F7C 18      8783 JR	XEQGO1ex
002F7D DA   
002F7E CD      8787 VDU:            CALL	EXPRI
002F7F 15   
002F80 18   
002F81 D9      8788 EXX
002F82 7D      8789 LD	A,L
002F83 06      8790 LD	B,1
002F84 01   
002F85 CD      8791 VDU1:           CALL	OSWRCH
002F86 93   
002F87 05   
002F88 10      8792 DJNZ	VDU1
002F89 FB   
002F8A FD      8793 LD	A,(IY)
002F8B 7E   
002F8C 00   
002F8D FE      8794 CP	'|'
002F8E 7C   
002F8F 28      8795 JR	Z,VDU4
002F90 15   
002F91 FE      8796 CP	','
002F92 2C   
002F93 28      8797 JR	Z,VDU2
002F94 08   
002F95 FE      8798 CP	';'
002F96 3B   
002F97 20      8799 JR	NZ,VDU3
002F98 06   
002F99 7C      8800 LD	A,H
002F9A CD      8801 CALL	OSWRCH
002F9B 93   
002F9C 05   
002F9D FD      8802 VDU2:           INC	IY
002F9E 23   
002F9F CD      8803 VDU3:           CALL	TERMQ
002FA0 18   
002FA1 35   
002FA2 20      8804 JR	NZ,VDU
002FA3 DA   
002FA4 18      8805 JR	XEQGO1ex
002FA5 B2   
002FA6 FD      8807 VDU4:           INC	IY
002FA7 23   
002FA8 AF      8808 XOR	A
002FA9 06      8809 LD	B,9
002FAA 09   
002FAB 18      8810 JR	VDU1
002FAC D8   
002FAD CD      8814 CLOSE:          CALL	CHANEL
002FAE B3   
002FAF 36   
002FB0 CD      8815 CALL	OSSHUT
002FB1 35   
002FB2 06   
002FB3 18      8816 JR	XEQGO1ex
002FB4 A3   
002FB5 CD      8821 BPUT:           CALL	CHANEL		;CHANNEL NUMBER
002FB6 B3   
002FB7 36   
002FB8 D5      8822 PUSH	DE
002FB9 CD      8823 CALL	COMMA
002FBA 84   
002FBB 20   
002FBC CD      8824 CALL	EXPR
002FBD E4   
002FBE 16   
002FBF 08      8825 EX	AF,AF'
002FC0 FA      8826 JP	M,BPUTS
002FC1 CE   
002FC2 2F   
002FC3 CD      8827 CALL	SFIX
002FC4 F9   
002FC5 1B   
002FC6 D9      8828 EXX
002FC7 7D      8829 LD	A,L
002FC8 D1      8830 POP	DE
002FC9 CD      8831 CALL	OSBPUT
002FCA 45   
002FCB 06   
002FCC 18      8832 BPUTX:          JR	XEQGO1ex
002FCD 8A   
002FCE 7B      8834 BPUTS:          LD	A,E
002FCF D1      8835 POP	DE
002FD0 57      8836 LD	D,A
002FD1 21      8837 LD	HL,ACCS
002FD2 00   
002FD3 52   
002FD4 7E      8838 BPUTS1:         LD	A,(HL)
002FD5 23      8839 INC	HL
002FD6 CD      8840 CALL	OSBPUT
002FD7 45   
002FD8 06   
002FD9 15      8841 DEC	D
002FDA 20      8842 JR	NZ,BPUTS1
002FDB F8   
002FDC CD      8843 CALL	NXT
002FDD ED   
002FDE 44   
002FDF FE      8844 CP	';'
002FE0 3B   
002FE1 FD      8845 INC	IY
002FE2 23   
002FE3 28      8846 JR	Z,BPUTX
002FE4 E7   
002FE5 3E      8847 LD	A,LF
002FE6 0A   
002FE7 CD      8848 CALL	OSBPUT
002FE8 45   
002FE9 06   
002FEA FD      8849 DEC	IY
002FEB 2B   
002FEC 18      8850 JR	BPUTX
002FED DE   
002FEE CD      8854 CALL:           CALL	EXPRI		;ADDRESS
002FEF 15   
002FF0 18   
002FF1 D9      8855 EXX
002FF2 E5      8856 PUSH	HL		;SAVE IT
002FF3 06      8857 LD	B,0		;PARAMETER COUNTER
002FF4 00   
002FF5 11      8858 LD	DE,BUFFER	;VECTOR
002FF6 00   
002FF7 53   
002FF8 CD      8859 CALL1:          CALL	NXT
002FF9 ED   
002FFA 44   
002FFB FE      8860 CP	','
002FFC 2C   
002FFD 20      8861 JR	NZ,CALL2
002FFE 17   
002FFF FD      8862 INC	IY
003000 23   
003001 04      8863 INC	B
003002 CD      8864 CALL	NXT
003003 ED   
003004 44   
003005 C5      8865 PUSH	BC
003006 D5      8866 PUSH	DE
003007 CD      8867 CALL	VAR_
003008 B8   
003009 25   
00300A D1      8868 POP	DE
00300B C1      8869 POP	BC
00300C 13      8870 INC	DE
00300D 12      8871 LD	(DE),A		;PARAMETER TYPE
00300E 13      8872 INC	DE
00300F EB      8873 EX	DE,HL
003010 73      8874 LD	(HL),E		;PARAMETER ADDRESS
003011 23      8875 INC	HL
003012 72      8876 LD	(HL),D
003013 EB      8877 EX	DE,HL
003014 18      8878 JR	CALL1
003015 E2   
003016 78      8879 CALL2:          LD	A,B
003017 32      8880 LD	(BUFFER),A	;PARAMETER COUNT
003018 00   
003019 53   
00301A E1      8881 POP	HL		;RESTORE ADDRESS
00301B CD      8882 CALL	USR1
00301C 25   
00301D 30   
00301E C3      8883 JP	XEQ
00301F 7B   
003020 24   
003021 CD      8887 USR:            CALL	ITEMI
003022 42   
003023 18   
003024 D9      8888 EXX
003025 E5      8889 USR1:           PUSH	HL		;ADDRESS ON STACK
003026 FD      8890 EX	(SP),IY
003027 E3   
003028 24      8891 INC	H		;PAGE &FF?
003029 21      8892 LD	HL,USR2		;RETURN ADDRESS
00302A 54   
00302B 30   
00302C E5      8893 PUSH	HL
00302D DD      8894 LD	IX,STAVAR
00302E 21   
00302F 00   
003030 54   
003031 CC      8895 CALL	Z,OSCALL	;INTERCEPT PAGE &FF
003032 8A   
003033 10   
003034 DD      8896 LD	C,(IX+24)
003035 4E   
003036 18   
003037 C5      8897 PUSH	BC
003038 F1      8898 POP	AF		;LOAD FLAGS
003039 DD      8899 LD	A,(IX+4)	;LOAD Z80 REGISTERS
00303A 7E   
00303B 04   
00303C DD      8900 LD	B,(IX+8)
00303D 46   
00303E 08   
00303F DD      8901 LD	C,(IX+12)
003040 4E   
003041 0C   
003042 DD      8902 LD	D,(IX+16)
003043 56   
003044 10   
003045 DD      8903 LD	E,(IX+20)
003046 5E   
003047 14   
003048 DD      8904 LD	H,(IX+32)
003049 66   
00304A 20   
00304B DD      8905 LD	L,(IX+48)
00304C 6E   
00304D 30   
00304E DD      8906 LD	IX,BUFFER
00304F 21   
003050 00   
003051 53   
003052 FD      8907 JP	(IY)		;OFF TO USER ROUTINE
003053 E9   
003054 FD      8908 USR2:           POP	IY
003055 E1   
003056 AF      8909 XOR	A
003057 4F      8910 LD	C,A
003058 C9      8911 RET
003059 CD      8917 LEFTSL:         CALL    GETSTR
00305A A0   
00305B 25   
00305C 21      8918 LD	HL,0FF00H	;Default all but last
00305D 00   
00305E FF   
00305F 20      8919 JR	NZ,MIDSL1
003060 48   
003061 18      8920 JR	MIDSL0
003062 26   
003063 CD      8922 RITESL:         CALL	GETSTR
003064 A0   
003065 25   
003066 21      8923 LD	HL,0FFFFH	;Default last char only
003067 FF   
003068 FF   
003069 20      8924 JR	NZ,MIDSL1
00306A 3E   
00306B 18      8925 JR	MIDSL0
00306C 1C   
00306D CD      8927 MIDSL:          CALL	GETSTR
00306E A0   
00306F 25   
003070 3E      8928 LD	A,5
003071 05   
003072 C2      8929 JP	NZ,ERROR_	;'Missing comma'
003073 26   
003074 3F   
003075 FD      8930 INC	IY
003076 23   
003077 DD      8931 PUSH	IX
003078 E5   
003079 CD      8932 CALL	EXPRI
00307A 15   
00307B 18   
00307C DD      8933 POP	IX
00307D E1   
00307E D9      8934 EXX
00307F CD      8935 CALL	NXT
003080 ED   
003081 44   
003082 2D      8936 DEC	L
003083 26      8937 LD	H,254		;Default rest of string
003084 FE   
003085 FE      8938 CP	','
003086 2C   
003087 20      8939 JR	NZ,MIDSL1
003088 20   
003089 FD      8940 MIDSL0:         INC	IY
00308A 23   
00308B E5      8941 PUSH	HL
00308C DD      8942 PUSH	IX
00308D E5   
00308E CD      8943 CALL	EXPRI
00308F 15   
003090 18   
003091 DD      8944 POP	IX
003092 E1   
003093 D9      8945 EXX
003094 7D      8946 LD	A,L
003095 E1      8947 POP	HL
003096 B7      8948 OR	A
003097 28      8949 JR	Z,MIDSL2	;Zero length
003098 0D   
003099 3D      8950 DEC	A
00309A 85      8951 ADD	A,L
00309B 67      8952 LD	H,A
00309C 30      8953 JR	NC,MIDSL1
00309D 0B   
00309E 7D      8954 LD	A,L
00309F 3C      8955 INC	A
0030A0 28      8956 JR	Z,MIDSL1
0030A1 07   
0030A2 26      8957 LD	H,254
0030A3 FE   
0030A4 18      8958 JR	MIDSL1
0030A5 03   
0030A6 21      8960 MIDSL2:         LD	HL,1
0030A7 01   
0030A8 00   
0030A9 CD      8961 MIDSL1:         CALL	BRAKET
0030AA 90   
0030AB 20   
0030AC CD      8962 CALL	EQUALS
0030AD 31   
0030AE 35   
0030AF E5      8963 PUSH	HL
0030B0 DD      8964 PUSH	IX
0030B1 E5   
0030B2 CD      8965 CALL	EXPRS
0030B3 1E   
0030B4 18   
0030B5 DD      8966 POP	IX
0030B6 E1   
0030B7 E1      8967 POP	HL
0030B8 4B      8968 LD	C,E
0030B9 DD      8969 LD	B,(IX+0)
0030BA 46   
0030BB 00   
0030BC DD      8970 LD	E,(IX+2)
0030BD 5E   
0030BE 02   
0030BF DD      8971 LD	D,(IX+3)
0030C0 56   
0030C1 03   
0030C2 7D      8982 LD	A,L
0030C3 3C      8983 INC	A
0030C4 20      8984 JR	NZ,SUBSL1
0030C5 0F   
0030C6 24      8985 INC	H
0030C7 24      8986 INC	H
0030C8 79      8987 LD	A,C
0030C9 BC      8988 CP	H
0030CA 30      8989 JR	NC,SUBSL0
0030CB 01   
0030CC 67      8990 LD	H,A
0030CD 78      8991 SUBSL0:         LD	A,B
0030CE 94      8992 SUB	H
0030CF 30      8993 JR	NC,SUBSL6
0030D0 01   
0030D1 AF      8994 XOR	A
0030D2 6F      8995 SUBSL6:         LD	L,A
0030D3 18      8996 JR	SUBSL5
0030D4 12   
0030D5 7C      8998 SUBSL1:         LD	A,H
0030D6 3C      8999 INC	A
0030D7 20      9000 JR	NZ,SUBSL2
0030D8 06   
0030D9 78      9001 LD	A,B
0030DA D6      9002 SUB	2
0030DB 02   
0030DC 38      9003 JR	C,SUBSL9
0030DD 24   
0030DE 67      9004 LD	H,A
0030DF 7D      9005 SUBSL2:         LD	A,L
0030E0 B8      9006 CP	B
0030E1 30      9007 JR	NC,SUBSL9
0030E2 1F   
0030E3 7C      9008 LD	A,H
0030E4 B8      9009 CP	B
0030E5 38      9010 JR	C,SUBSL3
0030E6 03   
0030E7 78      9011 SUBSL5:         LD	A,B
0030E8 3D      9012 DEC	A
0030E9 67      9013 LD	H,A
0030EA 7C      9014 SUBSL3:         LD	A,H
0030EB 95      9015 SUB	L
0030EC 38      9016 JR	C,SUBSL9
0030ED 14   
0030EE 3C      9017 INC	A
0030EF B9      9018 CP	C
0030F0 38      9019 JR	C,SUBSL4
0030F1 01   
0030F2 79      9020 LD	A,C
0030F3 06      9021 SUBSL4:         LD	B,0
0030F4 00   
0030F5 60      9022 LD	H,B
0030F6 4F      9023 LD	C,A
0030F7 B7      9024 OR	A
0030F8 28      9025 JR	Z,SUBSL9
0030F9 08   
0030FA EB      9026 EX	DE,HL
0030FB 19      9027 ADD	HL,DE
0030FC EB      9028 EX	DE,HL
0030FD 21      9029 LD	HL,ACCS
0030FE 00   
0030FF 52   
003100 ED      9030 LDIR
003101 B0   
003102 C3      9031 SUBSL9:         JP	XEQ
003103 7B   
003104 24   
003105 FD      9037 EXITex:           INC	IY		;Skip FOR/REPEAT/WHILE
003106 23   
003107 FE      9038 CP	TFOR
003108 E3   
003109 20      9039 JR	NZ,EXIT0
00310A 0C   
00310B DD      9040 LD	IX,0		;For EXITex FOR <var>
00310C 21   
00310D 00   
00310E 00   
00310F CD      9041 CALL	TERMQ
003110 18   
003111 35   
003112 C4      9042 CALL	NZ,GETVAR
003113 C5   
003114 41   
003115 3E      9043 LD	A,TFOR
003116 E3   
003117 16      9044 EXIT0:          LD	D,1		;Level for WSRCH
003118 01   
003119 5F      9045 LD	E,A
00311A 7B      9046 EXIT1:          LD	A,E
00311B C1      9047 POP	BC		;Marker
00311C 21      9048 LD	HL,FORCHK
00311D 43   
00311E 29   
00311F B7      9049 OR	A
003120 ED      9050 SBC	HL,BC
003121 42   
003122 28      9051 JR	Z,EXIT4
003123 25   
003124 21      9052 LD	HL,REPCHK
003125 CF   
003126 28   
003127 B7      9053 OR	A
003128 ED      9054 SBC	HL,BC
003129 42   
00312A 28      9055 JR	Z,EXIT6
00312B 38   
00312C 21      9056 LD	HL,WHICHK
00312D 10   
00312E 2E   
00312F B7      9057 OR	A
003130 ED      9058 SBC	HL,BC
003131 42   
003132 28      9059 JR	Z,EXIT7
003133 3A   
003134 C5      9060 PUSH	BC		;Put back marker
003135 DD      9061 PUSH	IX
003136 E5   
003137 C1      9062 POP	BC
003138 D9      9063 EXX
003139 3E      9064 LD	A,3
00313A 03   
00313B CD      9065 CALL	RESLOC
00313C 13   
00313D 34   
00313E D9      9066 EXX
00313F C5      9067 PUSH	BC
003140 DD      9068 POP	IX
003141 E1   
003142 20      9069 JR	NZ,EXIT1
003143 D6   
003144 3E      9070 LD	A,44
003145 2C   
003146 C3      9071 JP	ERROR_		;'Bad EXITex'
003147 26   
003148 3F   
003149 C1      9073 EXIT4:          POP	BC		;VARPTR
00314A 21      9074 LD	HL,14		;Skip text pointer, limit & step
00314B 0E   
00314C 00   
00314D 39      9075 ADD	HL,SP
00314E F9      9076 LD	SP,HL		;Pop FOR record
00314F FE      9077 CP	TFOR
003150 E3   
003151 20      9078 JR	NZ,EXIT1
003152 C7   
003153 DD      9079 PUSH	IX
003154 E5   
003155 E1      9080 POP	HL
003156 7C      9081 LD	A,H
003157 B5      9082 OR	L
003158 28      9083 JR	Z,EXIT5
003159 02   
00315A ED      9084 SBC	HL,BC
00315B 42   
00315C 01      9085 EXIT5:          LD	BC,TFOR+TNEXT*256
00315D 00   
00315E D0   
00315F 28      9086 JR	Z,EXIT8
003160 15   
003161 14      9087 INC	D		;Count nested FOR loops
003162 18      9088 JR	EXIT1
003163 B6   
003164 C1      9090 EXIT6:          POP	BC		;Text pointer
003165 FE      9091 CP	TREPEAT
003166 F5   
003167 20      9092 JR	NZ,EXIT1
003168 B1   
003169 01      9093 LD	BC,TREPEAT+TUNTIL*256
00316A 00   
00316B F2   
00316C 18      9094 JR	EXIT8
00316D 08   
00316E C1      9096 EXIT7:          POP	BC		;Text pointer
00316F FE      9097 CP	TWHILE
003170 C7   
003171 20      9098 JR	NZ,EXIT1
003172 A7   
003173 01      9099 LD	BC,TWHILE+TENDWHILE*256
003174 00   
003175 95   
003176 CD      9100 EXIT8:          CALL	WSRCH
003177 32   
003178 36   
003179 CD      9101 CALL	SPAN		;Skip UNTIL expression
00317A 24   
00317B 35   
00317C C3      9102 JP	XEQ
00317D 7B   
00317E 24   
00317F CD      9106 PUT:            CALL	EXPRI		;PORT ADDRESS
003180 15   
003181 18   
003182 D9      9107 EXX
003183 E5      9108 PUSH	HL
003184 CD      9109 CALL	COMMA
003185 84   
003186 20   
003187 CD      9110 CALL	EXPRI		;DATA
003188 15   
003189 18   
00318A D9      9111 EXX
00318B C1      9112 POP	BC
00318C ED      9113 OUT	(C),L		;OUTPUT TO PORT BC
00318D 69   
00318E C3      9114 JP	XEQ
00318F 7B   
003190 24   
003191 CD      9125 ASSIGN:         CALL	GETVAR		;VARIABLE
003192 C5   
003193 41   
003194 D8      9126 RET	C		;ILLEGAL VARIABLE
003195 C4      9127 CALL	NZ,PUTVAR
003196 AF   
003197 41   
003198 57      9128 LD	D,A		;Type
003199 CD      9129 CALL	NXT
00319A ED   
00319B 44   
00319C FD      9130 INC	IY
00319D 23   
00319E 5F      9131 LD	E,A		;Operator (or =)
00319F FE      9132 CP	'='
0031A0 3D   
0031A1 C4      9133 CALL	NZ,EQUALS
0031A2 31   
0031A3 35   
0031A4 7A      9134 LD	A,D
0031A5 E6      9135 AND	11000000B
0031A6 C0   
0031A7 C0      9136 RET	NZ		;String or array
0031A8 D5      9137 PUSH	DE
0031A9 E5      9138 PUSH	HL
0031AA CD      9139 CALL	EXPRN
0031AB 0E   
0031AC 18   
0031AD DD      9140 POP	IX
0031AE E1   
0031AF D1      9141 POP	DE
0031B0 7B      9152 MODIFY:         LD	A,E
0031B1 FE      9153 CP	'='
0031B2 3D   
0031B3 28      9154 JR	Z,STORE0	;Simple assignment
0031B4 1C   
0031B5 D5      9155 PUSH	DE
0031B6 D9      9156 EXX
0031B7 EB      9157 EX	DE,HL
0031B8 D9      9158 EXX
0031B9 EB      9159 EX	DE,HL
0031BA 41      9160 LD	B,C
0031BB E3      9161 EX	(SP),HL
0031BC 7C      9162 LD	A,H
0031BD E3      9163 EX	(SP),HL
0031BE CD      9164 CALL	LOADN
0031BF 07   
0031C0 19   
0031C1 E3      9165 EX	(SP),HL
0031C2 7D      9166 LD	A,L
0031C3 E3      9167 EX	(SP),HL
0031C4 E6      9168 AND	15
0031C5 0F   
0031C6 DD      9169 PUSH	IX
0031C7 E5   
0031C8 CD      9170 CALL	FPP
0031C9 F7   
0031CA 44   
0031CB DD      9171 POP	IX
0031CC E1   
0031CD D1      9172 POP	DE
0031CE DA      9173 JP	C,ERROR_
0031CF 26   
0031D0 3F   
0031D1 7A      9174 STORE0:         LD	A,D		;Type
0031D2 FE      9175 STOREN:         CP	5
0031D3 05   
0031D4 28      9176 JR	Z,STORE5
0031D5 12   
0031D6 F5      9177 PUSH	AF
0031D7 0C      9178 INC	C		;SPEED - & PRESERVE F'
0031D8 0D      9179 DEC	C		; WHEN CALLED BY FNEND0
0031D9 C4      9180 CALL	NZ,SFIX		;CONVERT TO INTEGER
0031DA F9   
0031DB 1B   
0031DC F1      9181 POP	AF
0031DD FE      9182 CP	4
0031DE 04   
0031DF 28      9183 JR	Z,STORE4
0031E0 0A   
0031E1 BF      9184 CP	A		;SET ZERO
0031E2 D9      9185 STORE1:         EXX
0031E3 DD      9186 LD	(IX+0),L
0031E4 75   
0031E5 00   
0031E6 D9      9187 EXX
0031E7 C9      9188 RET
0031E8 DD      9190 STORE5:         LD	(IX+4),C
0031E9 71   
0031EA 04   
0031EB D9      9191 STORE4:         EXX
0031EC DD      9192 LD	(IX+0),L
0031ED 75   
0031EE 00   
0031EF DD      9193 LD	(IX+1),H
0031F0 74   
0031F1 01   
0031F2 D9      9194 EXX
0031F3 DD      9195 LD	(IX+2),L
0031F4 75   
0031F5 02   
0031F6 DD      9196 LD	(IX+3),H
0031F7 74   
0031F8 03   
0031F9 C9      9197 RET
0031FA 7D      9206 MODIFS:         LD	A,L		;Operator
0031FB FE      9207 CP	'+'
0031FC 2B   
0031FD 7C      9208 LD	A,H		;Type
0031FE 20      9209 JR	NZ,STACCS
0031FF 20   
003200 FD      9210 PUSH	IY
003201 E5   
003202 DD      9211 PUSH	IX
003203 E5   
003204 FD      9212 POP	IY
003205 E1   
003206 CD      9213 CALL	PUSHS
003207 FB   
003208 1F   
003209 FD      9214 PUSH	IY
00320A E5   
00320B DD      9215 POP	IX
00320C E1   
00320D CD      9216 CALL	LOADS
00320E F0   
00320F 19   
003210 C1      9217 POP	BC
003211 78      9218 LD	A,B		;Type
003212 0C      9219 INC	C
003213 0D      9220 DEC	C
003214 28      9221 JR	Z,MODFS1	;Zero length
003215 08   
003216 21      9222 LD	HL,0
003217 00   
003218 00   
003219 44      9223 LD	B,H
00321A 39      9224 ADD	HL,SP
00321B ED      9225 LDIR
00321C B0   
00321D F9      9226 LD	SP,HL
00321E FD      9227 MODFS1:         POP	IY
00321F E1   
003220 21      9231 STACCS:         LD	HL,ACCS
003221 00   
003222 52   
003223 1F      9232 STORES:         RRA
003224 30      9233 JR	NC,STORS3	;FIXED STRING
003225 4F   
003226 E5      9234 PUSH	HL
003227 CD      9235 CALL	LOAD4
003228 14   
003229 19   
00322A 7B      9236 LD	A,E		;LENGTH OF STRING
00322B D9      9237 EXX
00322C 6F      9238 LD	L,A
00322D 7C      9239 LD	A,H		;LENGTH ALLOCATED
00322E D9      9240 EXX
00322F BB      9241 CP	E
003230 30      9242 JR	NC,STORS1	;ENOUGH ROOM
003231 24   
003232 D9      9243 EXX
003233 65      9244 LD	H,L
003234 D9      9245 EXX
003235 E5      9246 PUSH	HL
003236 06      9247 LD	B,0
003237 00   
003238 4F      9248 LD	C,A
003239 09      9249 ADD	HL,BC
00323A ED      9250 LD	BC,(FREE)
00323B 4B   
00323C E0   
00323D 54   
00323E ED      9251 SBC	HL,BC		;IS STRING LAST?
00323F 42   
003240 E1      9252 POP	HL
003241 28      9253 JR	Z,STORS0
003242 12   
003243 60      9254 LD	H,B
003244 69      9255 LD	L,C		;DESTINATION
003245 B7      9257 OR	A		;V5 optimisation
003246 28      9258 JR	Z,STORS0
003247 0D   
003248 7B      9259 LD	A,E
003249 5F      9260 STORS2:         LD	E,A
00324A 1D      9261 DEC	E
00324B A3      9262 AND	E
00324C 20      9263 JR	NZ,STORS2
00324D FB   
00324E 37      9264 SCF
00324F CB      9265 RL	E
003250 13   
003251 7B      9266 LD	A,E
003252 D9      9267 EXX
003253 67      9268 LD	H,A
003254 D9      9269 EXX
003255 37      9271 STORS0:         SCF
003256 CD      9272 STORS1:         CALL	STORE4		;PRESERVES CARRY!
003257 EB   
003258 31   
003259 06      9273 LD	B,0
00325A 00   
00325B 4B      9274 LD	C,E
00325C EB      9275 EX	DE,HL
00325D E1      9276 POP	HL
00325E 0D      9277 DEC	C
00325F 0C      9278 INC	C
003260 C8      9279 RET	Z		;NULL STRING
003261 ED      9280 LDIR
003262 B0   
003263 D0      9281 RET	NC		;STRING REPLACED
003264 ED      9282 LD	(FREE),DE
003265 53   
003266 E0   
003267 54   
003268 E5      9283 CHECK:          PUSH	HL
003269 2A      9284 LD	HL,(FREE)
00326A E0   
00326B 54   
00326C 24      9285 INC	H
00326D ED      9286 SBC	HL,SP
00326E 72   
00326F E1      9287 POP	HL
003270 D8      9288 RET	C
003271 AF      9289 XOR	A
003272 C3      9290 JP	ERROR_		;"No room"
003273 26   
003274 3F   
003275 4B      9292 STORS3:         LD	C,E
003276 DD      9293 PUSH	IX
003277 E5   
003278 D1      9294 POP	DE
003279 AF      9295 XOR	A
00327A 47      9296 LD	B,A
00327B B9      9297 CP	C
00327C 28      9298 JR	Z,STORS5
00327D 02   
00327E ED      9299 LDIR
00327F B0   
003280 3E      9300 STORS5:         LD	A,CR
003281 0D   
003282 12      9301 LD	(DE),A
003283 C9      9302 RET
003284 DD      9306 SAVRET:         LD	(IX+0),L		;Formal VARPTR
003285 75   
003286 00   
003287 DD      9307 LD	(IX+1),H
003288 74   
003289 01   
00328A DD      9308 LD	(IX+2),A
00328B 77   
00328C 02   
00328D FD      9309 EX	(SP),IY
00328E E3   
00328F F5      9310 PUSH	AF
003290 FD      9311 PUSH	IY
003291 E5   
003292 DD      9312 PUSH	IX
003293 E5   
003294 CD      9313 CALL	NXT
003295 ED   
003296 44   
003297 CD      9314 CALL	VAR_
003298 B8   
003299 25   
00329A DD      9315 POP	IX
00329B E1   
00329C DD      9316 LD	(IX+4),L		;Actual VARPTR
00329D 75   
00329E 04   
00329F DD      9317 LD	(IX+5),H
0032A0 74   
0032A1 05   
0032A2 DD      9318 LD	(IX+6),A
0032A3 77   
0032A4 06   
0032A5 FD      9319 POP	IY
0032A6 E1   
0032A7 F1      9320 POP	AF
0032A8 01      9321 LD	BC,8
0032A9 08   
0032AA 00   
0032AB DD      9322 ADD	IX,BC
0032AC 09   
0032AD 18      9323 JR	ARGUE0
0032AE 2D   
0032AF 3E      9335 ARGUE:          LD	A,-1
0032B0 FF   
0032B1 F5      9336 PUSH	AF		;PUT MARKER ON STACK
0032B2 FD      9337 ARGUE1:         INC	IY		;BUMP PAST ( | ,
0032B3 23   
0032B4 13      9338 INC	DE
0032B5 D5      9339 PUSH	DE
0032B6 06      9340 LD	B,0
0032B7 00   
0032B8 CD      9341 CALL	NXT
0032B9 ED   
0032BA 44   
0032BB FE      9342 CP	TRETURN
0032BC F8   
0032BD 20      9343 JR	NZ,ARGUE9
0032BE 06   
0032BF FD      9344 INC	IY		;SKIP 'RETURN'
0032C0 23   
0032C1 CD      9345 CALL	NXT
0032C2 ED   
0032C3 44   
0032C4 04      9346 INC	B		;FLAG 'RETURN'
0032C5 C5      9347 ARGUE9:         PUSH	BC
0032C6 DD      9348 PUSH	IX
0032C7 E5   
0032C8 CD      9349 CALL	GETVAR		;FORMAL PARAMETER
0032C9 C5   
0032CA 41   
0032CB 38      9350 JR	C,ARGERR
0032CC 49   
0032CD C4      9351 CALL	NZ,PUTVAR
0032CE AF   
0032CF 41   
0032D0 DD      9352 POP	IX
0032D1 E1   
0032D2 C1      9353 POP	BC
0032D3 D1      9354 POP	DE
0032D4 E5      9355 PUSH	HL		;VARPTR
0032D5 F5      9356 PUSH	AF
0032D6 D5      9357 PUSH	DE
0032D7 05      9358 DEC	B
0032D8 28      9359 JR	Z,SAVRET
0032D9 AA   
0032DA FD      9360 EX	(SP),IY
0032DB E3   
0032DC CB      9361 ARGUE0:         BIT	6,A		;ARRAY?
0032DD 77   
0032DE 20      9362 JR	NZ,ARGUE3
0032DF 3B   
0032E0 B7      9363 OR	A		;TYPE
0032E1 FA      9364 JP	M,ARGUE2	;STRING
0032E2 F7   
0032E3 32   
0032E4 DD      9365 PUSH	IX
0032E5 E5   
0032E6 CD      9366 CALL	EXPRN		;ACTUAL PARAMETER
0032E7 0E   
0032E8 18   
0032E9 DD      9367 POP	IX
0032EA E1   
0032EB FD      9368 EX	(SP),IY
0032EC E3   
0032ED D1      9369 POP	DE
0032EE F1      9370 POP	AF
0032EF D9      9371 EXX
0032F0 E5      9372 PUSH	HL
0032F1 D9      9373 EXX
0032F2 E5      9374 PUSH	HL
0032F3 47      9375 LD	B,A
0032F4 C5      9376 PUSH	BC
0032F5 18      9377 JR	ARGUE4
0032F6 13   
0032F7 DD      9379 ARGUE2:         PUSH	IX
0032F8 E5   
0032F9 CD      9380 CALL	EXPRS
0032FA 1E   
0032FB 18   
0032FC D9      9381 EXX
0032FD C1      9382 POP	BC
0032FE FD      9383 EX	(SP),IY
0032FF E3   
003300 D1      9384 POP	DE
003301 D9      9385 EXX
003302 F1      9386 POP	AF
003303 CD      9387 CALL	PUSHS
003304 FB   
003305 1F   
003306 D9      9388 EXX
003307 C5      9389 PUSH	BC
003308 DD      9390 POP	IX
003309 E1   
00330A CD      9391 ARGUE4:         CALL	NXT
00330B ED   
00330C 44   
00330D FE      9392 CP	','
00330E 2C   
00330F 20      9393 JR	NZ,ARGUE5
003310 27   
003311 1A      9394 LD	A,(DE)
003312 FE      9395 CP	','
003313 2C   
003314 28      9396 JR	Z,ARGUE1	;ANOTHER
003315 9C   
003316 3E      9397 ARGERR:         LD	A,31
003317 1F   
003318 C3      9398 JP	ERROR_		;"Bad arguments"
003319 26   
00331A 3F   
00331B DD      9400 ARGUE3:         PUSH	IX
00331C E5   
00331D CD      9401 CALL	NXT
00331E ED   
00331F 44   
003320 CD      9402 CALL	GETVAR
003321 C5   
003322 41   
003323 38      9403 JR	C,ARGERR
003324 F1   
003325 DD      9404 LD	C,(IX+0)
003326 4E   
003327 00   
003328 DD      9405 LD	B,(IX+1)
003329 46   
00332A 01   
00332B DD      9406 POP	IX
00332C E1   
00332D CD      9407 CALL	NXT
00332E ED   
00332F 44   
003330 FD      9408 EX	(SP),IY
003331 E3   
003332 D1      9409 POP	DE
003333 F1      9410 POP	AF
003334 C5      9411 PUSH	BC		;STACK ARRAY POINTER
003335 F5      9412 PUSH	AF		;STACK TYPE
003336 18      9413 JR	ARGUE4
003337 D2   
003338 CD      9415 ARGUE5:         CALL	BRAKET
003339 90   
00333A 20   
00333B 1A      9416 LD	A,(DE)
00333C FE      9417 CP	')'
00333D 29   
00333E 20      9418 JR	NZ,ARGERR
00333F D6   
003340 13      9419 INC	DE
003341 D9      9420 UNSTAK:         EXX
003342 C1      9421 ARGUE6:         POP	BC
003343 78      9422 LD	A,B
003344 3C      9423 INC	A
003345 D9      9424 EXX
003346 C8      9425 RET	Z		;MARKER POPPED
003347 D9      9426 EXX
003348 3D      9427 DEC	A
003349 CB      9428 BIT	6,A		;ARRAY
00334A 77   
00334B 20      9429 JR	NZ,ARGUE8
00334C 19   
00334D B7      9430 OR	A
00334E FA      9431 JP	M,ARGUE7	;STRING
00334F 5C   
003350 33   
003351 E1      9432 POP	HL
003352 D9      9433 EXX
003353 E1      9434 POP	HL
003354 D9      9435 EXX
003355 DD      9436 POP	IX
003356 E1   
003357 CD      9437 CALL	STOREN		;WRITE TO DUMMY
003358 D2   
003359 31   
00335A 18      9438 JR	ARGUE6
00335B E6   
00335C CD      9440 ARGUE7:         CALL	POPS
00335D 19   
00335E 20   
00335F DD      9441 POP	IX
003360 E1   
003361 CD      9442 CALL	STACCS
003362 20   
003363 32   
003364 18      9443 JR	ARGUE6
003365 DC   
003366 C1      9445 ARGUE8:         POP	BC		;ARRAY POINTER
003367 DD      9446 POP	IX
003368 E1   
003369 DD      9447 LD	(IX+0),C
00336A 71   
00336B 00   
00336C DD      9448 LD	(IX+1),B
00336D 70   
00336E 01   
00336F 18      9449 JR	ARGUE6
003370 D1   
003371 3E      9454 RETXFR:         LD	A,-1
003372 FF   
003373 F5      9455 PUSH	AF		;PUT MARKER ON STACK
003374 D9      9456 RETXF1:         EXX
003375 DD      9457 LD	L,(IX+4)	;Actual parameter (destination)
003376 6E   
003377 04   
003378 DD      9458 LD	H,(IX+5)
003379 66   
00337A 05   
00337B E5      9459 PUSH	HL		;STACK VARPTR
00337C DD      9460 LD	L,(IX+0)	;Formal parameter (source)
00337D 6E   
00337E 00   
00337F DD      9461 LD	H,(IX+1)
003380 66   
003381 01   
003382 DD      9462 LD	A,(IX+2)
003383 7E   
003384 02   
003385 CB      9463 BIT	6,A		;ARRAY?
003386 77   
003387 20      9464 JR	NZ,RETXF3
003388 19   
003389 B7      9465 OR	A		;TYPE
00338A FA      9466 JP	M,RETXF2	;STRING
00338B A8   
00338C 33   
00338D E5      9467 PUSH	HL
00338E DD      9468 EX	(SP),IX
00338F E3   
003390 CD      9469 CALL	LOADN
003391 07   
003392 19   
003393 DD      9470 POP	IX
003394 E1   
003395 D9      9471 EXX			;STACK VALUE
003396 E5      9472 PUSH	HL
003397 D9      9473 EXX
003398 E5      9474 PUSH	HL
003399 DD      9475 RETXF6:         LD	B,(IX+6)
00339A 46   
00339B 06   
00339C C5      9476 PUSH	BC		;TYPE & EXPONENT
00339D CD      9477 RETXF5:         CALL	CHECK		;CHECK ROOM
00339E 68   
00339F 32   
0033A0 18      9478 JR	RETXF4
0033A1 1E   
0033A2 5E      9480 RETXF3:         LD	E,(HL)
0033A3 23      9481 INC	HL
0033A4 56      9482 LD	D,(HL)
0033A5 D5      9483 PUSH	DE		;STACK ARRAY POINTER
0033A6 18      9484 JR	RETXF6
0033A7 F1   
0033A8 E5      9486 RETXF2:         PUSH	HL
0033A9 DD      9487 EX	(SP),IX
0033AA E3   
0033AB CD      9488 CALL	LOADS
0033AC F0   
0033AD 19   
0033AE DD      9489 POP	IX
0033AF E1   
0033B0 DD      9490 LD	A,(IX+6)
0033B1 7E   
0033B2 06   
0033B3 D9      9491 EXX
0033B4 DD      9492 PUSH	IX
0033B5 E5   
0033B6 E1      9493 POP	HL
0033B7 D9      9494 EXX
0033B8 CD      9495 CALL	PUSHS
0033B9 FB   
0033BA 1F   
0033BB D9      9496 EXX
0033BC E5      9497 PUSH	HL
0033BD DD      9498 POP	IX
0033BE E1   
0033BF D9      9499 EXX
0033C0 11      9500 RETXF4:         LD	DE,8
0033C1 08   
0033C2 00   
0033C3 DD      9501 ADD	IX,DE
0033C4 19   
0033C5 D9      9502 EXX
0033C6 10      9503 DJNZ	RETXF1
0033C7 AC   
0033C8 C3      9504 JP	UNSTAK
0033C9 41   
0033CA 33   
0033CB C1      9508 RESRET:         POP	BC		;B = 'RETURN' COUNT
0033CC 26      9509 LD	H,0
0033CD 00   
0033CE 68      9510 LD	L,B
0033CF 29      9511 ADD	HL,HL
0033D0 29      9512 ADD	HL,HL
0033D1 29      9513 ADD	HL,HL		;RETURN COUNT * 8
0033D2 39      9514 ADD	HL,SP
0033D3 DD      9515 LD	IX,0
0033D4 21   
0033D5 00   
0033D6 00   
0033D7 DD      9516 ADD	IX,SP		;ADDRESS PARAMETER LIST
0033D8 39   
0033D9 F5      9517 PUSH	AF
0033DA D5      9518 PUSH	DE
0033DB E5      9519 PUSH	HL
0033DC D9      9520 EXX
0033DD C5      9521 PUSH	BC
0033DE D5      9522 PUSH	DE
0033DF D9      9523 EXX
0033E0 78      9524 LD	A,B
0033E1 21      9525 LD	HL,ACCS
0033E2 00   
0033E3 52   
0033E4 11      9526 LD	DE,BUFFER
0033E5 00   
0033E6 53   
0033E7 01      9527 LD	BC,255
0033E8 FF   
0033E9 00   
0033EA ED      9528 LDIR
0033EB B0   
0033EC 47      9529 LD	B,A
0033ED CD      9530 CALL	RETXFR		;TRANSFER VIA STACK
0033EE 71   
0033EF 33   
0033F0 21      9531 LD	HL,BUFFER
0033F1 00   
0033F2 53   
0033F3 11      9532 LD	DE,ACCS
0033F4 00   
0033F5 52   
0033F6 01      9533 LD	BC,255
0033F7 FF   
0033F8 00   
0033F9 ED      9534 LDIR
0033FA B0   
0033FB D9      9535 EXX
0033FC D1      9536 POP	DE
0033FD C1      9537 POP	BC
0033FE D9      9538 EXX
0033FF E1      9539 POP	HL
003400 D1      9540 POP	DE
003401 F1      9541 POP	AF
003402 18      9542 JR	RESAR1
003403 0A   
003404 C1      9546 RESARR:         POP	BC
003405 CB      9547 BIT	7,B		;String array?
003406 78   
003407 E1      9548 POP	HL
003408 C1      9549 POP	BC
003409 09      9550 ADD	HL,BC
00340A 39      9551 ADD	HL,SP
00340B C4      9552 CALL	NZ,FREESA	;Free string array
00340C C5   
00340D 36   
00340E F9      9553 RESAR1:         LD	SP,HL
00340F DD      9554 INC	IX		;Flag something restored
003410 23   
003411 18      9555 JR	RESLO1
003412 05   
003413 D1      9562 RESLOC:         POP	DE		;Return address
003414 DD      9563 LD	IX,0		;To flag nothing was restored
003415 21   
003416 00   
003417 00   
003418 C1      9564 RESLO1:         POP	BC		;Marker ?
003419 21      9565 LD	HL,LOCCHK
00341A 0C   
00341B 35   
00341C B7      9566 OR	A
00341D ED      9567 SBC	HL,BC
00341E 42   
00341F 28      9568 JR	Z,RESLO2	;Something to restore
003420 1A   
003421 B7      9569 OR	A
003422 20      9570 JR	NZ,RESLO8
003423 0F   
003424 21      9571 LD	HL,RETCHK
003425 52   
003426 2A   
003427 ED      9572 SBC	HL,BC
003428 42   
003429 28      9573 JR	Z,RESRET
00342A A0   
00342B 21      9574 LD	HL,ARRCHK
00342C BE   
00342D 26   
00342E B7      9575 OR	A
00342F ED      9576 SBC	HL,BC
003430 42   
003431 28      9577 JR	Z,RESARR
003432 D1   
003433 DD      9578 RESLO8:         PUSH	IX
003434 E5   
003435 E1      9579 POP	HL
003436 7C      9580 LD	A,H
003437 B5      9581 OR	L
003438 C5      9582 RESLO0:         PUSH	BC		;Put back marker
003439 EB      9583 EX	DE,HL
00343A E9      9584 JP	(HL)		;Return
00343B DD      9586 RESLO2:         POP	IX		;Variable pointer
00343C E1   
00343D B7      9587 OR	A
00343E 28      9588 JR	Z,RESLO3	;Everything allowed
00343F 20   
003440 DD      9589 PUSH	IX
003441 E5   
003442 C1      9590 POP	BC
003443 CB      9591 BIT	0,A
003444 47   
003445 28      9592 JR	Z,RESLO6	;Bit 0 set, so
003446 07   
003447 21      9593 LD	HL,DATPTR	;test for DATPTR
003448 F0   
003449 54   
00344A ED      9594 SBC	HL,BC
00344B 42   
00344C 28      9595 JR	Z,RESLO3
00344D 12   
00344E B7      9596 RESLO6:         OR	A
00344F CB      9597 BIT	1,A
003450 4F   
003451 28      9598 JR	Z,RESLO7	;Bit 1 set, so
003452 07   
003453 21      9599 LD	HL,ERRTRP	;test for ERRPTR
003454 EA   
003455 54   
003456 ED      9600 SBC	HL,BC
003457 42   
003458 28      9601 JR	Z,RESLO3
003459 06   
00345A C5      9602 RESLO7:         PUSH	BC		;Put back pointer
00345B 01      9603 LD	BC,LOCCHK
00345C 0C   
00345D 35   
00345E 18      9604 JR	RESLO0
00345F D8   
003460 C1      9606 RESLO3:         POP	BC		;Type / exponent
003461 CB      9607 BIT	6,B
003462 70   
003463 20      9608 JR	NZ,RESLO4	;Array?
003464 14   
003465 CB      9609 BIT	7,B
003466 78   
003467 20      9610 JR	NZ,RESLO5	;String?
003468 23   
003469 E1      9611 POP	HL
00346A D9      9612 EXX
00346B E1      9613 POP	HL
00346C D9      9614 EXX
00346D CB      9615 BIT	4,B
00346E 60   
00346F 20      9616 JR	NZ,RESLO1
003470 A7   
003471 F5      9617 PUSH	AF
003472 78      9618 LD	A,B
003473 CD      9619 CALL	STOREN		;Numeric
003474 D2   
003475 31   
003476 F1      9620 POP	AF
003477 18      9621 JR	RESLO1
003478 9F   
003479 E1      9623 RESLO4:         POP	HL
00347A CB      9624 BIT	4,B
00347B 60   
00347C 20      9625 JR	NZ,RESLO1
00347D 9A   
00347E DD      9626 LD	(IX+0),L	;Array
00347F 75   
003480 00   
003481 DD      9627 LD	(IX+1),H
003482 74   
003483 01   
003484 18      9628 JR	RESLO1
003485 92   
003486 06      9630 RESLO9:         LD	B,0
003487 00   
003488 09      9631 ADD	HL,BC
003489 F9      9632 LD	SP,HL
00348A 18      9633 RESLGO:         JR	RESLO1
00348B 8C   
00348C 21      9635 RESLO5:         LD	HL,0
00348D 00   
00348E 00   
00348F 39      9636 ADD	HL,SP
003490 CB      9637 BIT	4,B
003491 60   
003492 20      9638 JR	NZ,RESLO9
003493 F2   
003494 F5      9639 PUSH	AF
003495 D5      9640 PUSH	DE
003496 59      9641 LD	E,C
003497 78      9642 LD	A,B
003498 CD      9643 CALL	STORES		;String
003499 23   
00349A 32   
00349B D1      9644 POP	DE
00349C F1      9645 POP	AF
00349D F9      9646 LD	SP,HL
00349E 18      9647 JR	RESLGO
00349F EA   
0034A0 D1      9657 SAVLOC:         POP	DE		;RETURN ADDRESS
0034A1 FD      9658 SAVLO1:         INC	IY		;BUMP PAST ( | ,
0034A2 23   
0034A3 CD      9659 CALL	NXT
0034A4 ED   
0034A5 44   
0034A6 FE      9660 CP	TRETURN
0034A7 F8   
0034A8 20      9661 JR	NZ,SAVLO6
0034A9 08   
0034AA 08      9662 EX	AF,AF'
0034AB 3C      9663 INC	A		;RETURN counter
0034AC 08      9664 EX	AF,AF'
0034AD FD      9665 INC	IY		;Bump past RETURN
0034AE 23   
0034AF CD      9666 CALL	NXT
0034B0 ED   
0034B1 44   
0034B2 D5      9667 SAVLO6:         PUSH	DE
0034B3 D9      9668 EXX
0034B4 C5      9669 PUSH	BC
0034B5 D5      9670 PUSH	DE
0034B6 E5      9671 PUSH	HL
0034B7 D9      9672 EXX
0034B8 CD      9673 CALL	VAR_		;DUMMY VARIABLE
0034B9 B8   
0034BA 25   
0034BB D9      9674 EXX
0034BC E1      9675 POP	HL
0034BD D1      9676 POP	DE
0034BE C1      9677 POP	BC
0034BF D9      9678 EXX
0034C0 D1      9679 POP	DE
0034C1 CB      9680 BIT	6,A		;ARRAY?
0034C2 77   
0034C3 20      9681 JR	NZ,SAVLO3
0034C4 12   
0034C5 B7      9682 OR	A		;TYPE
0034C6 FA      9683 JP	M,SAVLO2	;STRING
0034C7 E1   
0034C8 34   
0034C9 D9      9684 EXX
0034CA E5      9685 PUSH	HL		;SAVE H'L'
0034CB D9      9686 EXX
0034CC 47      9687 LD	B,A		;TYPE
0034CD CD      9688 CALL	LOADN
0034CE 07   
0034CF 19   
0034D0 D9      9689 EXX
0034D1 E3      9690 EX	(SP),HL
0034D2 D9      9691 EXX
0034D3 E5      9692 PUSH	HL
0034D4 C5      9693 PUSH	BC
0034D5 18      9694 JR	SAVLO4
0034D6 30   
0034D7 DD      9696 SAVLO3:         LD	C,(IX+0)	;ARRAY POINTER
0034D8 4E   
0034D9 00   
0034DA DD      9697 LD	B,(IX+1)
0034DB 46   
0034DC 01   
0034DD C5      9698 PUSH	BC		;SAVE TO STACK
0034DE F5      9699 PUSH	AF		;SAVE TYPE
0034DF 18      9700 JR	SAVLO4
0034E0 26   
0034E1 F5      9702 SAVLO2:         PUSH	AF		;STRING TYPE
0034E2 D5      9703 PUSH	DE
0034E3 D9      9704 EXX
0034E4 E5      9705 PUSH	HL
0034E5 D9      9706 EXX
0034E6 CD      9707 CALL	LOADS
0034E7 F0   
0034E8 19   
0034E9 D9      9708 EXX
0034EA E1      9709 POP	HL
0034EB D9      9710 EXX
0034EC 4B      9711 LD	C,E
0034ED D1      9712 POP	DE
0034EE CD      9713 CALL	CHECK
0034EF 68   
0034F0 32   
0034F1 F1      9714 POP	AF		;LEVEL STACK
0034F2 21      9715 LD	HL,0
0034F3 00   
0034F4 00   
0034F5 45      9716 LD	B,L
0034F6 ED      9717 SBC	HL,BC
0034F7 42   
0034F8 39      9718 ADD	HL,SP
0034F9 F9      9719 LD	SP,HL
0034FA 47      9720 LD	B,A		;TYPE
0034FB C5      9721 PUSH	BC
0034FC 28      9722 JR	Z,SAVLO4
0034FD 09   
0034FE D5      9723 PUSH	DE
0034FF 11      9724 LD	DE,ACCS
003500 00   
003501 52   
003502 EB      9725 EX	DE,HL
003503 45      9726 LD	B,L
003504 ED      9727 LDIR			;SAVE STRING ON STACK
003505 B0   
003506 D1      9728 POP	DE
003507 DD      9729 SAVLO4:         PUSH	IX		;VARPTR
003508 E5   
003509 CD      9730 CALL	SAVLO5
00350A 0C   
00350B 35   
00350C CD      9732 SAVLO5:         CALL	CHECK
00350D 68   
00350E 32   
00350F CD      9733 CALL	NXT
003510 ED   
003511 44   
003512 FE      9734 CP	','		;MORE?
003513 2C   
003514 28      9735 JR	Z,SAVLO1
003515 8B   
003516 EB      9736 EX	DE,HL
003517 E9      9737 JP	(HL)		;"RETURN"
003518 CD      9739 TERMQ:          CALL	NXT
003519 ED   
00351A 44   
00351B FE      9740 CP	TELSE
00351C 8B   
00351D D0      9741 RET	NC
00351E FE      9742 CP	':'		;ASSEMBLER SEPARATOR
00351F 3A   
003520 D0      9743 RET	NC
003521 FE      9744 CP	CR
003522 0D   
003523 C9      9745 RET
003524 CD      9747 SPAN:           CALL	TERMQ
003525 18   
003526 35   
003527 C8      9748 RET	Z
003528 FD      9749 INC	IY
003529 23   
00352A FE      9750 CP	'"'
00352B 22   
00352C CC      9751 CALL	Z,QUOTE
00352D 7B   
00352E 36   
00352F 18      9752 JR	SPAN
003530 F3   
003531 CD      9754 EQUALS:         CALL	NXT
003532 ED   
003533 44   
003534 FD      9755 INC	IY
003535 23   
003536 FE      9756 CP	'='
003537 3D   
003538 C8      9757 RET	Z
003539 3E      9758 LD	A,4
00353A 04   
00353B C3      9759 JP	ERROR_		;"Mistake"
00353C 26   
00353D 3F   
00353E FE      9761 FORMAT:         CP	TTAB
00353F 8A   
003540 28      9762 JR	Z,DOTAB
003541 0C   
003542 FE      9763 CP	TSPC
003543 89   
003544 28      9764 JR	Z,DOSPC
003545 38   
003546 FE      9766 CP	39	; apostrophe
003547 27   
003548 C0      9767 RET	NZ
003549 CD      9768 CALL	CRLF
00354A DD   
00354B 40   
00354C AF      9769 XOR	A
00354D C9      9770 RET
00354E C5      9772 DOTAB:          PUSH	BC
00354F CD      9773 CALL	EXPRI
003550 15   
003551 18   
003552 D9      9774 EXX
003553 C1      9775 POP	BC
003554 FD      9776 LD	A,(IY)
003555 7E   
003556 00   
003557 FE      9777 CP	','
003558 2C   
003559 28      9778 JR	Z,DOTAB1
00355A 11   
00355B CD      9779 CALL	BRAKET
00355C 90   
00355D 20   
00355E 7D      9780 LD	A,L
00355F 21      9781 TABIT:          LD	HL,COUNT
003560 FB   
003561 54   
003562 BE      9782 CP	(HL)
003563 C8      9783 RET	Z
003564 F5      9784 PUSH	AF
003565 DC      9785 CALL	C,CRLF
003566 DD   
003567 40   
003568 F1      9786 POP	AF
003569 96      9787 SUB	(HL)
00356A 18      9788 JR	SPACES
00356B 19   
00356C FD      9789 DOTAB1:         INC	IY
00356D 23   
00356E C5      9790 PUSH	BC
00356F E5      9791 PUSH	HL
003570 CD      9792 CALL	EXPRI
003571 15   
003572 18   
003573 D9      9793 EXX
003574 D1      9794 POP	DE
003575 C1      9795 POP	BC
003576 CD      9796 CALL	BRAKET
003577 90   
003578 20   
003579 CD      9797 CALL	PUTCSR
00357A 7E   
00357B 0D   
00357C AF      9798 XOR	A
00357D C9      9799 RET
00357E C5      9801 DOSPC:          PUSH	BC
00357F CD      9802 CALL	ITEMI
003580 42   
003581 18   
003582 D9      9803 EXX
003583 7D      9804 LD	A,L
003584 C1      9805 POP	BC
003585 B7      9806 SPACES:         OR	A
003586 C8      9807 RET	Z
003587 C5      9808 PUSH	BC
003588 47      9809 LD	B,A
003589 3E      9810 FILL1:          LD	A,' '
00358A 20   
00358B CD      9811 CALL	OUTCHR
00358C E4   
00358D 40   
00358E 10      9812 DJNZ	FILL1
00358F F9   
003590 C1      9813 POP	BC
003591 AF      9814 XOR	A
003592 C9      9815 RET
003593 21      9817 PTEXT:          LD	HL,ACCS
003594 00   
003595 52   
003596 1C      9818 INC	E
003597 1D      9819 PTEXT1:         DEC	E
003598 C8      9820 RET	Z
003599 7E      9821 LD	A,(HL)
00359A 23      9822 INC	HL
00359B CD      9823 CALL	OUTCHR
00359C E4   
00359D 40   
00359E 18      9824 JR	PTEXT1
00359F F7   
0035A0 F5      9826 FETCHS:         PUSH	AF
0035A1 C5      9827 PUSH	BC
0035A2 E5      9828 PUSH	HL
0035A3 FD      9829 EX	(SP),IY
0035A4 E3   
0035A5 CD      9830 CALL	XTRACT
0035A6 BD   
0035A7 35   
0035A8 CD      9831 CALL	NXT
0035A9 ED   
0035AA 44   
0035AB FD      9832 EX	(SP),IY
0035AC E3   
0035AD E1      9833 POP	HL
0035AE C1      9834 POP	BC
0035AF F1      9835 POP	AF
0035B0 C9      9836 RET
0035B1 11      9838 LINES:          LD	DE,ACCS
0035B2 00   
0035B3 52   
0035B4 7E      9839 LINE1S:         LD	A,(HL)
0035B5 12      9840 LD	(DE),A
0035B6 FE      9841 CP	CR
0035B7 0D   
0035B8 C8      9842 RET	Z
0035B9 23      9843 INC	HL
0035BA 1C      9844 INC	E
0035BB 18      9845 JR	LINE1S
0035BC F7   
0035BD CD      9847 XTRACT:         CALL	NXT
0035BE ED   
0035BF 44   
0035C0 FE      9848 CP	'"'
0035C1 22   
0035C2 FD      9849 INC	IY
0035C3 23   
0035C4 CA      9850 JP	Z,CONS
0035C5 5C   
0035C6 19   
0035C7 FD      9851 DEC	IY
0035C8 2B   
0035C9 11      9852 LD	DE,ACCS
0035CA 00   
0035CB 52   
0035CC FD      9853 XTRAC1:         LD	A,(IY)
0035CD 7E   
0035CE 00   
0035CF 12      9854 LD	(DE),A
0035D0 FE      9855 CP	','
0035D1 2C   
0035D2 C8      9856 RET	Z
0035D3 FE      9857 CP	CR
0035D4 0D   
0035D5 C8      9858 RET	Z
0035D6 FD      9859 INC	IY
0035D7 23   
0035D8 1C      9860 INC	E
0035D9 18      9861 JR	XTRAC1
0035DA F1   
0035DB 3E      9863 DSRCH:          LD	A,TDATA
0035DC DC   
0035DD 06      9864 SEARCHex:         LD	B,0
0035DE 00   
0035DF 4E      9865 SRCH1:          LD	C,(HL)
0035E0 0C      9866 INC	C
0035E1 0D      9867 DEC	C
0035E2 28      9868 JR	Z,SRCH2		;FAIL
0035E3 0C   
0035E4 23      9869 INC	HL
0035E5 23      9870 INC	HL
0035E6 23      9871 INC	HL
0035E7 BE      9872 CP	(HL)
0035E8 C8      9873 RET	Z
0035E9 0D      9874 DEC	C
0035EA 0D      9875 DEC	C
0035EB 0D      9876 DEC	C
0035EC 09      9877 ADD	HL,BC
0035ED C3      9878 JP	SRCH1
0035EE DF   
0035EF 35   
0035F0 2B      9879 SRCH2:          DEC	HL		;POINT TO CR
0035F1 37      9880 SCF
0035F2 C9      9881 RET
0035F3 2E      9895 NSCAN:          LD	L,0		;nest level
0035F4 00   
0035F5 FD      9896 NSCAN1:         LD	A,(IY)		;get line length
0035F6 7E   
0035F7 00   
0035F8 B7      9897 OR	A		;test zero = end of prog
0035F9 28      9898 JR	Z,NSCAN6
0035FA 34   
0035FB FD      9899 LD	A,(IY+3)	;initial token
0035FC 7E   
0035FD 03   
0035FE B8      9900 CP	B		;test value reqd
0035FF 28      9901 JR	Z,NSCAN3	;found (1)
003600 1D   
003601 B9      9902 CP	C
003602 28      9903 JR	Z,NSCAN3	;found (2)
003603 1A   
003604 BA      9904 NSCAN7:         CP	D		;unnest?
003605 28      9905 JR	Z,NSCAN5
003606 22   
003607 C5      9906 NSCAN2:         PUSH	BC
003608 06      9907 LD	B,0
003609 00   
00360A FD      9908 LD	C,(IY)
00360B 4E   
00360C 00   
00360D FD      9909 ADD	IY,BC		;go to next line
00360E 09   
00360F FD      9910 LD	A,(IY-2)
003610 7E   
003611 FE   
003612 BB      9911 CP	E		;nest?
003613 79      9912 LD	A,C
003614 C1      9913 POP	BC
003615 20      9914 JR	NZ,NSCAN1	;continue
003616 DE   
003617 FE      9915 CP	5		;empty line ?
003618 05   
003619 38      9916 JR	C,NSCAN1	;continue
00361A DA   
00361B 2C      9917 INC	L		;increment nest level
00361C 18      9918 JR	NSCAN1		;continue
00361D D7   
00361E 2C      9920 NSCAN3:         INC	L
00361F 2D      9921 DEC	L
003620 20      9922 JR	NZ,NSCAN7
003621 E2   
003622 01      9923 NSCAN4:         LD	BC,4
003623 04   
003624 00   
003625 FD      9924 ADD	IY,BC
003626 09   
003627 AF      9925 XOR	A		;Z
003628 C9      9926 RET
003629 2D      9928 NSCAN5:         DEC	L		;decrement nest level
00362A F2      9929 JP	P,NSCAN2
00362B 07   
00362C 36   
00362D 18      9930 JR	NSCAN4
00362E F3   
00362F F6      9932 NSCAN6:         OR	1		;NZ
003630 01   
003631 C9      9933 RET
003632 FD      9945 WSRCH:          LD	A,(IY)
003633 7E   
003634 00   
003635 FD      9946 INC	IY
003636 23   
003637 FE      9947 CP	'"'
003638 22   
003639 CC      9948 CALL	Z,QUOTE
00363A 7B   
00363B 36   
00363C FE      9949 CP	TREM
00363D F4   
00363E 28      9950 JR	Z,WSRCHM
00363F 22   
003640 FE      9951 CP	TEXIT
003641 10   
003642 28      9952 JR	Z,WSRCHE
003643 30   
003644 B8      9953 CP	B
003645 28      9954 JR	Z,WSRCHX
003646 29   
003647 B9      9955 CP	C
003648 28      9956 JR	Z,WSRCHP
003649 23   
00364A FE      9957 CP	CR
00364B 0D   
00364C 20      9958 JR	NZ,WSRCH
00364D E4   
00364E FD      9959 WSRCH1:         LD	A,(IY)			;Line length
00364F 7E   
003650 00   
003651 FD      9960 INC	IY
003652 23   
003653 B7      9961 OR	A
003654 CA      9962 JP	Z,END
003655 B5   
003656 24   
003657 FD      9963 INC	IY
003658 23   
003659 FD      9964 INC	IY			;Skip line number
00365A 23   
00365B FD      9965 LD	A,(IY)
00365C 7E   
00365D 00   
00365E FE      9966 CP	TDATA
00365F DC   
003660 20      9967 JR	NZ,WSRCH
003661 D0   
003662 FD      9968 WSRCHM:         LD	A,(IY)
003663 7E   
003664 00   
003665 FD      9969 INC	IY
003666 23   
003667 FE      9970 CP	CR
003668 0D   
003669 20      9971 JR	NZ,WSRCHM		;Skip to end of line
00366A F7   
00366B 18      9972 JR	WSRCH1
00366C E1   
00366D 14      9974 WSRCHP:         INC	D
00366E 18      9975 JR	WSRCH
00366F C2   
003670 15      9977 WSRCHX:         DEC	D
003671 20      9978 JR	NZ,WSRCH
003672 BF   
003673 C9      9979 RET
003674 CD      9981 WSRCHE:         CALL	NXT
003675 ED   
003676 44   
003677 FD      9982 INC	IY
003678 23   
003679 18      9983 JR	WSRCH
00367A B7   
00367B FD      9987 QUOTE:          LD	A,(IY)
00367C 7E   
00367D 00   
00367E FD      9988 INC	IY
00367F 23   
003680 FE      9989 CP	CR
003681 0D   
003682 CA      9990 JP	Z,MISQUO
003683 8A   
003684 36   
003685 FE      9991 CP	'"'
003686 22   
003687 20      9992 JR	NZ,QUOTE
003688 F2   
003689 C9      9993 RET
00368A 3E      9995 MISQUO:         LD	A,9
00368B 09   
00368C C3      9996 JP	ERROR_		;"Missing quote"
00368D 26   
00368E 3F   
00368F 62     10005 X14OR5:         LD	H,D
003690 6B     10006 LD	L,E
003691 FE     10007 CP	1
003692 01   
003693 C8     10008 RET	Z
003694 FE     10009 CP	5
003695 05   
003696 29     10010 ADD	HL,HL
003697 D8     10011 RET	C
003698 29     10012 ADD	HL,HL
003699 D8     10013 RET	C
00369A EB     10014 EX	DE,HL
00369B C0     10015 RET	NZ
00369C 19     10016 ADD	HL,DE
00369D EB     10017 EX	DE,HL
00369E C9     10018 RET
00369F EB     10027 MUL16:          EX	DE,HL
0036A0 21     10028 LD	HL,0
0036A1 00   
0036A2 00   
0036A3 3E     10029 LD	A,16
0036A4 10   
0036A5 29     10030 MUL161:         ADD	HL,HL
0036A6 D8     10031 RET	C		;OVERFLOW
0036A7 CB     10032 SLA	E
0036A8 23   
0036A9 CB     10033 RL	D
0036AA 12   
0036AB 30     10034 JR	NC,MUL162
0036AC 02   
0036AD 09     10035 ADD	HL,BC
0036AE D8     10036 RET	C
0036AF 3D     10037 MUL162:         DEC	A
0036B0 20     10038 JR	NZ,MUL161
0036B1 F3   
0036B2 C9     10039 RET
0036B3 CD     10041 CHANEL:         CALL	NXT
0036B4 ED   
0036B5 44   
0036B6 FE     10042 CP	'#'
0036B7 23   
0036B8 3E     10043 LD	A,45
0036B9 2D   
0036BA C2     10044 JP	NZ,ERROR_	;"Missing #"
0036BB 26   
0036BC 3F   
0036BD FD     10045 CHNL:           INC	IY		;SKIP '#'
0036BE 23   
0036BF CD     10046 CALL	ITEMI
0036C0 42   
0036C1 18   
0036C2 D9     10047 EXX
0036C3 EB     10048 EX	DE,HL
0036C4 C9     10049 RET
0036C5 F5     10057 FREESA:         PUSH	AF
0036C6 C5     10058 FREES0:         PUSH	BC
0036C7 D5     10059 PUSH	DE
0036C8 E5     10060 PUSH	HL
0036C9 AF     10061 XOR	A
0036CA 50     10062 LD	D,B
0036CB 59     10063 LD	E,C
0036CC 47     10064 LD	B,A
0036CD D5     10065 FREES1:         PUSH	DE
0036CE 2B     10066 DEC	HL
0036CF 56     10067 LD	D,(HL)
0036D0 2B     10068 DEC	HL
0036D1 5E     10069 LD	E,(HL)
0036D2 2B     10070 DEC	HL
0036D3 4E     10071 LD	C,(HL)
0036D4 2B     10072 DEC	HL
0036D5 E5     10073 PUSH	HL
0036D6 2A     10074 LD	HL,(FREE)
0036D7 E0   
0036D8 54   
0036D9 EB     10075 EX	DE,HL
0036DA 09     10076 ADD	HL,BC
0036DB ED     10077 SBC	HL,DE
0036DC 52   
0036DD 20     10078 JR	NZ,FREES2
0036DE 07   
0036DF 19     10079 ADD	HL,DE
0036E0 ED     10080 SBC	HL,BC
0036E1 42   
0036E2 22     10081 LD	(FREE),HL
0036E3 E0   
0036E4 54   
0036E5 B4     10082 OR	H
0036E6 D1     10083 FREES2:         POP	DE
0036E7 E1     10084 POP	HL
0036E8 0E     10085 LD	C,4
0036E9 04   
0036EA B7     10086 OR	A
0036EB ED     10087 SBC	HL,BC
0036EC 42   
0036ED EB     10088 EX	DE,HL
0036EE 20     10089 JR	NZ,FREES1
0036EF DD   
0036F0 B7     10090 OR	A
0036F1 E1     10091 POP	HL
0036F2 D1     10092 POP	DE
0036F3 C1     10093 POP	BC
0036F4 B7     10094 OR	A
0036F5 20     10095 JR	NZ,FREES0
0036F6 CF   
0036F7 F1     10096 POP	AF
0036F8 C9     10097 RET
0036F9             10102   ; --- Begin main.asm ---
0036F9 C3     10260 START:          JP	COLD
0036FA 23   
0036FB 37   
0036FC C3     10261 JP	WARM
0036FD 91   
0036FE 37   
0036FF C3     10262 JP	ESCAPE
003700 C5   
003701 25   
003702 C3     10263 JP	EXTERR
003703 37   
003704 3F   
003705 C3     10264 JP	TELL
003706 DC   
003707 44   
003708 C3     10265 JP	TEXT_
003709 CA   
00370A 44   
00370B C3     10266 JP	ITEMI
00370C 42   
00370D 18   
00370E C3     10267 JP	EXPRI
00370F 15   
003710 18   
003711 C3     10268 JP	EXPRS
003712 1E   
003713 18   
003714 C3     10269 JP	OSCLI
003715 95   
003716 09   
003717 C3     10270 JP	OSBGET
003718 3D   
003719 06   
00371A C3     10271 JP	OSBPUT
00371B 45   
00371C 06   
00371D C3     10272 JP	OSSTAT
00371E 4E   
00371F 06   
003720 C3     10273 JP	OSSHUT
003721 35   
003722 06   
003723 21     10274 COLD:           LD	HL,STAVAR	;COLD START
003724 00   
003725 54   
003726 F9     10275 LD	SP,HL
003727 36     10276 LD	(HL),10
003728 0A   
003729 2C     10277 INC	L
00372A 36     10278 LD	(HL),9
00372B 09   
00372C 2C     10279 INC	L
00372D AF     10280 XOR	A
00372E 77     10281 PURGE:          LD	(HL),A		;CLEAR SCRATCHPAD
00372F 2C     10282 INC	L
003730 20     10283 JR	NZ,PURGE
003731 FC   
003732 3E     10284 LD	A,37H		;V3.0
003733 37   
003734 32     10285 LD	(LISTON),A
003735 FE   
003736 54   
003737 21     10286 LD	HL,NOTICE
003738 70   
003739 37   
00373A 22     10287 LD	(ERRTXT),HL
00373B EE   
00373C 54   
00373D CD     10288 CALL	OSINIT
00373E 82   
00373F 05   
003740 ED     10289 LD	(HIMEM),DE
003741 53   
003742 E2   
003743 54   
003744 22     10290 LD	(PAGE_),HL
003745 DC   
003746 54   
003747 CD     10291 CALL	NEWIT
003748 20   
003749 40   
00374A C2     10292 JP	NZ,CHAIN0	;AUTO-RUN
00374B 34   
00374C 24   
00374D CD     10293 CALL	TELL
00374E DC   
00374F 44   
003750 42     10294 VERMSG:         DB	"BBC BASIC (Z80) Version 5.00  "
003751 42   
003752 43   
003753 20   
003754 42   
003755 41   
003756 53   
003757 49   
003758 43   
003759 20   
00375A 28   
00375B 5A   
00375C 38   
00375D 30   
00375E 29   
00375F 20   
003760 56   
003761 65   
003762 72   
003763 73   
003764 69   
003765 6F   
003766 6E   
003767 20   
003768 35   
003769 2E   
00376A 30   
00376B 30   
00376C 20   
00376D 20   
00376E 0D     10295 DB	CR
00376F 0A     10296 DB	LF
003770 28     10297 NOTICE:         DB	"(C) Copyright R.T.Russell 2024"
003771 43   
003772 29   
003773 20   
003774 43   
003775 6F   
003776 70   
003777 79   
003778 72   
003779 69   
00377A 67   
00377B 68   
00377C 74   
00377D 20   
00377E 52   
00377F 2E   
003780 54   
003781 2E   
003782 52   
003783 75   
003784 73   
003785 73   
003786 65   
003787 6C   
003788 6C   
003789 20   
00378A 32   
00378B 30   
00378C 32   
00378D 34   
00378E 0D     10298 DB	CR
00378F 0A     10299 DB	LF
003790 00     10300 DB	0
003791 F6     10301 WARM:           DB	0F6H
003792 37     10302 CLOOP:          SCF
003793 ED     10303 LD	SP,(HIMEM)
003794 7B   
003795 E2   
003796 54   
003797 CD     10304 CALL	PROMPT		;PROMPT USER
003798 91   
003799 05   
00379A 21     10305 LD	HL,LISTON
00379B FE   
00379C 54   
00379D 7E     10306 LD	A,(HL)
00379E E6     10307 AND	0FH		;LISTO
00379F 0F   
0037A0 F6     10308 OR	30H		;OPT 3
0037A1 30   
0037A2 77     10309 LD	(HL),A
0037A3 ED     10310 SBC	HL,HL		;HL <- 0 (V3.0)
0037A4 62   
0037A5 22     10311 LD	(ERRTRP),HL
0037A6 EA   
0037A7 54   
0037A8 22     10312 LD	(ONERSP),HL
0037A9 EC   
0037AA 54   
0037AB 22     10313 LD	(CURLIN),HL	;For CMOS EDIT->LIST
0037AC F4   
0037AD 54   
0037AE 2A     10314 LD	HL,(AUTONO)
0037AF E8   
0037B0 54   
0037B1 E5     10315 PUSH	HL
0037B2 7C     10316 LD	A,H
0037B3 B5     10317 OR	L
0037B4 28     10318 JR	Z,NOAUTO
0037B5 17   
0037B6 E5     10319 PUSH	HL
0037B7 CD     10320 CALL	PBCD		;AUTO NUMBER
0037B8 78   
0037B9 41   
0037BA E1     10321 POP	HL
0037BB ED     10322 LD	BC,(INCREM)
0037BC 4B   
0037BD FF   
0037BE 54   
0037BF 06     10323 LD	B,0
0037C0 00   
0037C1 09     10324 ADD	HL,BC
0037C2 DA     10325 JP	C,TOOBIGmn
0037C3 91   
0037C4 43   
0037C5 22     10326 LD	(AUTONO),HL
0037C6 E8   
0037C7 54   
0037C8 3E     10327 LD	A,' '
0037C9 20   
0037CA CD     10328 CALL	OUTCHR
0037CB E4   
0037CC 40   
0037CD 21     10329 NOAUTO:         LD	HL,ACCS
0037CE 00   
0037CF 52   
0037D0 CD     10330 CALL	OSLINE		;GET CONSOLE INPUT
0037D1 C9   
0037D2 05   
0037D3 AF     10331 XOR	A
0037D4 32     10332 LD	(COUNT),A
0037D5 FB   
0037D6 54   
0037D7 FD     10333 LD	IY,ACCS
0037D8 21   
0037D9 00   
0037DA 52   
0037DB 21     10334 LD	HL,COMNDS
0037DC C3   
0037DD 3B   
0037DE CD     10335 CALL	LEX0
0037DF 88   
0037E0 3F   
0037E1 E1     10336 POP	HL
0037E2 20     10337 JR	NZ,NOTCMD
0037E3 19   
0037E4 87     10338 ADD	A,A
0037E5 4F     10339 LD	C,A
0037E6 7C     10340 LD	A,H
0037E7 B5     10341 OR	L
0037E8 20     10342 JR	NZ,INAUTO
0037E9 0F   
0037EA 47     10343 LD	B,A
0037EB 21     10344 LD	HL,CMDTABmn
0037EC F3   
0037ED 3B   
0037EE 09     10345 ADD	HL,BC
0037EF 7E     10346 LD	A,(HL)		;TABLE ENTRY
0037F0 23     10347 INC	HL
0037F1 66     10348 LD	H,(HL)
0037F2 6F     10349 LD	L,A
0037F3 FD     10350 INC	IY
0037F4 23   
0037F5 CD     10351 CALL	NXT
0037F6 ED   
0037F7 44   
0037F8 E9     10352 JP	(HL)		;EXECUTE COMMAND
0037F9 FD     10354 INAUTO:         LD	IY,ACCS
0037FA 21   
0037FB 00   
0037FC 52   
0037FD 7C     10355 NOTCMD:         LD	A,H
0037FE B5     10356 OR	L
0037FF CC     10357 CALL	Z,LINNUM
003800 6C   
003801 43   
003802 CD     10358 CALL	NXT
003803 ED   
003804 44   
003805 11     10359 LD	DE,BUFFER
003806 00   
003807 53   
003808 0E     10360 LD	C,1		;LEFT MODE
003809 01   
00380A E5     10361 PUSH	HL
00380B CD     10362 CALL	LEXAN2		;LEXICAL ANALYSIS
00380C FA   
00380D 43   
00380E E1     10363 POP	HL
00380F 12     10364 LD	(DE),A		;TERMINATOR
003810 AF     10365 XOR	A
003811 47     10366 LD	B,A
003812 4B     10367 LD	C,E		;BC=LINE LENGTH
003813 13     10368 INC	DE
003814 12     10369 LD	(DE),A		;ZERO NEXT
003815 7C     10370 LD	A,H
003816 B5     10371 OR	L
003817 FD     10372 LD	IY,BUFFER	;FOR XEQ
003818 21   
003819 00   
00381A 53   
00381B CA     10373 JP	Z,XEQ		;DIRECT MODE
00381C 7B   
00381D 24   
00381E C5     10374 PUSH	BC
00381F CD     10375 CALL	FINDL
003820 25   
003821 41   
003822 CC     10376 CALL	Z,DEL
003823 CB   
003824 3F   
003825 C1     10377 POP	BC
003826 79     10378 LD	A,C
003827 B7     10379 OR	A
003828 28     10380 JR	Z,CLOOP2	;DELETE LINE ONLY
003829 39   
00382A C6     10381 ADD	A,4
00382B 04   
00382C 4F     10382 LD	C,A		;LENGTH INCLUSIVE
00382D D5     10383 PUSH	DE		;LINE NUMBER
00382E C5     10384 PUSH	BC		;SAVE LINE LENGTH
00382F EB     10385 EX	DE,HL
003830 C5     10386 PUSH	BC
003831 CD     10387 CALL	GETTOP
003832 07   
003833 40   
003834 C1     10388 POP	BC
003835 E5     10389 PUSH	HL
003836 09     10390 ADD	HL,BC
003837 E5     10391 PUSH	HL
003838 24     10392 INC	H
003839 AF     10393 XOR	A
00383A ED     10394 SBC	HL,SP
00383B 72   
00383C E1     10395 POP	HL
00383D D2     10396 JP	NC,ERROR_	;"No room"
00383E 26   
00383F 3F   
003840 E3     10397 EX	(SP),HL
003841 E5     10398 PUSH	HL
003842 23     10399 INC	HL
003843 B7     10400 OR	A
003844 ED     10401 SBC	HL,DE
003845 52   
003846 44     10402 LD	B,H		;BC=AMOUNT TO MOVE
003847 4D     10403 LD	C,L
003848 E1     10404 POP	HL
003849 D1     10405 POP	DE
00384A 28     10406 JR	Z,ATEND
00384B 02   
00384C ED     10407 LDDR			;MAKE SPACE
00384D B8   
00384E C1     10408 ATEND:          POP	BC		;LINE LENGTH
00384F D1     10409 POP	DE		;LINE NUMBER
003850 23     10410 INC	HL
003851 71     10411 LD	(HL),C		;STORE LENGTH
003852 23     10412 INC	HL
003853 73     10413 LD	(HL),E		;STORE LINE NUMBER
003854 23     10414 INC	HL
003855 72     10415 LD	(HL),D
003856 23     10416 INC	HL
003857 11     10417 LD	DE,BUFFER
003858 00   
003859 53   
00385A EB     10418 EX	DE,HL
00385B 0D     10419 DEC	C
00385C 0D     10420 DEC	C
00385D 0D     10421 DEC	C
00385E ED     10422 LDIR			;ADD LINE
00385F B0   
003860 CD     10423 CALL	CLEAN
003861 FC   
003862 3F   
003863 C3     10424 CLOOP2:         JP	CLOOP
003864 92   
003865 37   
003866 80     10431 KEYWDS:         DB	80H
003867 41     10432 DB	"AND"
003868 4E   
003869 44   
00386A 94     10433 DB	94H
00386B 41     10434 DB	"ABS"
00386C 42   
00386D 53   
00386E 95     10435 DB	95H
00386F 41     10436 DB	"ACS"
003870 43   
003871 53   
003872 96     10437 DB	96H
003873 41     10438 DB	"ADVAL"
003874 44   
003875 56   
003876 41   
003877 4C   
003878 97     10439 DB	97H
003879 41     10440 DB	"ASC"
00387A 53   
00387B 43   
00387C 98     10441 DB	98H
00387D 41     10442 DB	"ASN"
00387E 53   
00387F 4E   
003880 99     10443 DB	99H
003881 41     10444 DB	"ATN"
003882 54   
003883 4E   
003884 9A     10445 DB	9AH
003885 42     10446 DB	"BGET "
003886 47   
003887 45   
003888 54   
003889 20   
00388A D5     10447 DB	0D5H
00388B 42     10448 DB	"BPUT "
00388C 50   
00388D 55   
00388E 54   
00388F 20   
003890 0F     10449 DB	0FH
003891 42     10450 DB	"BY "		; v5
003892 59   
003893 20   
003894 FB     10451 DB	0FBH
003895 43     10452 DB	"COLOUR"
003896 4F   
003897 4C   
003898 4F   
003899 55   
00389A 52   
00389B FB     10453 DB	0FBH
00389C 43     10454 DB	"COLOR"
00389D 4F   
00389E 4C   
00389F 4F   
0038A0 52   
0038A1 D6     10455 DB	0D6H
0038A2 43     10456 DB	"CALL"
0038A3 41   
0038A4 4C   
0038A5 4C   
0038A6 C8     10457 DB	0C8H
0038A7 43     10458 DB	"CASE"		; v5
0038A8 41   
0038A9 53   
0038AA 45   
0038AB D7     10459 DB	0D7H
0038AC 43     10460 DB	"CHAIN"
0038AD 48   
0038AE 41   
0038AF 49   
0038B0 4E   
0038B1 BD     10461 DB	0BDH
0038B2 43     10462 DB	"CHR$"
0038B3 48   
0038B4 52   
0038B5 24   
0038B6 D8     10463 DB	0D8H
0038B7 43     10464 DB	"CLEAR "
0038B8 4C   
0038B9 45   
0038BA 41   
0038BB 52   
0038BC 20   
0038BD D9     10465 DB	0D9H
0038BE 43     10466 DB	"CLOSE "
0038BF 4C   
0038C0 4F   
0038C1 53   
0038C2 45   
0038C3 20   
0038C4 DA     10467 DB	0DAH
0038C5 43     10468 DB	"CLG "
0038C6 4C   
0038C7 47   
0038C8 20   
0038C9 DB     10469 DB	0DBH
0038CA 43     10470 DB	"CLS "
0038CB 4C   
0038CC 53   
0038CD 20   
0038CE 9B     10471 DB	9BH
0038CF 43     10472 DB	"COS"
0038D0 4F   
0038D1 53   
0038D2 9C     10473 DB	9CH
0038D3 43     10474 DB	"COUNT "
0038D4 4F   
0038D5 55   
0038D6 4E   
0038D7 54   
0038D8 20   
0038D9 01     10475 DB	01H
0038DA 43     10476 DB	"CIRCLE"	; v5
0038DB 49   
0038DC 52   
0038DD 43   
0038DE 4C   
0038DF 45   
0038E0 DC     10477 DB	0DCH
0038E1 44     10478 DB	"DATA"
0038E2 41   
0038E3 54   
0038E4 41   
0038E5 9D     10479 DB	9DH
0038E6 44     10480 DB	"DEG"
0038E7 45   
0038E8 47   
0038E9 DD     10481 DB	0DDH
0038EA 44     10482 DB	"DEF"
0038EB 45   
0038EC 46   
0038ED 81     10483 DB	81H
0038EE 44     10484 DB	"DIV"
0038EF 49   
0038F0 56   
0038F1 DE     10485 DB	0DEH
0038F2 44     10486 DB	"DIM"
0038F3 49   
0038F4 4D   
0038F5 DF     10487 DB	0DFH
0038F6 44     10488 DB	"DRAW"
0038F7 52   
0038F8 41   
0038F9 57   
0038FA E1     10489 DB	0E1H
0038FB 45     10490 DB	"ENDPROC "
0038FC 4E   
0038FD 44   
0038FE 50   
0038FF 52   
003900 4F   
003901 43   
003902 20   
003903 CE     10491 DB	0CEH
003904 45     10492 DB	"ENDWHILE "	; v5
003905 4E   
003906 44   
003907 57   
003908 48   
003909 49   
00390A 4C   
00390B 45   
00390C 20   
00390D CB     10493 DB	0CBH
00390E 45     10494 DB	"ENDCASE "	; v5
00390F 4E   
003910 44   
003911 43   
003912 41   
003913 53   
003914 45   
003915 20   
003916 CD     10495 DB	0CDH
003917 45     10496 DB	"ENDIF "	; v5
003918 4E   
003919 44   
00391A 49   
00391B 46   
00391C 20   
00391D E0     10497 DB	0E0H
00391E 45     10498 DB	"END "
00391F 4E   
003920 44   
003921 20   
003922 E2     10499 DB	0E2H
003923 45     10500 DB	"ENVELOPE"
003924 4E   
003925 56   
003926 45   
003927 4C   
003928 4F   
003929 50   
00392A 45   
00392B 8B     10501 DB	8BH
00392C 45     10502 DB	"ELSE"
00392D 4C   
00392E 53   
00392F 45   
003930 A0     10503 DB	0A0H
003931 45     10504 DB	"EVAL"
003932 56   
003933 41   
003934 4C   
003935 9E     10505 DB	9EH
003936 45     10506 DB	"ERL "
003937 52   
003938 4C   
003939 20   
00393A 85     10507 DB	85H
00393B 45     10508 DB	"ERROR"
00393C 52   
00393D 52   
00393E 4F   
00393F 52   
003940 C5     10509 DB	0C5H
003941 45     10510 DB	"EOF "
003942 4F   
003943 46   
003944 20   
003945 82     10511 DB	82H
003946 45     10512 DB	"EOR"
003947 4F   
003948 52   
003949 9F     10513 DB	9FH
00394A 45     10514 DB	"ERR "
00394B 52   
00394C 52   
00394D 20   
00394E 10     10515 DB	10H
00394F 45     10516 DB	"EXIT "		; v5
003950 58   
003951 49   
003952 54   
003953 20   
003954 A1     10517 DB	0A1H
003955 45     10518 DB	"EXP"
003956 58   
003957 50   
003958 A2     10519 DB	0A2H
003959 45     10520 DB	"EXT "
00395A 58   
00395B 54   
00395C 20   
00395D 02     10521 DB	02H
00395E 45     10522 DB	"ELLIPSE"	; v5
00395F 4C   
003960 4C   
003961 49   
003962 50   
003963 53   
003964 45   
003965 E3     10523 DB	0E3H
003966 46     10524 DB	"FOR"
003967 4F   
003968 52   
003969 A3     10525 DB	0A3H
00396A 46     10526 DB	"FALSE "
00396B 41   
00396C 4C   
00396D 53   
00396E 45   
00396F 20   
003970 03     10527 DB	03H
003971 46     10528 DB	"FILL"		; v5
003972 49   
003973 4C   
003974 4C   
003975 A4     10529 DB	0A4H
003976 46     10530 DB	"FN"
003977 4E   
003978 E5     10531 DB	0E5H
003979 47     10532 DB	"GOTO"
00397A 4F   
00397B 54   
00397C 4F   
00397D BE     10533 DB	0BEH
00397E 47     10534 DB	"GET$"
00397F 45   
003980 54   
003981 24   
003982 A5     10535 DB	0A5H
003983 47     10536 DB	"GET"
003984 45   
003985 54   
003986 E4     10537 DB	0E4H
003987 47     10538 DB	"GOSUB"
003988 4F   
003989 53   
00398A 55   
00398B 42   
00398C E6     10539 DB	0E6H
00398D 47     10540 DB	"GCOL"
00398E 43   
00398F 4F   
003990 4C   
003991 93     10541 DB	93H
003992 48     10542 DB	"HIMEM "
003993 49   
003994 4D   
003995 45   
003996 4D   
003997 20   
003998 E8     10543 DB	0E8H
003999 49     10544 DB	"INPUT"
00399A 4E   
00399B 50   
00399C 55   
00399D 54   
00399E E7     10545 DB	0E7H
00399F 49     10546 DB	"IF"
0039A0 46   
0039A1 BF     10547 DB	0BFH
0039A2 49     10548 DB	"INKEY$"
0039A3 4E   
0039A4 4B   
0039A5 45   
0039A6 59   
0039A7 24   
0039A8 A6     10549 DB	0A6H
0039A9 49     10550 DB	"INKEY"
0039AA 4E   
0039AB 4B   
0039AC 45   
0039AD 59   
0039AE A8     10551 DB	0A8H
0039AF 49     10552 DB	"INT"
0039B0 4E   
0039B1 54   
0039B2 A7     10553 DB	0A7H
0039B3 49     10554 DB	"INSTR("
0039B4 4E   
0039B5 53   
0039B6 54   
0039B7 52   
0039B8 28   
0039B9 0C     10555 DB	0CH
0039BA 49     10556 DB	"INSTALL"	; v5
0039BB 4E   
0039BC 53   
0039BD 54   
0039BE 41   
0039BF 4C   
0039C0 4C   
0039C1 86     10557 DB	86H
0039C2 4C     10558 DB	"LINE"
0039C3 49   
0039C4 4E   
0039C5 45   
0039C6 92     10559 DB	92H
0039C7 4C     10560 DB	"LOMEM "
0039C8 4F   
0039C9 4D   
0039CA 45   
0039CB 4D   
0039CC 20   
0039CD EA     10561 DB	0EAH
0039CE 4C     10562 DB	"LOCAL"
0039CF 4F   
0039D0 43   
0039D1 41   
0039D2 4C   
0039D3 C0     10563 DB	0C0H
0039D4 4C     10564 DB	"LEFT$("
0039D5 45   
0039D6 46   
0039D7 54   
0039D8 24   
0039D9 28   
0039DA A9     10565 DB	0A9H
0039DB 4C     10566 DB	"LEN"
0039DC 45   
0039DD 4E   
0039DE E9     10567 DB	0E9H
0039DF 4C     10568 DB	"LET"
0039E0 45   
0039E1 54   
0039E2 AB     10569 DB	0ABH
0039E3 4C     10570 DB	"LOG"
0039E4 4F   
0039E5 47   
0039E6 AA     10571 DB	0AAH
0039E7 4C     10572 DB	"LN"
0039E8 4E   
0039E9 C1     10573 DB	0C1H
0039EA 4D     10574 DB	"MID$("
0039EB 49   
0039EC 44   
0039ED 24   
0039EE 28   
0039EF EB     10575 DB	0EBH
0039F0 4D     10576 DB	"MODE"
0039F1 4F   
0039F2 44   
0039F3 45   
0039F4 83     10577 DB	83H
0039F5 4D     10578 DB	"MOD"
0039F6 4F   
0039F7 44   
0039F8 EC     10579 DB	0ECH
0039F9 4D     10580 DB	"MOVE"
0039FA 4F   
0039FB 56   
0039FC 45   
0039FD 04     10581 DB	04H
0039FE 4D     10582 DB	"MOUSE"		; v5
0039FF 4F   
003A00 55   
003A01 53   
003A02 45   
003A03 ED     10583 DB	0EDH
003A04 4E     10584 DB	"NEXT"
003A05 45   
003A06 58   
003A07 54   
003A08 AC     10585 DB	0ACH
003A09 4E     10586 DB	"NOT"
003A0A 4F   
003A0B 54   
003A0C EE     10587 DB	0EEH
003A0D 4F     10588 DB	"ON"
003A0E 4E   
003A0F 87     10589 DB	87H
003A10 4F     10590 DB	"OFF "
003A11 46   
003A12 46   
003A13 20   
003A14 CA     10591 DB	0CAH
003A15 4F     10592 DB	"OF "		; v5
003A16 46   
003A17 20   
003A18 05     10593 DB	05H
003A19 4F     10594 DB	"ORIGIN"	; v5
003A1A 52   
003A1B 49   
003A1C 47   
003A1D 49   
003A1E 4E   
003A1F 84     10595 DB	84H
003A20 4F     10596 DB	"OR"
003A21 52   
003A22 8E     10597 DB	8EH
003A23 4F     10598 DB	"OPENIN"
003A24 50   
003A25 45   
003A26 4E   
003A27 49   
003A28 4E   
003A29 AE     10599 DB	0AEH
003A2A 4F     10600 DB	"OPENOUT"
003A2B 50   
003A2C 45   
003A2D 4E   
003A2E 4F   
003A2F 55   
003A30 54   
003A31 AD     10601 DB	0ADH
003A32 4F     10602 DB	"OPENUP"
003A33 50   
003A34 45   
003A35 4E   
003A36 55   
003A37 50   
003A38 FF     10603 DB	0FFH
003A39 4F     10604 DB	"OSCLI"
003A3A 53   
003A3B 43   
003A3C 4C   
003A3D 49   
003A3E CC     10605 DB	0CCH
003A3F 4F     10606 DB	"OTHERWISE"	; v5
003A40 54   
003A41 48   
003A42 45   
003A43 52   
003A44 57   
003A45 49   
003A46 53   
003A47 45   
003A48 F1     10607 DB	0F1H
003A49 50     10608 DB	"PRINT"
003A4A 52   
003A4B 49   
003A4C 4E   
003A4D 54   
003A4E 90     10609 DB	90H
003A4F 50     10610 DB	"PAGE "
003A50 41   
003A51 47   
003A52 45   
003A53 20   
003A54 8F     10611 DB	8FH
003A55 50     10612 DB	"PTR "
003A56 54   
003A57 52   
003A58 20   
003A59 AF     10613 DB	0AFH
003A5A 50     10614 DB	"PI "
003A5B 49   
003A5C 20   
003A5D F0     10615 DB	0F0H
003A5E 50     10616 DB	"PLOT"
003A5F 4C   
003A60 4F   
003A61 54   
003A62 B0     10617 DB	0B0H
003A63 50     10618 DB	"POINT("
003A64 4F   
003A65 49   
003A66 4E   
003A67 54   
003A68 28   
003A69 F2     10619 DB	0F2H
003A6A 50     10620 DB	"PROC"
003A6B 52   
003A6C 4F   
003A6D 43   
003A6E B1     10621 DB	0B1H
003A6F 50     10622 DB	"POS "
003A70 4F   
003A71 53   
003A72 20   
003A73 0E     10623 DB	0EH
003A74 50     10624 DB	"PUT"		; Token changed
003A75 55   
003A76 54   
003A77 06     10625 DB	06H
003A78 51     10626 DB	"QUIT "		; v5
003A79 55   
003A7A 49   
003A7B 54   
003A7C 20   
003A7D F8     10627 DB	0F8H
003A7E 52     10628 DB	"RETURN "
003A7F 45   
003A80 54   
003A81 55   
003A82 52   
003A83 4E   
003A84 20   
003A85 F5     10629 DB	0F5H
003A86 52     10630 DB	"REPEAT"
003A87 45   
003A88 50   
003A89 45   
003A8A 41   
003A8B 54   
003A8C F6     10631 DB	0F6H
003A8D 52     10632 DB	"REPORT "
003A8E 45   
003A8F 50   
003A90 4F   
003A91 52   
003A92 54   
003A93 20   
003A94 F3     10633 DB	0F3H
003A95 52     10634 DB	"READ"
003A96 45   
003A97 41   
003A98 44   
003A99 F4     10635 DB	0F4H
003A9A 52     10636 DB	"REM"
003A9B 45   
003A9C 4D   
003A9D F9     10637 DB	0F9H
003A9E 52     10638 DB	"RUN "
003A9F 55   
003AA0 4E   
003AA1 20   
003AA2 B2     10639 DB	0B2H
003AA3 52     10640 DB	"RAD"
003AA4 41   
003AA5 44   
003AA6 F7     10641 DB	0F7H
003AA7 52     10642 DB	"RESTORE"
003AA8 45   
003AA9 53   
003AAA 54   
003AAB 4F   
003AAC 52   
003AAD 45   
003AAE C2     10643 DB	0C2H
003AAF 52     10644 DB	"RIGHT$("
003AB0 49   
003AB1 47   
003AB2 48   
003AB3 54   
003AB4 24   
003AB5 28   
003AB6 B3     10645 DB	0B3H
003AB7 52     10646 DB	"RND "
003AB8 4E   
003AB9 44   
003ABA 20   
003ABB 07     10647 DB	07H
003ABC 52     10648 DB	"RECTANGLE"	; v5
003ABD 45   
003ABE 43   
003ABF 54   
003AC0 41   
003AC1 4E   
003AC2 47   
003AC3 4C   
003AC4 45   
003AC5 88     10649 DB	88H
003AC6 53     10650 DB	"STEP"
003AC7 54   
003AC8 45   
003AC9 50   
003ACA B4     10651 DB	0B4H
003ACB 53     10652 DB	"SGN"
003ACC 47   
003ACD 4E   
003ACE B5     10653 DB	0B5H
003ACF 53     10654 DB	"SIN"
003AD0 49   
003AD1 4E   
003AD2 B6     10655 DB	0B6H
003AD3 53     10656 DB	"SQR"
003AD4 51   
003AD5 52   
003AD6 89     10657 DB	89H
003AD7 53     10658 DB	"SPC"
003AD8 50   
003AD9 43   
003ADA C3     10659 DB	0C3H
003ADB 53     10660 DB	"STR$"
003ADC 54   
003ADD 52   
003ADE 24   
003ADF C4     10661 DB	0C4H
003AE0 53     10662 DB	"STRING$("
003AE1 54   
003AE2 52   
003AE3 49   
003AE4 4E   
003AE5 47   
003AE6 24   
003AE7 28   
003AE8 D4     10663 DB	0D4H
003AE9 53     10664 DB	"SOUND"
003AEA 4F   
003AEB 55   
003AEC 4E   
003AED 44   
003AEE FA     10665 DB	0FAH
003AEF 53     10666 DB	"STOP "
003AF0 54   
003AF1 4F   
003AF2 50   
003AF3 20   
003AF4 C6     10667 DB	0C6H
003AF5 53     10668 DB	"SUM"		; v5
003AF6 55   
003AF7 4D   
003AF8 08     10669 DB	08H
003AF9 53     10670 DB	"SWAP"		; v5
003AFA 57   
003AFB 41   
003AFC 50   
003AFD 09     10671 DB	09H
003AFE 53     10672 DB	"SYS"		; v5
003AFF 59   
003B00 53   
003B01 B7     10673 DB	0B7H
003B02 54     10674 DB	"TAN"
003B03 41   
003B04 4E   
003B05 8A     10675 DB	8AH
003B06 54     10676 DB	"TAB("
003B07 41   
003B08 42   
003B09 28   
003B0A 8C     10677 DB	8CH
003B0B 54     10678 DB	"THEN"
003B0C 48   
003B0D 45   
003B0E 4E   
003B0F 91     10679 DB	91H
003B10 54     10680 DB	"TIME "
003B11 49   
003B12 4D   
003B13 45   
003B14 20   
003B15 0A     10681 DB	0AH
003B16 54     10682 DB	"TINT"
003B17 49   
003B18 4E   
003B19 54   
003B1A B8     10683 DB	0B8H
003B1B 54     10684 DB	"TO"
003B1C 4F   
003B1D FC     10685 DB	0FCH
003B1E 54     10686 DB	"TRACE"
003B1F 52   
003B20 41   
003B21 43   
003B22 45   
003B23 B9     10687 DB	0B9H
003B24 54     10688 DB	"TRUE "
003B25 52   
003B26 55   
003B27 45   
003B28 20   
003B29 FD     10689 DB	0FDH
003B2A 55     10690 DB	"UNTIL"
003B2B 4E   
003B2C 54   
003B2D 49   
003B2E 4C   
003B2F BA     10691 DB	0BAH
003B30 55     10692 DB	"USR"
003B31 53   
003B32 52   
003B33 EF     10693 DB	0EFH
003B34 56     10694 DB	"VDU"
003B35 44   
003B36 55   
003B37 BB     10695 DB	0BBH
003B38 56     10696 DB	"VAL"
003B39 41   
003B3A 4C   
003B3B BC     10697 DB	0BCH
003B3C 56     10698 DB	"VPOS "
003B3D 50   
003B3E 4F   
003B3F 53   
003B40 20   
003B41 C7     10699 DB	0C7H
003B42 57     10700 DB	"WHILE"		; v5
003B43 48   
003B44 49   
003B45 4C   
003B46 45   
003B47 C9     10701 DB	0C9H
003B48 57     10702 DB	"WHEN"		; v5
003B49 48   
003B4A 45   
003B4B 4E   
003B4C 0B     10703 DB	0BH
003B4D 57     10704 DB	"WAIT "		; v5
003B4E 41   
003B4F 49   
003B50 54   
003B51 20   
003B52 FE     10705 DB	0FEH
003B53 57     10706 DB	"WIDTH"
003B54 49   
003B55 44   
003B56 54   
003B57 48   
003B58 CF     10708 DB	0CFH
003B59 50     10709 DB	"PTR"
003B5A 54   
003B5B 52   
003B5C D1     10710 DB	0D1H
003B5D 54     10711 DB	"TIME"
003B5E 49   
003B5F 4D   
003B60 45   
003B61 D3     10712 DB	0D3H
003B62 48     10713 DB	"HIMEM"
003B63 49   
003B64 4D   
003B65 45   
003B66 4D   
003B67 D2     10714 DB	0D2H
003B68 4C     10715 DB	"LOMEM"
003B69 4F   
003B6A 4D   
003B6B 45   
003B6C 4D   
003B6D D0     10716 DB	0D0H
003B6E 50     10717 DB	"PAGE"
003B6F 41   
003B70 47   
003B71 45   
003B72 11     10719 DB	11H
003B73 4D     10720 DB	"Missing "
003B74 69   
003B75 73   
003B76 73   
003B77 69   
003B78 6E   
003B79 67   
003B7A 20   
003B7B 12     10721 DB	12H
003B7C 4E     10722 DB	"No such "
003B7D 6F   
003B7E 20   
003B7F 73   
003B80 75   
003B81 63   
003B82 68   
003B83 20   
003B84 13     10723 DB	13H
003B85 42     10724 DB	"Bad "
003B86 61   
003B87 64   
003B88 20   
003B89 14     10725 DB	14H
003B8A 20     10726 DB	" range"
003B8B 72   
003B8C 61   
003B8D 6E   
003B8E 67   
003B8F 65   
003B90 15     10727 DB	15H
003B91 76     10728 DB	"variable"
003B92 61   
003B93 72   
003B94 69   
003B95 61   
003B96 62   
003B97 6C   
003B98 65   
003B99 16     10729 DB	16H
003B9A 4F     10730 DB	"Out of"
003B9B 75   
003B9C 74   
003B9D 20   
003B9E 6F   
003B9F 66   
003BA0 17     10731 DB	17H
003BA1 4E     10732 DB	"No "
003BA2 6F   
003BA3 20   
003BA4 18     10733 DB	18H
003BA5 20     10734 DB	" space"
003BA6 73   
003BA7 70   
003BA8 61   
003BA9 63   
003BAA 65   
003BAB 19     10735 DB	19H
003BAC 4E     10736 DB	"Not in a "
003BAD 6F   
003BAE 74   
003BAF 20   
003BB0 69   
003BB1 6E   
003BB2 20   
003BB3 61   
003BB4 20   
003BB5 1A     10737 DB	1AH
003BB6 20     10738 DB	" loop"
003BB7 6C   
003BB8 6F   
003BB9 6F   
003BBA 70   
003BBB 1B     10739 DB	1BH
003BBC 20     10740 DB	" not "
003BBD 6E   
003BBE 6F   
003BBF 74   
003BC0 20   
003BC1 FF     10742 DW	-1
003BC2 FF   
003BC3 80     10746 COMNDS:         DB	80H
003BC4 41     10747 DB	"AUTO"
003BC5 55   
003BC6 54   
003BC7 4F   
003BC8 81     10748 DB	81H
003BC9 44     10749 DB	"DELETE"
003BCA 45   
003BCB 4C   
003BCC 45   
003BCD 54   
003BCE 45   
003BCF 82     10750 DB	82H
003BD0 4C     10751 DB	"LIST"
003BD1 49   
003BD2 53   
003BD3 54   
003BD4 83     10752 DB	83H
003BD5 4C     10753 DB	"LOAD"
003BD6 4F   
003BD7 41   
003BD8 44   
003BD9 84     10754 DB	84H
003BDA 4E     10755 DB	"NEW "
003BDB 45   
003BDC 57   
003BDD 20   
003BDE 85     10756 DB	85H
003BDF 4F     10757 DB	"OLD "
003BE0 4C   
003BE1 44   
003BE2 20   
003BE3 86     10758 DB	86H
003BE4 52     10759 DB	"RENUMBER"
003BE5 45   
003BE6 4E   
003BE7 55   
003BE8 4D   
003BE9 42   
003BEA 45   
003BEB 52   
003BEC 87     10760 DB	87H
003BED 53     10761 DB	"SAVE"
003BEE 41   
003BEF 56   
003BF0 45   
003BF1 FF     10762 DW	-1
003BF2 FF   
003BF3 C5     10766 CMDTABmn:         DW	AUTO
003BF4 3E   
003BF5 68     10767 DW	DELETE
003BF6 3D   
003BF7 90     10768 DW	LIST
003BF8 3D   
003BF9 E4     10769 DW	LOAD
003BFA 3E   
003BFB DF     10770 DW	NEW
003BFC 3E   
003BFD F2     10771 DW	OLD
003BFE 3E   
003BFF 15     10772 DW	RENUM
003C00 3E   
003C01 0B     10773 DW	SAVE
003C02 3F   
003C03 17     10777 ERRWDS:         DB	17H
003C04 72     10778 DB	"room"
003C05 6F   
003C06 6F   
003C07 6D   
003C08 00     10779 DB	0
003C09 16     10780 DB	16H
003C0A 14     10781 DB	14H
003C0B 00     10782 DW	0
003C0C 00   
003C0D 4D     10783 DB	"Multiple label"
003C0E 75   
003C0F 6C   
003C10 74   
003C11 69   
003C12 70   
003C13 6C   
003C14 65   
003C15 20   
003C16 6C   
003C17 61   
003C18 62   
003C19 65   
003C1A 6C   
003C1B 00     10784 DB	0
003C1C 4D     10785 DB	"Mistake"
003C1D 69   
003C1E 73   
003C1F 74   
003C20 61   
003C21 6B   
003C22 65   
003C23 00     10786 DB	0
003C24 11     10787 DB	11H
003C25 2C     10788 DB	','
003C26 00     10789 DB	0
003C27 54     10790 DB	"Type mismatch"
003C28 79   
003C29 70   
003C2A 65   
003C2B 20   
003C2C 6D   
003C2D 69   
003C2E 73   
003C2F 6D   
003C30 61   
003C31 74   
003C32 63   
003C33 68   
003C34 00     10791 DB	0
003C35 19     10792 DB	19H
003C36 A4     10793 DB	TFN
003C37 00     10794 DW	0
003C38 00   
003C39 11     10795 DB	11H
003C3A 22     10796 DB	'"'
003C3B 00     10797 DB	0
003C3C 13     10798 DB	13H
003C3D DE     10799 DB	TDIM
003C3E 00     10800 DB	0
003C3F DE     10801 DB	TDIM
003C40 18     10802 DB	18H
003C41 00     10803 DB	0
003C42 19     10804 DB	19H
003C43 A4     10805 DB	TFN
003C44 20     10806 DB	" or "
003C45 6F   
003C46 72   
003C47 20   
003C48 F2     10807 DB	TPROC
003C49 00     10808 DB	0
003C4A 19     10809 DB	19H
003C4B F2     10810 DB	TPROC
003C4C 00     10811 DB	0
003C4D 13     10812 DB	13H
003C4E 75     10813 DB	"use of array"
003C4F 73   
003C50 65   
003C51 20   
003C52 6F   
003C53 66   
003C54 20   
003C55 61   
003C56 72   
003C57 72   
003C58 61   
003C59 79   
003C5A 00     10814 DB	0
003C5B 13     10815 DB	13H
003C5C 73     10816 DB	"subscript"
003C5D 75   
003C5E 62   
003C5F 73   
003C60 63   
003C61 72   
003C62 69   
003C63 70   
003C64 74   
003C65 00     10817 DB	0
003C66 53     10818 DB	"Syntax error"
003C67 79   
003C68 6E   
003C69 74   
003C6A 61   
003C6B 78   
003C6C 20   
003C6D 65   
003C6E 72   
003C6F 72   
003C70 6F   
003C71 72   
003C72 00     10819 DB	0
003C73 45     10820 DB	"Escape"
003C74 73   
003C75 63   
003C76 61   
003C77 70   
003C78 65   
003C79 00     10821 DB	0
003C7A 44     10822 DB	"Division by zero"
003C7B 69   
003C7C 76   
003C7D 69   
003C7E 73   
003C7F 69   
003C80 6F   
003C81 6E   
003C82 20   
003C83 62   
003C84 79   
003C85 20   
003C86 7A   
003C87 65   
003C88 72   
003C89 6F   
003C8A 00     10823 DB	0
003C8B 53     10824 DB	"String too long"
003C8C 74   
003C8D 72   
003C8E 69   
003C8F 6E   
003C90 67   
003C91 20   
003C92 74   
003C93 6F   
003C94 6F   
003C95 20   
003C96 6C   
003C97 6F   
003C98 6E   
003C99 67   
003C9A 00     10825 DB	0
003C9B 4E     10826 DB	"Number too big"
003C9C 75   
003C9D 6D   
003C9E 62   
003C9F 65   
003CA0 72   
003CA1 20   
003CA2 74   
003CA3 6F   
003CA4 6F   
003CA5 20   
003CA6 62   
003CA7 69   
003CA8 67   
003CA9 00     10827 DB	0
003CAA 2D     10828 DB	"-ve root"
003CAB 76   
003CAC 65   
003CAD 20   
003CAE 72   
003CAF 6F   
003CB0 6F   
003CB1 74   
003CB2 00     10829 DB	0
003CB3 4C     10830 DB	"Log"
003CB4 6F   
003CB5 67   
003CB6 14     10831 DB	14H
003CB7 00     10832 DB	0
003CB8 41     10833 DB	"Accuracy lost"
003CB9 63   
003CBA 63   
003CBB 75   
003CBC 72   
003CBD 61   
003CBE 63   
003CBF 79   
003CC0 20   
003CC1 6C   
003CC2 6F   
003CC3 73   
003CC4 74   
003CC5 00     10834 DB	0
003CC6 45     10835 DB	"Exponent"
003CC7 78   
003CC8 70   
003CC9 6F   
003CCA 6E   
003CCB 65   
003CCC 6E   
003CCD 74   
003CCE 14     10836 DB	14H
003CCF 00     10837 DW	0
003CD0 00   
003CD1 12     10838 DB	12H
003CD2 15     10839 DB	15H
003CD3 00     10840 DB	0
003CD4 11     10841 DB	11H
003CD5 29     10842 DB	')'
003CD6 00     10843 DB	0
003CD7 13     10844 DB	13H
003CD8 68     10845 DB	"hex or binary"
003CD9 65   
003CDA 78   
003CDB 20   
003CDC 6F   
003CDD 72   
003CDE 20   
003CDF 62   
003CE0 69   
003CE1 6E   
003CE2 61   
003CE3 72   
003CE4 79   
003CE5 00     10846 DB	0
003CE6 12     10847 DB	12H
003CE7 A4     10848 DB	TFN
003CE8 2F     10849 DB	'/'
003CE9 F2     10850 DB	TPROC
003CEA 00     10851 DB	0
003CEB 13     10852 DB	13H
003CEC 63     10853 DB	"call"
003CED 61   
003CEE 6C   
003CEF 6C   
003CF0 00     10854 DB	0
003CF1 13     10855 DB	13H
003CF2 61     10856 DB	"arguments"
003CF3 72   
003CF4 67   
003CF5 75   
003CF6 6D   
003CF7 65   
003CF8 6E   
003CF9 74   
003CFA 73   
003CFB 00     10857 DB	0
003CFC 19     10858 DB	19H
003CFD E3     10859 DB	TFOR
003CFE 1A     10860 DB	1AH
003CFF 00     10861 DB	0
003D00 43     10862 DB	"Can't match "
003D01 61   
003D02 6E   
003D03 27   
003D04 74   
003D05 20   
003D06 6D   
003D07 61   
003D08 74   
003D09 63   
003D0A 68   
003D0B 20   
003D0C E3     10863 DB	TFOR
003D0D 00     10864 DB	0
003D0E 13     10865 DB	13H
003D0F E3     10866 DB	TFOR
003D10 20     10867 DB	' '
003D11 15     10868 DB	15H
003D12 00     10869 DW	0
003D13 00   
003D14 11     10870 DB	11H
003D15 B8     10871 DB	TTO
003D16 00     10872 DW	0
003D17 00   
003D18 17     10873 DB	17H
003D19 E4     10874 DB	TGOSUB
003D1A 00     10875 DB	0
003D1B EE     10876 DB	TON
003D1C 20     10877 DB	" syntax"
003D1D 73   
003D1E 79   
003D1F 6E   
003D20 74   
003D21 61   
003D22 78   
003D23 00     10878 DB	0
003D24 EE     10879 DB	TON
003D25 14     10880 DB	14H
003D26 00     10881 DB	0
003D27 12     10882 DB	12H
003D28 6C     10883 DB	"line"
003D29 69   
003D2A 6E   
003D2B 65   
003D2C 00     10884 DB	0
003D2D 16     10885 DB	16H
003D2E 20     10886 DB	' '
003D2F DC     10887 DB	TDATA
003D30 00     10888 DB	0
003D31 19     10889 DB	19H
003D32 F5     10890 DB	TREPEAT
003D33 1A     10891 DB	1AH
003D34 00     10892 DB	0
003D35 13     10893 DB	13H
003D36 10     10894 DB	TEXIT
003D37 00     10895 DB	0
003D38 11     10896 DB	11H
003D39 23     10897 DB	'#'
003D3A 00     10898 DB	0
003D3B 19     10899 DB	19H		;46 Not in a WHILE loop
003D3C C7     10900 DB	TWHILE
003D3D 1A     10901 DB	1AH
003D3E 00     10902 DB	0
003D3F 11     10903 DB	11H		;47 Missing ENDCASE
003D40 CB     10904 DB	TENDCASE
003D41 00     10905 DB	0
003D42 CA     10906 DB	TOF		;48 OF not last
003D43 1B     10907 DB	1BH
003D44 6C     10908 DB	"last"
003D45 61   
003D46 73   
003D47 74   
003D48 00     10909 DB	0
003D49 11     10910 DB	11H		;49 Missing ENDIF
003D4A CD     10911 DB	TENDIF
003D4B 00     10912 DB	0
003D4C 00     10913 DW	0
003D4D 00   
003D4E 00     10914 DB	0
003D4F EE     10915 DB	TON		;53 ON ERROR not LOCAL
003D50 20     10916 DB	' '
003D51 85     10917 DB	TERROR
003D52 1B     10918 DB	1BH
003D53 EA     10919 DB	TLOCAL
003D54 00     10920 DB	0
003D55 DC     10921 DB	TDATA		;54 DATA not LOCAL
003D56 1B     10922 DB	1BH
003D57 EA     10923 DB	TLOCAL
003D58 00     10924 DB	0
003D59 E3     10928 TOKADD:         DB	TFOR
003D5A F5     10929 DB	TREPEAT
003D5B C7     10930 DB	TWHILE
003D5C C8     10931 DB	TCASE
003D5D 8B     10932 DB	TELSE
003D5E C9     10933 DB	TWHEN
003D5F CC     10934 DB	TOTHERWISE
003D60 ED     10939 TOKSUB:         DB	TNEXT
003D61 FD     10940 DB	TUNTIL
003D62 CE     10941 DB	TENDWHILE
003D63 CB     10942 DB	TENDCASE
003D64 CD     10943 DB	TENDIF
003D65 8B     10944 DB	TELSE
003D66 C9     10945 DB	TWHEN
003D67 CC     10946 DB	TOTHERWISE
003D68 CD     10953 DELETE:         CALL	DLPAIR
003D69 B9   
003D6A 43   
003D6B 7E     10954 DELET1:         LD	A,(HL)
003D6C B7     10955 OR	A
003D6D 28     10956 JR	Z,WARMNC
003D6E 79   
003D6F 23     10957 INC	HL
003D70 5E     10958 LD	E,(HL)
003D71 23     10959 INC	HL
003D72 56     10960 LD	D,(HL)
003D73 2B     10961 DEC	HL
003D74 2B     10962 DEC	HL
003D75 EB     10963 EX	DE,HL
003D76 37     10964 SCF
003D77 ED     10965 SBC	HL,BC
003D78 42   
003D79 EB     10966 EX	DE,HL
003D7A 30     10967 JR	NC,WARMNC
003D7B 6C   
003D7C C5     10968 PUSH	BC
003D7D CD     10969 CALL	DEL
003D7E CB   
003D7F 3F   
003D80 C1     10970 POP	BC
003D81 18     10971 JR	DELET1
003D82 E8   
003D83 FD     10975 LISTO:          INC	IY		;SKIP "O"
003D84 23   
003D85 CD     10976 CALL	EXPRI
003D86 15   
003D87 18   
003D88 D9     10977 EXX
003D89 7D     10978 LD	A,L
003D8A 32     10979 LD	(LISTON),A
003D8B FE   
003D8C 54   
003D8D C3     10980 JP	CLOOP
003D8E 92   
003D8F 37   
003D90 FE     10988 LIST:           CP	'O'
003D91 4F   
003D92 28     10989 JR	Z,LISTO
003D93 EF   
003D94 0E     10990 LD	C,1
003D95 01   
003D96 11     10991 LD	DE,BUFFER
003D97 00   
003D98 53   
003D99 CD     10992 CALL	LEXAN2
003D9A FA   
003D9B 43   
003D9C 12     10993 LD	(DE),A
003D9D FD     10994 LD	IY,BUFFER
003D9E 21   
003D9F 00   
003DA0 53   
003DA1 CD     10995 CALL	DLPAIR
003DA2 B9   
003DA3 43   
003DA4 CD     10996 CALL	NXT
003DA5 ED   
003DA6 44   
003DA7 FE     10997 CP	TIF		;IF CLAUSE ?
003DA8 E7   
003DA9 3E     10998 LD	A,0		;INIT IF-CLAUSE LENGTH
003DAA 00   
003DAB 20     10999 JR	NZ,LISTB
003DAC 15   
003DAD FD     11000 INC	IY		;SKIP IF
003DAE 23   
003DAF CD     11001 CALL	NXT		;SKIP SPACES (IF ANY)
003DB0 ED   
003DB1 44   
003DB2 EB     11002 EX	DE,HL
003DB3 FD     11003 PUSH	IY
003DB4 E5   
003DB5 E1     11004 POP	HL		;HL ADDRESSES IF CLAUSE
003DB6 3E     11005 LD	A,CR
003DB7 0D   
003DB8 C5     11006 PUSH	BC
003DB9 01     11007 LD	BC,256
003DBA 00   
003DBB 01   
003DBC ED     11008 CPIR			;LOCATE CR
003DBD B1   
003DBE 79     11009 LD	A,C
003DBF 2F     11010 CPL			;A = SUBSTRING LENGTH
003DC0 C1     11011 POP	BC
003DC1 EB     11012 EX	DE,HL
003DC2 5F     11013 LISTB:          LD	E,A		;IF-CLAUSE LENGTH
003DC3 78     11014 LD	A,B
003DC4 B1     11015 OR	C
003DC5 20     11016 JR	NZ,LISTA
003DC6 01   
003DC7 0B     11017 DEC	BC
003DC8 D9     11018 LISTA:          EXX
003DC9 DD     11019 LD	IX,LISTON
003DCA 21   
003DCB FE   
003DCC 54   
003DCD 1E     11020 LD	E,0		;INDENTATION COUNT
003DCE 00   
003DCF D9     11021 EXX
003DD0 3E     11022 LD	A,20
003DD1 14   
003DD2 C5     11024 LISTC:          PUSH	BC		;SAVE HIGH LINE NUMBER
003DD3 D5     11025 PUSH	DE		;SAVE IF-CLAUSE LENGTH
003DD4 E5     11026 PUSH	HL		;SAVE PROGRAM POINTER
003DD5 08     11027 EX	AF,AF'
003DD6 7E     11028 LD	A,(HL)
003DD7 B7     11029 OR	A
003DD8 28     11030 JR	Z,WARMNC
003DD9 0E   
003DDA 7B     11034 LD	A,E		;A = IF-CLAUSE LENGTH
003DDB 23     11035 INC	HL
003DDC 5E     11036 LD	E,(HL)
003DDD 23     11037 INC	HL
003DDE 56     11038 LD	D,(HL)		;DE = LINE NUMBER
003DDF 2B     11039 DEC	HL
003DE0 2B     11040 DEC	HL
003DE1 D5     11041 PUSH	DE		;SAVE LINE NUMBER
003DE2 EB     11042 EX	DE,HL
003DE3 37     11043 SCF
003DE4 ED     11044 SBC	HL,BC
003DE5 42   
003DE6 EB     11045 EX	DE,HL
003DE7 D1     11046 POP	DE		;RESTORE LINE NUMBER
003DE8 D2     11047 WARMNC:         JP	NC,WARM
003DE9 91   
003DEA 37   
003DEB 4E     11048 LD	C,(HL)		;C = LINE LENGTH + 4
003DEC 47     11049 LD	B,A		;B = IF-CLAUSE LENGTH
003DED 23     11053 INC	HL
003DEE 23     11054 INC	HL
003DEF 23     11055 INC	HL		;HL ADDRESSES LINE TEXT
003DF0 0D     11056 DEC	C
003DF1 0D     11057 DEC	C
003DF2 0D     11058 DEC	C
003DF3 0D     11059 DEC	C		;C = LINE LENGTH
003DF4 D5     11060 PUSH	DE		;SAVE LINE NUMBER
003DF5 E5     11061 PUSH	HL		;SAVE LINE ADDRESS
003DF6 AF     11062 XOR	A		;A <- 0
003DF7 B8     11063 CP	B		;WAS THERE AN IF-CLAUSE
003DF8 FD     11064 PUSH	IY
003DF9 E5   
003DFA D1     11065 POP	DE		;DE ADDRESSES IF-CLAUSE
003DFB C4     11066 CALL	NZ,SEARCH	;SEARCH FOR IF CLAUSE
003DFC D4   
003DFD 1D   
003DFE E1     11067 POP	HL		;RESTORE LINE ADDRESS
003DFF D1     11068 POP	DE		;RESTORE LINE NUMBER
003E00 FD     11069 PUSH	IY
003E01 E5   
003E02 CC     11070 CALL	Z,LISTIT	;LIST IF MATCH
003E03 3F   
003E04 40   
003E05 FD     11071 POP	IY
003E06 E1   
003E07 08     11073 EX	AF,AF'
003E08 3D     11074 DEC	A
003E09 CD     11075 CALL	LTRAP
003E0A 18   
003E0B 06   
003E0C E1     11076 POP	HL		;RESTORE POINTER
003E0D 5E     11077 LD	E,(HL)
003E0E 16     11078 LD	D,0
003E0F 00   
003E10 19     11079 ADD	HL,DE		;ADDRESS NEXT LINE
003E11 D1     11080 POP	DE		;RESTORE IF-CLAUSE LEN
003E12 C1     11081 POP	BC		;RESTORE HI LINE NUMBER
003E13 18     11082 JR	LISTC
003E14 BD   
003E15 CD     11089 RENUM:          CALL	CLEAR		;USES DYNAMIC AREA
003E16 25   
003E17 40   
003E18 CD     11090 CALL	PAIR		;LOAD HL,BC
003E19 96   
003E1A 43   
003E1B D9     11091 EXX
003E1C 2A     11092 LD	HL,(PAGE_)
003E1D DC   
003E1E 54   
003E1F ED     11093 LD	DE,(LOMEM)
003E20 5B   
003E21 DE   
003E22 54   
003E23 7E     11094 RENUM1:         LD	A,(HL)		;BUILD TABLE
003E24 B7     11095 OR	A
003E25 28     11096 JR	Z,RENUM2
003E26 28   
003E27 23     11097 INC	HL
003E28 4E     11098 LD	C,(HL)		;OLD LINE NUMBER
003E29 23     11099 INC	HL
003E2A 46     11100 LD	B,(HL)
003E2B EB     11101 EX	DE,HL
003E2C 71     11102 LD	(HL),C
003E2D 23     11103 INC	HL
003E2E 70     11104 LD	(HL),B
003E2F 23     11105 INC	HL
003E30 D9     11106 EXX
003E31 E5     11107 PUSH	HL
003E32 09     11108 ADD	HL,BC		;ADD INCREMENT
003E33 DA     11109 JP	C,TOOBIGmn	;"Too big"
003E34 91   
003E35 43   
003E36 D9     11110 EXX
003E37 C1     11111 POP	BC
003E38 71     11112 LD	(HL),C
003E39 23     11113 INC	HL
003E3A 70     11114 LD	(HL),B
003E3B 23     11115 INC	HL
003E3C EB     11116 EX	DE,HL
003E3D 2B     11117 DEC	HL
003E3E 2B     11118 DEC	HL
003E3F AF     11119 XOR	A
003E40 47     11120 LD	B,A
003E41 4E     11121 LD	C,(HL)
003E42 09     11122 ADD	HL,BC		;NEXT LINE
003E43 EB     11123 EX	DE,HL
003E44 E5     11124 PUSH	HL
003E45 24     11125 INC	H
003E46 ED     11126 SBC	HL,SP
003E47 72   
003E48 E1     11127 POP	HL
003E49 EB     11128 EX	DE,HL
003E4A 38     11129 JR	C,RENUM1	;CONTINUE
003E4B D7   
003E4C C3     11130 JP	ERROR_		;'No room' (A = 0)
003E4D 26   
003E4E 3F   
003E4F EB     11132 RENUM2:         EX	DE,HL
003E50 36     11133 LD	(HL),-1
003E51 FF   
003E52 23     11134 INC	HL
003E53 36     11135 LD	(HL),-1
003E54 FF   
003E55 ED     11136 LD	DE,(LOMEM)
003E56 5B   
003E57 DE   
003E58 54   
003E59 D9     11137 EXX
003E5A 2A     11138 LD	HL,(PAGE_)
003E5B DC   
003E5C 54   
003E5D 4E     11139 RENUM3:         LD	C,(HL)
003E5E 79     11140 LD	A,C
003E5F B7     11141 OR	A
003E60 28     11142 JR	Z,WARMNC
003E61 86   
003E62 D9     11143 EXX
003E63 EB     11144 EX	DE,HL
003E64 23     11145 INC	HL
003E65 23     11146 INC	HL
003E66 5E     11147 LD	E,(HL)
003E67 23     11148 INC	HL
003E68 56     11149 LD	D,(HL)
003E69 23     11150 INC	HL
003E6A D5     11151 PUSH	DE
003E6B EB     11152 EX	DE,HL
003E6C D9     11153 EXX
003E6D D1     11154 POP	DE
003E6E 23     11155 INC	HL
003E6F 73     11156 LD	(HL),E		;NEW LINE NUMBER
003E70 23     11157 INC	HL
003E71 72     11158 LD	(HL),D
003E72 23     11159 INC	HL
003E73 0D     11160 DEC	C
003E74 0D     11161 DEC	C
003E75 0D     11162 DEC	C
003E76 06     11163 LD	B,0
003E77 00   
003E78 3E     11164 RENUM7:         LD	A,TLINO
003E79 8D   
003E7A ED     11165 CPIR			;SEARCH FOR LINE NUMBER
003E7B B1   
003E7C 20     11166 JR	NZ,RENUM3
003E7D DF   
003E7E C5     11167 PUSH	BC
003E7F E5     11168 PUSH	HL
003E80 E5     11169 PUSH	HL
003E81 FD     11170 POP	IY
003E82 E1   
003E83 D9     11171 EXX
003E84 E5     11172 PUSH	HL
003E85 CD     11173 CALL	DECODE		;DECODE LINE NUMBER
003E86 42   
003E87 1F   
003E88 E1     11174 POP	HL
003E89 D9     11175 EXX
003E8A 44     11176 LD	B,H
003E8B 4D     11177 LD	C,L
003E8C 2A     11178 LD	HL,(LOMEM)
003E8D DE   
003E8E 54   
003E8F 5E     11179 RENUM4:         LD	E,(HL)		;CROSS-REFERENCE TABLE
003E90 23     11180 INC	HL
003E91 56     11181 LD	D,(HL)
003E92 23     11182 INC	HL
003E93 EB     11183 EX	DE,HL
003E94 B7     11184 OR	A		;CLEAR CARRY
003E95 ED     11185 SBC	HL,BC
003E96 42   
003E97 EB     11186 EX	DE,HL
003E98 5E     11187 LD	E,(HL)		;NEW NUMBER
003E99 23     11188 INC	HL
003E9A 56     11189 LD	D,(HL)
003E9B 23     11190 INC	HL
003E9C 38     11191 JR	C,RENUM4
003E9D F1   
003E9E EB     11192 EX	DE,HL
003E9F 28     11193 JR	Z,RENUM5	;FOUND
003EA0 1A   
003EA1 CD     11194 CALL	TELL
003EA2 DC   
003EA3 44   
003EA4 46     11195 DB	"Failed at "
003EA5 61   
003EA6 69   
003EA7 6C   
003EA8 65   
003EA9 64   
003EAA 20   
003EAB 61   
003EAC 74   
003EAD 20   
003EAE 00     11196 DB	0
003EAF D9     11197 EXX
003EB0 E5     11198 PUSH	HL
003EB1 D9     11199 EXX
003EB2 E1     11200 POP	HL
003EB3 CD     11201 CALL	PBCDL
003EB4 74   
003EB5 41   
003EB6 CD     11202 CALL	CRLF
003EB7 DD   
003EB8 40   
003EB9 18     11203 JR	RENUM6
003EBA 06   
003EBB D1     11204 RENUM5:         POP	DE
003EBC D5     11205 PUSH	DE
003EBD 1B     11206 DEC	DE
003EBE CD     11207 CALL	ENCODE		;RE-WRITE NUMBER
003EBF A1   
003EC0 44   
003EC1 E1     11208 RENUM6:         POP	HL
003EC2 C1     11209 POP	BC
003EC3 18     11210 JR	RENUM7
003EC4 B3   
003EC5 CD     11217 AUTO:           CALL	PAIR
003EC6 96   
003EC7 43   
003EC8 22     11218 LD	(AUTONO),HL
003EC9 E8   
003ECA 54   
003ECB 79     11219 LD	A,C
003ECC 32     11220 LD	(INCREM),A
003ECD FF   
003ECE 54   
003ECF 18     11221 JR	CLOOP0
003ED0 37   
003ED1 CD     11226 BAD:            CALL	TELL		;"Bad program'
003ED2 DC   
003ED3 44   
003ED4 13     11227 DB	13H
003ED5 70     11228 DB	"program"
003ED6 72   
003ED7 6F   
003ED8 67   
003ED9 72   
003EDA 61   
003EDB 6D   
003EDC 0D     11229 DB	CR
003EDD 0A     11230 DB	LF
003EDE 00     11231 DB	0
003EDF CD     11232 NEW:            CALL	NEWIT
003EE0 20   
003EE1 40   
003EE2 18     11233 JR	CLOOP0
003EE3 24   
003EE4 CD     11237 LOAD:           CALL	EXPRS		;GET FILENAME
003EE5 1E   
003EE6 18   
003EE7 3E     11238 LD	A,CR
003EE8 0D   
003EE9 12     11239 LD	(DE),A
003EEA CD     11240 CALL	LOAD0
003EEB E2   
003EEC 3F   
003EED CD     11241 CALL	CLEAR
003EEE 25   
003EEF 40   
003EF0 18     11242 JR	WARM0
003EF1 31   
003EF2 2A     11246 OLD:            LD	HL,(PAGE_)
003EF3 DC   
003EF4 54   
003EF5 E5     11247 PUSH	HL
003EF6 23     11248 INC	HL
003EF7 23     11249 INC	HL
003EF8 23     11250 INC	HL
003EF9 01     11251 LD	BC,252
003EFA FC   
003EFB 00   
003EFC 3E     11252 LD	A,CR
003EFD 0D   
003EFE ED     11253 CPIR
003EFF B1   
003F00 20     11254 JR	NZ,BAD
003F01 CF   
003F02 7D     11255 LD	A,L
003F03 E1     11256 POP	HL
003F04 77     11257 LD	(HL),A
003F05 CD     11258 CALL	CLEAN
003F06 FC   
003F07 3F   
003F08 C3     11259 CLOOP0:         JP	CLOOP
003F09 92   
003F0A 37   
003F0B CD     11263 SAVE:           CALL	EXPRS		;FILENAME
003F0C 1E   
003F0D 18   
003F0E 3E     11264 LD	A,CR
003F0F 0D   
003F10 12     11265 LD	(DE),A
003F11 ED     11266 LD	DE,(PAGE_)
003F12 5B   
003F13 DC   
003F14 54   
003F15 CD     11267 CALL	GETTOP
003F16 07   
003F17 40   
003F18 B7     11268 OR	A
003F19 ED     11269 SBC	HL,DE
003F1A 52   
003F1B 44     11270 LD	B,H		;LENGTH OF PROGRAM
003F1C 4D     11271 LD	C,L
003F1D 21     11272 LD	HL,ACCS
003F1E 00   
003F1F 52   
003F20 CD     11273 CALL	OSSAVE
003F21 A4   
003F22 07   
003F23 C3     11274 WARM0:          JP	WARM
003F24 91   
003F25 37   
003F26 21     11279 ERROR_:         LD	HL,ERRWDS
003F27 03   
003F28 3C   
003F29 4F     11280 LD	C,A
003F2A B7     11281 OR	A
003F2B 28     11282 JR	Z,ERROR1
003F2C 0C   
003F2D 47     11283 LD	B,A		;ERROR NUMBER
003F2E AF     11284 XOR	A
003F2F BE     11285 ERROR0:         CP	(HL)
003F30 23     11286 INC	HL
003F31 20     11287 JR	NZ,ERROR0
003F32 FC   
003F33 10     11288 DJNZ	ERROR0
003F34 FA   
003F35 18     11289 JR	ERROR1		;MUST NOT PUSH HL HERE
003F36 02   
003F37 E1     11291 EXTERR:         POP	HL
003F38 4F     11292 LD	C,A
003F39 22     11293 ERROR1:         LD	(ERRTXT),HL
003F3A EE   
003F3B 54   
003F3C 2A     11294 LD	HL,(ONERSP)
003F3D EC   
003F3E 54   
003F3F 7C     11295 LD	A,H
003F40 B5     11296 OR	L
003F41 ED     11297 LD	SP,(HIMEM)	;MUST SET SP BEFORE 'CALL'
003F42 7B   
003F43 E2   
003F44 54   
003F45 28     11298 JR	Z,ERROR4
003F46 01   
003F47 F9     11299 LD	SP,HL
003F48 79     11300 ERROR4:         LD	A,C		;ERROR NUMBER
003F49 CD     11301 CALL	SETLIN		;SP IS SET NOW
003F4A 3D   
003F4B 41   
003F4C 32     11302 LD	(ERR),A
003F4D FD   
003F4E 54   
003F4F 22     11303 LD	(ERL),HL
003F50 F2   
003F51 54   
003F52 B7     11304 OR	A
003F53 28     11305 JR	Z,ERROR2	;'FATAL' ERROR
003F54 0B   
003F55 2A     11306 LD	HL,(ERRTRP)
003F56 EA   
003F57 54   
003F58 7C     11307 LD	A,H
003F59 B5     11308 OR	L
003F5A E5     11309 PUSH	HL
003F5B FD     11310 POP	IY
003F5C E1   
003F5D C2     11311 JP	NZ,XEQ		;ERROR TRAPPED
003F5E 7B   
003F5F 24   
003F60 ED     11312 ERROR2:         LD	SP,(HIMEM)
003F61 7B   
003F62 E2   
003F63 54   
003F64 ED     11313 SBC	HL,HL
003F65 62   
003F66 22     11314 LD	(AUTONO),HL
003F67 E8   
003F68 54   
003F69 22     11315 LD	(TRACEN),HL	;CANCEL TRACE
003F6A E6   
003F6B 54   
003F6C CD     11316 CALL	RESET		;RESET OPSYS
003F6D 25   
003F6E 06   
003F6F CD     11317 CALL	CRLF
003F70 DD   
003F71 40   
003F72 CD     11318 CALL	REPORT		;MESSAGE
003F73 C7   
003F74 44   
003F75 2A     11319 LD	HL,(ERL)
003F76 F2   
003F77 54   
003F78 CD     11320 CALL	SAYLN
003F79 64   
003F7A 41   
003F7B 1E     11321 LD	E,0
003F7C 00   
003F7D DC     11322 CALL	C,OSSHUT	;CLOSE ALL FILES
003F7E 35   
003F7F 06   
003F80 CD     11323 CALL	CRLF
003F81 DD   
003F82 40   
003F83 18     11324 JR	CLOOP0
003F84 83   
003F85 21     11337 LEX:            LD	HL,KEYWDS
003F86 66   
003F87 38   
003F88 FD     11338 LEX0:           LD	A,(IY)
003F89 7E   
003F8A 00   
003F8B 46     11339 LD	B,(HL)
003F8C 23     11340 INC	HL
003F8D BE     11341 CP	(HL)
003F8E 28     11342 JR	Z,LEX2
003F8F 0A   
003F90 D8     11343 RET	C		;FAIL EXIT
003F91 23     11344 LEX1:           INC	HL
003F92 7E     11345 LD	A,(HL)
003F93 FE     11346 CP	160
003F94 A0   
003F95 EA     11347 JP	PE,LEX1
003F96 91   
003F97 3F   
003F98 18     11348 JR	LEX0
003F99 EE   
003F9A FD     11350 LEX2:           PUSH	IY		;SAVE POINTER
003F9B E5   
003F9C 23     11351 LEX3:           INC	HL
003F9D 7E     11352 LD	A,(HL)
003F9E FE     11353 CP	160
003F9F A0   
003FA0 E2     11354 JP	PO,LEX6		;FOUND
003FA1 C7   
003FA2 3F   
003FA3 FD     11355 INC	IY
003FA4 23   
003FA5 FD     11356 LD	A,(IY)
003FA6 7E   
003FA7 00   
003FA8 BE     11357 CP	(HL)
003FA9 20     11358 JR	NZ,LEX7
003FAA 05   
003FAB FE     11359 CP	161
003FAC A1   
003FAD EA     11360 JP	PE,LEX3
003FAE 9C   
003FAF 3F   
003FB0 FD     11361 LEX7:           LD	A,(IY)
003FB1 7E   
003FB2 00   
003FB3 FE     11362 CP	'.'
003FB4 2E   
003FB5 28     11363 JR	Z,LEX6		;FOUND (ABBREV.)
003FB6 10   
003FB7 CD     11364 CALL	RANGE1
003FB8 DE   
003FB9 43   
003FBA 38     11365 JR	C,LEX5
003FBB 04   
003FBC FD     11366 LEX4:           POP	IY		;RESTORE POINTER
003FBD E1   
003FBE 18     11367 JR	LEX1
003FBF D1   
003FC0 7E     11369 LEX5:           LD	A,(HL)
003FC1 FE     11370 CP	' '
003FC2 20   
003FC3 20     11371 JR	NZ,LEX4
003FC4 F7   
003FC5 FD     11372 DEC	IY
003FC6 2B   
003FC7 F1     11373 LEX6:           POP	AF
003FC8 AF     11374 XOR	A
003FC9 78     11375 LD	A,B
003FCA C9     11376 RET
003FCB D5     11382 DEL:            PUSH	DE
003FCC E5     11383 PUSH	HL
003FCD E5     11384 PUSH	HL
003FCE 06     11385 LD	B,0
003FCF 00   
003FD0 4E     11386 LD	C,(HL)
003FD1 09     11387 ADD	HL,BC
003FD2 E5     11388 PUSH	HL
003FD3 EB     11389 EX	DE,HL
003FD4 CD     11390 CALL	GETTOP
003FD5 07   
003FD6 40   
003FD7 ED     11391 SBC	HL,DE
003FD8 52   
003FD9 44     11392 LD	B,H
003FDA 4D     11393 LD	C,L
003FDB E1     11394 POP	HL
003FDC D1     11395 POP	DE
003FDD ED     11396 LDIR			;DELETE LINE
003FDE B0   
003FDF E1     11397 POP	HL
003FE0 D1     11398 POP	DE
003FE1 C9     11399 RET
003FE2 ED     11409 LOAD0:          LD	DE,(PAGE_)
003FE3 5B   
003FE4 DC   
003FE5 54   
003FE6 21     11410 LD	HL,-256
003FE7 00   
003FE8 FF   
003FE9 39     11411 ADD	HL,SP
003FEA ED     11412 SBC	HL,DE		;FIND AVAILABLE SPACE
003FEB 52   
003FEC 44     11413 LD	B,H
003FED 4D     11414 LD	C,L
003FEE 21     11415 LD	HL,ACCS
003FEF 00   
003FF0 52   
003FF1 CD     11416 CALL	OSLOAD		;LOAD
003FF2 AE   
003FF3 06   
003FF4 D4     11417 CALL	NC,NEWIT
003FF5 20   
003FF6 40   
003FF7 3E     11418 LD	A,0
003FF8 00   
003FF9 D2     11419 JP	NC,ERROR_	;"No room"
003FFA 26   
003FFB 3F   
003FFC CD     11420 CLEAN:          CALL	GETTOP
003FFD 07   
003FFE 40   
003FFF 2B     11421 DEC	HL
004000 36     11422 LD	(HL),-1		;WRITE &FFFF
004001 FF   
004002 2B     11423 DEC	HL
004003 36     11424 LD	(HL),-1
004004 FF   
004005 18     11425 JR	CLEAR
004006 1E   
004007 2A     11427 GETTOP:         LD	HL,(PAGE_)
004008 DC   
004009 54   
00400A 06     11428 LD	B,0
00400B 00   
00400C 3E     11429 LD	A,CR
00400D 0D   
00400E 4E     11430 GETOP1:         LD	C,(HL)
00400F 0C     11431 INC	C
004010 0D     11432 DEC	C
004011 28     11433 JR	Z,GETOP2
004012 09   
004013 09     11434 ADD	HL,BC
004014 2B     11435 DEC	HL
004015 BE     11436 CP	(HL)
004016 23     11437 INC	HL
004017 28     11438 JR	Z,GETOP1
004018 F5   
004019 C3     11439 JP	BAD
00401A D1   
00401B 3E   
00401C 23     11440 GETOP2:         INC	HL		;N.B. CALLED FROM NEWIT
00401D 23     11441 INC	HL
00401E 23     11442 INC	HL
00401F C9     11443 RET
004020 2A     11452 NEWIT:          LD	HL,(PAGE_)
004021 DC   
004022 54   
004023 36     11453 LD	(HL),0
004024 00   
004025 E5     11454 CLEAR:          PUSH	HL
004026 C5     11455 PUSH	BC
004027 F5     11456 PUSH	AF
004028 CD     11457 CALL	GETTOP
004029 07   
00402A 40   
00402B 22     11458 LD	(LOMEM),HL
00402C DE   
00402D 54   
00402E 22     11459 LD	(FREE),HL
00402F E0   
004030 54   
004031 21     11460 LD	HL,DYNVAR
004032 6C   
004033 54   
004034 06     11462 LD	B,54+2*2
004035 70   
004036 36     11463 CLEAR1:         LD	(HL),0
004037 00   
004038 23     11464 INC	HL
004039 10     11465 DJNZ	CLEAR1
00403A FB   
00403B F1     11466 POP	AF
00403C C1     11467 POP	BC
00403D E1     11468 POP	HL
00403E C9     11469 RET
00403F E5     11478 LISTIT:         PUSH	HL
004040 EB     11479 EX	DE,HL
004041 C5     11480 PUSH	BC
004042 CD     11481 CALL	PBCD
004043 78   
004044 41   
004045 C1     11482 POP	BC
004046 E1     11483 POP	HL
004047 7E     11484 LD	A,(HL)
004048 D9     11485 EXX
004049 21     11486 LD	HL,TOKSUB
00404A 60   
00404B 3D   
00404C 01     11487 LD	BC,LENSUB
00404D 08   
00404E 00   
00404F ED     11488 CPIR
004050 B1   
004051 CC     11489 CALL	Z,INDSUB
004052 D7   
004053 40   
004054 FE     11490 CP	TENDCASE
004055 CB   
004056 CC     11491 CALL	Z,INDSUB
004057 D7   
004058 40   
004059 3E     11492 LD	A,' '
00405A 20   
00405B DD     11493 BIT	0,(IX)
00405C CB   
00405D 00   
00405E 46   
00405F C4     11494 CALL	NZ,OUTCHR
004060 E4   
004061 40   
004062 7B     11495 LD	A,E
004063 87     11496 ADD	A,A
004064 DD     11497 BIT	1,(IX)
004065 CB   
004066 00   
004067 4E   
004068 C4     11498 CALL	NZ,SPACES
004069 85   
00406A 35   
00406B D9     11499 EXX
00406C 7E     11500 LD	A,(HL)
00406D 1E     11501 LD	E,0
00406E 00   
00406F D9     11502 EXX
004070 01     11503 LD	BC,LENADD
004071 07   
004072 00   
004073 21     11504 LIST5:          LD	HL,TOKADD
004074 59   
004075 3D   
004076 ED     11505 CPIR
004077 B1   
004078 CC     11506 CALL	Z,INDADD
004079 DB   
00407A 40   
00407B FE     11507 CP	TCASE
00407C C8   
00407D CC     11508 CALL	Z,INDADD
00407E DB   
00407F 40   
004080 D9     11509 EXX
004081 7E     11510 LIST8:          LD	A,(HL)
004082 23     11511 INC	HL
004083 FE     11512 CP	CR
004084 0D   
004085 28     11513 JR	Z,LIST9
004086 25   
004087 57     11514 LD	D,A
004088 FE     11515 CP	TEXIT
004089 10   
00408A 20     11516 JR	NZ,LIST6
00408B 02   
00408C CB     11517 SET	7,E
00408D FB   
00408E FE     11518 LIST6:          CP	'"'
00408F 22   
004090 20     11519 JR	NZ,LIST7
004091 01   
004092 1C     11520 INC	E
004093 CD     11521 LIST7:          CALL	LOUT
004094 CB   
004095 40   
004096 7B     11522 LD	A,E
004097 E6     11523 AND	81H
004098 81   
004099 20     11524 JR	NZ,LIST8
00409A E6   
00409B 7E     11525 LD	A,(HL)
00409C D9     11526 EXX
00409D 21     11527 LD	HL,TOKSUB
00409E 60   
00409F 3D   
0040A0 01     11528 LD	BC,3
0040A1 03   
0040A2 00   
0040A3 ED     11529 CPIR
0040A4 B1   
0040A5 CC     11530 CALL	Z,INDSUB
0040A6 D7   
0040A7 40   
0040A8 0E     11531 LD	C,4
0040A9 04   
0040AA 18     11532 JR	LIST5
0040AB C7   
0040AC 7A     11534 LIST9:          LD	A,D
0040AD FE     11535 CP	TTHEN
0040AE 8C   
0040AF D9     11536 EXX
0040B0 CC     11537 CALL	Z,INDADD
0040B1 DB   
0040B2 40   
0040B3 D9     11538 EXX
0040B4 18     11539 JR	CRLF
0040B5 27   
0040B6 E5     11541 PRLINO:         PUSH	HL
0040B7 FD     11542 POP	IY
0040B8 E1   
0040B9 C5     11543 PUSH	BC
0040BA CD     11544 CALL	DECODE
0040BB 42   
0040BC 1F   
0040BD C1     11545 POP	BC
0040BE D9     11546 EXX
0040BF C5     11547 PUSH	BC
0040C0 D5     11548 PUSH	DE
0040C1 CD     11549 CALL	PBCDL
0040C2 74   
0040C3 41   
0040C4 D1     11550 POP	DE
0040C5 C1     11551 POP	BC
0040C6 D9     11552 EXX
0040C7 FD     11553 PUSH	IY
0040C8 E5   
0040C9 E1     11554 POP	HL
0040CA C9     11555 RET
0040CB CB     11557 LOUT:           BIT	0,E
0040CC 43   
0040CD 20     11558 JR	NZ,OUTCHR
0040CE 15   
0040CF FE     11559 CP	TLINO
0040D0 8D   
0040D1 28     11560 JR	Z,PRLINO
0040D2 E3   
0040D3 CD     11561 CALL	OUT
0040D4 FD   
0040D5 40   
0040D6 C9     11562 RET
0040D7 1D     11564 INDSUB:         DEC	E
0040D8 F2     11565 JP	P,INDRET
0040D9 DC   
0040DA 40   
0040DB 1C     11566 INDADD:         INC	E
0040DC C9     11567 INDRET:         RET
0040DD 3E     11575 CRLF:           LD	A,CR
0040DE 0D   
0040DF CD     11576 CALL	OUTCHR
0040E0 E4   
0040E1 40   
0040E2 3E     11577 LD	A,LF
0040E3 0A   
0040E4 CD     11578 OUTCHR:         CALL	OSWRCH
0040E5 93   
0040E6 05   
0040E7 D6     11579 SUB	CR
0040E8 0D   
0040E9 28     11580 JR	Z,CARRET
0040EA 05   
0040EB D8     11581 RET	C		;NON-PRINTING
0040EC 3A     11582 LD	A,(COUNT)
0040ED FB   
0040EE 54   
0040EF 3C     11583 INC	A
0040F0 32     11584 CARRET:         LD	(COUNT),A
0040F1 FB   
0040F2 54   
0040F3 C8     11585 RET	Z
0040F4 E5     11586 PUSH	HL
0040F5 2A     11587 LD	HL,(WIDTH)
0040F6 FC   
0040F7 54   
0040F8 BD     11588 CP	L
0040F9 E1     11589 POP	HL
0040FA C0     11590 RET	NZ
0040FB 18     11591 JR	CRLF
0040FC E0   
0040FD FE     11598 OUT:            CP	160
0040FE A0   
0040FF EA     11599 JP	PE,OUTCHR
004100 E4   
004101 40   
004102 C5     11600 PUSH	BC
004103 E5     11601 PUSH	HL
004104 21     11602 LD	HL,KEYWDS
004105 66   
004106 38   
004107 01     11603 LD	BC,KEYWDL
004108 5B   
004109 03   
00410A ED     11604 CPIR
00410B B1   
00410C C4     11605 CALL	NZ,OUTCHR
00410D E4   
00410E 40   
00410F 06     11606 LD	B,160
004110 A0   
004111 FE     11607 CP	145
004112 91   
004113 EA     11608 JP	PE,TOKEN1
004114 17   
004115 41   
004116 04     11609 INC	B
004117 7E     11610 TOKEN1:         LD	A,(HL)
004118 23     11611 INC	HL
004119 B8     11612 CP	B
00411A F5     11613 PUSH	AF
00411B EC     11614 CALL	PE,OUTCHR
00411C E4   
00411D 40   
00411E F1     11615 POP	AF
00411F EA     11616 JP	PE,TOKEN1
004120 17   
004121 41   
004122 E1     11617 POP	HL
004123 C1     11618 POP	BC
004124 C9     11619 RET
004125 EB     11628 FINDL:          EX	DE,HL
004126 2A     11629 LD	HL,(PAGE_)
004127 DC   
004128 54   
004129 AF     11630 XOR	A		;A=0
00412A BE     11631 CP	(HL)
00412B 3C     11632 INC	A
00412C D0     11633 RET	NC
00412D AF     11634 XOR	A		;CLEAR CARRY
00412E 47     11635 LD	B,A
00412F 4E     11636 FINDL1:         LD	C,(HL)
004130 E5     11637 PUSH	HL
004131 23     11638 INC	HL
004132 7E     11639 LD	A,(HL)
004133 23     11640 INC	HL
004134 66     11641 LD	H,(HL)
004135 6F     11642 LD	L,A
004136 ED     11643 SBC	HL,DE
004137 52   
004138 E1     11644 POP	HL
004139 D0     11645 RET	NC		;FOUND | PAST
00413A 09     11646 ADD	HL,BC
00413B 18     11647 JR	FINDL1
00413C F2   
00413D 06     11654 SETLIN:         LD	B,0
00413E 00   
00413F ED     11655 LD	DE,(CURLIN)
004140 5B   
004141 F4   
004142 54   
004143 2A     11656 LD	HL,(PAGE_)
004144 DC   
004145 54   
004146 B7     11657 OR	A
004147 ED     11658 SBC	HL,DE
004148 52   
004149 19     11659 ADD	HL,DE
00414A 30     11660 JR	NC,SET3
00414B 13   
00414C 4E     11661 SET1:           LD	C,(HL)
00414D 0C     11662 INC	C
00414E 0D     11663 DEC	C
00414F 28     11664 JR	Z,SET3
004150 0E   
004151 09     11665 ADD	HL,BC
004152 ED     11666 SBC	HL,DE
004153 52   
004154 19     11667 ADD	HL,DE
004155 38     11668 JR	C,SET1
004156 F5   
004157 ED     11669 SBC	HL,BC
004158 42   
004159 23     11670 INC	HL
00415A 5E     11671 LD	E,(HL)		;LINE NUMBER
00415B 23     11672 INC	HL
00415C 56     11673 LD	D,(HL)
00415D EB     11674 EX	DE,HL
00415E C9     11675 SET2:           RET
00415F 21     11677 SET3:           LD	HL,0
004160 00   
004161 00   
004162 18     11678 JR	SET2
004163 FA   
004164 7C     11686 SAYLN:          LD	A,H
004165 B5     11687 OR	L
004166 C8     11688 RET	Z
004167 CD     11689 CALL	TELL
004168 DC   
004169 44   
00416A 20     11690 DB	" at line "
00416B 61   
00416C 74   
00416D 20   
00416E 6C   
00416F 69   
004170 6E   
004171 65   
004172 20   
004173 00     11691 DB	0
004174 0E     11692 PBCDL:          LD	C,0
004175 00   
004176 18     11693 JR	PBCD0
004177 02   
004178 0E     11700 PBCD:           LD	C,' '
004179 20   
00417A 06     11701 PBCD0:          LD	B,5
00417B 05   
00417C 11     11702 LD	DE,10000
00417D 10   
00417E 27   
00417F AF     11703 PBCD1:          XOR	A
004180 ED     11704 PBCD2:          SBC	HL,DE
004181 52   
004182 3C     11705 INC	A
004183 30     11706 JR	NC,PBCD2
004184 FB   
004185 19     11707 ADD	HL,DE
004186 3D     11708 DEC	A
004187 28     11709 JR	Z,PBCD3
004188 04   
004189 CB     11710 SET	4,C
00418A E1   
00418B CB     11711 SET	5,C
00418C E9   
00418D B1     11712 PBCD3:          OR	C
00418E C4     11713 CALL	NZ,OUTCHR
00418F E4   
004190 40   
004191 78     11714 LD	A,B
004192 FE     11715 CP	5
004193 05   
004194 28     11716 JR	Z,PBCD4
004195 06   
004196 29     11717 ADD	HL,HL
004197 54     11718 LD	D,H
004198 5D     11719 LD	E,L
004199 29     11720 ADD	HL,HL
00419A 29     11721 ADD	HL,HL
00419B 19     11722 ADD	HL,DE
00419C 11     11723 PBCD4:          LD	DE,1000
00419D E8   
00419E 03   
00419F 10     11724 DJNZ	PBCD1
0041A0 DE   
0041A1 37     11725 SCF
0041A2 C9     11726 RET
0041A3 FD     11730 GETV1:          INC	IY
0041A4 23   
0041A5 FD     11731 INC	IY		;SKIP ()
0041A6 23   
0041A7 E5     11732 PUSH	HL		;SET EXIT CONDITIONS
0041A8 DD     11733 POP	IX
0041A9 E1   
0041AA 7A     11734 LD	A,D
0041AB F6     11735 OR	64		;FLAG ARRAY
0041AC 40   
0041AD BF     11736 CP	A
0041AE C9     11737 RET
0041AF CD     11744 PUTVAR:         CALL	CREATE
0041B0 1E   
0041B1 43   
0041B2 FD     11745 LD	A,(IY)
0041B3 7E   
0041B4 00   
0041B5 FE     11746 CP	'('
0041B6 28   
0041B7 20     11747 JR	NZ,GETVZ	;SET EXIT CONDITIONS
0041B8 7D   
0041B9 FD     11748 LD	A,(IY+1)
0041BA 7E   
0041BB 01   
0041BC FE     11749 CP	')'		;WHOLE ARRAY?
0041BD 29   
0041BE 28     11750 JR	Z,GETV1
0041BF E3   
0041C0 3E     11751 ARRAY:          LD	A,14		;'Bad use of array'
0041C1 0E   
0041C2 C3     11752 ERROR3:         JP	ERROR_
0041C3 26   
0041C4 3F   
0041C5 FD     11766 GETVAR:         LD	A,(IY)
0041C6 7E   
0041C7 00   
0041C8 FE     11767 CP	'!'
0041C9 21   
0041CA 28     11768 JR	Z,GETV5
0041CB 76   
0041CC FE     11769 CP	'?'
0041CD 3F   
0041CE 28     11770 JR	Z,GETV6
0041CF 76   
0041D0 FE     11771 CP	'|'
0041D1 7C   
0041D2 28     11772 JR	Z,GETVF
0041D3 75   
0041D4 FE     11773 CP	'$'
0041D5 24   
0041D6 28     11774 JR	Z,GETV4
0041D7 75   
0041D8 CD     11775 CALL	LOCATE
0041D9 92   
0041DA 42   
0041DB C0     11776 RET	NZ
0041DC FD     11777 LD	A,(IY)
0041DD 7E   
0041DE 00   
0041DF FE     11778 CP	'('		;ARRAY?
0041E0 28   
0041E1 20     11779 JR	NZ,GETVX	;EXIT
0041E2 4B   
0041E3 FD     11780 LD	A,(IY+1)
0041E4 7E   
0041E5 01   
0041E6 FE     11781 CP	')'		;WHOLE ARRAY?
0041E7 29   
0041E8 28     11782 JR	Z,GETV1
0041E9 B9   
0041EA D5     11783 PUSH	DE		;SAVE TYPE
0041EB 7E     11784 LD	A,(HL)
0041EC 23     11785 INC	HL
0041ED 66     11786 LD	H,(HL)
0041EE 6F     11787 LD	L,A		;INDIRECT LINK
0041EF E6     11788 AND	0FEH
0041F0 FE   
0041F1 B4     11789 OR	H
0041F2 28     11790 JR	Z,ARRAY
0041F3 CC   
0041F4 7E     11791 LD	A,(HL)		;NO. OF DIMENSIONS
0041F5 B7     11792 OR	A
0041F6 28     11793 JR	Z,ARRAY
0041F7 C8   
0041F8 23     11794 INC	HL
0041F9 11     11795 LD	DE,0		;ACCUMULATOR
0041FA 00   
0041FB 00   
0041FC F5     11796 PUSH	AF
0041FD FD     11797 INC	IY		;SKIP (
0041FE 23   
0041FF E5     11798 GETV3:          PUSH	HL
004200 D5     11799 PUSH	DE
004201 CD     11800 CALL	EXPRI		;SUBSCRIPT
004202 15   
004203 18   
004204 D9     11801 EXX
004205 D1     11802 POP	DE
004206 E3     11803 EX	(SP),HL
004207 4E     11804 LD	C,(HL)
004208 23     11805 INC	HL
004209 46     11806 LD	B,(HL)
00420A 23     11807 INC	HL
00420B E3     11808 EX	(SP),HL
00420C EB     11809 EX	DE,HL
00420D D5     11810 PUSH	DE
00420E CD     11811 CALL	MUL16		;HL=HL*BC
00420F 9F   
004210 36   
004211 D1     11812 POP	DE
004212 19     11813 ADD	HL,DE
004213 EB     11814 EX	DE,HL
004214 B7     11815 OR	A
004215 ED     11816 SBC	HL,BC
004216 42   
004217 3E     11817 LD	A,15
004218 0F   
004219 30     11818 JR	NC,ERROR3	;"Subscript"
00421A A7   
00421B E1     11819 POP	HL
00421C F1     11820 POP	AF
00421D 3D     11821 DEC	A		;DIMENSION COUNTER
00421E 20     11822 JR	NZ,GETV2
00421F 1C   
004220 CD     11823 CALL	BRAKET		;CLOSING BRACKET
004221 90   
004222 20   
004223 F1     11824 POP	AF		;RESTORE TYPE
004224 E5     11825 PUSH	HL
004225 CD     11826 CALL	X14OR5		;DE=DE*n
004226 8F   
004227 36   
004228 E1     11827 POP	HL
004229 19     11828 ADD	HL,DE
00422A 57     11829 LD	D,A		;TYPE
00422B FD     11830 LD	A,(IY)
00422C 7E   
00422D 00   
00422E FE     11831 GETVX:          CP	'?'
00422F 3F   
004230 28     11832 JR	Z,GETV9
004231 26   
004232 FE     11833 CP	'!'
004233 21   
004234 28     11834 JR	Z,GETV8
004235 1E   
004236 E5     11835 GETVZ:          PUSH	HL		;SET EXIT CONDITIONS
004237 DD     11836 POP	IX
004238 E1   
004239 7A     11837 LD	A,D
00423A BF     11838 CP	A
00423B C9     11839 RET
00423C F5     11841 GETV2:          PUSH	AF
00423D CD     11842 CALL	COMMA
00423E 84   
00423F 20   
004240 18     11843 JR	GETV3
004241 BD   
004242 3E     11847 GETV5:          LD	A,4		;UNARY 32-BIT INDIRN.
004243 04   
004244 18     11848 JR	GETV7
004245 09   
004246 AF     11849 GETV6:          XOR	A		;UNARY 8-BIT INDIRECTION
004247 18     11850 JR	GETV7
004248 06   
004249 3E     11851 GETVF:          LD	A,5		;VARIANT INDIRECTION
00424A 05   
00424B 18     11852 JR	GETV7
00424C 02   
00424D 3E     11853 GETV4:          LD	A,128		;STATIC STRING
00424E 80   
00424F ED     11854 GETV7:          SBC	HL,HL
004250 62   
004251 F5     11855 PUSH	AF
004252 18     11856 JR	GETV0
004253 15   
004254 06     11858 GETV8:          LD	B,4		;32-BIT BINARY INDIRN.
004255 04   
004256 18     11859 JR	GETVA
004257 02   
004258 06     11860 GETV9:          LD	B,0		;8-BIT BINARY INDIRN.
004259 00   
00425A E5     11861 GETVA:          PUSH	HL
00425B DD     11862 POP	IX
00425C E1   
00425D 7A     11863 LD	A,D		;TYPE
00425E FE     11864 CP	129
00425F 81   
004260 C8     11865 RET	Z		;STRING!
004261 C5     11866 PUSH	BC
004262 CD     11867 CALL	LOADN		;LEFT OPERAND
004263 07   
004264 19   
004265 CD     11868 CALL	SFIX
004266 F9   
004267 1B   
004268 D9     11869 EXX
004269 E5     11870 GETV0:          PUSH	HL
00426A FD     11871 INC	IY
00426B 23   
00426C CD     11872 CALL	ITEMI
00426D 42   
00426E 18   
00426F D9     11873 EXX
004270 D1     11874 POP	DE
004271 F1     11875 POP	AF
004272 19     11876 ADD	HL,DE
004273 E5     11877 PUSH	HL
004274 DD     11878 POP	IX
004275 E1   
004276 BF     11879 CP	A
004277 C9     11880 RET
004278 FD     11890 GETDEF:         LD	A,(IY+1)
004279 7E   
00427A 01   
00427B CD     11891 CALL	RANGE1
00427C DE   
00427D 43   
00427E D8     11892 RET	C
00427F FD     11893 LD	A,(IY)
004280 7E   
004281 00   
004282 21     11894 LD	HL,FNPTR
004283 D8   
004284 54   
004285 FE     11895 CP	TFN
004286 A4   
004287 28     11896 JR	Z,LOC2
004288 43   
004289 21     11897 LD	HL,PROPTR
00428A DA   
00428B 54   
00428C FE     11898 CP	TPROC
00428D F2   
00428E 28     11899 JR	Z,LOC2
00428F 3C   
004290 37     11900 SCF
004291 C9     11901 RET
004292 D6     11917 LOCATE:         SUB	'@'
004293 40   
004294 D8     11918 RET	C
004295 26     11919 LD	H,0
004296 00   
004297 FE     11920 CP	'Z'-'@'+1
004298 1B   
004299 30     11921 JR	NC,LOC0		;NOT STATIC
00429A 1D   
00429B 87     11922 ADD	A,A
00429C 6F     11923 LD	L,A
00429D FD     11924 LD	A,(IY+1)	;2nd CHARACTER
00429E 7E   
00429F 01   
0042A0 FE     11925 CP	'%'
0042A1 25   
0042A2 20     11926 JR	NZ,LOC1		;NOT STATIC
0042A3 20   
0042A4 FD     11927 LD	A,(IY+2)
0042A5 7E   
0042A6 02   
0042A7 FE     11928 CP	'('
0042A8 28   
0042A9 28     11929 JR	Z,LOC1		;NOT STATIC
0042AA 19   
0042AB 29     11930 ADD	HL,HL
0042AC 11     11931 LD	DE,STAVAR	;STATIC VARIABLES
0042AD 00   
0042AE 54   
0042AF 19     11932 ADD	HL,DE
0042B0 FD     11933 INC	IY
0042B1 23   
0042B2 FD     11934 INC	IY
0042B3 23   
0042B4 16     11935 LD	D,4		;INTEGER TYPE
0042B5 04   
0042B6 AF     11936 XOR	A
0042B7 C9     11937 RET
0042B8 FE     11939 LOC0:           CP	'_'-'@'
0042B9 1F   
0042BA D8     11940 RET	C
0042BB FE     11941 CP	'z'-'@'+1
0042BC 3B   
0042BD 3F     11942 CCF
0042BE 3D     11943 DEC	A		;SET NZ
0042BF D8     11944 RET	C
0042C0 D6     11945 SUB	3
0042C1 03   
0042C2 87     11946 ADD	A,A
0042C3 6F     11947 LD	L,A
0042C4 11     11948 LOC1:           LD	DE,DYNVAR	;DYNAMIC VARIABLES
0042C5 6C   
0042C6 54   
0042C7 2D     11949 DEC	L
0042C8 2D     11950 DEC	L
0042C9 37     11951 SCF
0042CA F8     11952 RET	M
0042CB 19     11953 ADD	HL,DE
0042CC 5E     11954 LOC2:           LD	E,(HL)
0042CD 23     11955 INC	HL
0042CE 56     11956 LD	D,(HL)
0042CF 7A     11957 LD	A,D
0042D0 B3     11958 OR	E
0042D1 28     11959 JR	Z,LOC6		;UNDEFINED VARIABLE
0042D2 49   
0042D3 62     11960 LD	H,D
0042D4 6B     11961 LD	L,E
0042D5 23     11962 INC	HL		;SKIP LINK
0042D6 23     11963 INC	HL
0042D7 FD     11964 PUSH	IY
0042D8 E5   
0042D9 7E     11965 LOC3:           LD	A,(HL)		;COMPARE
0042DA 23     11966 INC	HL
0042DB FD     11967 INC	IY
0042DC 23   
0042DD FD     11968 CP	(IY)
0042DE BE   
0042DF 00   
0042E0 28     11969 JR	Z,LOC3
0042E1 F7   
0042E2 B7     11970 OR	A		;0=TERMINATOR
0042E3 28     11971 JR	Z,LOC5		;FOUND (MAYBE)
0042E4 05   
0042E5 FD     11972 LOC4:           POP	IY
0042E6 E1   
0042E7 EB     11973 EX	DE,HL
0042E8 18     11974 JR	LOC2		;TRY NEXT ENTRY
0042E9 E2   
0042EA FD     11976 LOC5:           DEC	IY
0042EB 2B   
0042EC FD     11977 LD	A,(IY)
0042ED 7E   
0042EE 00   
0042EF FE     11978 CP	'('
0042F0 28   
0042F1 28     11979 JR	Z,LOCX		;FOUND
0042F2 13   
0042F3 FD     11980 INC	IY
0042F4 23   
0042F5 CD     11981 CALL	RANGE
0042F6 D1   
0042F7 43   
0042F8 38     11982 JR	C,LOCX		;FOUND
0042F9 0C   
0042FA FE     11983 CP	'('
0042FB 28   
0042FC 28     11984 JR	Z,LOC4		;KEEP LOOKING
0042FD E7   
0042FE FD     11985 LD	A,(IY-1)
0042FF 7E   
004300 FF   
004301 CD     11986 CALL	RANGE1
004302 DE   
004303 43   
004304 30     11987 JR	NC,LOC4		;KEEP LOOKING
004305 DF   
004306 D1     11988 LOCX:           POP	DE
004307 FD     11989 TYPE:           LD	A,(IY-1)
004308 7E   
004309 FF   
00430A FE     11990 CP	'$'
00430B 24   
00430C 16     11991 LD	D,129
00430D 81   
00430E C8     11992 RET	Z		;STRING
00430F FE     11993 CP	'&'
004310 26   
004311 16     11994 LD	D,1
004312 01   
004313 C8     11995 RET	Z		;BYTE
004314 FE     11996 CP	'%'
004315 25   
004316 16     11997 LD	D,4
004317 04   
004318 C8     11998 RET	Z		;INTEGER
004319 14     11999 INC	D
00431A BF     12000 CP	A
00431B C9     12001 RET
00431C 3C     12003 LOC6:           INC	A		;SET NZ
00431D C9     12004 RET
00431E AF     12011 CREATE:         XOR	A
00431F ED     12012 LD	DE,(FREE)
004320 5B   
004321 E0   
004322 54   
004323 72     12013 LD	(HL),D
004324 2B     12014 DEC	HL
004325 73     12015 LD	(HL),E
004326 EB     12016 EX	DE,HL
004327 77     12017 LD	(HL),A
004328 23     12018 INC	HL
004329 77     12019 LD	(HL),A
00432A 23     12020 INC	HL
00432B FD     12021 LOC7:           INC	IY
00432C 23   
00432D CD     12022 CALL	RANGE		;END OF VARIABLE?
00432E D1   
00432F 43   
004330 38     12023 JR	C,LOC8
004331 14   
004332 77     12024 LD	(HL),A
004333 23     12025 INC	HL
004334 CD     12026 CALL	RANGE1
004335 DE   
004336 43   
004337 30     12027 JR	NC,LOC7
004338 F2   
004339 FE     12028 CP	'('
00433A 28   
00433B 28     12029 JR	Z,LOC8
00433C 09   
00433D FD     12030 LD	A,(IY+1)
00433E 7E   
00433F 01   
004340 FE     12031 CP	'('
004341 28   
004342 28     12032 JR	Z,LOC7
004343 E7   
004344 FD     12033 INC	IY
004345 23   
004346 36     12034 LOC8:           LD	(HL),0		;TERMINATOR
004347 00   
004348 23     12035 INC	HL
004349 E5     12036 PUSH	HL
00434A CD     12037 CALL	TYPE
00434B 07   
00434C 43   
00434D FD     12038 LD	A,(IY)
00434E 7E   
00434F 00   
004350 FE     12039 CP	'('
004351 28   
004352 3E     12040 LD	A,2		;SIZE OF INDIRECT LINK
004353 02   
004354 28     12041 JR	Z,LOC9
004355 07   
004356 7A     12042 LD	A,D
004357 B7     12043 OR	A		;STRING?
004358 F2     12044 JP	P,LOC9
004359 5D   
00435A 43   
00435B 3E     12045 LD	A,4
00435C 04   
00435D 36     12046 LOC9:           LD	(HL),0		;INITIALISE TO ZERO
00435E 00   
00435F 23     12047 INC	HL
004360 3D     12048 DEC	A
004361 20     12049 JR	NZ,LOC9
004362 FA   
004363 22     12050 LD	(FREE),HL
004364 E0   
004365 54   
004366 CD     12051 CALL	CHECK
004367 68   
004368 32   
004369 E1     12052 POP	HL
00436A AF     12053 XOR	A
00436B C9     12054 RET
00436C CD     12062 LINNUM:         CALL	NXT
00436D ED   
00436E 44   
00436F 21     12063 LD	HL,0
004370 00   
004371 00   
004372 FD     12064 LINNM1:         LD	A,(IY)
004373 7E   
004374 00   
004375 D6     12065 SUB	'0'
004376 30   
004377 D8     12066 RET	C
004378 FE     12067 CP	10
004379 0A   
00437A D0     12068 RET	NC
00437B FD     12069 INC	IY
00437C 23   
00437D 54     12070 LD	D,H
00437E 5D     12071 LD	E,L
00437F 29     12072 ADD	HL,HL		;*2
004380 38     12073 JR	C,TOOBIGmn
004381 0F   
004382 29     12074 ADD	HL,HL		;*4
004383 38     12075 JR	C,TOOBIGmn
004384 0C   
004385 19     12076 ADD	HL,DE		;*5
004386 38     12077 JR	C,TOOBIGmn
004387 09   
004388 29     12078 ADD	HL,HL		;*10
004389 38     12079 JR	C,TOOBIGmn
00438A 06   
00438B 5F     12080 LD	E,A
00438C 16     12081 LD	D,0
00438D 00   
00438E 19     12082 ADD	HL,DE		;ADD IN DIGIT
00438F 30     12083 JR	NC,LINNM1
004390 E1   
004391 3E     12084 TOOBIGmn:         LD	A,20
004392 14   
004393 C3     12085 JP	ERROR_		;"Too big"
004394 26   
004395 3F   
004396 CD     12093 PAIR:           CALL	LINNUM		;FIRST
004397 6C   
004398 43   
004399 7C     12094 LD	A,H
00439A B5     12095 OR	L
00439B 20     12096 JR	NZ,PAIR1
00439C 02   
00439D 2E     12097 LD	L,10
00439E 0A   
00439F CD     12098 PAIR1:          CALL	TERMQ
0043A0 18   
0043A1 35   
0043A2 FD     12099 INC	IY
0043A3 23   
0043A4 E5     12100 PUSH	HL
0043A5 21     12101 LD	HL,10
0043A6 0A   
0043A7 00   
0043A8 C4     12102 CALL	NZ,LINNUM	;SECOND
0043A9 6C   
0043AA 43   
0043AB E3     12103 EX	(SP),HL
0043AC C1     12104 POP	BC
0043AD 78     12105 LD	A,B
0043AE B1     12106 OR	C
0043AF C0     12107 RET	NZ
0043B0 CD     12108 CALL	EXTERR
0043B1 37   
0043B2 3F   
0043B3 53     12109 DB	"Silly"
0043B4 69   
0043B5 6C   
0043B6 6C   
0043B7 79   
0043B8 00     12110 DB	0
0043B9 CD     12118 DLPAIR:         CALL	LINNUM
0043BA 6C   
0043BB 43   
0043BC E5     12119 PUSH	HL
0043BD CD     12120 CALL	TERMQ
0043BE 18   
0043BF 35   
0043C0 28     12121 JR	Z,DLP1
0043C1 09   
0043C2 FE     12122 CP	TIF
0043C3 E7   
0043C4 28     12123 JR	Z,DLP1
0043C5 05   
0043C6 FD     12124 INC	IY
0043C7 23   
0043C8 CD     12125 CALL	LINNUM
0043C9 6C   
0043CA 43   
0043CB E3     12126 DLP1:           EX	(SP),HL
0043CC CD     12127 CALL	FINDL
0043CD 25   
0043CE 41   
0043CF C1     12128 POP	BC
0043D0 C9     12129 RET
0043D1 FD     12136 RANGE:          LD	A,(IY)
0043D2 7E   
0043D3 00   
0043D4 FE     12137 CP	'$'
0043D5 24   
0043D6 D8     12138 RET	C
0043D7 FE     12139 CP	'&'+1
0043D8 27   
0043D9 3F     12140 CCF
0043DA D0     12141 RET	NC
0043DB FE     12142 CP	'('
0043DC 28   
0043DD C8     12143 RET	Z
0043DE FE     12144 RANGE1:         CP	'0'
0043DF 30   
0043E0 D8     12145 RET	C
0043E1 FE     12146 CP	'9'+1
0043E2 3A   
0043E3 3F     12147 CCF
0043E4 D0     12148 RET	NC
0043E5 FE     12149 CP	'@'		;V2.4
0043E6 40   
0043E7 C8     12150 RET	Z
0043E8 FE     12151 RANGE2:         CP	'A'
0043E9 41   
0043EA D8     12152 RET	C
0043EB FE     12153 CP	'Z'+1
0043EC 5B   
0043ED 3F     12154 CCF
0043EE D0     12155 RET	NC
0043EF FE     12156 CP	'_'
0043F0 5F   
0043F1 D8     12157 RET	C
0043F2 FE     12158 CP	'z'+1
0043F3 7B   
0043F4 3F     12159 CCF
0043F5 C9     12160 RET
0043F6 12     12176 LEXAN1:         LD	(DE),A		;TRANSFER TO BUFFER
0043F7 13     12177 INC	DE		;INCREMENT POINTERS
0043F8 FD     12178 INC	IY
0043F9 23   
0043FA 7B     12179 LEXAN2:         LD	A,E		;MAIN ENTRY
0043FB FE     12180 CP	252		;TEST LENGTH
0043FC FC   
0043FD 3E     12181 LD	A,19
0043FE 13   
0043FF D2     12182 JP	NC,ERROR_	;'String too long'
004400 26   
004401 3F   
004402 FD     12183 LD	A,(IY)
004403 7E   
004404 00   
004405 FE     12184 CP	CR
004406 0D   
004407 C8     12185 RET	Z		;END OF LINE
004408 CD     12186 CALL	RANGE1
004409 DE   
00440A 43   
00440B 30     12187 JR	NC,LEXAN3
00440C 04   
00440D CB     12188 RES	5,C		;NOT IN VARIABLE
00440E A9   
00440F CB     12189 RES	3,C		;NOT IN HEX
004410 99   
004411 FE     12190 LEXAN3:         CP	' '
004412 20   
004413 28     12191 JR	Z,LEXAN1	;PASS SPACES
004414 E1   
004415 FE     12192 CP	','
004416 2C   
004417 28     12193 JR	Z,LEXAN1	;PASS COMMAS
004418 DD   
004419 FE     12194 CP	'G'
00441A 47   
00441B 38     12195 JR	C,LEXAN4
00441C 02   
00441D CB     12196 RES	3,C		;NOT IN HEX
00441E 99   
00441F FE     12197 LEXAN4:         CP	'"'
004420 22   
004421 20     12198 JR	NZ,LEXAN5
004422 05   
004423 CB     12199 RL	C
004424 11   
004425 3F     12200 CCF			;TOGGLE C7
004426 CB     12201 RR	C
004427 19   
004428 CB     12202 LEXAN5:         BIT	4,C
004429 61   
00442A 28     12203 JR	Z,LEXAN6
00442B 10   
00442C CB     12204 RES	4,C
00442D A1   
00442E C5     12205 PUSH	BC
00442F D5     12206 PUSH	DE
004430 CD     12207 CALL	LINNUM		;GET LINE NUMBER
004431 6C   
004432 43   
004433 D1     12208 POP	DE
004434 C1     12209 POP	BC
004435 7C     12210 LD	A,H
004436 B5     12211 OR	L
004437 C4     12212 CALL	NZ,ENCODE	;ENCODE LINE NUMBER
004438 A1   
004439 44   
00443A 18     12213 JR	LEXAN2		;CONTINUE
00443B BE   
00443C 0D     12215 LEXAN6:         DEC	C
00443D 28     12216 JR	Z,LEXAN7	;C=1 (LEFT)
00443E 09   
00443F 0C     12217 INC	C
004440 20     12218 JR	NZ,LEXAN1
004441 B4   
004442 B7     12219 OR	A
004443 F4     12220 CALL	P,LEX		;TOKENISE IF POSS.
004444 85   
004445 3F   
004446 18     12221 JR	LEXAN8
004447 12   
004448 FE     12223 LEXAN7:         CP	'*'
004449 2A   
00444A 28     12224 JR	Z,LEXAN9
00444B 16   
00444C B7     12225 OR	A
00444D F4     12226 CALL	P,LEX		;TOKENISE IF POSS.
00444E 85   
00444F 3F   
004450 FE     12227 CP	TOKLO
004451 8F   
004452 38     12228 JR	C,LEXAN8
004453 06   
004454 FE     12229 CP	TOKHI+1
004455 94   
004456 30     12230 JR	NC,LEXAN8
004457 02   
004458 C6     12231 ADD	A,OFFSET	;LEFT VERSION
004459 40   
00445A FE     12232 LEXAN8:         CP	TREM
00445B F4   
00445C 28     12233 JR	Z,LEXAN9
00445D 04   
00445E FE     12234 CP	TDATA
00445F DC   
004460 20     12235 JR	NZ,LEXANA
004461 02   
004462 CB     12236 LEXAN9:         SET	6,C		;QUIT TOKENISING
004463 F1   
004464 FE     12237 LEXANA:         CP	TFN
004465 A4   
004466 28     12238 JR	Z,LEXANB
004467 09   
004468 FE     12239 CP	TPROC
004469 F2   
00446A 28     12240 JR	Z,LEXANB
00446B 05   
00446C CD     12241 CALL	RANGE2
00446D E8   
00446E 43   
00446F 38     12242 JR	C,LEXANC
004470 02   
004471 CB     12243 LEXANB:         SET	5,C		;IN VARIABLE/FN/PROC
004472 E9   
004473 FE     12244 LEXANC:         CP	'&'
004474 26   
004475 20     12245 JR	NZ,LEXAND
004476 02   
004477 CB     12246 SET	3,C		;IN HEX
004478 D9   
004479 21     12247 LEXAND:         LD	HL,LIST1
00447A 98   
00447B 44   
00447C C5     12248 PUSH	BC
00447D 01     12249 LD	BC,LIST1L
00447E 06   
00447F 00   
004480 ED     12250 CPIR
004481 B1   
004482 C1     12251 POP	BC
004483 20     12252 JR	NZ,LEXANE
004484 02   
004485 CB     12253 SET	4,C		;ACCEPT LINE NUMBER
004486 E1   
004487 21     12254 LEXANE:         LD	HL,LIST2
004488 9C   
004489 44   
00448A C5     12255 PUSH	BC
00448B 01     12256 LD	BC,LIST2L
00448C 05   
00448D 00   
00448E ED     12257 CPIR
00448F B1   
004490 C1     12258 POP	BC
004491 20     12259 JR	NZ,LEXANF
004492 02   
004493 CB     12260 SET	0,C		;ENTER LEFT MODE
004494 C1   
004495 C3     12261 LEXANF:         JP	LEXAN1
004496 F6   
004497 43   
004498 E5     12263 LIST1:          DB	TGOTO
004499 E4     12264 DB	TGOSUB
00449A F7     12265 DB	TRESTORE
00449B FC     12266 DB	TTRACE
00449C 8C     12267 LIST2:          DB	TTHEN
00449D 8B     12268 DB	TELSE
00449E F5     12270 DB	TREPEAT
00449F 85     12271 DB	TERROR
0044A0 3A     12272 DB	':'
0044A1 CB     12280 ENCODE:         SET	4,C
0044A2 E1   
0044A3 EB     12281 EX	DE,HL
0044A4 36     12282 LD	(HL),TLINO
0044A5 8D   
0044A6 23     12283 INC	HL
0044A7 7A     12284 LD	A,D
0044A8 E6     12285 AND	0C0H
0044A9 C0   
0044AA 0F     12286 RRCA
0044AB 0F     12287 RRCA
0044AC 47     12288 LD	B,A
0044AD 7B     12289 LD	A,E
0044AE E6     12290 AND	0C0H
0044AF C0   
0044B0 B0     12291 OR	B
0044B1 0F     12292 RRCA
0044B2 0F     12293 RRCA
0044B3 EE     12294 XOR	01010100B
0044B4 54   
0044B5 77     12295 LD	(HL),A
0044B6 23     12296 INC	HL
0044B7 7B     12297 LD	A,E
0044B8 E6     12298 AND	3FH
0044B9 3F   
0044BA F6     12299 OR	'@'
0044BB 40   
0044BC 77     12300 LD	(HL),A
0044BD 23     12301 INC	HL
0044BE 7A     12302 LD	A,D
0044BF E6     12303 AND	3FH
0044C0 3F   
0044C1 F6     12304 OR	'@'
0044C2 40   
0044C3 77     12305 LD	(HL),A
0044C4 23     12306 INC	HL
0044C5 EB     12307 EX	DE,HL
0044C6 C9     12308 RET
0044C7 2A     12315 REPORT:         LD	HL,(ERRTXT)
0044C8 EE   
0044C9 54   
0044CA 7E     12316 TEXT_:          LD	A,(HL)
0044CB 23     12317 INC	HL
0044CC B7     12318 OR	A
0044CD C8     12319 RET	Z
0044CE FE     12320 CP	LF
0044CF 0A   
0044D0 28     12321 JR	Z,TEXTLF	;Token for TINT
0044D1 05   
0044D2 CD     12322 CALL	OUT
0044D3 FD   
0044D4 40   
0044D5 18     12323 JR	TEXT_
0044D6 F3   
0044D7 CD     12325 TEXTLF:         CALL	OUTCHR
0044D8 E4   
0044D9 40   
0044DA 18     12326 JR	TEXT_
0044DB EE   
0044DC E3     12332 TELL:           EX	(SP),HL		;GET RETURN ADDRESS
0044DD CD     12333 CALL	TEXT_
0044DE CA   
0044DF 44   
0044E0 E3     12334 EX	(SP),HL
0044E1 C9     12335 RET
0044E2 CD     12339 NLIST:          CALL	NXT
0044E3 ED   
0044E4 44   
0044E5 FE     12340 CP	','		;ANOTHER VARIABLE?
0044E6 2C   
0044E7 28     12341 JR	Z,NXT1
0044E8 0A   
0044E9 C1     12342 POP	BC		;DITCH RETURN ADDRESS
0044EA C3     12343 JP	XEQ
0044EB 7B   
0044EC 24   
0044ED FD     12345 NXT:            LD	A,(IY)
0044EE 7E   
0044EF 00   
0044F0 FE     12346 CP	' '
0044F1 20   
0044F2 C0     12347 RET	NZ
0044F3 FD     12348 NXT1:           INC	IY
0044F4 23   
0044F5 18     12349 JR	NXT
0044F6 F6   
0044F7             12354   ; --- Begin math.asm ---
0044F7 FD     12399 FPP:            PUSH	IY		;Save IY
0044F8 E5   
0044F9 FD     12400 LD	IY,0
0044FA 21   
0044FB 00   
0044FC 00   
0044FD FD     12401 ADD	IY,SP		;Save SP in IY
0044FE 39   
0044FF CD     12402 CALL	OP		;Perform operation
004500 0E   
004501 45   
004502 BF     12403 CP	A		;Good return (Z, NC)
004503 FD     12404 EXITmat:           POP	IY		;Restore IY
004504 E1   
004505 C9     12405 RET			;Return to caller
004506 3E     12409 BADmat:            LD	A,BADOP		;"Bad operation code"
004507 01   
004508 FD     12410 ERROR_mat:         LD	SP,IY		;Restore SP from IY
004509 F9   
00450A B7     12411 OR	A		;Set NZ
00450B 37     12412 SCF			;Set C
00450C 18     12413 JR	EXITmat
00450D F5   
00450E FE     12418 OP:             CP	RTABLE-DTABLE/2
00450F 2E   
004510 30     12419 JR	NC,BADmat
004511 F4   
004512 FE     12421 CP	FTABLE-DTABLE/2
004513 10   
004514 30     12422 JR	NC,DISPAT
004515 07   
004516 08     12423 EX	AF,AF'
004517 78     12424 LD	A,B
004518 B1     12425 OR	C		;Both integer?
004519 C4     12426 CALL	NZ,FLOATA	;No, so float both
00451A 87   
00451B 4E   
00451C 08     12427 EX	AF,AF'
00451D E5     12428 DISPAT:         PUSH	HL
00451E 21     12429 LD	HL,DTABLE
00451F 2E   
004520 45   
004521 C5     12430 PUSH	BC
004522 87     12431 ADD	A,A		;A = op-code * 2
004523 4F     12432 LD	C,A
004524 06     12433 LD	B,0		;BC = op-code * 2
004525 00   
004526 09     12434 ADD	HL,BC
004527 7E     12435 LD	A,(HL)		;Get low byte
004528 23     12436 INC	HL
004529 66     12437 LD	H,(HL)		;Get high byte
00452A 6F     12438 LD	L,A
00452B C1     12439 POP	BC
00452C E3     12440 EX	(SP),HL
00452D C9     12441 RET			;Off to routine
00452E AD     12445 DTABLE:         DW	IAND		;0  & (INTEGER)
00452F 45   
004530 FA     12446 DW	IBDIV		;1  DIV
004531 45   
004532 BF     12447 DW	IEOR		;2  EOR
004533 45   
004534 E3     12448 DW	IMOD		;3  MOD
004535 45   
004536 D1     12449 DW	IOR		;4  |
004537 45   
004538 F8     12450 DW	ILE		;5  <=
004539 47   
00453A 05     12451 DW	INE		;6  <>
00453B 48   
00453C ED     12452 DW	IGE		;7  >=
00453D 47   
00453E D6     12453 DW	ILT		;8  <
00453F 47   
004540 10     12454 DW	IEQ		;9  =
004541 48   
004542 C4     12455 DW	IMUL		;10 *
004543 46   
004544 1D     12456 DW	IADD		;11 +
004545 46   
004546 E1     12457 DW	IGT		;12 >
004547 47   
004548 07     12458 DW	ISUB		;13 -
004549 46   
00454A 3F     12459 DW	IPOW		;14 ^
00454B 47   
00454C 7C     12460 DW	IDIV		;15 /
00454D 46   
00454E 60     12462 FTABLE:         DW	ABS		;16 ABS
00454F 48   
004550 BC     12463 DW	ACS		;17 ACS
004551 4B   
004552 18     12464 DW	ASN		;18 ASN
004553 4B   
004554 3D     12465 DW	ATN		;19 ATN
004555 4B   
004556 56     12466 DW	COS		;20 COS
004557 49   
004558 8A     12467 DW	DEG		;21 DEG
004559 48   
00455A FB     12468 DW	EXP		;22 EXP
00455B 49   
00455C D0     12469 DW	INT_		;23 INT_
00455D 48   
00455E 86     12470 DW	LN		;24 LN
00455F 4A   
004560 06     12471 DW	LOG		;25 LOG
004561 4B   
004562 6B     12472 DW	CPL_		;26 NOT
004563 48   
004564 92     12473 DW	RAD		;27 RAD
004565 48   
004566 A8     12474 DW	SGN		;28 SGN
004567 48   
004568 61     12475 DW	SIN		;29 SIN
004569 49   
00456A E6     12476 DW	SQR		;30 SQR
00456B 48   
00456C 39     12477 DW	TAN		;31 TAN
00456D 49   
00456E 03     12479 DW	ZEROmat		;32 ZERO
00456F 4F   
004570 DA     12480 DW	FONE		;33 FONE
004571 49   
004572 14     12481 DW	TRUE		;34 TRUE
004573 48   
004574 7E     12482 DW	PI		;35 PI
004575 48   
004576 B8     12484 DW	VAL		;36 VAL
004577 48   
004578 C4     12485 DW	STRmat		;37 STR$
004579 4B   
00457A D9     12487 DW	SFIXmat		;38 FIX
00457B 4D   
00457C 94     12488 DW	SFLOAT		;39 FLOAT
00457D 4E   
00457E D9     12490 DW	FTEST		;40 TEST
00457F 4E   
004580 EA     12491 DW	FCOMP		;41 COMPARE
004581 4E   
004582 1F     12493 DW	ISHL		;42 <<
004583 48   
004584 1F     12494 DW	ISHX		;43 <<<
004585 48   
004586 2C     12495 DW	ISAR		;44 >>
004587 48   
004588 3E     12496 DW	ISHR		;45 >>>
004589 48   
00458A AA     12498 RTABLE:         DW	FAND		;& (FLOATING-POINT)
00458B 45   
00458C F7     12499 DW	FBDIV		;DIV
00458D 45   
00458E BC     12500 DW	FEOR		;EOR
00458F 45   
004590 E0     12501 DW	FMOD		;MOD
004591 45   
004592 CE     12502 DW	FOR		;|
004593 45   
004594 F3     12503 DW	FLE		;<=
004595 47   
004596 00     12504 DW	FNE		;<>
004597 48   
004598 E8     12505 DW	FGE		;>=
004599 47   
00459A D1     12506 DW	FLT		;<
00459B 47   
00459C 0B     12507 DW	FEQ		;=
00459D 48   
00459E EF     12508 DW	FMUL		;*
00459F 46   
0045A0 27     12509 DW	FADD		;+
0045A1 46   
0045A2 DC     12510 DW	FGT		;>
0045A3 47   
0045A4 11     12511 DW	FSUB		;-
0045A5 46   
0045A6 A7     12512 DW	FPOW		;^
0045A7 47   
0045A8 7F     12513 DW	FDIV		;/
0045A9 46   
0045AA CD     12524 FAND:           CALL	FIX2
0045AB D0   
0045AC 4D   
0045AD 7C     12525 IAND:           LD	A,H
0045AE A2     12526 AND	D
0045AF 67     12527 LD	H,A
0045B0 7D     12528 LD	A,L
0045B1 A3     12529 AND	E
0045B2 6F     12530 LD	L,A
0045B3 D9     12531 EXX
0045B4 7C     12532 LD	A,H
0045B5 A2     12533 AND	D
0045B6 67     12534 LD	H,A
0045B7 7D     12535 LD	A,L
0045B8 A3     12536 AND	E
0045B9 6F     12537 LD	L,A
0045BA D9     12538 EXX
0045BB C9     12539 RET
0045BC CD     12544 FEOR:           CALL	FIX2
0045BD D0   
0045BE 4D   
0045BF 7C     12545 IEOR:           LD	A,H
0045C0 AA     12546 XOR	D
0045C1 67     12547 LD	H,A
0045C2 7D     12548 LD	A,L
0045C3 AB     12549 XOR	E
0045C4 6F     12550 LD	L,A
0045C5 D9     12551 EXX
0045C6 7C     12552 LD	A,H
0045C7 AA     12553 XOR	D
0045C8 67     12554 LD	H,A
0045C9 7D     12555 LD	A,L
0045CA AB     12556 XOR	E
0045CB 6F     12557 LD	L,A
0045CC D9     12558 EXX
0045CD C9     12559 RET
0045CE CD     12564 FOR:            CALL	FIX2
0045CF D0   
0045D0 4D   
0045D1 7C     12565 IOR:            LD	A,H
0045D2 B2     12566 OR	D
0045D3 67     12567 LD	H,A
0045D4 7D     12568 LD	A,L
0045D5 B3     12569 OR	E
0045D6 6F     12570 LD	L,A
0045D7 D9     12571 EXX
0045D8 7C     12572 LD	A,H
0045D9 B2     12573 OR	D
0045DA 67     12574 LD	H,A
0045DB 7D     12575 LD	A,L
0045DC B3     12576 OR	E
0045DD 6F     12577 LD	L,A
0045DE D9     12578 EXX
0045DF C9     12579 RET
0045E0 CD     12584 FMOD:           CALL	FIX2
0045E1 D0   
0045E2 4D   
0045E3 7C     12585 IMOD:           LD	A,H
0045E4 AA     12586 XOR	D		;DIV RESULT SIGN
0045E5 CB     12587 BIT	7,H
0045E6 7C   
0045E7 CD     12588 CALL	ABS2		;MAKE BOTH POSITIVE
0045E8 D7   
0045E9 50   
0045EA 3E     12589 LD	A,-33
0045EB DF   
0045EC CD     12590 CALL	DIVA		;DIVIDE
0045ED 13   
0045EE 50   
0045EF D9     12591 EXX
0045F0 0E     12592 LD	C,0		;INTEGER MARKER
0045F1 00   
0045F2 08     12593 EX	AF,AF'
0045F3 C8     12594 RET	Z
0045F4 C3     12595 JP	NEGATE
0045F5 E8   
0045F6 4D   
0045F7 CD     12599 FBDIV:          CALL	FIX2
0045F8 D0   
0045F9 4D   
0045FA CD     12600 IBDIV:          CALL	IMOD
0045FB E3   
0045FC 45   
0045FD B7     12601 OR	A
0045FE CD     12602 CALL	SWAP
0045FF BE   
004600 4E   
004601 0E     12603 LD	C,0
004602 00   
004603 F0     12604 RET	P
004604 C3     12605 JP	NEGATE
004605 E8   
004606 4D   
004607 CD     12610 ISUB:           CALL	SUB
004608 46   
004609 4F   
00460A E0     12611 RET	PO
00460B CD     12612 CALL	ADD
00460C 40   
00460D 4F   
00460E CD     12613 CALL	FLOAT2
00460F 8B   
004610 4E   
004611 7A     12614 FSUB:           LD	A,D
004612 EE     12615 XOR	80H		;CHANGE SIGN THEN ADD
004613 80   
004614 57     12616 LD	D,A
004615 18     12617 JR	FADD
004616 10   
004617 7C     12621 RSUB:           LD	A,H
004618 EE     12622 XOR	80H
004619 80   
00461A 67     12623 LD	H,A
00461B 18     12624 JR	FADD
00461C 0A   
00461D CD     12629 IADD:           CALL	ADD
00461E 40   
00461F 4F   
004620 E0     12630 RET	PO
004621 CD     12631 CALL	SUB
004622 46   
004623 4F   
004624 CD     12632 CALL	FLOAT2
004625 8B   
004626 4E   
004627 05     12633 FADD:           DEC	B
004628 04     12634 INC	B
004629 C8     12635 RET	Z		;ARG 2 ZERO
00462A 0D     12636 DEC	C
00462B 0C     12637 INC	C
00462C CA     12638 JP	Z,SWAP		;ARG 1 ZERO
00462D BE   
00462E 4E   
00462F D9     12639 EXX
004630 01     12640 LD	BC,0		;INITIALISE
004631 00   
004632 00   
004633 D9     12641 EXX
004634 7C     12642 LD	A,H
004635 AA     12643 XOR	D		;XOR SIGNS
004636 F5     12644 PUSH	AF
004637 78     12645 LD	A,B
004638 B9     12646 CP	C		;COMPARE EXPONENTS
004639 DC     12647 CALL	C,SWAP		;MAKE DED'E'B LARGEST
00463A BE   
00463B 4E   
00463C 78     12648 LD	A,B
00463D CB     12649 SET	7,H		;IMPLIED 1
00463E FC   
00463F C4     12650 CALL	NZ,FIX		;ALIGN
004640 C0   
004641 4D   
004642 F1     12651 POP	AF
004643 7A     12652 LD	A,D		;SIGN OF LARGER
004644 CB     12653 SET	7,D		;IMPLIED 1
004645 FA   
004646 FA     12654 JP	M,FADD3		;SIGNS DIFFERENT
004647 53   
004648 46   
004649 CD     12655 CALL	ADD		;HLH'L'=HLH'L'+DED'E'
00464A 40   
00464B 4F   
00464C DC     12656 CALL	C,DIV2		;NORMALISE
00464D C6   
00464E 4E   
00464F CB     12657 SET	7,H
004650 FC   
004651 18     12658 JR	FADD4
004652 0A   
004653 CD     12660 FADD3:          CALL	SUB		;HLH'L'=HLH'L'-DED'E'
004654 46   
004655 4F   
004656 DC     12661 CALL	C,NEG		;NEGATE HLH'L'B'C'
004657 FC   
004658 4D   
004659 CD     12662 CALL	FLO48
00465A 68   
00465B 4E   
00465C 2F     12663 CPL			;CHANGE RESULT SIGN
00465D D9     12664 FADD4:          EXX
00465E EB     12665 EX	DE,HL
00465F 21     12666 LD	HL,8000H
004660 00   
004661 80   
004662 B7     12667 OR	A		;CLEAR CARRY
004663 ED     12668 SBC	HL,BC
004664 42   
004665 EB     12669 EX	DE,HL
004666 D9     12670 EXX
004667 CC     12671 CALL	Z,ODD		;ROUND UNBIASSED
004668 B8   
004669 4E   
00466A DC     12672 CALL	C,ADD1		;ROUND UP
00466B AA   
00466C 4E   
00466D DC     12673 CALL	C,INCC
00466E D2   
00466F 4E   
004670 CB     12674 RES	7,H
004671 BC   
004672 0D     12675 DEC	C
004673 0C     12676 INC	C
004674 CA     12677 JP	Z,ZEROmat
004675 03   
004676 4F   
004677 B7     12678 OR	A		;RESULT SIGNQ
004678 F0     12679 RET	P		;POSITIVE
004679 CB     12680 SET	7,H		;NEGATIVE
00467A FC   
00467B C9     12681 RET
00467C CD     12686 IDIV:           CALL	FLOAT2
00467D 8B   
00467E 4E   
00467F 05     12687 FDIV:           DEC	B		;TEST FOR ZERO
004680 04     12688 INC	B
004681 3E     12689 LD	A,DIVBY0
004682 12   
004683 CA     12690 JP	Z,ERROR_mat		;"Division by zero"
004684 08   
004685 45   
004686 0D     12691 DEC	C		;TEST FOR ZERO
004687 0C     12692 INC	C
004688 C8     12693 RET	Z
004689 7C     12694 LD	A,H
00468A AA     12695 XOR	D		;CALC. RESULT SIGN
00468B 08     12696 EX	AF,AF'		;SAVE SIGN
00468C CB     12697 SET	7,D		;REPLACE IMPLIED 1's
00468D FA   
00468E CB     12698 SET	7,H
00468F FC   
004690 C5     12699 PUSH	BC		;SAVE EXPONENTS
004691 42     12700 LD	B,D		;LOAD REGISTERS
004692 4B     12701 LD	C,E
004693 11     12702 LD	DE,0
004694 00   
004695 00   
004696 D9     12703 EXX
004697 42     12704 LD	B,D
004698 4B     12705 LD	C,E
004699 11     12706 LD	DE,0
00469A 00   
00469B 00   
00469C 3E     12707 LD	A,-32		;LOOP COUNTER
00469D E0   
00469E CD     12708 CALL	DIVA		;DIVIDE
00469F 13   
0046A0 50   
0046A1 D9     12709 EXX
0046A2 CB     12710 BIT	7,D
0046A3 7A   
0046A4 D9     12711 EXX
0046A5 CC     12712 CALL	Z,DIVB		;NORMALISE & INC A
0046A6 2E   
0046A7 50   
0046A8 EB     12713 EX	DE,HL
0046A9 D9     12714 EXX
0046AA CB     12715 SRL	B		;DIVISOR/2
0046AB 38   
0046AC CB     12716 RR	C
0046AD 19   
0046AE B7     12717 OR	A		;CLEAR CARRY
0046AF ED     12718 SBC	HL,BC		;REMAINDER-DIVISOR/2
0046B0 42   
0046B1 3F     12719 CCF
0046B2 EB     12720 EX	DE,HL		;RESULT IN HLH'L'
0046B3 CC     12721 CALL	Z,ODD		;ROUND UNBIASSED
0046B4 B8   
0046B5 4E   
0046B6 DC     12722 CALL	C,ADD1		;ROUND UP
0046B7 AA   
0046B8 4E   
0046B9 C1     12723 POP	BC		;RESTORE EXPONENTS
0046BA DC     12724 CALL	C,INCC
0046BB D2   
0046BC 4E   
0046BD 1F     12725 RRA			;LSB OF A TO CARRY
0046BE 79     12726 LD	A,C		;COMPUTE NEW EXPONENT
0046BF 98     12727 SBC	A,B
0046C0 3F     12728 CCF
0046C1 C3     12729 JP	CHKOVF
0046C2 28   
0046C3 47   
0046C4 7C     12733 IMUL:           LD	A,H
0046C5 AA     12734 XOR	D
0046C6 CD     12735 CALL	ABS2		;MAKE BOTH POSITIVE
0046C7 D7   
0046C8 50   
0046C9 3E     12736 LD	A,-33
0046CA DF   
0046CB CD     12737 CALL	MULA		;MULTIPLY
0046CC 41   
0046CD 50   
0046CE D9     12738 EXX
0046CF 0E     12739 LD	C,191		;PRESET EXPONENT
0046D0 BF   
0046D1 CD     12740 CALL	TESTmat		;TEST RANGE
0046D2 E3   
0046D3 4E   
0046D4 20     12741 JR	NZ,IMUL1	;TOO BIG
0046D5 0D   
0046D6 CB     12742 BIT	7,D
0046D7 7A   
0046D8 20     12743 JR	NZ,IMUL1
0046D9 09   
0046DA CD     12744 CALL	SWAP
0046DB BE   
0046DC 4E   
0046DD 4A     12745 LD	C,D		;INTEGER MARKER
0046DE 08     12746 EX	AF,AF'
0046DF F0     12747 RET	P
0046E0 C3     12748 JP	NEGATE
0046E1 E8   
0046E2 4D   
0046E3 0D     12750 IMUL1:          DEC	C
0046E4 CD     12751 CALL	SLA8
0046E5 AA   
0046E6 50   
0046E7 F2     12752 JP	P,IMUL1		;NORMALISE
0046E8 E3   
0046E9 46   
0046EA 08     12753 EX	AF,AF'
0046EB F8     12754 RET	M
0046EC CB     12755 RES	7,H		;POSITIVE
0046ED BC   
0046EE C9     12756 RET
0046EF 05     12760 FMUL:           DEC	B		;TEST FOR ZERO
0046F0 04     12761 INC	B
0046F1 CA     12762 JP	Z,ZEROmat
0046F2 03   
0046F3 4F   
0046F4 0D     12763 DEC	C		;TEST FOR ZERO
0046F5 0C     12764 INC	C
0046F6 C8     12765 RET	Z
0046F7 7C     12766 LD	A,H
0046F8 AA     12767 XOR	D		;CALC. RESULT SIGN
0046F9 08     12768 EX	AF,AF'
0046FA CB     12769 SET	7,D		;REPLACE IMPLIED 1's
0046FB FA   
0046FC CB     12770 SET	7,H
0046FD FC   
0046FE C5     12771 PUSH	BC		;SAVE EXPONENTS
0046FF 44     12772 LD	B,H		;LOAD REGISTERS
004700 4D     12773 LD	C,L
004701 21     12774 LD	HL,0
004702 00   
004703 00   
004704 D9     12775 EXX
004705 44     12776 LD	B,H
004706 4D     12777 LD	C,L
004707 21     12778 LD	HL,0
004708 00   
004709 00   
00470A 3E     12779 LD	A,-32		;LOOP COUNTER
00470B E0   
00470C CD     12780 CALL	MULA		;MULTIPLY
00470D 41   
00470E 50   
00470F DC     12781 CALL	C,MULB		;NORMALISE & INC A
004710 55   
004711 50   
004712 D9     12782 EXX
004713 E5     12783 PUSH	HL
004714 21     12784 LD	HL,8000H
004715 00   
004716 80   
004717 B7     12785 OR	A		;CLEAR CARRY
004718 ED     12786 SBC	HL,DE
004719 52   
00471A E1     12787 POP	HL
00471B CC     12788 CALL	Z,ODD		;ROUND UNBIASSED
00471C B8   
00471D 4E   
00471E DC     12789 CALL	C,ADD1		;ROUND UP
00471F AA   
004720 4E   
004721 C1     12790 POP	BC		;RESTORE EXPONENTS
004722 DC     12791 CALL	C,INCC
004723 D2   
004724 4E   
004725 1F     12792 RRA			;LSB OF A TO CARRY
004726 79     12793 LD	A,C		;COMPUTE NEW EXPONENT
004727 88     12794 ADC	A,B
004728 38     12795 CHKOVF:         JR	C,CHKO1
004729 05   
00472A F2     12796 JP	P,ZEROmat		;UNDERFLOW
00472B 03   
00472C 4F   
00472D 18     12797 JR	CHKO2
00472E 03   
00472F FA     12798 CHKO1:          JP	M,OFLOW		;OVERFLOW
004730 D4   
004731 4E   
004732 C6     12799 CHKO2:          ADD	A,80H
004733 80   
004734 4F     12800 LD	C,A
004735 CA     12801 JP	Z,ZEROmat
004736 03   
004737 4F   
004738 08     12802 EX	AF,AF'		;RESTORE SIGN BIT
004739 CB     12803 RES	7,H
00473A BC   
00473B F0     12804 RET	P
00473C CB     12805 SET	7,H
00473D FC   
00473E C9     12806 RET
00473F CD     12810 IPOW:           CALL	SWAP
004740 BE   
004741 4E   
004742 CB     12811 BIT	7,H
004743 7C   
004744 F5     12812 PUSH	AF		;SAVE SIGN
004745 C4     12813 CALL	NZ,NEGATE
004746 E8   
004747 4D   
004748 48     12814 IPOW0:          LD	C,B
004749 06     12815 LD	B,32		;LOOP COUNTER
00474A 20   
00474B CD     12816 IPOW1:          CALL	X2
00474C 5D   
00474D 4F   
00474E 38     12817 JR	C,IPOW2
00474F 08   
004750 10     12818 DJNZ	IPOW1
004751 F9   
004752 F1     12819 POP	AF
004753 D9     12820 EXX
004754 2C     12821 INC	L		;RESULT=1
004755 D9     12822 EXX
004756 4C     12823 LD	C,H
004757 C9     12824 RET
004758 F1     12826 IPOW2:          POP	AF
004759 C5     12827 PUSH	BC
00475A EB     12828 EX	DE,HL
00475B E5     12829 PUSH	HL
00475C D9     12830 EXX
00475D EB     12831 EX	DE,HL
00475E E5     12832 PUSH	HL
00475F D9     12833 EXX
004760 DD     12834 LD	IX,0
004761 21   
004762 00   
004763 00   
004764 DD     12835 ADD	IX,SP
004765 39   
004766 28     12836 JR	Z,IPOW4
004767 34   
004768 C5     12837 PUSH	BC
004769 D9     12838 EXX
00476A D5     12839 PUSH	DE
00476B D9     12840 EXX
00476C D5     12841 PUSH	DE
00476D CD     12842 CALL	SFLOAT
00476E 94   
00476F 4E   
004770 CD     12843 CALL	RECIP
004771 72   
004772 4A   
004773 CD     12844 CALL	STORE5
004774 E8   
004775 31   
004776 18     12845 JR	IPOW5
004777 1D   
004778 C5     12847 IPOW3:          PUSH	BC
004779 D9     12848 EXX
00477A CB     12849 SLA	E
00477B 23   
00477C CB     12850 RL	D
00477D 12   
00477E D5     12851 PUSH	DE
00477F D9     12852 EXX
004780 CB     12853 RL	E
004781 13   
004782 CB     12854 RL	D
004783 12   
004784 D5     12855 PUSH	DE
004785 3E     12856 LD	A,'*' & 0FH
004786 0A   
004787 F5     12857 PUSH	AF
004788 CD     12858 CALL	COPY
004789 6F   
00478A 4F   
00478B CD     12859 CALL	OP		;SQUARE
00478C 0E   
00478D 45   
00478E F1     12860 POP	AF
00478F CD     12861 CALL	DLOAD5
004790 D3   
004791 19   
004792 DC     12862 CALL	C,OP		;MULTIPLY BY X
004793 0E   
004794 45   
004795 D1     12863 IPOW5:          POP	DE
004796 D9     12864 EXX
004797 D1     12865 POP	DE
004798 D9     12866 EXX
004799 79     12867 LD	A,C
00479A C1     12868 POP	BC
00479B 4F     12869 LD	C,A
00479C 10     12870 IPOW4:          DJNZ	IPOW3
00479D DA   
00479E F1     12871 POP	AF
00479F F1     12872 POP	AF
0047A0 F1     12873 POP	AF
0047A1 C9     12874 RET
0047A2 F1     12876 FPOW0:          POP	AF
0047A3 F1     12877 POP	AF
0047A4 F1     12878 POP	AF
0047A5 18     12879 JR	IPOW0
0047A6 A1   
0047A7 CB     12883 FPOW:           BIT	7,D
0047A8 7A   
0047A9 F5     12884 PUSH	AF
0047AA CD     12885 CALL	SWAP
0047AB BE   
0047AC 4E   
0047AD CD     12886 CALL	PUSH5
0047AE 7D   
0047AF 4F   
0047B0 0D     12887 DEC	C
0047B1 0C     12888 INC	C
0047B2 28     12889 JR	Z,FPOW0
0047B3 EE   
0047B4 3E     12890 LD	A,158
0047B5 9E   
0047B6 B9     12891 CP	C
0047B7 38     12892 JR	C,FPOW1
0047B8 08   
0047B9 3C     12893 INC	A
0047BA CD     12894 CALL	FIX
0047BB C0   
0047BC 4D   
0047BD 08     12895 EX	AF,AF'
0047BE F2     12896 JP	P,FPOW0
0047BF A2   
0047C0 47   
0047C1 CD     12897 FPOW1:          CALL	SWAP
0047C2 BE   
0047C3 4E   
0047C4 CD     12898 CALL	LN0
0047C5 89   
0047C6 4A   
0047C7 CD     12899 CALL	POP5
0047C8 86   
0047C9 4F   
0047CA F1     12900 POP	AF
0047CB CD     12901 CALL	FMUL
0047CC EF   
0047CD 46   
0047CE C3     12902 JP	EXP0
0047CF FE   
0047D0 49   
0047D1 CD     12907 FLT:            CALL	FCP
0047D2 0D   
0047D3 4F   
0047D4 18     12908 JR	ILT1
0047D5 03   
0047D6 CD     12909 ILT:            CALL	ICP
0047D7 00   
0047D8 4F   
0047D9 D0     12910 ILT1:           RET	NC
0047DA 18     12911 JR	TRUE
0047DB 38   
0047DC CD     12913 FGT:            CALL	FCP
0047DD 0D   
0047DE 4F   
0047DF 18     12914 JR	IGT1
0047E0 03   
0047E1 CD     12915 IGT:            CALL	ICP
0047E2 00   
0047E3 4F   
0047E4 C8     12916 IGT1:           RET	Z
0047E5 D8     12917 RET	C
0047E6 18     12918 JR	TRUE
0047E7 2C   
0047E8 CD     12920 FGE:            CALL	FCP
0047E9 0D   
0047EA 4F   
0047EB 18     12921 JR	IGE1
0047EC 03   
0047ED CD     12922 IGE:            CALL	ICP
0047EE 00   
0047EF 4F   
0047F0 D8     12923 IGE1:           RET	C
0047F1 18     12924 JR	TRUE
0047F2 21   
0047F3 CD     12926 FLE:            CALL	FCP
0047F4 0D   
0047F5 4F   
0047F6 18     12927 JR	ILE1
0047F7 03   
0047F8 CD     12928 ILE:            CALL	ICP
0047F9 00   
0047FA 4F   
0047FB 28     12929 ILE1:           JR	Z,TRUE
0047FC 17   
0047FD D0     12930 RET	NC
0047FE 18     12931 JR	TRUE
0047FF 14   
004800 CD     12933 FNE:            CALL	FCP
004801 0D   
004802 4F   
004803 18     12934 JR	INE1
004804 03   
004805 CD     12935 INE:            CALL	ICP
004806 00   
004807 4F   
004808 C8     12936 INE1:           RET	Z
004809 18     12937 JR	TRUE
00480A 09   
00480B CD     12939 FEQ:            CALL	FCP
00480C 0D   
00480D 4F   
00480E 18     12940 JR	IEQ1
00480F 03   
004810 CD     12941 IEQ:            CALL	ICP
004811 00   
004812 4F   
004813 C0     12942 IEQ1:           RET	NZ
004814 21     12943 TRUE:           LD	HL,-1
004815 FF   
004816 FF   
004817 D9     12944 EXX
004818 21     12945 LD	HL,-1
004819 FF   
00481A FF   
00481B D9     12946 EXX
00481C AF     12947 XOR	A
00481D 4F     12948 LD	C,A
00481E C9     12949 RET
00481F CD     12954 ISHL:           CALL	SHIFTS
004820 50   
004821 48   
004822 28     12955 JR	Z,SHRET
004823 07   
004824 D9     12956 ISHL1:          EXX
004825 29     12957 ADD	HL,HL
004826 D9     12958 EXX
004827 ED     12959 ADC	HL,HL
004828 6A   
004829 10     12960 DJNZ	ISHL1
00482A F9   
00482B C9     12961 SHRET:          RET
00482C CD     12963 ISAR:           CALL	SHIFTS
00482D 50   
00482E 48   
00482F 28     12964 JR	Z,SHRET
004830 FA   
004831 CB     12965 ISAR1:          SRA	H
004832 2C   
004833 CB     12966 RR	L
004834 1D   
004835 D9     12967 EXX
004836 CB     12968 RR	H
004837 1C   
004838 CB     12969 RR	L
004839 1D   
00483A D9     12970 EXX
00483B 10     12971 DJNZ	ISAR1
00483C F4   
00483D C9     12972 RET
00483E CD     12974 ISHR:           CALL	SHIFTS
00483F 50   
004840 48   
004841 28     12975 JR	Z,SHRET
004842 E8   
004843 CB     12976 ISHR1:          SRL	H
004844 3C   
004845 CB     12977 RR	L
004846 1D   
004847 D9     12978 EXX
004848 CB     12979 RR	H
004849 1C   
00484A CB     12980 RR	L
00484B 1D   
00484C D9     12981 EXX
00484D 10     12982 DJNZ	ISHR1
00484E F4   
00484F C9     12983 RET
004850 CD     12985 SHIFTS:         CALL	FIX2
004851 D0   
004852 4D   
004853 7A     12986 LD	A,D
004854 B3     12987 OR	E
004855 D9     12988 EXX
004856 B2     12989 OR	D
004857 7B     12990 LD	A,E
004858 D9     12991 EXX
004859 06     12992 LD	B,32
00485A 20   
00485B 20     12993 JR	NZ,SHMAX
00485C 02   
00485D 47     12994 LD	B,A
00485E B7     12995 OR	A
00485F C9     12996 SHMAX:          RET
004860 CB     13007 ABS:            BIT	7,H
004861 7C   
004862 C8     13008 RET	Z		;POSITIVE/ZERO
004863 0D     13009 DEC	C
004864 0C     13010 INC	C
004865 CA     13011 JP	Z,NEGATE	;INTEGER
004866 E8   
004867 4D   
004868 CB     13012 RES	7,H
004869 BC   
00486A C9     13013 RET
00486B CD     13018 CPL_:           CALL	SFIXmat
00486C D9   
00486D 4D   
00486E 7C     13019 LD	A,H
00486F 2F     13020 CPL
004870 67     13021 LD	H,A
004871 7D     13022 LD	A,L
004872 2F     13023 CPL
004873 6F     13024 LD	L,A
004874 D9     13025 EXX
004875 7C     13026 LD	A,H
004876 2F     13027 CPL
004877 67     13028 LD	H,A
004878 7D     13029 LD	A,L
004879 2F     13030 CPL
00487A 6F     13031 LD	L,A
00487B D9     13032 EXX
00487C AF     13033 XOR	A		;NUMERIC MARKER
00487D C9     13034 RET
00487E 21     13039 PI:             LD	HL,490FH
00487F 0F   
004880 49   
004881 D9     13040 EXX
004882 21     13041 LD	HL,0DAA2H
004883 A2   
004884 DA   
004885 D9     13042 EXX
004886 0E     13043 LD	C,81H
004887 81   
004888 AF     13044 XOR	A		;NUMERIC MARKER
004889 C9     13045 RET
00488A CD     13050 DEG:            CALL	FPI180
00488B 9A   
00488C 48   
00488D CD     13051 CALL	FMUL
00488E EF   
00488F 46   
004890 AF     13052 XOR	A
004891 C9     13053 RET
004892 CD     13058 RAD:            CALL	FPI180
004893 9A   
004894 48   
004895 CD     13059 CALL	FDIV
004896 7F   
004897 46   
004898 AF     13060 XOR	A
004899 C9     13061 RET
00489A CD     13065 FPI180:         CALL	SFLOAT
00489B 94   
00489C 4E   
00489D 11     13066 LD	DE,652EH
00489E 2E   
00489F 65   
0048A0 D9     13067 EXX
0048A1 11     13068 LD	DE,0E0D3H
0048A2 D3   
0048A3 E0   
0048A4 D9     13069 EXX
0048A5 06     13070 LD	B,85H
0048A6 85   
0048A7 C9     13071 RET
0048A8 CD     13076 SGN:            CALL	TESTmat
0048A9 E3   
0048AA 4E   
0048AB B1     13077 OR	C
0048AC C8     13078 RET	Z		;ZERO
0048AD CB     13079 BIT	7,H
0048AE 7C   
0048AF C2     13080 JP	NZ,TRUE		;-1
0048B0 14   
0048B1 48   
0048B2 CD     13081 CALL	ZEROmat
0048B3 03   
0048B4 4F   
0048B5 C3     13082 JP	ADD1		;1
0048B6 AA   
0048B7 4E   
0048B8 CD     13088 VAL:            CALL	SIGNQ
0048B9 C5   
0048BA 50   
0048BB F5     13089 PUSH	AF
0048BC CD     13090 CALL	CON
0048BD 16   
0048BE 4D   
0048BF F1     13091 POP	AF
0048C0 FE     13092 CP	'-'
0048C1 2D   
0048C2 3E     13093 LD	A,0		;NUMERIC MARKER
0048C3 00   
0048C4 C0     13094 RET	NZ
0048C5 0D     13095 DEC	C
0048C6 0C     13096 INC	C
0048C7 CA     13097 JP	Z,NEGATE	;ZERO/INTEGER
0048C8 E8   
0048C9 4D   
0048CA 7C     13098 LD	A,H
0048CB EE     13099 XOR	80H		;CHANGE SIGN (FP)
0048CC 80   
0048CD 67     13100 LD	H,A
0048CE AF     13101 XOR	A
0048CF C9     13102 RET
0048D0 0D     13107 INT_:           DEC	C
0048D1 0C     13108 INC	C
0048D2 C8     13109 RET	Z		;ZERO/INTEGER
0048D3 3E     13110 LD	A,159
0048D4 9F   
0048D5 44     13111 LD	B,H		;B7=SIGN BIT
0048D6 CD     13112 CALL	FIX
0048D7 C0   
0048D8 4D   
0048D9 08     13113 EX	AF,AF'
0048DA A0     13114 AND	B
0048DB FC     13115 CALL	M,ADD1		;NEGATIVE NON-INTEGER
0048DC AA   
0048DD 4E   
0048DE 78     13116 LD	A,B
0048DF B7     13117 OR	A
0048E0 FC     13118 CALL	M,NEGATE
0048E1 E8   
0048E2 4D   
0048E3 AF     13119 XOR	A
0048E4 4F     13120 LD	C,A
0048E5 C9     13121 RET
0048E6 CD     13126 SQR:            CALL	SFLOAT
0048E7 94   
0048E8 4E   
0048E9 CB     13127 SQR0:           BIT	7,H
0048EA 7C   
0048EB 3E     13128 LD	A,NGROOT
0048EC 15   
0048ED C2     13129 JP	NZ,ERROR_mat	;"-ve root"
0048EE 08   
0048EF 45   
0048F0 0D     13130 DEC	C
0048F1 0C     13131 INC	C
0048F2 C8     13132 RET	Z		;ZERO
0048F3 CB     13133 SET	7,H		;IMPLIED 1
0048F4 FC   
0048F5 CB     13134 BIT	0,C
0048F6 41   
0048F7 CC     13135 CALL	Z,DIV2		;MAKE EXPONENT ODD
0048F8 C6   
0048F9 4E   
0048FA 79     13136 LD	A,C
0048FB D6     13137 SUB	80H
0048FC 80   
0048FD CB     13138 SRA	A		;HALVE EXPONENT
0048FE 2F   
0048FF C6     13139 ADD	A,80H
004900 80   
004901 4F     13140 LD	C,A
004902 C5     13141 PUSH	BC		;SAVE EXPONENT
004903 EB     13142 EX	DE,HL
004904 21     13143 LD	HL,0
004905 00   
004906 00   
004907 44     13144 LD	B,H
004908 4D     13145 LD	C,L
004909 D9     13146 EXX
00490A EB     13147 EX	DE,HL
00490B 21     13148 LD	HL,0
00490C 00   
00490D 00   
00490E 44     13149 LD	B,H
00490F 4D     13150 LD	C,L
004910 3E     13151 LD	A,-31
004911 E1   
004912 CD     13152 CALL	SQRA		;ROOT
004913 74   
004914 50   
004915 D9     13153 EXX
004916 CB     13154 BIT	7,B
004917 78   
004918 D9     13155 EXX
004919 CC     13156 CALL	Z,SQRA		;NORMALISE & INC A
00491A 74   
00491B 50   
00491C CD     13157 CALL	SQRB
00491D 93   
00491E 50   
00491F B7     13158 OR	A		;CLEAR CARRY
004920 CD     13159 CALL	DIVB
004921 2E   
004922 50   
004923 CB     13160 RR	E		;LSB TO CARRY
004924 1B   
004925 60     13161 LD	H,B
004926 69     13162 LD	L,C
004927 D9     13163 EXX
004928 60     13164 LD	H,B
004929 69     13165 LD	L,C
00492A DC     13166 CALL	C,ADD1		;ROUND UP
00492B AA   
00492C 4E   
00492D C1     13167 POP	BC		;RESTORE EXPONENT
00492E DC     13168 CALL	C,INCC
00492F D2   
004930 4E   
004931 1F     13169 RRA
004932 9F     13170 SBC	A,A
004933 81     13171 ADD	A,C
004934 4F     13172 LD	C,A
004935 CB     13173 RES	7,H		;POSITIVE
004936 BC   
004937 AF     13174 XOR	A
004938 C9     13175 RET
004939 CD     13180 TAN:            CALL	SFLOAT
00493A 94   
00493B 4E   
00493C CD     13181 CALL	PUSH5
00493D 7D   
00493E 4F   
00493F CD     13182 CALL	COS0
004940 59   
004941 49   
004942 CD     13183 CALL	POP5
004943 86   
004944 4F   
004945 CD     13184 CALL	PUSH5
004946 7D   
004947 4F   
004948 CD     13185 CALL	SWAP
004949 BE   
00494A 4E   
00494B CD     13186 CALL	SIN0
00494C 64   
00494D 49   
00494E CD     13187 CALL	POP5
00494F 86   
004950 4F   
004951 CD     13188 CALL	FDIV
004952 7F   
004953 46   
004954 AF     13189 XOR	A		;NUMERIC MARKER
004955 C9     13190 RET
004956 CD     13195 COS:            CALL	SFLOAT
004957 94   
004958 4E   
004959 CD     13196 COS0:           CALL	SCALE
00495A 09   
00495B 4E   
00495C 1C     13197 INC	E
00495D 1C     13198 INC	E
00495E 7B     13199 LD	A,E
00495F 18     13200 JR	SIN1
004960 0E   
004961 CD     13205 SIN:            CALL	SFLOAT
004962 94   
004963 4E   
004964 E5     13206 SIN0:           PUSH	HL		;H7=SIGN
004965 CD     13207 CALL	SCALE
004966 09   
004967 4E   
004968 F1     13208 POP	AF
004969 07     13209 RLCA
00496A 07     13210 RLCA
00496B 07     13211 RLCA
00496C E6     13212 AND	4
00496D 04   
00496E AB     13213 XOR	E
00496F F5     13214 SIN1:           PUSH	AF		;OCTANT
004970 CB     13215 RES	7,H
004971 BC   
004972 1F     13216 RRA
004973 CD     13217 CALL	PIBY4
004974 F0   
004975 49   
004976 DC     13218 CALL	C,RSUB		;X=(PI/4)-X
004977 17   
004978 46   
004979 F1     13219 POP	AF
00497A F5     13220 PUSH	AF
00497B E6     13221 AND	3
00497C 03   
00497D E2     13222 JP	PO,SIN2		;USE COSINE APPROX.
00497E AE   
00497F 49   
004980 CD     13223 CALL	PUSH5		;SAVE X
004981 7D   
004982 4F   
004983 CD     13224 CALL	SQUARE		;PUSH X*X
004984 77   
004985 4F   
004986 CD     13225 CALL	POLY
004987 B0   
004988 4F   
004989 B7     13226 DW	0A8B7H		;a(8)
00498A A8   
00498B 11     13227 DW	3611H
00498C 36   
00498D 6D     13228 DB	6DH
00498E 26     13229 DW	0DE26H		;a(6)
00498F DE   
004990 05     13230 DW	0D005H
004991 D0   
004992 73     13231 DB	73H
004993 C0     13232 DW	80C0H		;a(4)
004994 80   
004995 88     13233 DW	888H
004996 08   
004997 79     13234 DB	79H
004998 9D     13235 DW	0AA9DH		;a(2)
004999 AA   
00499A AA     13236 DW	0AAAAH
00499B AA   
00499C 7D     13237 DB	7DH
00499D 00     13238 DW	0		;a(0)
00499E 00   
00499F 00     13239 DW	0
0049A0 00   
0049A1 80     13240 DB	80H
0049A2 CD     13241 CALL	POP5
0049A3 86   
0049A4 4F   
0049A5 CD     13242 CALL	POP5
0049A6 86   
0049A7 4F   
0049A8 CD     13243 CALL	FMUL
0049A9 EF   
0049AA 46   
0049AB C3     13244 JP	SIN3
0049AC D0   
0049AD 49   
0049AE CD     13246 SIN2:           CALL	SQUARE		;PUSH X*X
0049AF 77   
0049B0 4F   
0049B1 CD     13247 CALL	POLY
0049B2 B0   
0049B3 4F   
0049B4 71     13248 DW	0D571H		;b(8)
0049B5 D5   
0049B6 78     13249 DW	4C78H
0049B7 4C   
0049B8 70     13250 DB	70H
0049B9 AF     13251 DW	94AFH		;b(6)
0049BA 94   
0049BB 03     13252 DW	0B603H
0049BC B6   
0049BD 76     13253 DB	76H
0049BE C8     13254 DW	9CC8H		;b(4)
0049BF 9C   
0049C0 AA     13255 DW	2AAAH
0049C1 2A   
0049C2 7B     13256 DB	7BH
0049C3 DD     13257 DW	0FFDDH		;b(2)
0049C4 FF   
0049C5 FF     13258 DW	0FFFFH
0049C6 FF   
0049C7 7E     13259 DB	7EH
0049C8 00     13260 DW	0		;b(0)
0049C9 00   
0049CA 00     13261 DW	0
0049CB 00   
0049CC 80     13262 DB	80H
0049CD CD     13263 CALL	POP5
0049CE 86   
0049CF 4F   
0049D0 F1     13264 SIN3:           POP	AF
0049D1 E6     13265 AND	4
0049D2 04   
0049D3 C8     13266 RET	Z
0049D4 0D     13267 DEC	C
0049D5 0C     13268 INC	C
0049D6 C8     13269 RET	Z		;ZERO
0049D7 CB     13270 SET	7,H		;MAKE NEGATIVE
0049D8 FC   
0049D9 C9     13271 RET
0049DA 21     13275 FONE:           LD	HL,0
0049DB 00   
0049DC 00   
0049DD D9     13276 EXX
0049DE 21     13277 LD	HL,0
0049DF 00   
0049E0 00   
0049E1 D9     13278 EXX
0049E2 0E     13279 LD	C,80H
0049E3 80   
0049E4 C9     13280 RET
0049E5 11     13282 DONE:           LD	DE,0
0049E6 00   
0049E7 00   
0049E8 D9     13283 EXX
0049E9 11     13284 LD	DE,0
0049EA 00   
0049EB 00   
0049EC D9     13285 EXX
0049ED 06     13286 LD	B,80H
0049EE 80   
0049EF C9     13287 RET
0049F0 11     13289 PIBY4:          LD	DE,490FH
0049F1 0F   
0049F2 49   
0049F3 D9     13290 EXX
0049F4 11     13291 LD	DE,0DAA2H
0049F5 A2   
0049F6 DA   
0049F7 D9     13292 EXX
0049F8 06     13293 LD	B,7FH
0049F9 7F   
0049FA C9     13294 RET
0049FB CD     13299 EXP:            CALL	SFLOAT
0049FC 94   
0049FD 4E   
0049FE CD     13300 EXP0:           CALL	LN2		;LN(2)
0049FF 7B   
004A00 4A   
004A01 D9     13301 EXX
004A02 1D     13302 DEC	E
004A03 01     13303 LD	BC,0D1CFH	;0.6931471805599453
004A04 CF   
004A05 D1   
004A06 D9     13304 EXX
004A07 E5     13305 PUSH	HL		;H7=SIGN
004A08 CD     13306 CALL	MOD48		;"MODULUS"
004A09 19   
004A0A 4E   
004A0B F1     13307 POP	AF
004A0C CB     13308 BIT	7,E
004A0D 7B   
004A0E 28     13309 JR	Z,EXP1
004A0F 09   
004A10 17     13310 RLA
004A11 DA     13311 JP	C,ZEROmat
004A12 03   
004A13 4F   
004A14 3E     13312 LD	A,EXPRNG
004A15 18   
004A16 C3     13313 JP	ERROR_mat		;"Exp range"
004A17 08   
004A18 45   
004A19 E6     13315 EXP1:           AND	80H
004A1A 80   
004A1B B3     13316 OR	E
004A1C F5     13317 PUSH	AF		;INTEGER PART
004A1D CB     13318 RES	7,H
004A1E BC   
004A1F CD     13319 CALL	PUSH5		;PUSH X*LN(2)
004A20 7D   
004A21 4F   
004A22 CD     13320 CALL	POLY
004A23 B0   
004A24 4F   
004A25 72     13321 DW	4072H		;a(7)
004A26 40   
004A27 2E     13322 DW	942EH
004A28 94   
004A29 73     13323 DB	73H
004A2A 65     13324 DW	6F65H		;a(6)
004A2B 6F   
004A2C 4F     13325 DW	2E4FH
004A2D 2E   
004A2E 76     13326 DB	76H
004A2F 37     13327 DW	6D37H		;a(5)
004A30 6D   
004A31 02     13328 DW	8802H
004A32 88   
004A33 79     13329 DB	79H
004A34 12     13330 DW	0E512H		;a(4)
004A35 E5   
004A36 A0     13331 DW	2AA0H
004A37 2A   
004A38 7B     13332 DB	7BH
004A39 14     13333 DW	4F14H		;a(3)
004A3A 4F   
004A3B AA     13334 DW	0AAAAH
004A3C AA   
004A3D 7D     13335 DB	7DH
004A3E 56     13336 DW	0FD56H		;a(2)
004A3F FD   
004A40 FF     13337 DW	7FFFH
004A41 7F   
004A42 7E     13338 DB	7EH
004A43 FE     13339 DW	0FFFEH		;a(1)
004A44 FF   
004A45 FF     13340 DW	0FFFFH
004A46 FF   
004A47 7F     13341 DB	7FH
004A48 00     13342 DW	0		;a(0)
004A49 00   
004A4A 00     13343 DW	0
004A4B 00   
004A4C 80     13344 DB	80H
004A4D CD     13345 CALL	POP5
004A4E 86   
004A4F 4F   
004A50 F1     13346 POP	AF
004A51 F5     13347 PUSH	AF
004A52 F4     13348 CALL	P,RECIP		;X=1/X
004A53 72   
004A54 4A   
004A55 F1     13349 POP	AF
004A56 F2     13350 JP	P,EXP4
004A57 5D   
004A58 4A   
004A59 E6     13351 AND	7FH
004A5A 7F   
004A5B ED     13352 NEG
004A5C 44   
004A5D C6     13353 EXP4:           ADD	A,80H
004A5E 80   
004A5F 81     13354 ADD	A,C
004A60 38     13355 JR	C,EXP2
004A61 05   
004A62 F2     13356 JP	P,ZEROmat		;UNDERFLOW
004A63 03   
004A64 4F   
004A65 18     13357 JR	EXP3
004A66 03   
004A67 FA     13358 EXP2:           JP	M,OFLOW		;OVERFLOW
004A68 D4   
004A69 4E   
004A6A C6     13359 EXP3:           ADD	A,80H
004A6B 80   
004A6C CA     13360 JP	Z,ZEROmat
004A6D 03   
004A6E 4F   
004A6F 4F     13361 LD	C,A
004A70 AF     13362 XOR	A		;NUMERIC MARKER
004A71 C9     13363 RET
004A72 CD     13365 RECIP:          CALL	DONE
004A73 E5   
004A74 49   
004A75 CD     13366 RDIV:           CALL	SWAP
004A76 BE   
004A77 4E   
004A78 C3     13367 JP	FDIV		;RECIPROCAL
004A79 7F   
004A7A 46   
004A7B 11     13369 LN2:            LD	DE,3172H	;LN(2)
004A7C 72   
004A7D 31   
004A7E D9     13370 EXX
004A7F 11     13371 LD	DE,17F8H
004A80 F8   
004A81 17   
004A82 D9     13372 EXX
004A83 06     13373 LD	B,7FH
004A84 7F   
004A85 C9     13374 RET
004A86 CD     13379 LN:             CALL	SFLOAT
004A87 94   
004A88 4E   
004A89 3E     13380 LN0:            LD	A,LOGRNG
004A8A 16   
004A8B CB     13381 BIT	7,H
004A8C 7C   
004A8D C2     13382 JP	NZ,ERROR_mat	;"Log range"
004A8E 08   
004A8F 45   
004A90 0C     13383 INC	C
004A91 0D     13384 DEC	C
004A92 CA     13385 JP	Z,ERROR_mat
004A93 08   
004A94 45   
004A95 11     13386 LD	DE,3504H	;SQR(2)
004A96 04   
004A97 35   
004A98 D9     13387 EXX
004A99 11     13388 LD	DE,0F333H	;1.41421356237
004A9A 33   
004A9B F3   
004A9C D9     13389 EXX
004A9D CD     13390 CALL	ICP0		;MANTISSA>SQR(2)?
004A9E 15   
004A9F 4F   
004AA0 79     13391 LD	A,C		;EXPONENT
004AA1 0E     13392 LD	C,80H		;1 <= X < 2
004AA2 80   
004AA3 38     13393 JR	C,LN4
004AA4 02   
004AA5 0D     13394 DEC	C
004AA6 3C     13395 INC	A
004AA7 F5     13396 LN4:            PUSH	AF		;SAVE EXPONENT
004AA8 CD     13397 CALL	RATIO		;X=(X-1)/(X+1)
004AA9 92   
004AAA 4F   
004AAB CD     13398 CALL	PUSH5
004AAC 7D   
004AAD 4F   
004AAE CD     13399 CALL	SQUARE		;PUSH X*X
004AAF 77   
004AB0 4F   
004AB1 CD     13400 CALL	POLY
004AB2 B0   
004AB3 4F   
004AB4 48     13401 DW	0CC48H		;a(9)
004AB5 CC   
004AB6 FB     13402 DW	74FBH
004AB7 74   
004AB8 7D     13403 DB	7DH
004AB9 AF     13404 DW	0AEAFH		;a(7)
004ABA AE   
004ABB FF     13405 DW	11FFH
004ABC 11   
004ABD 7E     13406 DB	7EH
004ABE 8C     13407 DW	0D98CH		;a(5)
004ABF D9   
004AC0 CD     13408 DW	4CCDH
004AC1 4C   
004AC2 7E     13409 DB	7EH
004AC3 E3     13410 DW	0A9E3H		;a(3)
004AC4 A9   
004AC5 AA     13411 DW	2AAAH
004AC6 2A   
004AC7 7F     13412 DB	7FH
004AC8 00     13413 DW	0		;a(1)
004AC9 00   
004ACA 00     13414 DW	0
004ACB 00   
004ACC 81     13415 DB	81H
004ACD CD     13416 CALL	POP5
004ACE 86   
004ACF 4F   
004AD0 CD     13417 CALL	POP5
004AD1 86   
004AD2 4F   
004AD3 CD     13418 CALL	FMUL
004AD4 EF   
004AD5 46   
004AD6 F1     13419 POP	AF		;EXPONENT
004AD7 CD     13420 CALL	PUSH5
004AD8 7D   
004AD9 4F   
004ADA 08     13421 EX	AF,AF'
004ADB CD     13422 CALL	ZEROmat
004ADC 03   
004ADD 4F   
004ADE 08     13423 EX	AF,AF'
004ADF D6     13424 SUB	80H
004AE0 80   
004AE1 28     13425 JR	Z,LN3
004AE2 1B   
004AE3 30     13426 JR	NC,LN1
004AE4 02   
004AE5 2F     13427 CPL
004AE6 3C     13428 INC	A
004AE7 67     13429 LN1:            LD	H,A
004AE8 0E     13430 LD	C,87H
004AE9 87   
004AEA F5     13431 PUSH	AF
004AEB CD     13432 CALL	FLOAT
004AEC 7A   
004AED 4E   
004AEE CB     13433 RES	7,H
004AEF BC   
004AF0 CD     13434 CALL	LN2
004AF1 7B   
004AF2 4A   
004AF3 CD     13435 CALL	FMUL
004AF4 EF   
004AF5 46   
004AF6 F1     13436 POP	AF
004AF7 30     13437 JR	NC,LN3
004AF8 05   
004AF9 FA     13438 JP	M,LN3
004AFA FE   
004AFB 4A   
004AFC CB     13439 SET	7,H
004AFD FC   
004AFE CD     13440 LN3:            CALL	POP5
004AFF 86   
004B00 4F   
004B01 CD     13441 CALL	FADD
004B02 27   
004B03 46   
004B04 AF     13442 XOR	A
004B05 C9     13443 RET
004B06 CD     13448 LOG:            CALL	LN
004B07 86   
004B08 4A   
004B09 11     13449 LD	DE,5E5BH	;LOG(e)
004B0A 5B   
004B0B 5E   
004B0C D9     13450 EXX
004B0D 11     13451 LD	DE,0D8A9H
004B0E A9   
004B0F D8   
004B10 D9     13452 EXX
004B11 06     13453 LD	B,7EH
004B12 7E   
004B13 CD     13454 CALL	FMUL
004B14 EF   
004B15 46   
004B16 AF     13455 XOR	A
004B17 C9     13456 RET
004B18 CD     13461 ASN:            CALL	SFLOAT
004B19 94   
004B1A 4E   
004B1B CD     13462 CALL	PUSH5
004B1C 7D   
004B1D 4F   
004B1E CD     13463 CALL	COPY
004B1F 6F   
004B20 4F   
004B21 CD     13464 CALL	FMUL
004B22 EF   
004B23 46   
004B24 CD     13465 CALL	DONE
004B25 E5   
004B26 49   
004B27 CD     13466 CALL	RSUB
004B28 17   
004B29 46   
004B2A CD     13467 CALL	SQR0
004B2B E9   
004B2C 48   
004B2D CD     13468 CALL	POP5
004B2E 86   
004B2F 4F   
004B30 0C     13469 INC	C
004B31 0D     13470 DEC	C
004B32 3E     13471 LD	A,2
004B33 02   
004B34 D5     13472 PUSH	DE
004B35 28     13473 JR	Z,ACS1
004B36 70   
004B37 D1     13474 POP	DE
004B38 CD     13475 CALL	RDIV
004B39 75   
004B3A 4A   
004B3B 18     13476 JR	ATN0
004B3C 03   
004B3D CD     13481 ATN:            CALL	SFLOAT
004B3E 94   
004B3F 4E   
004B40 E5     13482 ATN0:           PUSH	HL		;SAVE SIGN
004B41 CB     13483 RES	7,H
004B42 BC   
004B43 11     13484 LD	DE,5413H	;TAN(PI/8)=SQR(2)-1
004B44 13   
004B45 54   
004B46 D9     13485 EXX
004B47 11     13486 LD	DE,0CCD0H
004B48 D0   
004B49 CC   
004B4A D9     13487 EXX
004B4B 06     13488 LD	B,7EH
004B4C 7E   
004B4D CD     13489 CALL	FCP0		;COMPARE
004B4E 12   
004B4F 4F   
004B50 06     13490 LD	B,0
004B51 00   
004B52 38     13491 JR	C,ATN2
004B53 1C   
004B54 11     13492 LD	DE,1A82H	;TAN(3*PI/8)=SQR(2)+1
004B55 82   
004B56 1A   
004B57 D9     13493 EXX
004B58 11     13494 LD	DE,799AH
004B59 9A   
004B5A 79   
004B5B D9     13495 EXX
004B5C 06     13496 LD	B,81H
004B5D 81   
004B5E CD     13497 CALL	FCP0		;COMPARE
004B5F 12   
004B60 4F   
004B61 38     13498 JR	C,ATN1
004B62 08   
004B63 CD     13499 CALL	RECIP		;X=1/X
004B64 72   
004B65 4A   
004B66 06     13500 LD	B,2
004B67 02   
004B68 C3     13501 JP	ATN2
004B69 70   
004B6A 4B   
004B6B CD     13502 ATN1:           CALL	RATIO		;X=(X-1)/(X+1)
004B6C 92   
004B6D 4F   
004B6E 06     13503 LD	B,1
004B6F 01   
004B70 C5     13504 ATN2:           PUSH	BC		;SAVE FLAG
004B71 CD     13505 CALL	PUSH5
004B72 7D   
004B73 4F   
004B74 CD     13506 CALL	SQUARE		;PUSH X*X
004B75 77   
004B76 4F   
004B77 CD     13507 CALL	POLY
004B78 B0   
004B79 4F   
004B7A 35     13508 DW	0F335H		;a(13)
004B7B F3   
004B7C D8     13509 DW	37D8H
004B7D 37   
004B7E 7B     13510 DB	7BH
004B7F 91     13511 DW	6B91H		;a(11)
004B80 6B   
004B81 B9     13512 DW	0AAB9H
004B82 AA   
004B83 7C     13513 DB	7CH
004B84 DE     13514 DW	41DEH		;a(9)
004B85 41   
004B86 97     13515 DW	6197H
004B87 61   
004B88 7C     13516 DB	7CH
004B89 7B     13517 DW	9D7BH		;a(7)
004B8A 9D   
004B8B 37     13518 DW	9237H
004B8C 92   
004B8D 7D     13519 DB	7DH
004B8E 5A     13520 DW	2A5AH		;a(5)
004B8F 2A   
004B90 CC     13521 DW	4CCCH
004B91 4C   
004B92 7D     13522 DB	7DH
004B93 5C     13523 DW	0A95CH		;a(3)
004B94 A9   
004B95 AA     13524 DW	0AAAAH
004B96 AA   
004B97 7E     13525 DB	7EH
004B98 00     13526 DW	0		;a(1)
004B99 00   
004B9A 00     13527 DW	0
004B9B 00   
004B9C 80     13528 DB	80H
004B9D CD     13529 CALL	POP5
004B9E 86   
004B9F 4F   
004BA0 CD     13530 CALL	POP5
004BA1 86   
004BA2 4F   
004BA3 CD     13531 CALL	FMUL
004BA4 EF   
004BA5 46   
004BA6 F1     13532 POP	AF
004BA7 CD     13533 ACS1:           CALL	PIBY4		;PI/4
004BA8 F0   
004BA9 49   
004BAA 1F     13534 RRA
004BAB F5     13535 PUSH	AF
004BAC DC     13536 CALL	C,FADD
004BAD 27   
004BAE 46   
004BAF F1     13537 POP	AF
004BB0 04     13538 INC	B
004BB1 1F     13539 RRA
004BB2 DC     13540 CALL	C,RSUB
004BB3 17   
004BB4 46   
004BB5 F1     13541 POP	AF
004BB6 B7     13542 OR	A
004BB7 F0     13543 RET	P
004BB8 CB     13544 SET	7,H		;MAKE NEGATIVE
004BB9 FC   
004BBA AF     13545 XOR	A
004BBB C9     13546 RET
004BBC CD     13551 ACS:            CALL	ASN
004BBD 18   
004BBE 4B   
004BBF 3E     13552 LD	A,2
004BC0 02   
004BC1 F5     13553 PUSH	AF
004BC2 18     13554 JR	ACS1
004BC3 E3   
004BC4 CD     13564 STRmat:            CALL	SFLOAT
004BC5 94   
004BC6 4E   
004BC7 06     13565 LD	B,0		;DEFAULT PT. POSITION
004BC8 00   
004BC9 CB     13566 BIT	7,H		;NEGATIVE?
004BCA 7C   
004BCB 28     13567 JR	Z,STR10
004BCC 06   
004BCD CB     13568 RES	7,H
004BCE BC   
004BCF 3E     13569 LD	A,'-'
004BD0 2D   
004BD1 12     13570 LD	(DE),A		;STORE SIGN
004BD2 13     13571 INC	DE
004BD3 AF     13572 STR10:          XOR	A		;CLEAR A
004BD4 B9     13573 CP	C
004BD5 28     13574 JR	Z,STR2mat		;ZERO
004BD6 47   
004BD7 D5     13575 PUSH	DE		;SAVE TEXT POINTER
004BD8 78     13576 LD	A,B
004BD9 F5     13577 STR11:          PUSH	AF		;SAVE DECIMAL COUNTER
004BDA 79     13578 LD	A,C		;BINARY EXPONENT
004BDB FE     13579 CP	161
004BDC A1   
004BDD 30     13580 JR	NC,STR14
004BDE 1A   
004BDF FE     13581 CP	155
004BE0 9B   
004BE1 30     13582 JR	NC,STR15
004BE2 25   
004BE3 2F     13583 CPL
004BE4 FE     13584 CP	225
004BE5 E1   
004BE6 38     13585 JR	C,STR13
004BE7 02   
004BE8 3E     13586 LD	A,-8
004BE9 F8   
004BEA C6     13587 STR13:          ADD	A,28
004BEB 1C   
004BEC CD     13588 CALL	POWR10
004BED D7   
004BEE 4F   
004BEF F5     13589 PUSH	AF
004BF0 CD     13590 CALL	FMUL
004BF1 EF   
004BF2 46   
004BF3 F1     13591 POP	AF
004BF4 47     13592 LD	B,A
004BF5 F1     13593 POP	AF
004BF6 90     13594 SUB	B
004BF7 18     13595 JR	STR11
004BF8 E0   
004BF9 D6     13596 STR14:          SUB	32
004BFA 20   
004BFB CD     13597 CALL	POWR10
004BFC D7   
004BFD 4F   
004BFE F5     13598 PUSH	AF
004BFF CD     13599 CALL	FDIV
004C00 7F   
004C01 46   
004C02 F1     13600 POP	AF
004C03 47     13601 LD	B,A
004C04 F1     13602 POP	AF
004C05 80     13603 ADD	A,B
004C06 18     13604 JR	STR11
004C07 D1   
004C08 3E     13605 STR15:          LD	A,9
004C09 09   
004C0A CD     13606 CALL	POWR10		;10^9
004C0B D7   
004C0C 4F   
004C0D CD     13607 CALL	FCP0
004C0E 12   
004C0F 4F   
004C10 79     13608 LD	A,C
004C11 C1     13609 POP	BC
004C12 4F     13610 LD	C,A
004C13 CB     13611 SET	7,H		;IMPLIED 1
004C14 FC   
004C15 DC     13612 CALL	C,X10B		;X10, DEC B
004C16 34   
004C17 4F   
004C18 D1     13613 POP	DE		;RESTORE TEXT POINTER
004C19 CB     13614 RES	7,C
004C1A B9   
004C1B 3E     13615 LD	A,0
004C1C 00   
004C1D 17     13616 RLA			;PUT CARRY IN LSB
004C1E 0C     13624 STR2mat:           INC	C
004C1F 08     13625 EX	AF,AF'		;SAVE A
004C20 78     13626 LD	A,B
004C21 DD     13627 BIT	1,(IX+2)
004C22 CB   
004C23 02   
004C24 4E   
004C25 20     13628 JR	NZ,STR20
004C26 08   
004C27 AF     13629 XOR	A
004C28 DD     13630 CP	(IX+1)
004C29 BE   
004C2A 01   
004C2B 28     13631 JR	Z,STR21
004C2C 0A   
004C2D 3E     13632 LD	A,-10
004C2E F6   
004C2F DD     13633 STR20:          ADD	A,(IX+1)	;SIG. FIG. COUNT
004C30 86   
004C31 01   
004C32 B7     13634 OR	A		;CLEAR CARRY
004C33 FA     13635 JP	M,STR21
004C34 37   
004C35 4C   
004C36 AF     13636 XOR	A
004C37 F5     13637 STR21:          PUSH	AF
004C38 08     13638 EX	AF,AF'		;RESTORE A
004C39 CD     13639 STR22:          CALL	X2		;RL AHLH'L'
004C3A 5D   
004C3B 4F   
004C3C 8F     13640 ADC	A,A
004C3D FE     13641 CP	10
004C3E 0A   
004C3F 38     13642 JR	C,STR23
004C40 05   
004C41 D6     13643 SUB	10
004C42 0A   
004C43 D9     13644 EXX
004C44 2C     13645 INC	L		;SET RESULT BIT
004C45 D9     13646 EXX
004C46 0D     13647 STR23:          DEC	C
004C47 20     13648 JR	NZ,STR22	;32 TIMES
004C48 F0   
004C49 4F     13649 LD	C,A		;REMAINDER
004C4A 7C     13650 LD	A,H
004C4B E6     13651 AND	3FH		;CLEAR OUT JUNK
004C4C 3F   
004C4D 67     13652 LD	H,A
004C4E F1     13653 POP	AF
004C4F F2     13654 JP	P,STR24
004C50 5C   
004C51 4C   
004C52 3C     13655 INC	A
004C53 20     13656 JR	NZ,STR26
004C54 1C   
004C55 3E     13657 LD	A,4
004C56 04   
004C57 B9     13658 CP	C		;ROUND UP?
004C58 3E     13659 LD	A,0
004C59 00   
004C5A 18     13660 JR	STR26
004C5B 15   
004C5C F5     13661 STR24:          PUSH	AF
004C5D 79     13662 LD	A,C
004C5E CE     13663 ADC	A,'0'		;ADD CARRY
004C5F 30   
004C60 FE     13664 CP	'0'
004C61 30   
004C62 28     13665 JR	Z,STR25		;SUPPRESS ZERO
004C63 05   
004C64 FE     13666 CP	'9'+1
004C65 3A   
004C66 3F     13667 CCF
004C67 30     13668 JR	NC,STR26
004C68 08   
004C69 E3     13669 STR25:          EX	(SP),HL
004C6A CB     13670 BIT	6,L		;ZERO FLAG
004C6B 75   
004C6C E3     13671 EX	(SP),HL
004C6D 20     13672 JR	NZ,STR27
004C6E 05   
004C6F 3E     13673 LD	A,'0'
004C70 30   
004C71 3C     13674 STR26:          INC	A		;SET +VE
004C72 3D     13675 DEC	A
004C73 F5     13676 PUSH	AF		;PUT ON STACK + CARRY
004C74 04     13677 STR27:          INC	B
004C75 CD     13678 CALL	TESTmat		;IS HLH'L' ZERO?
004C76 E3   
004C77 4E   
004C78 0E     13679 LD	C,32
004C79 20   
004C7A 3E     13680 LD	A,0
004C7B 00   
004C7C 20     13681 JR	NZ,STR22
004C7D BB   
004C7E F1     13682 POP	AF
004C7F F5     13683 PUSH	AF
004C80 3E     13684 LD	A,0
004C81 00   
004C82 38     13685 JR	C,STR22
004C83 B5   
004C84 EB     13693 STR3:           EX	DE,HL		;STRING POINTER
004C85 0E     13694 LD	C,-1		;FLAG "E"
004C86 FF   
004C87 16     13695 LD	D,1
004C88 01   
004C89 DD     13696 LD	E,(IX+1)	;f2
004C8A 5E   
004C8B 01   
004C8C DD     13697 BIT	0,(IX+2)
004C8D CB   
004C8E 02   
004C8F 46   
004C90 20     13698 JR	NZ,STR34	;E MODE
004C91 32   
004C92 DD     13699 BIT	1,(IX+2)
004C93 CB   
004C94 02   
004C95 4E   
004C96 28     13700 JR	Z,STR31
004C97 11   
004C98 78     13701 LD	A,B		;F MODE
004C99 B7     13702 OR	A
004C9A 28     13703 JR	Z,STR30
004C9B 04   
004C9C FA     13704 JP	M,STR30
004C9D A0   
004C9E 4C   
004C9F 50     13705 LD	D,B
004CA0 7A     13706 STR30:          LD	A,D
004CA1 DD     13707 ADD	A,(IX+1)
004CA2 86   
004CA3 01   
004CA4 5F     13708 LD	E,A
004CA5 FE     13709 CP	11
004CA6 0B   
004CA7 38     13710 JR	C,STR32
004CA8 17   
004CA9 78     13711 STR31:          LD	A,B		;G MODE
004CAA 11     13712 LD	DE,101H
004CAB 01   
004CAC 01   
004CAD B7     13713 OR	A
004CAE FA     13714 JP	M,STR34
004CAF C4   
004CB0 4C   
004CB1 28     13715 JR	Z,STR32
004CB2 0D   
004CB3 DD     13716 LD	A,(IX+1)
004CB4 7E   
004CB5 01   
004CB6 B7     13717 OR	A
004CB7 20     13718 JR	NZ,STR3A
004CB8 02   
004CB9 3E     13719 LD	A,10
004CBA 0A   
004CBB B8     13720 STR3A:          CP	B
004CBC 38     13721 JR	C,STR34
004CBD 06   
004CBE 50     13722 LD	D,B
004CBF 58     13723 LD	E,B
004CC0 78     13724 STR32:          LD	A,B
004CC1 C6     13725 ADD	A,129
004CC2 81   
004CC3 4F     13726 LD	C,A
004CC4 CB     13727 STR34:          SET	7,D
004CC5 FA   
004CC6 1D     13728 DEC	E
004CC7 7A     13729 STR35:          LD	A,D
004CC8 B9     13730 CP	C
004CC9 30     13731 JR	NC,STR33
004CCA 0C   
004CCB F1     13732 STR36:          POP	AF
004CCC 28     13733 JR	Z,STR37
004CCD 03   
004CCE F2     13734 JP	P,STR38
004CCF D9   
004CD0 4C   
004CD1 F5     13735 STR37:          PUSH	AF
004CD2 1C     13736 INC	E
004CD3 1D     13737 DEC	E
004CD4 FA     13738 JP	M,STR4
004CD5 E8   
004CD6 4C   
004CD7 3E     13739 STR33:          LD	A,'0'
004CD8 30   
004CD9 15     13740 STR38:          DEC	D
004CDA E2     13741 JP	PO,STR39
004CDB E0   
004CDC 4C   
004CDD 36     13742 LD	(HL),'.'
004CDE 2E   
004CDF 23     13743 INC	HL
004CE0 77     13744 STR39:          LD	(HL),A
004CE1 23     13745 INC	HL
004CE2 1D     13746 DEC	E
004CE3 F2     13747 JP	P,STR35
004CE4 C7   
004CE5 4C   
004CE6 18     13748 JR	STR36
004CE7 E3   
004CE8 F1     13750 STR4:           POP	AF
004CE9 0C     13751 STR40:          INC	C
004CEA 4D     13752 LD	C,L
004CEB 20     13753 JR	NZ,STR44
004CEC 27   
004CED 36     13754 LD	(HL),'E'	;EXPONENT
004CEE 45   
004CEF 23     13755 INC	HL
004CF0 78     13756 LD	A,B
004CF1 3D     13757 DEC	A
004CF2 F2     13758 JP	P,STR41
004CF3 FA   
004CF4 4C   
004CF5 36     13759 LD	(HL),'-'
004CF6 2D   
004CF7 23     13760 INC	HL
004CF8 ED     13761 NEG
004CF9 44   
004CFA 36     13762 STR41:          LD	(HL),'0'
004CFB 30   
004CFC 28     13763 JR	Z,STR47
004CFD 15   
004CFE FE     13764 CP	10
004CFF 0A   
004D00 47     13765 LD	B,A
004D01 3E     13766 LD	A,':'
004D02 3A   
004D03 38     13767 JR	C,STR42
004D04 03   
004D05 23     13768 INC	HL
004D06 36     13769 LD	(HL),'0'
004D07 30   
004D08 34     13770 STR42:          INC	(HL)
004D09 BE     13771 CP	(HL)
004D0A 20     13772 JR	NZ,STR43
004D0B 05   
004D0C 36     13773 LD	(HL),'0'
004D0D 30   
004D0E 2B     13774 DEC	HL
004D0F 34     13775 INC	(HL)
004D10 23     13776 INC	HL
004D11 10     13777 STR43:          DJNZ	STR42
004D12 F5   
004D13 23     13778 STR47:          INC	HL
004D14 EB     13779 STR44:          EX	DE,HL
004D15 C9     13780 RET
004D16 CD     13790 CON:            CALL	ZEROmat		;INITIALISE TO ZERO
004D17 03   
004D18 4F   
004D19 0E     13791 LD	C,0		;TRUNCATION COUNTER
004D1A 00   
004D1B CD     13792 CALL	NUMBERmat		;GET INTEGER PART
004D1C 9B   
004D1D 4D   
004D1E FE     13793 CP	'.'
004D1F 2E   
004D20 06     13794 LD	B,0		;DECL. PLACE COUNTER
004D21 00   
004D22 CC     13795 CALL	Z,NUMBIX	;GET FRACTION PART
004D23 99   
004D24 4D   
004D25 FE     13796 CP	'E'
004D26 45   
004D27 3E     13797 LD	A,0		;INITIALISE EXPONENT
004D28 00   
004D29 CC     13798 CALL	Z,GETEXP	;GET EXPONENT
004D2A 6A   
004D2B 4D   
004D2C CB     13799 BIT	7,H
004D2D 7C   
004D2E 20     13800 JR	NZ,CON0		;INTEGER OVERFLOW
004D2F 08   
004D30 B7     13801 OR	A
004D31 20     13802 JR	NZ,CON0		;EXPONENT NON-ZERO
004D32 05   
004D33 B8     13803 CP	B
004D34 20     13804 JR	NZ,CON0		;DECIMAL POINT
004D35 02   
004D36 B9     13805 CP	C
004D37 C8     13806 RET	Z		;INTEGER
004D38 90     13807 CON0:           SUB	B
004D39 81     13808 ADD	A,C
004D3A 0E     13809 LD	C,159
004D3B 9F   
004D3C CD     13810 CALL	FLOAT
004D3D 7A   
004D3E 4E   
004D3F CB     13811 RES	7,H		;DITCH IMPLIED 1
004D40 BC   
004D41 B7     13812 OR	A
004D42 C8     13813 RET	Z		;DONE
004D43 FA     13814 JP	M,CON2		;NEGATIVE EXPONENT
004D44 4E   
004D45 4D   
004D46 CD     13815 CALL	POWR10
004D47 D7   
004D48 4F   
004D49 CD     13816 CALL	FMUL		;SCALE
004D4A EF   
004D4B 46   
004D4C AF     13817 XOR	A
004D4D C9     13818 RET
004D4E FE     13819 CON2:           CP	-38
004D4F DA   
004D50 38     13820 JR	C,CON3		;CAN'T SCALE IN ONE GO
004D51 0A   
004D52 ED     13821 NEG
004D53 44   
004D54 CD     13822 CALL	POWR10
004D55 D7   
004D56 4F   
004D57 CD     13823 CALL	FDIV		;SCALE
004D58 7F   
004D59 46   
004D5A AF     13824 XOR	A
004D5B C9     13825 RET
004D5C F5     13826 CON3:           PUSH	AF
004D5D 3E     13827 LD	A,38
004D5E 26   
004D5F CD     13828 CALL	POWR10
004D60 D7   
004D61 4F   
004D62 CD     13829 CALL	FDIV
004D63 7F   
004D64 46   
004D65 F1     13830 POP	AF
004D66 C6     13831 ADD	A,38
004D67 26   
004D68 18     13832 JR	CON2
004D69 E4   
004D6A C5     13842 GETEXP:         PUSH	BC		;SAVE REGISTERS
004D6B 47     13843 LD	B,A		;INITIAL VALUE
004D6C 0E     13844 LD	C,2		;2 DIGITS MAX
004D6D 02   
004D6E DD     13845 INC	IX		;BUMP PAST 'E'
004D6F 23   
004D70 CD     13846 CALL	SIGNQ
004D71 C5   
004D72 50   
004D73 08     13847 EX	AF,AF'		;SAVE EXPONENT SIGN
004D74 CD     13848 GETEX1:         CALL	DIGITQ
004D75 BB   
004D76 50   
004D77 38     13849 JR	C,GETEX2
004D78 17   
004D79 78     13850 LD	A,B		;B=B*10
004D7A 87     13851 ADD	A,A
004D7B 87     13852 ADD	A,A
004D7C 80     13853 ADD	A,B
004D7D 87     13854 ADD	A,A
004D7E 47     13855 LD	B,A
004D7F DD     13856 LD	A,(IX)		;GET BACK DIGIT
004D80 7E   
004D81 00   
004D82 DD     13857 INC	IX
004D83 23   
004D84 E6     13858 AND	0FH		;MASK UNWANTED BITS
004D85 0F   
004D86 80     13859 ADD	A,B		;ADD IN DIGIT
004D87 47     13860 LD	B,A
004D88 0D     13861 DEC	C
004D89 F2     13862 JP	P,GETEX1
004D8A 74   
004D8B 4D   
004D8C 06     13863 LD	B,100		;FORCE OVERFLOW
004D8D 64   
004D8E 18     13864 JR	GETEX1
004D8F E4   
004D90 08     13865 GETEX2:         EX	AF,AF'		;RESTORE SIGN
004D91 FE     13866 CP	'-'
004D92 2D   
004D93 78     13867 LD	A,B
004D94 C1     13868 POP	BC		;RESTORE
004D95 C0     13869 RET	NZ
004D96 ED     13870 NEG			;NEGATE EXPONENT
004D97 44   
004D98 C9     13871 RET
004D99 DD     13884 NUMBIX:         INC	IX
004D9A 23   
004D9B CD     13885 NUMBERmat:         CALL	DIGITQ
004D9C BB   
004D9D 50   
004D9E D8     13886 RET	C
004D9F 04     13887 INC	B		;INCREMENT DIGIT COUNT
004DA0 DD     13888 INC	IX
004DA1 23   
004DA2 CD     13889 CALL	X10		;*10 & COPY OLD VALUE
004DA3 4E   
004DA4 4F   
004DA5 38     13890 JR	C,NUMB1		;OVERFLOW
004DA6 13   
004DA7 0D     13891 DEC	C		;SEE IF TRUNCATED
004DA8 0C     13892 INC	C
004DA9 20     13893 JR	NZ,NUMB1	;IMPORTANT!
004DAA 0F   
004DAB E6     13894 AND	0FH
004DAC 0F   
004DAD D9     13895 EXX
004DAE 06     13896 LD	B,0
004DAF 00   
004DB0 4F     13897 LD	C,A
004DB1 09     13898 ADD	HL,BC		;ADD IN DIGIT
004DB2 D9     13899 EXX
004DB3 30     13900 JR	NC,NUMBERmat
004DB4 E6   
004DB5 23     13901 INC	HL		;CARRY
004DB6 7C     13902 LD	A,H
004DB7 B5     13903 OR	L
004DB8 20     13904 JR	NZ,NUMBERmat
004DB9 E1   
004DBA 0C     13905 NUMB1:          INC	C		;TRUNCATION COUNTER
004DBB CD     13906 CALL	SWAP1		;RESTORE PREVIOUS VALUE
004DBC C1   
004DBD 4E   
004DBE 18     13907 JR	NUMBERmat
004DBF DB   
004DC0 08     13917 FIX:            EX	AF,AF'
004DC1 AF     13918 XOR	A
004DC2 08     13919 EX	AF,AF'
004DC3 CB     13920 SET	7,H		;IMPLIED 1
004DC4 FC   
004DC5 CD     13921 FIX1:           CALL	DIV2
004DC6 C6   
004DC7 4E   
004DC8 B9     13922 CP	C
004DC9 C8     13923 RET	Z
004DCA D2     13924 JP	NC,FIX1
004DCB C5   
004DCC 4D   
004DCD C3     13925 JP	OFLOW
004DCE D4   
004DCF 4E   
004DD0 CD     13935 FIX2:           CALL	SWAP
004DD1 BE   
004DD2 4E   
004DD3 CD     13936 CALL	SFIXmat
004DD4 D9   
004DD5 4D   
004DD6 CD     13937 CALL	SWAP
004DD7 BE   
004DD8 4E   
004DD9 0D     13938 SFIXmat:           DEC	C
004DDA 0C     13939 INC	C
004DDB C8     13940 RET	Z		;INTEGER/ZERO
004DDC CB     13941 BIT	7,H		;SIGN
004DDD 7C   
004DDE F5     13942 PUSH	AF
004DDF 3E     13943 LD	A,159
004DE0 9F   
004DE1 CD     13944 CALL	FIX
004DE2 C0   
004DE3 4D   
004DE4 F1     13945 POP	AF
004DE5 0E     13946 LD	C,0
004DE6 00   
004DE7 C8     13947 RET	Z
004DE8 B7     13948 NEGATE:         OR	A		;CLEAR CARRY
004DE9 D9     13949 EXX
004DEA D5     13950 NEG0:           PUSH	DE
004DEB EB     13951 EX	DE,HL
004DEC 21     13952 LD	HL,0
004DED 00   
004DEE 00   
004DEF ED     13953 SBC	HL,DE
004DF0 52   
004DF1 D1     13954 POP	DE
004DF2 D9     13955 EXX
004DF3 D5     13956 PUSH	DE
004DF4 EB     13957 EX	DE,HL
004DF5 21     13958 LD	HL,0
004DF6 00   
004DF7 00   
004DF8 ED     13959 SBC	HL,DE
004DF9 52   
004DFA D1     13960 POP	DE
004DFB C9     13961 RET
004DFC D9     13967 NEG:            EXX
004DFD 2F     13968 CPL
004DFE E5     13969 PUSH	HL
004DFF B7     13970 OR	A		;CLEAR CARRY
004E00 ED     13971 SBC	HL,HL
004E01 62   
004E02 ED     13972 SBC	HL,BC
004E03 42   
004E04 44     13973 LD	B,H
004E05 4D     13974 LD	C,L
004E06 E1     13975 POP	HL
004E07 18     13976 JR	NEG0
004E08 E1   
004E09 3E     13989 SCALE:          LD	A,150
004E0A 96   
004E0B B9     13990 CP	C
004E0C 3E     13991 LD	A,ACLOST
004E0D 17   
004E0E DA     13992 JP	C,ERROR_mat		;"Accuracy lost"
004E0F 08   
004E10 45   
004E11 CD     13993 CALL	PIBY4
004E12 F0   
004E13 49   
004E14 D9     13994 EXX
004E15 01     13995 LD	BC,2169H	;3.141592653589793238
004E16 69   
004E17 21   
004E18 D9     13996 EXX
004E19 CB     13997 MOD48:          SET	7,D		;IMPLIED 1
004E1A FA   
004E1B CB     13998 SET	7,H
004E1C FC   
004E1D 79     13999 LD	A,C
004E1E 0E     14000 LD	C,0		;INIT QUOTIENT
004E1F 00   
004E20 DD     14001 LD	IX,0
004E21 21   
004E22 00   
004E23 00   
004E24 DD     14002 PUSH	IX		;PUT ZERO ON STACK
004E25 E5   
004E26 B8     14003 CP	B
004E27 38     14004 JR	C,MOD485	;DIVIDEND<DIVISOR
004E28 3A   
004E29 D9     14005 MOD481:         EXX			;CARRY=0 HERE
004E2A E3     14006 EX	(SP),HL
004E2B ED     14007 SBC	HL,BC
004E2C 42   
004E2D E3     14008 EX	(SP),HL
004E2E ED     14009 SBC	HL,DE
004E2F 52   
004E30 D9     14010 EXX
004E31 ED     14011 SBC	HL,DE
004E32 52   
004E33 30     14012 JR	NC,MOD482	;DIVIDEND>=DIVISOR
004E34 09   
004E35 D9     14013 EXX
004E36 E3     14014 EX	(SP),HL
004E37 09     14015 ADD	HL,BC
004E38 E3     14016 EX	(SP),HL
004E39 ED     14017 ADC	HL,DE
004E3A 5A   
004E3B D9     14018 EXX
004E3C ED     14019 ADC	HL,DE
004E3D 5A   
004E3E 3F     14020 MOD482:         CCF
004E3F CB     14021 RL	C		;QUOTIENT
004E40 11   
004E41 30     14022 JR	NC,MOD483
004E42 02   
004E43 CB     14023 SET	7,C		;STICKY BIT
004E44 F9   
004E45 3D     14024 MOD483:         DEC	A
004E46 B8     14025 CP	B
004E47 38     14026 JR	C,MOD484	;DIVIDEND<DIVISOR
004E48 19   
004E49 E3     14027 EX	(SP),HL
004E4A 29     14028 ADD	HL,HL		;DIVIDEND * 2
004E4B E3     14029 EX	(SP),HL
004E4C D9     14030 EXX
004E4D ED     14031 ADC	HL,HL
004E4E 6A   
004E4F D9     14032 EXX
004E50 ED     14033 ADC	HL,HL
004E51 6A   
004E52 30     14034 JR	NC,MOD481	;AGAIN
004E53 D5   
004E54 B7     14035 OR	A
004E55 D9     14036 EXX
004E56 E3     14037 EX	(SP),HL
004E57 ED     14038 SBC	HL,BC		;OVERFLOW, SO SUBTRACT
004E58 42   
004E59 E3     14039 EX	(SP),HL
004E5A ED     14040 SBC	HL,DE
004E5B 52   
004E5C D9     14041 EXX
004E5D ED     14042 SBC	HL,DE
004E5E 52   
004E5F B7     14043 OR	A
004E60 18     14044 JR	MOD482
004E61 DC   
004E62 3C     14046 MOD484:         INC	A
004E63 59     14047 MOD485:         LD	E,C		;QUOTIENT
004E64 4F     14048 LD	C,A		;REMAINDER EXPONENT
004E65 D9     14049 EXX
004E66 C1     14050 POP	BC
004E67 D9     14051 EXX
004E68 CB     14052 FLO48:          BIT	7,H
004E69 7C   
004E6A C0     14053 RET	NZ
004E6B D9     14054 EXX
004E6C CB     14055 SLA	C
004E6D 21   
004E6E CB     14056 RL	B
004E6F 10   
004E70 ED     14057 ADC	HL,HL
004E71 6A   
004E72 D9     14058 EXX
004E73 ED     14059 ADC	HL,HL
004E74 6A   
004E75 0D     14060 DEC	C
004E76 C2     14061 JP	NZ,FLO48
004E77 68   
004E78 4E   
004E79 C9     14062 RET
004E7A CB     14068 FLOAT:          BIT	7,H
004E7B 7C   
004E7C C0     14069 RET	NZ
004E7D D9     14070 EXX			;SAME AS "X2"
004E7E 29     14071 ADD	HL,HL		;TIME-CRITICAL
004E7F D9     14072 EXX			;REGION
004E80 ED     14073 ADC	HL,HL		;(BENCHMARKS)
004E81 6A   
004E82 0D     14074 DEC	C
004E83 C2     14075 JP	NZ,FLOAT
004E84 7A   
004E85 4E   
004E86 C9     14076 RET
004E87 08     14083 FLOATA:         EX	AF,AF'
004E88 C6     14085 ADD	A,RTABLE-DTABLE/2
004E89 2E   
004E8A 08     14086 EX	AF,AF'
004E8B CD     14087 FLOAT2:         CALL	SWAP
004E8C BE   
004E8D 4E   
004E8E CD     14088 CALL	SFLOAT
004E8F 94   
004E90 4E   
004E91 CD     14089 CALL	SWAP
004E92 BE   
004E93 4E   
004E94 0D     14090 SFLOAT:         DEC	C
004E95 0C     14091 INC	C
004E96 C0     14092 RET	NZ		;ALREADY FLOATING-POINT
004E97 CD     14093 CALL	TESTmat
004E98 E3   
004E99 4E   
004E9A C8     14094 RET	Z		;ZERO
004E9B 7C     14095 LD	A,H
004E9C B7     14096 OR	A
004E9D FC     14097 CALL	M,NEGATE
004E9E E8   
004E9F 4D   
004EA0 0E     14098 LD	C,159
004EA1 9F   
004EA2 CD     14099 CALL	FLOAT
004EA3 7A   
004EA4 4E   
004EA5 B7     14100 OR	A
004EA6 F8     14101 RET	M		;NEGATIVE
004EA7 CB     14102 RES	7,H
004EA8 BC   
004EA9 C9     14103 RET
004EAA D9     14109 ADD1:           EXX
004EAB 01     14110 LD	BC,1
004EAC 01   
004EAD 00   
004EAE 09     14111 ADD	HL,BC
004EAF D9     14112 EXX
004EB0 D0     14113 RET	NC
004EB1 C5     14114 PUSH	BC
004EB2 01     14115 LD	BC,1
004EB3 01   
004EB4 00   
004EB5 09     14116 ADD	HL,BC
004EB6 C1     14117 POP	BC
004EB7 C9     14118 RET
004EB8 B7     14125 ODD:            OR	A		;CLEAR CARRY
004EB9 D9     14126 EXX
004EBA CB     14127 SET	0,L		;MAKE ODD
004EBB C5   
004EBC D9     14128 EXX
004EBD C9     14129 RET
004EBE 79     14137 SWAP:           LD	A,C
004EBF 48     14138 LD	C,B
004EC0 47     14139 LD	B,A
004EC1 EB     14140 SWAP1:          EX	DE,HL
004EC2 D9     14141 EXX
004EC3 EB     14142 EX	DE,HL
004EC4 D9     14143 EXX
004EC5 C9     14144 RET
004EC6 CD     14150 DIV2:           CALL	D2
004EC7 64   
004EC8 4F   
004EC9 D9     14151 EXX
004ECA CB     14152 RR	B
004ECB 18   
004ECC CB     14153 RR	C
004ECD 19   
004ECE 08     14154 EX	AF,AF'
004ECF B0     14155 OR	B
004ED0 08     14156 EX	AF,AF'
004ED1 D9     14157 EXX
004ED2 0C     14158 INCC:           INC	C
004ED3 C0     14159 RET	NZ
004ED4 3E     14160 OFLOW:          LD	A,TOOBIG
004ED5 14   
004ED6 C3     14161 JP	ERROR_mat		;"Too big"
004ED7 08   
004ED8 45   
004ED9 CD     14166 FTEST:          CALL	TESTmat
004EDA E3   
004EDB 4E   
004EDC C8     14167 RET	Z
004EDD 7C     14168 LD	A,H
004EDE E6     14169 AND	10000000B
004EDF 80   
004EE0 F6     14170 OR	01000000B
004EE1 40   
004EE2 C9     14171 RET
004EE3 7C     14177 TESTmat:           LD	A,H
004EE4 B5     14178 OR	L
004EE5 D9     14179 EXX
004EE6 B4     14180 OR	H
004EE7 B5     14181 OR	L
004EE8 D9     14182 EXX
004EE9 C9     14183 RET
004EEA 78     14188 FCOMP:          LD	A,B
004EEB B1     14189 OR	C		;Both integer?
004EEC 20     14190 JR	NZ,FCOMP1
004EED 0A   
004EEE CD     14191 CALL	ICP
004EEF 00   
004EF0 4F   
004EF1 3E     14192 FCOMP0:         LD	A,0
004EF2 00   
004EF3 C8     14193 RET	Z		;Equal
004EF4 3E     14194 LD	A,80H
004EF5 80   
004EF6 1F     14195 RRA
004EF7 C9     14196 RET
004EF8 CD     14198 FCOMP1:         CALL	FLOAT2		;Float both
004EF9 8B   
004EFA 4E   
004EFB CD     14199 CALL	FCP
004EFC 0D   
004EFD 4F   
004EFE 18     14200 JR	FCOMP0
004EFF F1   
004F00 CD     14210 ICP:            CALL	ICP1
004F01 2C   
004F02 4F   
004F03 3E     14211 ZEROmat:           LD	A,0
004F04 00   
004F05 D9     14212 EXX
004F06 67     14213 LD	H,A
004F07 6F     14214 LD	L,A
004F08 D9     14215 EXX
004F09 67     14216 LD	H,A
004F0A 6F     14217 LD	L,A
004F0B 4F     14218 LD	C,A
004F0C C9     14219 RET
004F0D CD     14221 FCP:            CALL	FCP1
004F0E 1F   
004F0F 4F   
004F10 18     14222 JR	ZEROmat		;PRESET FALSE
004F11 F1   
004F12 79     14224 FCP0:           LD	A,C
004F13 B8     14225 CP	B		;COMPARE EXPONENTS
004F14 C0     14226 RET	NZ
004F15 ED     14227 ICP0:           SBC	HL,DE		;COMP MANTISSA MSB
004F16 52   
004F17 19     14228 ADD	HL,DE
004F18 C0     14229 RET	NZ
004F19 D9     14230 EXX
004F1A ED     14231 SBC	HL,DE		;COMP MANTISSA LSB
004F1B 52   
004F1C 19     14232 ADD	HL,DE
004F1D D9     14233 EXX
004F1E C9     14234 RET
004F1F 7C     14236 FCP1:           LD	A,H
004F20 AA     14237 XOR	D
004F21 7C     14238 LD	A,H
004F22 17     14239 RLA
004F23 F8     14240 RET	M
004F24 30     14241 JR	NC,FCP0
004F25 EC   
004F26 CD     14242 CALL	FCP0
004F27 12   
004F28 4F   
004F29 C8     14243 RET	Z		;** V0.1 BUG FIX
004F2A 3F     14244 CCF
004F2B C9     14245 RET
004F2C 7C     14247 ICP1:           LD	A,H
004F2D AA     14248 XOR	D
004F2E F2     14249 JP	P,ICP0
004F2F 15   
004F30 4F   
004F31 7C     14250 LD	A,H
004F32 17     14251 RLA
004F33 C9     14252 RET
004F34 05     14258 X10B:           DEC	B
004F35 0C     14259 INC	C
004F36 CD     14260 X5:             CALL	COPY0
004F37 70   
004F38 4F   
004F39 CD     14261 CALL	D2C
004F3A 63   
004F3B 4F   
004F3C CD     14262 CALL	D2C
004F3D 63   
004F3E 4F   
004F3F 08     14263 EX	AF,AF'		;SAVE CARRY
004F40 D9     14264 ADD:            EXX
004F41 19     14265 ADD	HL,DE
004F42 D9     14266 EXX
004F43 ED     14267 ADC	HL,DE
004F44 5A   
004F45 C9     14268 RET
004F46 D9     14274 SUB:            EXX
004F47 B7     14275 OR	A
004F48 ED     14276 SBC	HL,DE
004F49 52   
004F4A D9     14277 EXX
004F4B ED     14278 SBC	HL,DE
004F4C 52   
004F4D C9     14279 RET
004F4E CD     14292 X10:            CALL	COPY0		;DED'E'=HLH'L'
004F4F 70   
004F50 4F   
004F51 CD     14293 CALL	X2
004F52 5D   
004F53 4F   
004F54 D8     14294 RET	C		;TOO BIG
004F55 CD     14295 CALL	X2
004F56 5D   
004F57 4F   
004F58 D8     14296 RET	C
004F59 CD     14297 CALL	ADD
004F5A 40   
004F5B 4F   
004F5C D8     14298 RET	C
004F5D D9     14299 X2:             EXX
004F5E 29     14300 ADD	HL,HL
004F5F D9     14301 EXX
004F60 ED     14302 ADC	HL,HL
004F61 6A   
004F62 C9     14303 RET
004F63 0C     14309 D2C:            INC	C
004F64 CB     14310 D2:             SRL	H
004F65 3C   
004F66 CB     14311 RR	L
004F67 1D   
004F68 D9     14312 EXX
004F69 CB     14313 RR	H
004F6A 1C   
004F6B CB     14314 RR	L
004F6C 1D   
004F6D D9     14315 EXX
004F6E C9     14316 RET
004F6F 41     14321 COPY:           LD	B,C
004F70 54     14322 COPY0:          LD	D,H
004F71 5D     14323 LD	E,L
004F72 D9     14324 EXX
004F73 54     14325 LD	D,H
004F74 5D     14326 LD	E,L
004F75 D9     14327 EXX
004F76 C9     14328 RET
004F77 CD     14334 SQUARE:         CALL	COPY
004F78 6F   
004F79 4F   
004F7A CD     14335 CALL	FMUL
004F7B EF   
004F7C 46   
004F7D DD     14336 PUSH5:          POP	IX		;RETURN ADDRESS
004F7E E1   
004F7F C5     14337 PUSH	BC
004F80 E5     14338 PUSH	HL
004F81 D9     14339 EXX
004F82 E5     14340 PUSH	HL
004F83 D9     14341 EXX
004F84 DD     14342 JP	(IX)		;"RETURN"
004F85 E9   
004F86 DD     14347 POP5:           POP	IX		;RETURN ADDRESS
004F87 E1   
004F88 D9     14348 EXX
004F89 D1     14349 POP	DE
004F8A D9     14350 EXX
004F8B D1     14351 POP	DE
004F8C 79     14352 LD	A,C
004F8D C1     14353 POP	BC
004F8E 41     14354 LD	B,C
004F8F 4F     14355 LD	C,A
004F90 DD     14356 JP	(IX)		;"RETURN"
004F91 E9   
004F92 CD     14363 RATIO:          CALL	PUSH5		;SAVE X
004F93 7D   
004F94 4F   
004F95 CD     14364 CALL	DONE
004F96 E5   
004F97 49   
004F98 CD     14365 CALL	FADD
004F99 27   
004F9A 46   
004F9B CD     14366 CALL	POP5		;RESTORE X
004F9C 86   
004F9D 4F   
004F9E CD     14367 CALL	PUSH5		;SAVE X+1
004F9F 7D   
004FA0 4F   
004FA1 CD     14368 CALL	SWAP
004FA2 BE   
004FA3 4E   
004FA4 CD     14369 CALL	DONE
004FA5 E5   
004FA6 49   
004FA7 CD     14370 CALL	FSUB
004FA8 11   
004FA9 46   
004FAA CD     14371 CALL	POP5		;RESTORE X+1
004FAB 86   
004FAC 4F   
004FAD C3     14372 JP	FDIV
004FAE 7F   
004FAF 46   
004FB0 DD     14383 POLY:           LD	IX,2
004FB1 21   
004FB2 02   
004FB3 00   
004FB4 DD     14384 ADD	IX,SP
004FB5 39   
004FB6 DD     14385 EX	(SP),IX
004FB7 E3   
004FB8 CD     14386 CALL	DLOAD5		;FIRST COEFFICIENT
004FB9 D3   
004FBA 19   
004FBB CD     14387 POLY1:          CALL	FMUL
004FBC EF   
004FBD 46   
004FBE 11     14388 LD	DE,5
004FBF 05   
004FC0 00   
004FC1 DD     14389 ADD	IX,DE
004FC2 19   
004FC3 CD     14390 CALL	DLOAD5		;NEXT COEFFICIENT
004FC4 D3   
004FC5 19   
004FC6 DD     14391 EX	(SP),IX
004FC7 E3   
004FC8 04     14392 INC	B
004FC9 05     14393 DEC	B		;TEST
004FCA FA     14394 JP	M,FADD
004FCB 27   
004FCC 46   
004FCD CD     14395 CALL	FADD
004FCE 27   
004FCF 46   
004FD0 CD     14396 CALL	DLOAD5		;X
004FD1 D3   
004FD2 19   
004FD3 DD     14397 EX	(SP),IX
004FD4 E3   
004FD5 18     14398 JR	POLY1
004FD6 E4   
004FD7 3C     14407 POWR10:         INC	A
004FD8 08     14408 EX	AF,AF'
004FD9 E5     14409 PUSH	HL
004FDA D9     14410 EXX
004FDB E5     14411 PUSH	HL
004FDC D9     14412 EXX
004FDD CD     14413 CALL	DONE
004FDE E5   
004FDF 49   
004FE0 CD     14414 CALL	SWAP
004FE1 BE   
004FE2 4E   
004FE3 AF     14415 XOR	A
004FE4 08     14416 POWR11:         EX	AF,AF'
004FE5 3D     14417 DEC	A
004FE6 28     14418 JR	Z,POWR14	;EXITmat TYPE 1
004FE7 20   
004FE8 F2     14419 JP	P,POWR13
004FE9 EF   
004FEA 4F   
004FEB B9     14420 CP	C
004FEC 38     14421 JR	C,POWR14	;EXITmat TYPE 2
004FED 1A   
004FEE 3C     14422 INC	A
004FEF 08     14423 POWR13:         EX	AF,AF'
004FF0 3C     14424 INC	A
004FF1 CB     14425 SET	7,H
004FF2 FC   
004FF3 CD     14426 CALL	X5
004FF4 36   
004FF5 4F   
004FF6 30     14427 JR	NC,POWR12
004FF7 05   
004FF8 08     14428 EX	AF,AF'
004FF9 CD     14429 CALL	D2C
004FFA 63   
004FFB 4F   
004FFC 08     14430 EX	AF,AF'
004FFD 08     14431 POWR12:         EX	AF,AF'
004FFE DC     14432 CALL	C,ADD1		;ROUND UP
004FFF AA   
005000 4E   
005001 0C     14433 INC	C
005002 FA     14434 JP	M,POWR11
005003 E4   
005004 4F   
005005 C3     14435 JP	OFLOW
005006 D4   
005007 4E   
005008 CD     14436 POWR14:         CALL	SWAP
005009 BE   
00500A 4E   
00500B CB     14437 RES	7,D
00500C BA   
00500D D9     14438 EXX
00500E E1     14439 POP	HL
00500F D9     14440 EXX
005010 E1     14441 POP	HL
005011 08     14442 EX	AF,AF'
005012 C9     14443 RET
005013 B7     14451 DIVA:           OR	A		;CLEAR CARRY
005014 ED     14452 DIV0:           SBC	HL,BC		;DIVIDEND-DIVISOR
005015 42   
005016 D9     14453 EXX
005017 ED     14454 SBC	HL,BC
005018 42   
005019 D9     14455 EXX
00501A 30     14456 JR	NC,DIV1
00501B 05   
00501C 09     14457 ADD	HL,BC		;DIVIDEND+DIVISOR
00501D D9     14458 EXX
00501E ED     14459 ADC	HL,BC
00501F 4A   
005020 D9     14460 EXX
005021 3F     14461 DIV1:           CCF
005022 CB     14462 DIVC:           RL	E		;SHIFT RESULT INTO DE
005023 13   
005024 CB     14463 RL	D
005025 12   
005026 D9     14464 EXX
005027 CB     14465 RL	E
005028 13   
005029 CB     14466 RL	D
00502A 12   
00502B D9     14467 EXX
00502C 3C     14468 INC	A
00502D F0     14469 RET	P
00502E ED     14470 DIVB:           ADC	HL,HL		;DIVIDEND*2
00502F 6A   
005030 D9     14471 EXX
005031 ED     14472 ADC	HL,HL
005032 6A   
005033 D9     14473 EXX
005034 30     14474 JR	NC,DIV0
005035 DE   
005036 B7     14475 OR	A
005037 ED     14476 SBC	HL,BC		;DIVIDEND-DIVISOR
005038 42   
005039 D9     14477 EXX
00503A ED     14478 SBC	HL,BC
00503B 42   
00503C D9     14479 EXX
00503D 37     14480 SCF
00503E C3     14481 JP	DIVC
00503F 22   
005040 50   
005041 B7     14489 MULA:           OR	A		;CLEAR CARRY
005042 D9     14490 MUL0:           EXX
005043 CB     14491 RR	D		;MULTIPLIER/2
005044 1A   
005045 CB     14492 RR	E
005046 1B   
005047 D9     14493 EXX
005048 CB     14494 RR	D
005049 1A   
00504A CB     14495 RR	E
00504B 1B   
00504C 30     14496 JR	NC,MUL1
00504D 05   
00504E 09     14497 ADD	HL,BC		;ADD IN MULTIPLICAND
00504F D9     14498 EXX
005050 ED     14499 ADC	HL,BC
005051 4A   
005052 D9     14500 EXX
005053 3C     14501 MUL1:           INC	A
005054 F0     14502 RET	P
005055 D9     14503 MULB:           EXX
005056 CB     14504 RR	H		;PRODUCT/2
005057 1C   
005058 CB     14505 RR	L
005059 1D   
00505A D9     14506 EXX
00505B CB     14507 RR	H
00505C 1C   
00505D CB     14508 RR	L
00505E 1D   
00505F C3     14509 JP	MUL0
005060 42   
005061 50   
005062 ED     14517 SQR1:           SBC	HL,BC
005063 42   
005064 D9     14518 EXX
005065 ED     14519 SBC	HL,BC
005066 42   
005067 D9     14520 EXX
005068 0C     14521 INC	C
005069 30     14522 JR	NC,SQR2
00506A 07   
00506B 0D     14523 DEC	C
00506C 09     14524 ADD	HL,BC
00506D D9     14525 EXX
00506E ED     14526 ADC	HL,BC
00506F 4A   
005070 D9     14527 EXX
005071 0D     14528 DEC	C
005072 3C     14529 SQR2:           INC	A
005073 F0     14530 RET	P
005074 CB     14531 SQRA:           SLA	C
005075 21   
005076 CB     14532 RL	B
005077 10   
005078 0C     14533 INC	C
005079 D9     14534 EXX
00507A CB     14535 RL	C
00507B 11   
00507C CB     14536 RL	B
00507D 10   
00507E CD     14537 CALL	SLA8
00507F AA   
005080 50   
005081 CD     14538 CALL	SLA8
005082 AA   
005083 50   
005084 D9     14539 EXX
005085 D2     14540 JP	NC,SQR1
005086 62   
005087 50   
005088 B7     14541 SQR3:           OR	A
005089 ED     14542 SBC	HL,BC
00508A 42   
00508B D9     14543 EXX
00508C ED     14544 SBC	HL,BC
00508D 42   
00508E D9     14545 EXX
00508F 0C     14546 INC	C
005090 C3     14547 JP	SQR2
005091 72   
005092 50   
005093 29     14549 SQRB:           ADD	HL,HL
005094 D9     14550 EXX
005095 ED     14551 ADC	HL,HL
005096 6A   
005097 D9     14552 EXX
005098 38     14553 JR	C,SQR3
005099 EE   
00509A 3C     14554 INC	A
00509B 0C     14555 INC	C
00509C ED     14556 SBC	HL,BC
00509D 42   
00509E D9     14557 EXX
00509F ED     14558 SBC	HL,BC
0050A0 42   
0050A1 D9     14559 EXX
0050A2 D0     14560 RET	NC
0050A3 09     14561 ADD	HL,BC
0050A4 D9     14562 EXX
0050A5 ED     14563 ADC	HL,BC
0050A6 4A   
0050A7 D9     14564 EXX
0050A8 0D     14565 DEC	C
0050A9 C9     14566 RET
0050AA D9     14568 SLA8:           EXX
0050AB CB     14569 SLA	E
0050AC 23   
0050AD CB     14570 RL	D
0050AE 12   
0050AF D9     14571 EXX
0050B0 CB     14572 RL	E
0050B1 13   
0050B2 CB     14573 RL	D
0050B3 12   
0050B4 D9     14574 EXX
0050B5 ED     14575 ADC	HL,HL
0050B6 6A   
0050B7 D9     14576 EXX
0050B8 ED     14577 ADC	HL,HL
0050B9 6A   
0050BA C9     14578 RET
0050BB DD     14580 DIGITQ:         LD	A,(IX)
0050BC 7E   
0050BD 00   
0050BE FE     14581 CP	'9'+1
0050BF 3A   
0050C0 3F     14582 CCF
0050C1 D8     14583 RET	C
0050C2 FE     14584 CP	'0'
0050C3 30   
0050C4 C9     14585 RET
0050C5 DD     14587 SIGNQ:          LD	A,(IX)
0050C6 7E   
0050C7 00   
0050C8 DD     14588 INC	IX
0050C9 23   
0050CA FE     14589 CP	' '
0050CB 20   
0050CC 28     14590 JR	Z,SIGNQ
0050CD F7   
0050CE FE     14591 CP	'+'
0050CF 2B   
0050D0 C8     14592 RET	Z
0050D1 FE     14593 CP	'-'
0050D2 2D   
0050D3 C8     14594 RET	Z
0050D4 DD     14595 DEC	IX
0050D5 2B   
0050D6 C9     14596 RET
0050D7 08     14598 ABS2:           EX	AF,AF'
0050D8 CB     14599 BIT	7,H
0050D9 7C   
0050DA C4     14600 CALL	NZ,NEGATE	;MAKE ARGUMENTS +VE
0050DB E8   
0050DC 4D   
0050DD CD     14601 CALL	SWAP
0050DE BE   
0050DF 4E   
0050E0 CB     14602 BIT	7,H
0050E1 7C   
0050E2 C4     14603 CALL	NZ,NEGATE
0050E3 E8   
0050E4 4D   
0050E5 44     14604 LD	B,H
0050E6 4D     14605 LD	C,L
0050E7 21     14606 LD	HL,0
0050E8 00   
0050E9 00   
0050EA D9     14607 EXX
0050EB 44     14608 LD	B,H
0050EC 4D     14609 LD	C,L
0050ED 21     14610 LD	HL,0
0050EE 00   
0050EF 00   
0050F0 C9     14611 RET
0050F1             14616   ; --- Begin data.asm ---
0050F1 FF   
0050F2 FF   
0050F3 FF   
0050F4 FF   
0050F5 FF   
0050F6 FF   
0050F7 FF   
0050F8 FF   
0050F9 FF   
0050FA FF   
0050FB FF   
0050FC FF   
0050FD FF   
0050FE FF   
0050FF FF   
005100 FF   
005101 FF   
005102 FF   
005103 FF   
005104 FF   
005105 FF   
005106 FF   
005107 FF   
005108 FF   
005109 FF   
00510A FF   
00510B FF   
00510C FF   
00510D FF   
00510E FF   
00510F FF   
005110 FF   
005111 FF   
005112 FF   
005113 FF   
005114 FF   
005115 FF   
005116 FF   
005117 FF   
005118 FF     14648 ALIGN 256
005119 FF   
00511A FF   
00511B FF   
00511C FF   
00511D FF   
00511E FF   
00511F FF   
005120 FF   
005121 FF   
005122 FF   
005123 FF   
005124 FF   
005125 FF   
005126 FF   
005127 FF   
005128 FF   
005129 FF   
00512A FF   
00512B FF   
00512C FF   
00512D FF   
00512E FF   
00512F FF   
005130 FF   
005131 FF   
005132 FF   
005133 FF   
005134 FF   
005135 FF   
005136 FF   
005137 FF   
005138 FF   
005139 FF   
00513A FF   
00513B FF   
00513C FF   
00513D FF   
00513E FF   
00513F FF   
005140 FF   
005141 FF   
005142 FF   
005143 FF   
005144 FF   
005145 FF   
005146 FF   
005147 FF   
005148 FF   
005149 FF   
00514A FF   
00514B FF   
00514C FF   
00514D FF   
00514E FF   
00514F FF   
005150 FF   
005151 FF   
005152 FF   
005153 FF   
005154 FF   
005155 FF   
005156 FF   
005157 FF   
005158 FF   
005159 FF   
00515A FF   
00515B FF   
00515C FF   
00515D FF   
00515E FF   
00515F FF   
005160 FF   
005161 FF   
005162 FF   
005163 FF   
005164 FF   
005165 FF   
005166 FF   
005167 FF   
005168 FF   
005169 FF   
00516A FF   
00516B FF   
00516C FF   
00516D FF   
00516E FF   
00516F FF   
005170 FF   
005171 FF   
005172 FF   
005173 FF   
005174 FF   
005175 FF   
005176 FF   
005177 FF   
005178 FF   
005179 FF   
00517A FF   
00517B FF   
00517C FF   
00517D FF   
00517E FF   
00517F FF   
005180 FF   
005181 FF   
005182 FF   
005183 FF   
005184 FF   
005185 FF   
005186 FF   
005187 FF   
005188 FF   
005189 FF   
00518A FF   
00518B FF   
00518C FF   
00518D FF   
00518E FF   
00518F FF   
005190 FF   
005191 FF   
005192 FF   
005193 FF   
005194 FF   
005195 FF   
005196 FF   
005197 FF   
005198 FF   
005199 FF   
00519A FF   
00519B FF   
00519C FF   
00519D FF   
00519E FF   
00519F FF   
0051A0 FF   
0051A1 FF   
0051A2 FF   
0051A3 FF   
0051A4 FF   
0051A5 FF   
0051A6 FF   
0051A7 FF   
0051A8 FF   
0051A9 FF   
0051AA FF   
0051AB FF   
0051AC FF   
0051AD FF   
0051AE FF   
0051AF FF   
0051B0 FF   
0051B1 FF   
0051B2 FF   
0051B3 FF   
0051B4 FF   
0051B5 FF   
0051B6 FF   
0051B7 FF   
0051B8 FF   
0051B9 FF   
0051BA FF   
0051BB FF   
0051BC FF   
0051BD FF   
0051BE FF   
0051BF FF   
0051C0 FF   
0051C1 FF   
0051C2 FF   
0051C3 FF   
0051C4 FF   
0051C5 FF   
0051C6 FF   
0051C7 FF   
0051C8 FF   
0051C9 FF   
0051CA FF   
0051CB FF   
0051CC FF   
0051CD FF   
0051CE FF   
0051CF FF   
0051D0 FF   
0051D1 FF   
0051D2 FF   
0051D3 FF   
0051D4 FF   
0051D5 FF   
0051D6 FF   
0051D7 FF   
0051D8 FF   
0051D9 FF   
0051DA FF   
0051DB FF   
0051DC FF   
0051DD FF   
0051DE FF   
0051DF FF   
0051E0 FF   
0051E1 FF   
0051E2 FF   
0051E3 FF   
0051E4 FF   
0051E5 FF   
0051E6 FF   
0051E7 FF   
0051E8 FF   
0051E9 FF   
0051EA FF   
0051EB FF   
0051EC FF   
0051ED FF   
0051EE FF   
0051EF FF   
0051F0 FF   
0051F1 FF   
0051F2 FF   
0051F3 FF   
0051F4 FF   
0051F5 FF   
0051F6 FF   
0051F7 FF   
0051F8 FF   
0051F9 FF   
0051FA FF   
0051FB FF   
0051FC FF   
0051FD FF   
0051FE FF   
0051FF FF   
